<!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.jpg?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.jpg?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="nginx,"><meta name="description" content="Â¶ä¸€ã€ç®€ä»‹Nginx æ˜¯ä¸€æ¬¾æ˜¯ç”±ä¿„ç½—æ–¯çš„ç¨‹åºè®¾è®¡å¸ˆIgor Sysoevæ‰€å¼€å‘é«˜æ€§èƒ½çš„ Web å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª IMAP&#x2F;POP3&#x2F;SMTP ä»£ç†æœåŠ¡å™¨ã€‚å®˜æ–¹å¼€æºç‰ˆå®˜ç½‘ï¼šhttps:&#x2F;&#x2F;nginx.orgæ–‡æ¡£ï¼šhttps:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docså®˜æ–¹å•†ä¸šç‰ˆå®˜ç½‘ï¼šhttps:&#x2F;&#x2F;www.nginx.comä¸­æ–‡å®˜ç½‘ï¼šhttps:&#x2F;&#x2F;www.nginx-cn.netNGINX"><meta property="og:type" content="article"><meta property="og:title" content="nginxå­¦ä¹ ç¬”è®°"><meta property="og:url" content="https://www.qcmoke.cn/devops/nginx.html"><meta property="og:site_name" content="Qcmoke&#39;s Blog"><meta property="og:description" content="Â¶ä¸€ã€ç®€ä»‹Nginx æ˜¯ä¸€æ¬¾æ˜¯ç”±ä¿„ç½—æ–¯çš„ç¨‹åºè®¾è®¡å¸ˆIgor Sysoevæ‰€å¼€å‘é«˜æ€§èƒ½çš„ Web å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª IMAP&#x2F;POP3&#x2F;SMTP ä»£ç†æœåŠ¡å™¨ã€‚å®˜æ–¹å¼€æºç‰ˆå®˜ç½‘ï¼šhttps:&#x2F;&#x2F;nginx.orgæ–‡æ¡£ï¼šhttps:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docså®˜æ–¹å•†ä¸šç‰ˆå®˜ç½‘ï¼šhttps:&#x2F;&#x2F;www.nginx.comä¸­æ–‡å®˜ç½‘ï¼šhttps:&#x2F;&#x2F;www.nginx-cn.netNGINX"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="article:published_time" content="2019-04-29T05:18:03.000Z"><meta property="article:modified_time" content="2024-07-20T20:04:07.754Z"><meta property="article:author" content="Qcmoke"><meta property="article:tag" content="nginx"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.qcmoke.cn/images/loading-post.gif"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"hide",offset:12,b2t:!1,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"åšä¸»"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://www.qcmoke.cn/devops/nginx.html"><title>nginxå­¦ä¹ ç¬”è®° | Qcmoke's Blog</title><meta name="generator" content="Hexo 4.2.1"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Qcmoke's Blog</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Peace & Love ! Learning to think independently !</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>é¦–é¡µ</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>åˆ†ç±»</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>æ ‡ç­¾</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>å½’æ¡£</a></li><li class="menu-item menu-item-çƒ­æ–‡"><a href="/top/" rel="section"><i class="menu-item-icon fa fa-fw fa-fire"></i><br>çƒ­æ–‡</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="menu-item-icon fa fa-fw fa-link"></i><br>å‹é“¾</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>å…³äº</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>æœç´¢</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="æœç´¢..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.qcmoke.cn/devops/nginx.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Qcmoke"><meta itemprop="description" content=""><meta itemprop="image" content="/images/logo.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Qcmoke's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">nginxå­¦ä¹ ç¬”è®°</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-04-29T13:18:03+08:00">2019-04-29 </time><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">æ›´æ–°äº&#58;</span> <time title="æ›´æ–°äº" itemprop="dateModified" datetime="2024-07-21T04:04:07+08:00">2024-07-21 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">åˆ†ç±»äº</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span> </a></span></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/devops/nginx.html#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/devops/nginx.html" itemprop="commentCount"></span> </a></span><span id="/devops/nginx.html" class="leancloud_visitors" data-flag-title="nginxå­¦ä¹ ç¬”è®°"><span class="post-meta-divider">|</span> <span class="lv-inline-block" style="display:inline-block"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span> <span class="leancloud-visitors-count"></span></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span> <span title="å­—æ•°ç»Ÿè®¡">11.6k </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span> <span title="é˜…è¯»æ—¶é•¿">47</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="ä¸€-ç®€ä»‹"><a class="header-anchor" href="#ä¸€-ç®€ä»‹">Â¶</a>ä¸€ã€ç®€ä»‹</h2><p>Nginx æ˜¯ä¸€æ¬¾æ˜¯ç”±ä¿„ç½—æ–¯çš„ç¨‹åºè®¾è®¡å¸ˆIgor Sysoevæ‰€å¼€å‘é«˜æ€§èƒ½çš„ Web å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª IMAP/POP3/SMTP ä»£ç†æœåŠ¡å™¨ã€‚</p><ul><li>å®˜æ–¹å¼€æºç‰ˆ<ul><li>å®˜ç½‘ï¼š<a href="https://nginx.org" target="_blank" rel="noopener">https://nginx.org</a></li><li>æ–‡æ¡£ï¼š<a href="https://nginx.org/en/docs" target="_blank" rel="noopener">https://nginx.org/en/docs</a></li></ul></li><li>å®˜æ–¹å•†ä¸šç‰ˆ<ul><li>å®˜ç½‘ï¼š<a href="https://www.nginx.com" target="_blank" rel="noopener">https://www.nginx.com</a></li><li>ä¸­æ–‡å®˜ç½‘ï¼š<a href="https://www.nginx-cn.net" target="_blank" rel="noopener">https://www.nginx-cn.net</a></li><li>NGINX Plus æ–‡æ¡£ï¼š<a href="https://docs.nginx.com/nginx" target="_blank" rel="noopener">https://docs.nginx.com/nginx</a></li></ul></li></ul><p>åœ¨é«˜è¿æ¥å¹¶å‘çš„æƒ…å†µä¸‹ï¼ŒNginx æ˜¯ Apache æœåŠ¡å™¨ä¸é”™çš„æ›¿ä»£å“ã€‚</p><h2 id="äºŒ-åœ¨çº¿åŒ…ç®¡ç†å™¨å®‰è£…nginx"><a class="header-anchor" href="#äºŒ-åœ¨çº¿åŒ…ç®¡ç†å™¨å®‰è£…nginx">Â¶</a>äºŒã€åœ¨çº¿åŒ…ç®¡ç†å™¨å®‰è£…nginx</h2><h3 id="1-aptå®‰è£…nginx"><a class="header-anchor" href="#1-aptå®‰è£…nginx">Â¶</a>1. aptå®‰è£…nginx</h3><h4 id="1-å®‰è£…nginx"><a class="header-anchor" href="#1-å®‰è£…nginx">Â¶</a>ï¼ˆ1ï¼‰å®‰è£…nginx</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install -y nginx</span><br><span class="line"><span class="comment">#æŸ¥çœ‹Nginxçš„æ˜¾å¼ç¼–è¯‘å‚æ•°</span></span><br><span class="line">nginx -V</span><br></pre></td></tr></table></figure><h4 id="3-å¸è½½nginx"><a class="header-anchor" href="#3-å¸è½½nginx">Â¶</a>ï¼ˆ3ï¼‰å¸è½½nginx</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop nginx</span><br><span class="line">apt purge -y nginx nginx-common</span><br><span class="line"><span class="comment">#å¸è½½ç³»ç»Ÿä¸­æ‰€æœ‰ä¸å†éœ€è¦çš„ä¾èµ–åŒ…</span></span><br><span class="line">apt autoremove -y</span><br><span class="line"><span class="comment">#åˆ é™¤å·²ä¸‹è½½çš„è½¯ä»¶åŒ…æ–‡ä»¶çš„ç¼“å­˜</span></span><br><span class="line">apt clean</span><br><span class="line"><span class="comment">#åˆ é™¤nginxé…ç½®æ–‡ä»¶ï¼ˆå¦‚éœ€è¦ï¼‰</span></span><br><span class="line">rm -rf /etc/nginx/</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœç”±äº Nginx å¸è½½ä¸å¹²å‡€å¯¼è‡´å‡ºç°é‡è£…å¤±è´¥çš„é—®é¢˜ï¼Œè§£å†³å¯å‚è€ƒï¼š<a href="https://www.cnblogs.com/alter888/p/9478022.html" target="_blank" rel="noopener">https://www.cnblogs.com/alter888/p/9478022.html</a></p></blockquote><h3 id="2-yumå®‰è£…nginx"><a class="header-anchor" href="#2-yumå®‰è£…nginx">Â¶</a>2. yumå®‰è£…nginx</h3><h4 id="1-è®¾ç½®nginxå®˜æ–¹yumæº-å¯é€‰"><a class="header-anchor" href="#1-è®¾ç½®nginxå®˜æ–¹yumæº-å¯é€‰">Â¶</a>ï¼ˆ1ï¼‰è®¾ç½®nginxå®˜æ–¹yumæºï¼ˆå¯é€‰ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">yum install yum-utils</span><br><span class="line">cat &gt; /etc/yum.repos.d/nginx.repo &lt;&lt; <span class="string">'EOF'</span></span><br><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line"></span><br><span class="line">[nginx-mainline]</span><br><span class="line">name=nginx mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><blockquote><p>è®¾ç½® nginx å®˜æ–¹ yum æºä»¥èƒ½å¤Ÿä½¿ç”¨æœ€æ–°ç‰ˆæœ¬</p></blockquote><h4 id="2-å®‰è£…nginx"><a class="header-anchor" href="#2-å®‰è£…nginx">Â¶</a>ï¼ˆ2ï¼‰å®‰è£…nginx</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nginx</span><br></pre></td></tr></table></figure><h4 id="3-æŸ¥çœ‹nginxå®‰è£…ä¿¡æ¯"><a class="header-anchor" href="#3-æŸ¥çœ‹nginxå®‰è£…ä¿¡æ¯">Â¶</a>ï¼ˆ3ï¼‰æŸ¥çœ‹nginxå®‰è£…ä¿¡æ¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹å·²ç»å®‰è£…nginxåŒ…ï¼ˆå¦‚ï¼šnginx-1.16.0-1.el7.ngx.x86_64ï¼‰</span></span><br><span class="line">rpm -q nginx</span><br><span class="line"><span class="comment">#æŸ¥çœ‹nginxç‰ˆæœ¬ï¼ˆå¦‚ï¼šnginx version: nginx/1.16.0ï¼‰</span></span><br><span class="line">nginx -v</span><br><span class="line"><span class="comment">#æŸ¥çœ‹yumå®‰è£…nginxçš„ç›®å½•</span></span><br><span class="line">rpm -ql nginx</span><br><span class="line"><span class="comment">#æŸ¥çœ‹Nginxçš„æ˜¾å¼ç¼–è¯‘å‚æ•°</span></span><br><span class="line">nginx -V</span><br></pre></td></tr></table></figure><h4 id="4-å¸è½½nginx"><a class="header-anchor" href="#4-å¸è½½nginx">Â¶</a>ï¼ˆ4ï¼‰å¸è½½nginx</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop nginx</span><br><span class="line">yum remove -y nginx</span><br><span class="line"><span class="comment">#å¸è½½ç³»ç»Ÿä¸­æ‰€æœ‰ä¸å†éœ€è¦çš„ä¾èµ–åŒ…</span></span><br><span class="line">yum autoremove -y</span><br><span class="line"><span class="comment">#åˆ é™¤nginxé…ç½®æ–‡ä»¶ï¼ˆå¦‚éœ€è¦ï¼‰</span></span><br><span class="line">rm -rf /etc/nginx/</span><br></pre></td></tr></table></figure><h3 id="3-åœ¨çº¿åŒ…ç®¡ç†å™¨å®‰è£…nginxè·¯å¾„"><a class="header-anchor" href="#3-åœ¨çº¿åŒ…ç®¡ç†å™¨å®‰è£…nginxè·¯å¾„">Â¶</a>3. åœ¨çº¿åŒ…ç®¡ç†å™¨å®‰è£…nginxè·¯å¾„</h3><blockquote><p>å®‰è£…nginxçš„ç›®å½•å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Nginxä¸»é…ç½®æ–‡ä»¶</span><br><span class="line">&#x2F;etc&#x2F;nginx                         </span><br><span class="line">&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br><span class="line">&#x2F;etc&#x2F;nginx&#x2F;conf.d </span><br><span class="line">&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf</span><br><span class="line">   </span><br><span class="line">Cgiã€Fastcgiã€Uwcgié…ç½®æ–‡ä»¶</span><br><span class="line">&#x2F;etc&#x2F;nginx&#x2F;fastcgi_params</span><br><span class="line">&#x2F;etc&#x2F;nginx&#x2F;scgi_params</span><br><span class="line">&#x2F;etc&#x2F;nginx&#x2F;uwsgi_params</span><br><span class="line">   </span><br><span class="line">Nginxç¼–ç è½¬æ¢æ˜ å°„é…ç½®æ–‡ä»¶</span><br><span class="line">&#x2F;etc&#x2F;nginx&#x2F;win-utf</span><br><span class="line">&#x2F;etc&#x2F;nginx&#x2F;koi-utf</span><br><span class="line">&#x2F;etc&#x2F;nginx&#x2F;koi-win</span><br><span class="line">   </span><br><span class="line">httpåè®®çš„Content-Typeä¸æ‰©å±•åé…ç½®æ–‡ä»¶</span><br><span class="line">&#x2F;etc&#x2F;nginx&#x2F;mime.types</span><br><span class="line"></span><br><span class="line">ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ç®¡ç†å™¨é…ç½®æ–‡ä»¶</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service</span><br><span class="line"></span><br><span class="line">Nginxâ½‡å¿—è½®è¯¢,â½‡å¿—åˆ‡å‰²é…ç½®æ–‡ä»¶</span><br><span class="line">&#x2F;etc&#x2F;logrotate.d&#x2F;nginx</span><br><span class="line"></span><br><span class="line">Nginxç»ˆç«¯ç®¡ç†å‘½ä»¤</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;nginx</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;nginx-debug</span><br><span class="line">   </span><br><span class="line">Nginxæ¨¡å—â½¬å½•</span><br><span class="line">&#x2F;etc&#x2F;nginx&#x2F;modules</span><br><span class="line">&#x2F;usr&#x2F;lib64&#x2F;nginx</span><br><span class="line">&#x2F;usr&#x2F;lib64&#x2F;nginx&#x2F;modules</span><br><span class="line">   </span><br><span class="line">Nginxé»˜è®¤ç«™ç‚¹â½¬å½•</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</span><br><span class="line"></span><br><span class="line">#Nginxçš„ç¼“å­˜â½¬å½•</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;doc&#x2F;nginx-1.12.2</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;man&#x2F;man8&#x2F;nginx.8.gz</span><br><span class="line"></span><br><span class="line">Nginxçš„â½‡å¿—â½¬å½•</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;nginx</span><br></pre></td></tr></table></figure><p>yumå®‰è£…nginxçš„ç¼–è¯‘å‚æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ç¨‹åºå®‰è£…â½¬å½•å’Œè·¯å¾„</span><br><span class="line">--prefix&#x3D;&#x2F;etc&#x2F;nginx</span><br><span class="line">--sbin-path&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx</span><br><span class="line">--modules-path&#x3D;&#x2F;usr&#x2F;lib64&#x2F;nginx&#x2F;modules</span><br><span class="line">--conf-path&#x3D;&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br><span class="line">--error-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log</span><br><span class="line">--http-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</span><br><span class="line">--pid-path&#x3D;&#x2F;var&#x2F;run&#x2F;nginx.pid</span><br><span class="line">--lock-path&#x3D;&#x2F;var&#x2F;run&#x2F;nginx.lock</span><br><span class="line">   </span><br><span class="line">ä¸´æ—¶ç¼“å­˜â½‚ä»¶</span><br><span class="line">--http-client-body-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;client_temp</span><br><span class="line">--http-proxy-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;proxy_temp</span><br><span class="line">--http-fastcgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;fastcgi_temp</span><br><span class="line">--http-uwsgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;uwsgi_temp</span><br><span class="line">--http-scgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;scgi_temp</span><br><span class="line"></span><br><span class="line">è®¾å®šNginxè¿›ç¨‹å¯åŠ¨â½¤æˆ·å’Œç»„(å®‰å…¨)</span><br><span class="line">--user&#x3D;nginx</span><br><span class="line">--group&#x3D;nginx</span><br><span class="line"></span><br><span class="line">è®¾ç½®é¢å¤–çš„å‚æ•°å°†è¢«æ·»åŠ åˆ°CFLAGSå˜é‡</span><br><span class="line">--with-cc-opt</span><br><span class="line"></span><br><span class="line">è®¾ç½®é™„åŠ çš„å‚æ•°, é“¾æ¥ç³»ç»Ÿåº“</span><br><span class="line">--with-ld-opt</span><br></pre></td></tr></table></figure></blockquote><h2 id="äºŒ-æºç ç¼–è¯‘å®‰è£…nginx"><a class="header-anchor" href="#äºŒ-æºç ç¼–è¯‘å®‰è£…nginx">Â¶</a>äºŒã€æºç ç¼–è¯‘å®‰è£…nginx</h2><p>å®˜æ–¹ä¸‹è½½åœ°å€ï¼š<a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">http://nginx.org/en/download.html</a></p><p>ç‰ˆæœ¬å·æ˜¯åŒæ•°çš„æ˜¯ç¨³å®šç‰ˆï¼Œè€Œå•æ•°åˆ™æ˜¯å¼€å‘ç‰ˆã€‚</p><p>ä»¥ä¸‹ä»¥ç¼–è¯‘å®‰è£…æ¥è®²è¿°ã€‚ä¸ºä»€ä¹ˆé€‰æ‹©ç¼–è¯‘å®‰è£…è€Œä¸é€‰æ‹©yumæˆ–è€…aptåŒ…ç®¡ç†å™¨å®‰è£…å‘¢ï¼Ÿå› ä¸ºyumæˆ–è€…aptå®‰è£…çš„æ˜¯å·²ç»ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œå·²ç»ç¼–è¯‘å¥½å°±è¯´æ˜æ‰©å±•æ¨¡å—å·²ç»å›ºå®šï¼Œå¾ˆéš¾å»æ·»åŠ æˆ–è€…ä¿®æ”¹è‡ªå®šä¹‰çš„æ‰©å±•æ¨¡å—ï¼Œè¿™é‡Œé€‰æ‹©ç¼–è¯‘å®‰è£…å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yumå®‰è£…nginxç¼–è¯‘ä¾èµ–</span></span><br><span class="line">yum install -y gcc gcc-c++ zlib  gd-devel zlib-devel openssl   openssl-devel pcre-devel make </span><br><span class="line"></span><br><span class="line"><span class="comment">#aptå®‰è£…nginxç¼–è¯‘ä¾èµ–</span></span><br><span class="line"><span class="comment"># apt install -y gcc make build-essential zlib1g-dev libpcre3-dev libssl-dev</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸‹è½½nginxæºç åŒ…</span></span><br><span class="line">wget http://nginx.org/download/nginx-1.18.0.tar.gz</span><br><span class="line"><span class="comment">#è§£å‹nginxæºç åŒ…</span></span><br><span class="line">tar zxvf nginx-1.18.0.tar.gz</span><br><span class="line"><span class="comment">#è®¾ç½®vimç¼–è¾‘nginxé…ç½®æ–‡ä»¶è¯­æ³•é«˜äº®ï¼ˆå¯é€‰ï¼Œå¦‚æœä¸æƒ³ç”¨äº†ç›´æ¥åˆ é™¤~/.vim/ç›®å½•å³å¯ï¼‰</span></span><br><span class="line">mkdir ~/.vim &amp;&amp; cp -r  nginx-1.18.0/contrib/vim/* ~/.vim/</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿›å…¥è§£å‹å¥½çš„nginxæºç ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> nginx-1.18.0</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”Ÿæˆnginxçš„ç¼–è¯‘é…ç½®æ–‡ä»¶MakeFile</span></span><br><span class="line">./configure \</span><br><span class="line">--prefix=/opt/nginx \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_v2_module \</span><br><span class="line">--with-http_sub_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--with-http_stub_status_module</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ ¹æ®MakeFileç¼–è¯‘nginx</span></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®‰è£…nginx</span></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¸è½½nginxï¼ˆå¦‚éœ€è¦ï¼‰</span></span><br><span class="line">rm -rf /opt/nginx</span><br><span class="line"><span class="comment">#å¦‚æœMakeFileé‡Œæœ‰uninstallç›®æ ‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡make uninstallè¿›è¡Œå¸è½½</span></span><br><span class="line"><span class="comment">#make uninstall</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¸…é™¤ç¼–è¯‘ç”Ÿæˆæ–‡ä»¶ï¼ˆå¦‚éœ€è¦ï¼ŒåŒ…æ‹¬ç”Ÿæˆçš„MakeFileã€äºŒè¿›åˆ¶æ–‡ä»¶ç­‰ï¼‰</span></span><br><span class="line">make clean</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ é™¤è§£å‹nginxæºç ç›®å½•å’Œnginxå®‰è£…åŒ…ï¼ˆå¦‚éœ€è¦ï¼‰</span></span><br><span class="line"><span class="built_in">cd</span> .. &amp;&amp; rm -rf nginx-1.18.0 &amp;&amp; rm -f nginx-1.18.0.tar.gz</span><br></pre></td></tr></table></figure><blockquote><p>ğŸ’â€â™‚ nginx å®‰è£…ç›®å½•ç»“æ„è¯´æ˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt;/opt/nginx</span><br><span class="line">&gt;â”œâ”€â”€ conf   <span class="comment">#å­˜æ”¾é…ç½®æ–‡ä»¶</span></span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ fastcgi.conf</span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ fastcgi.conf.default</span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ fastcgi_params</span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ fastcgi_params.default</span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ koi-utf</span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ koi-win</span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ mime.types</span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ mime.types.default</span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ nginx.conf</span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ nginx.conf.default</span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ scgi_params</span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ scgi_params.default</span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ uwsgi_params</span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ uwsgi_params.default</span><br><span class="line">&gt;â”‚Â Â  â””â”€â”€ win-utf</span><br><span class="line">&gt;â”œâ”€â”€ html    <span class="comment">#webåŸºç¡€æ ¹ç›®å½•</span></span><br><span class="line">&gt;â”‚Â Â  â”œâ”€â”€ 50xhtml</span><br><span class="line">&gt;â”‚Â Â  â””â”€â”€ index.html</span><br><span class="line">&gt;â”œâ”€â”€ logs    <span class="comment">#æ—¥å¿—æ–‡ä»¶ç›®å½•</span></span><br><span class="line">&gt;â””â”€â”€ sbin    <span class="comment">#æ‰§è¡Œè„šæœ¬ç›®å½•</span></span><br><span class="line">   â””â”€â”€ nginx</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ğŸ’â€â™‚ å¸¸ç”¨ç¼–è¯‘å‚æ•°è¯´æ˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;--prefix=ç»å¯¹è·¯å¾„	<span class="comment">#å®šä¹‰nginxå®‰è£…ç›®å½•ã€‚é»˜è®¤ä¸º/usr/local/nginxç›®å½•ã€‚æ³¨æ„ï¼šè¿™ä¸ªç›®æ ‡çš„è®¾ç½®ä¼šå½±å“å…¶ä»–å‚æ•°ä¸­çš„ç›¸å¯¹è·¯å¾„ç›®å½•ã€‚ï¼ˆä¾‹å¦‚ï¼š--sbin-path==sbin/nginx,é‚£ä¹ˆå®é™…ä¸Šå¯æ‰§è¡Œæ–‡ä»¶nginxçš„å®‰è£…å­˜æ”¾è·¯å¾„ä¸º/opt/nginx/sbin/nginxã€‚ï¼‰</span></span><br><span class="line">&gt;--sbin-path=path	<span class="comment">#è®¾ç½®nginxå¯æ‰§è¡Œæ–‡ä»¶çš„å®‰è£…å­˜æ”¾è·¯å¾„ã€‚é»˜è®¤ä¸º&lt;prefix&gt;/sbin/nginxã€‚</span></span><br><span class="line">&gt;--conf-path=path	<span class="comment">#è®¾ç½®nginx.confé…ç½®æ–‡ä»¶çš„å®‰è£…å­˜æ”¾è·¯å¾„ã€‚é»˜è®¤ä¸º&lt;prefix&gt;/confç›®å½•ã€‚</span></span><br><span class="line">&gt;--pid-path=path 	<span class="comment">#è®¾ç½®å°†å­˜å‚¨ä¸»è¿›ç¨‹çš„è¿›ç¨‹IDçš„nginx.pidæ–‡ä»¶çš„è·¯å¾„ã€‚é»˜è®¤&lt;prefix&gt;/logs/nginx.pid</span></span><br><span class="line">&gt;--error-log-path=path	<span class="comment">#è®¾ç½®errorè­¦å‘Šå’Œè¯Šæ–­æ—¥å¿—è·¯å¾„ã€‚é»˜è®¤&lt;prefix&gt;/logs/error.log</span></span><br><span class="line">&gt;--http-log-path=path	<span class="comment">#è®¾ç½®æ¯ä¸ªHTTPè¯·æ±‚å®Œæˆçš„è®°å½•æ—¥å¿—è·¯å¾„ã€‚é»˜è®¤&lt;prefix&gt;/logs/access.log</span></span><br><span class="line">&gt;--user=ç”¨æˆ·å 	<span class="comment">#æŒ‡å®šNginx workerè¿›ç¨‹è¿è¡Œæ—¶æ‰€å±çš„ç”¨æˆ·ã€‚é»˜è®¤ä¸ºï¼šnobodyã€‚</span></span><br><span class="line">&gt;--group=ç”¨æˆ·ç»„ <span class="comment">#æŒ‡å®šNginx workerè¿›ç¨‹è¿è¡Œæ—¶æ‰€å±çš„ç”¨æˆ·ç»„ã€‚é»˜è®¤ä¸ºï¼šnobodyã€‚</span></span><br><span class="line">&gt;--with-pcre	<span class="comment">#å…è®¸ç”¨æˆ·ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ¨¡å¼åŒ¹é…å’Œæ–‡æœ¬å¤„ç†ã€‚ï¼ˆé»˜è®¤å¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-threads	<span class="comment">#å¯ç”¨ Nginx çš„çº¿ç¨‹æ± åŠŸèƒ½ã€‚ï¼ˆé»˜è®¤å¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-poll_module <span class="comment">#å¯ç”¨pollå¤šè·¯å¤ç”¨å™¨æ¨¡å—ï¼Œç”¨äºå¤„ç†ç½‘ç»œäº‹ä»¶çš„å¤šè·¯å¤ç”¨ã€‚ï¼ˆé»˜è®¤å¯ç”¨ï¼Œå¦‚æœä¸æ˜¾å¼æŒ‡å®šè¿™--with-select_moduleæˆ–--with-poll_moduleä¸­çš„ä»»ä½•ä¸€ä¸ªï¼ŒNginx é»˜è®¤ä¼šä½¿ç”¨ --with-poll_moduleï¼‰</span></span><br><span class="line">&gt;--with-select_module	<span class="comment">#å¯ç”¨selectå¤šè·¯å¤ç”¨å™¨æ¨¡å—ã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-file-aio <span class="comment">#å¯ç”¨æ–‡ä»¶å¼‚æ­¥ioæ”¯æŒã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-ipv6	<span class="comment">#å¯ç”¨å¯¹IPv6çš„æ”¯æŒã€‚ï¼ˆé»˜è®¤å¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-http_upstream_module <span class="comment">#å¯ç”¨åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼Œç”±ngx_http_upstream_moduleæ¨¡å—æ”¯æŒï¼ˆé»˜è®¤å¯ç”¨ï¼‰</span></span><br><span class="line"></span><br><span class="line">&gt;--with-http_ssl_module	<span class="comment">#å¯ç”¨æ„å»ºå°†HTTPSåè®®æ”¯æŒæ·»åŠ åˆ°HTTPæœåŠ¡å™¨çš„æ¨¡å—çš„åŠŸèƒ½ã€‚éœ€è¦OpenSSLåº“æ¥æ„å»ºå’Œè¿è¡Œæ­¤æ¨¡å—ã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-http_gzip_static_module <span class="comment">#ç”¨äºé¢„å‹ç¼©é™æ€æ–‡ä»¶ï¼Œä»è€Œæé«˜ç½‘ç«™çš„æ€§èƒ½ã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-http_gunzip_module <span class="comment">#ç”¨äºåœ¨ Nginx ä¸­è§£å‹ç¼©ç»è¿‡å‹ç¼©çš„ HTTP å“åº”ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯å¯ä»¥æ­£å¸¸æ¥æ”¶å“åº”ã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-http_sub_module <span class="comment">#ç”¨äºåœ¨å“åº”å†…å®¹ä¸­æ‰§è¡Œå­—ç¬¦ä¸²æ›¿æ¢æ“ä½œï¼Œå¸¸ç”¨äºä¿®æ”¹ HTMLã€CSSã€JavaScript ç­‰å“åº”å†…å®¹ã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-http_realip_module <span class="comment">#ç”¨äºæ›¿æ¢å®¢æˆ·ç«¯ IP åœ°å€ï¼Œä»¥è§£å†³åå‘ä»£ç†ä¸­çš„ IP åœ°å€ä¼ªè£…é—®é¢˜ã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-http_image_filter_module <span class="comment">#æä¾›äº†åœ¨ HTTP è¯·æ±‚ä¸­å¤„ç†å›¾åƒçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ç¼©æ”¾ã€è£å‰ªã€æ—‹è½¬ã€åè½¬ç­‰åŠŸèƒ½ã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-http_mp4_module <span class="comment">#æä¾›äº†å¤„ç† MP4 æ–‡ä»¶çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬åˆ‡å‰²ã€æ‹¼æ¥ã€ç¼–ç ç­‰ã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-mail	<span class="comment">#å®‰è£…é‚®ä»¶æœåŠ¡å™¨åå‘ä»£ç†æ¨¡å—ï¼Œä½¿nginxå¯ä»¥åå‘ä»£ç†IMAPã€POP3ã€SMTPç­‰åè®®ã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-mail_ssl_module	<span class="comment">#ä½¿IMAPã€POP3ã€SMTPç­‰åè®®æ”¯æŒSSL/TLSåè®®åŠ å¯†ä¼ è¾“æ”¯æŒã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-http_v2_module <span class="comment">#æ˜¯ç”¨äºå¯ç”¨ HTTP/2 æ¨¡å—çš„é€‰é¡¹ã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</span></span><br><span class="line">&gt;--with-http_stub_status_module <span class="comment">#æä¾›äº†ä¸€ä¸ªç®€å•çš„çŠ¶æ€é¡µé¢ï¼Œç”¨äºç›‘æ§ Nginx æœåŠ¡å™¨çš„è¿è¡ŒçŠ¶æ€ã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³å¼ºåˆ¶ç¦ç”¨æŸä¸ªæ¨¡å—ï¼Œåªéœ€è¦å°†<code>--with</code>æ”¹æˆ<code>--without</code>ã€‚æ¯”å¦‚ç¦ç”¨selectå¤šè·¯å¤ç”¨å™¨æ¨¡å—ï¼Œåˆ™å‚æ•°ä¸ºï¼š<code>--without-select_module</code></p></blockquote><h2 id="ä¸‰-nginxå¸¸ç”¨å‘½ä»¤"><a class="header-anchor" href="#ä¸‰-nginxå¸¸ç”¨å‘½ä»¤">Â¶</a>ä¸‰ã€nginxå¸¸ç”¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯åŠ¨</span></span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢</span></span><br><span class="line">nginx -s stop <span class="comment">#ç«‹å³åœæ­¢æœåŠ¡ï¼ˆæŸ¥å‡ºnginxè¿›ç¨‹idåç›´æ¥å¼ºåˆ¶killæ€æ‰è¿›ç¨‹ï¼‰</span></span><br><span class="line">nginx -s quit <span class="comment">#å®‰å…¨åœ°åœæ­¢æœåŠ¡ï¼ˆç­‰å¾…æ‰€æœ‰è¯·æ±‚å¤„ç†å®Œæˆå†åœæ­¢æœåŠ¡ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡æ–°åŠ è½½é…ç½®ï¼ˆé‡æ–°åŠ è½½é…ç½®è€Œæ— éœ€åœæ­¢æˆ–é‡å¯æœåŠ¡ï¼‰</span></span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æµ‹é…ç½®æ–‡ä»¶æ­£ç¡®æ€§</span></span><br><span class="line">nginx  -t</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹nginxçš„ã€æ˜¾å¼ã€‘ç¼–è¯‘å‚æ•°</span></span><br><span class="line">nginx -V</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹nginxæ˜¯å¦åœ¨è¿è¡Œ</span></span><br><span class="line">ps aux | grep nginx</span><br></pre></td></tr></table></figure><blockquote><p>å…³äº<code>nginx -V</code>æŸ¥çœ‹ç¼–è¯‘å‚æ•°çš„è¯´æ˜ï¼š</p><p>æ³¨æ„æ‰§è¡Œ<code>nginx -V</code>åªæ˜¯åˆ—å‡ºåœ¨ç¼–è¯‘æ—¶æ‰§è¡Œ<code>./configure</code>çš„æ˜¾å¼è®¾ç½®å‚æ•°ï¼Œè€Œä¸ä»£è¡¨çœŸå®ç¼–è¯‘è¿›nginxçš„é…ç½®ï¼Œæ¯”å¦‚æœ‰å¾ˆå¤šçš„ç¼–è¯‘å‚æ•°æ˜¯é»˜è®¤å¯ç”¨çš„ï¼Œç¼–è¯‘æ—¶ä¹Ÿè¢«ç¼–è¯‘è¿›nginxäº†ï¼Œä½†æ˜¯é€šè¿‡<code>nginx -V</code>å‘½ä»¤å´ä¸èƒ½çœ‹åˆ°å¯¹åº”çš„å‚æ•°ã€‚å¦‚åœ¨æ‰§è¡Œ<code>./configure</code>æ—¶å³ä½¿æ²¡æœ‰æ˜¾å¼åœ°è®¾ç½®<code>--with-pcre</code>è¿™ä¸ªç¼–è¯‘å‚æ•°ï¼Œä½†æ˜¯ç¼–è¯‘å¥½çš„nginxè¿˜æ˜¯èƒ½å¤Ÿä½¿ç”¨æ­£åˆ™åŒ¹é…åŠŸèƒ½ã€‚</p></blockquote><h2 id="äº”-nginxå†…ç½®å˜é‡"><a class="header-anchor" href="#äº”-nginxå†…ç½®å˜é‡">Â¶</a>äº”ã€nginxå†…ç½®å˜é‡</h2><p>httpæ ¸â¼¼æ¨¡å—çš„å†…ç½®å˜é‡</p><blockquote><p>httpè¯·æ±‚å˜é‡<br>Nginxå†…ç½®å˜é‡<br>â¾ƒå®šä¹‰å˜é‡</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uri</span>: å½“å‰è¯·æ±‚çš„uriï¼Œä¸å¸¦å‚æ•°</span><br><span class="line"><span class="variable">$request_uri</span>: å®¢æˆ·ç«¯è¯·æ±‚çš„uriï¼Œå¸¦å®Œæ•´å‚æ•°</span><br><span class="line"><span class="variable">$host</span>: å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­Hostå­—æ®µé™¤å»ç«¯å£å·çš„éƒ¨åˆ†ã€‚å¯ç”¨äºè·å–è¯·æ±‚çš„åŸŸåä¿¡æ¯ï¼Œå¦‚æœhostâ¾¸éƒ¨ä¸ºç©ºåˆ™<span class="variable">$host</span>ç­‰ä»·</span><br><span class="line"><span class="variable">$http_host</span>: å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­Hostçš„å®Œæ•´å­—æ®µï¼ˆå¦‚æœ‰å®¢æˆ·ç«¯è¯·æ±‚å¤´Hostä¸­æœ‰ç«¯å£åˆ™<span class="variable">$http_host</span>åŒ…å«ç«¯å£ï¼‰</span><br><span class="line"><span class="variable">$proxy_host</span>ï¼šæŒ‡proxy_passä¸­è®¾ç½®çš„hostå€¼ï¼ˆå¯¹äºç«¯å£ï¼Œé»˜è®¤80ä¸åŒ…å«ï¼Œå…¶ä»–ç«¯å£åŒ…å«ï¼‰</span><br><span class="line"><span class="variable">$remote_addr</span>: å®¢æˆ·ç«¯IPï¼ˆå¦‚æœåªç»è¿‡ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œåˆ™å¯ä»¥è¡¨ç¤ºå®¢æˆ·ç«¯çš„çœŸå®IPï¼Œä½†å¦‚æœç»è¿‡å¤šä¸ªä»£ç†æœåŠ¡å™¨ï¼Œåˆ™åªèƒ½è¡¨ç¤ºæœ€åä»£ç†æœåŠ¡å™¨çš„IPï¼‰</span><br><span class="line"><span class="variable">$remote_port</span>: å®¢æˆ·ç«¯è¯·æ±‚çš„ç«¯å£ï¼ˆå®¢æˆ·ç«¯é€šå¸¸ä¼šä½¿ç”¨éšæœºçš„åŠ¨æ€ç«¯å£æ¥å‘èµ·è¯·æ±‚ï¼‰</span><br><span class="line"><span class="variable">$remote_user</span>: å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚æ—¶çš„ HTTP è®¤è¯ç”¨æˆ·å</span><br><span class="line"><span class="variable">$request_filename</span>: å®¢æˆ·ç«¯è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„</span><br><span class="line"><span class="variable">$request_method</span>: æ±‚â½…æ³•,	GET	POST	PUT</span><br><span class="line"><span class="variable">$server_addr</span>: å‰æœåŠ¡å™¨çš„ IP åœ°å€</span><br><span class="line"><span class="variable">$server_name</span>: æœåŠ¡å™¨é…ç½®çš„åŸŸåã€‚å¯ç”¨äºè·å–å½“å‰æœåŠ¡å™¨å—ï¼ˆserver blockï¼‰çš„é…ç½®çš„åŸŸåä¿¡æ¯ï¼ˆå¦‚æœåœ¨é…ç½®ä¸­ä½¿ç”¨äº†å¤šä¸ª server_name å£°æ˜ï¼Œ<span class="variable">$server_name</span> å°†ä¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…æˆåŠŸçš„åŸŸåã€‚ï¼‰</span><br><span class="line"><span class="variable">$server_port</span>: æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£</span><br><span class="line"><span class="variable">$server_protocol</span>: nginxæœåŠ¡å™¨ä½¿ç”¨çš„åè®®ç‰ˆæœ¬,	å¦‚http/1.1	http/1.0</span><br><span class="line"><span class="variable">$scheme</span>ï¼šå®¢æˆ·ç«¯è¯·æ±‚çš„åè®®æ–¹æ¡ˆï¼Œå¦‚ï¼šhttp æˆ– https ç­‰</span><br><span class="line"><span class="variable">$document_root</span>:	å½“å‰è¯·æ±‚æ˜ å°„åˆ°çš„rooté…ç½®</span><br><span class="line"><span class="variable">$hostname</span>: nginxæ‰€åœ¨çš„æœåŠ¡å™¨çš„ä¸»æœºå</span><br></pre></td></tr></table></figure><h2 id="å…­-è‡ªå®šä¹‰nginxé…ç½®æ–‡ä»¶"><a class="header-anchor" href="#å…­-è‡ªå®šä¹‰nginxé…ç½®æ–‡ä»¶">Â¶</a>å…­ã€è‡ªå®šä¹‰nginxé…ç½®æ–‡ä»¶</h2><p>åªéœ€åœ¨ nginx ä¸»é…ç½®æ–‡ä»¶ <code>nginx.conf</code> çš„ <code>http</code> èŠ‚ç‚¹ä¸­å¯¼å…¥ <code>conf/conf.d</code> ç›®å½•ï¼ˆå¦‚æœæ²¡æœ‰è‡ªè¡Œåˆ›å»ºè¯¥ç›®å½•ï¼‰çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ï¼Œå³å¯åœ¨ <code>conf/conf.d</code> ç›®å½•ä¸‹è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span> mime.types;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span> <span class="number">65</span>;</span><br><span class="line">    <span class="comment">#ä»¥ä¸Šä¸ºå…¶ä»–æ— å…³é…ç½®...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">### æ·»åŠ è¿™è¡Œä»£ç  ###</span></span><br><span class="line">    <span class="attribute">include</span> conf.d/<span class="regexp">*.conf</span>; <span class="comment">#nginxåŠ è½½ä¸»é…ç½®æ–‡ä»¶çš„æ—¶å€™è‡ªåŠ¨å¯¼å…¥conf.dç›®å½•ä¸‹çš„æ‰€æœ‰è‡ªå®šä¹‰é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#ä»¥ä¸‹ä¸ºå…¶ä»–æ— å…³é…ç½®...</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸ƒ-é…ç½®httpæœåŠ¡"><a class="header-anchor" href="#ä¸ƒ-é…ç½®httpæœåŠ¡">Â¶</a>ä¸ƒã€é…ç½®httpæœåŠ¡</h2><p>ï¼ˆ1ï¼‰åˆ›å»ºnginxé…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/nginx/conf/conf.d/http.conf</span><br></pre></td></tr></table></figure><p>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ç¬¬ä¸€ä¸ªè™šæ‹Ÿä¸»æœºé…ç½®(é™æ€èµ„æºæœåŠ¡å™¨)</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="comment">#server_name example.com;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span> /opt/nginx/html; <span class="comment">#é…ç½®webæ ¹ç›®å½•</span></span><br><span class="line">        <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#å›¾ç‰‡èµ„æº</span></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ .*\.(jpg|png|gif)$</span> &#123;</span><br><span class="line">        <span class="attribute">root</span> /opt/nginx/html;</span><br><span class="line">        <span class="attribute">gzip</span>	<span class="literal">on</span>;	<span class="comment">#ä¼ è¾“å‹ç¼©ï¼Œå‹ç¼©æœ¬èº«æ¯”è¾ƒè€—è´¹æœåŠ¡ç«¯æ€§èƒ½ï¼Œä½†ç»™å¸¦å®½å¸¦æ¥æ›´å¥½çš„ä¼ è¾“ã€‚æ°å½“çš„ä½¿ç”¨ä¼šå¢å¼ºèµ„æºçš„è®¿é—®æ•ˆç‡ã€‚</span></span><br><span class="line">        <span class="attribute">gzip_http_version</span>	<span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">gzip_comp_level</span>	<span class="number">2</span>;</span><br><span class="line">        <span class="attribute">gzip_types</span> gzip_types text/plain application/json application/x-javascript application/css application/xml application/xml+rss text/javascript application/x-httpd-php image/jpeg image/gif image/png;	<span class="comment">#å‹ç¼©çš„æ–‡ä»¶ç±»å‹ï¼Œä¸€èˆ¬æŒ‰éœ€é€‰æ‹©ï¼Œä½†è¿™é‡Œä¸ºäº†æœªæ¥æ–¹ä¾¿æ·»åŠ æ–‡ä»¶ç±»å‹å¤šé€‰ä¸€äº›ã€‚å…·ä½“é…ç½®å‚è€ƒæ–‡ä»¶/etc/nginx/mime.types</span></span><br><span class="line">        <span class="attribute">expires</span> <span class="number">1h</span>;	<span class="comment">#è®¾ç½®é™æ€èµ„æºæ–‡ä»¶åœ¨å®¢æˆ·ç«¯çš„ç¼“å­˜æ—¶é—´ï¼Œé™¤éå®¢æˆ·æ¸…æ¥šç¼“å­˜æˆ–è€…å…³é—­ç¼“å­˜æˆ–è€…å¼ºåˆ¶è®¿é—®æ‰ä¼šå†è®¿é—®ã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#æ–‡ä»¶ä¸‹è½½</span></span><br><span class="line">    <span class="attribute">location</span> /download &#123;</span><br><span class="line">        <span class="attribute">root</span> /opt/nginx/html; <span class="comment">#è®¿é—® http://localhost:8080/download/test.txt æ—¶ä¼šä¸‹è½½ /opt/nginx/html/test.txt è·¯å¾„çš„æ–‡ä»¶</span></span><br><span class="line">        <span class="attribute">charset</span> utf-<span class="number">8</span>,gbk;	<span class="comment">#è§£å†³ç›®å½•æˆ–è€…æ–‡ä»¶æ˜¾ç¤ºä¸­æ–‡ä¹±ç çš„é—®é¢˜</span></span><br><span class="line">        <span class="attribute">autoindex</span> <span class="literal">on</span>;	<span class="comment">#è‡ªåŠ¨æ˜¾ç¤ºèµ„æºè·¯å¾„çš„æ–‡ä»¶åç§°ï¼Œä»¥æ­¤æ¥å¼€å¯ç«™ç‚¹ä¸‹è½½ã€‚é»˜è®¤ä¸ºå…³é—­ã€‚</span></span><br><span class="line">        <span class="attribute">autoindex_localtime</span> <span class="literal">on</span>;	<span class="comment">#æ˜¾ç¤ºçš„â½‚æ–‡ä»¶æ—¶é—´ä¸ºæ–‡ä»¶çš„æœåŠ¡å™¨æ—¶é—´ã€‚é»˜è®¤ä¸ºoffï¼Œæ˜¾ç¤ºçš„æ–‡ä»¶æ—¶é—´ä¸ºGMTæ—¶é—´</span></span><br><span class="line">        <span class="attribute">autoindex_exact_size</span> <span class="literal">off</span>;	<span class="comment">#é»˜è®¤ä¸ºonï¼Œ æ˜¾ç¤ºå‡ºæ–‡ä»¶çš„ç¡®åˆ‡â¼¤å¤§å°ï¼Œå•ä½æ˜¯bytes;ä¿®æ”¹ä¸ºoffï¼Œæ˜¾ç¤ºå‡ºæ–‡ä»¶çš„â¼¤å¤§æ¦‚å¤§å°ï¼Œå•ä½æ˜¯kBæˆ–è€…MBæˆ–è€…GBã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## ç¬¬äºŒä¸ªè™šæ‹Ÿä¸»æœºé…ç½®</span></span><br><span class="line"><span class="comment"># server &#123;</span></span><br><span class="line"><span class="comment">#     listen	8081;</span></span><br><span class="line"><span class="comment">#     server_name	localhost;	#ä¸»æœºåï¼Œä¸€èˆ¬ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªåŸŸåæˆ–è€…ip</span></span><br><span class="line"><span class="comment">#     location / &#123;</span></span><br><span class="line"><span class="comment">#         root	/opt/nginx/html;</span></span><br><span class="line"><span class="comment">#         index	index.html index.htm;</span></span><br><span class="line"><span class="comment">#     &#125;</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰é…ç½®é˜²ç«å¢™å’Œé‡è½½ nginx é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é˜²ç«å¢™å¼€æ”¾ç›¸å…³ç›‘å¬ç«¯å£</span></span><br><span class="line">firewall-cmd --permanent --add-port=8080/tcp</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡è½½é…ç½®</span></span><br><span class="line">/opt/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰æµ‹è¯•</p><blockquote><p>è®¾æœåŠ¡å™¨ IP åœ°å€ä¸ºï¼š<code>198.23.188.200</code>ï¼Œåˆ™è®¿é—®åœ°å€ï¼š<a href="http://198.23.188.200:8080" target="_blank" rel="noopener">http://198.23.188.200:8080</a></p></blockquote><h2 id="å…«-é…ç½®åå‘ä»£ç†"><a class="header-anchor" href="#å…«-é…ç½®åå‘ä»£ç†">Â¶</a>å…«ã€é…ç½®åå‘ä»£ç†</h2><blockquote><p>åå‘ä»£ç†ï¼šå³å°†å®¢æˆ·ç«¯å¯¹æœ¬æœºçš„è®¿é—®è¯·æ±‚ä»£ç†è½¬å‘åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚åœ¨åå‘ä»£ç†ä¸­å¯ä»¥æŒ‰éœ€æ±‚é…ç½®å°†è¯·æ±‚è½¬å‘åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ï¼Œå¦‚æœæ˜¯å¤šä¸ªæœåŠ¡å™¨åˆ™å¯å®ç°è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½æ•ˆæœã€‚</p></blockquote><h3 id="1-åå‘ä»£ç†å¸¸ç”¨æŒ‡ä»¤"><a class="header-anchor" href="#1-åå‘ä»£ç†å¸¸ç”¨æŒ‡ä»¤">Â¶</a>1. åå‘ä»£ç†å¸¸ç”¨æŒ‡ä»¤</h3><blockquote><p>ä»£ç†è¯·æ±‚å¸¸ç”¨æŒ‡ä»¤ï¼š</p><ul><li><p><code>proxy_pass</code>: æŒ‡å®šåå‘ä»£ç†çš„ç›®æ ‡æœåŠ¡å™¨åœ°å€ã€‚ä¾‹å¦‚ï¼š<code>proxy_pass http://backend_server;</code></p></li><li><p><code>proxy_set_header</code>: è®¾ç½®ä¼ é€’ç»™åç«¯æœåŠ¡å™¨çš„è¯·æ±‚å¤´ä¿¡æ¯ï¼ˆåªæœ‰ç›®æ ‡æœåŠ¡å™¨éœ€è¦è§£æè¿™äº›è¯·æ±‚å¤´æ—¶æ‰æœ‰å¿…è¦é…ç½®ï¼Œå¦åˆ™å¯ä»¥ä¸é…ç½®ï¼‰ã€‚å¸¸è§çš„è¯·æ±‚å¤´è®¾ç½®é…ç½®å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_set_header</span> <span class="string">"Connection"</span> <span class="string">""</span>; <span class="comment">#åˆ é™¤Connectionè¯·æ±‚å¤´</span></span><br><span class="line"><span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>; <span class="comment">#è®¾ç½®è¯·æ±‚å¤´æŒ‡å®šä»£ç†è¯·æ±‚æ—¶çš„Hostå¤´ï¼Œ$hostè¡¨ç¤ºä½¿ç”¨å®¢æˆ·ç«¯çš„Hostï¼ˆä¸åŒ…å«ç«¯å£ï¼‰ä½œä¸ºä»£ç†è¯·æ±‚çš„Host</span></span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>; <span class="comment">#è®¾ç½®è¯·æ±‚å¤´æŒ‡å®šå®¢æˆ·ç«¯çœŸå®IPï¼Œ$remote_addrè¡¨ç¤ºå®¢æˆ·ç«¯çš„IPï¼ˆå¦‚æœåªç»è¿‡ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œåˆ™å¯ä»¥è¡¨ç¤ºå®¢æˆ·ç«¯çš„çœŸå®IPï¼Œä½†å¦‚æœç»è¿‡å¤šä¸ªä»£ç†æœåŠ¡å™¨ï¼Œåˆ™åªèƒ½è¡¨ç¤ºæœ€åä»£ç†æœåŠ¡å™¨çš„IPï¼‰</span></span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>; <span class="comment">#è®¾ç½®è¯·æ±‚å¤´æŒ‡å®šå®¢æˆ·ç«¯çš„çœŸå®IPä»¥åŠæ¯æ¬¡é€”ç»çš„ä»£ç†IPï¼ˆç”±é€—å·éš”å¼€,å¦‚ï¼š"192.168.60.1, 192.168.60.101"ï¼Œç¬¬ä¸€ä¸ªIPå³ä¸ºå®¢æˆ·ç«¯çš„çœŸå®IPã€‚ç›®æ ‡æœåŠ¡å™¨ä½¿ç”¨X-Forwarded-Forè·å–å®¢æˆ·ç«¯çœŸå®IPæ¯”è¾ƒå¯é ï¼‰</span></span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>; <span class="comment">#è®¾ç½®è¯·æ±‚å¤´æŒ‡å®šä½¿ç”¨çš„åè®®ï¼ˆå¦‚ï¼šhttpæˆ–è€…httpsï¼Œ$schemeè¡¨ç¤ºå®¢æˆ·ç«¯è¯·æ±‚nginxæ—¶ä½¿ç”¨çš„åè®®ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##å…¶ä»–è¯·æ±‚å¤´è®¾ç½®</span></span><br><span class="line"><span class="attribute">proxy_set_header</span> Range <span class="variable">$http_range</span>;</span><br></pre></td></tr></table></figure><ul><li><code>proxy_http_version</code>: æŒ‡å®š Nginx ä½¿ç”¨çš„ HTTP åè®®ç‰ˆæœ¬ï¼ˆå¦‚ï¼š<code>1.0</code>ï¼ˆé»˜è®¤ï¼‰ã€<code>1.1</code>ï¼‰ã€‚ä¾‹å¦‚ï¼š<code>proxy_http_version 1.1;</code></li><li><code>proxy_cache</code>: è®¾ç½®åå‘ä»£ç†ç¼“å­˜ã€‚å¯ä»¥é€šè¿‡ <code>proxy_cache</code> æŒ‡ä»¤æ¥å¯ç”¨ç¼“å­˜å¹¶æŒ‡å®šç¼“å­˜åç§°ã€‚ä¾‹å¦‚ï¼š<code>proxy_cache my_cache;</code></li><li><code>proxy_redirect</code>: è®¾ç½®åå‘ä»£ç†çš„é‡å®šå‘è§„åˆ™ã€‚å¯é€‰å€¼ï¼š<code>default</code>ï¼ˆé»˜è®¤å€¼ï¼Œä¼šè‡ªåŠ¨æ›¿æ¢å“åº”å¤´ä¸­çš„åŸŸåéƒ¨åˆ†ï¼Œå®ç°åå‘ä»£ç†çš„é‡å®šå‘ï¼‰ã€<code>off</code>ï¼ˆç¦ç”¨é‡å®šå‘ï¼Œä¸è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼‰ã€<code>redirect &lt;replacement&gt;</code>ï¼ˆæŒ‡å®šè‡ªå®šä¹‰çš„é‡å®šå‘è§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ç­‰æ–¹å¼æ¥è¿›è¡Œæ›¿æ¢ï¼‰ã€‚ä¾‹å¦‚ï¼š<code>proxy_redirect default;</code></li><li><code>proxy_connect_timeout</code>: è®¾ç½®ä¸åç«¯æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚ä¾‹å¦‚ï¼š<code>proxy_connect_timeout 5s;</code></li><li><code>proxy_read_timeout</code>: è®¾ç½®ä»åç«¯æœåŠ¡å™¨è¯»å–å“åº”çš„è¶…æ—¶æ—¶é—´ã€‚ä¾‹å¦‚ï¼š<code>proxy_read_timeout 10s;</code></li><li><code>proxy_send_timeout</code>: è®¾ç½®å‘åç«¯æœåŠ¡å™¨å‘é€è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ã€‚ä¾‹å¦‚ï¼š<code>proxy_send_timeout 10s;</code></li><li><code>proxy_buffering</code>ï¼š å¯ç”¨æˆ–ç¦ç”¨åå‘ä»£ç†ç¼“å†²ã€‚å¯é€‰ï¼š<code>on</code>ï¼ˆé»˜è®¤ï¼‰ã€<code>off</code>ï¼Œä¾‹å¦‚ï¼š<code>proxy_buffering on;</code></li><li><code>proxy_buffer_size &lt;size&gt;</code>ï¼šè®¾ç½®åå‘ä»£ç†ä½¿ç”¨çš„ç¼“å†²åŒºå¤§å°ã€‚é»˜è®¤ 4KBã€‚ä½¿ç”¨ç¤ºä¾‹ï¼š<code>proxy_buffer_size 8k;</code></li><li><code>proxy_buffers &lt;number&gt; &lt;size&gt;</code>ï¼šè®¾ç½®åå‘ä»£ç†ç¼“å†²åŒºçš„æ•°é‡å’Œå¤§å°ã€‚é»˜è®¤æ¯ä¸ªè¿æ¥åˆ†é…ä¸¤ä¸ªç¼“å†²åŒºï¼Œæ¯ä¸ªç¼“å†²åŒºå¤§å°ä¸º 4KBã€‚å¦‚ï¼š<code>proxy_buffers 4 16k;</code></li><li><code>proxy_busy_buffers_size &lt;size&gt;</code>ï¼šè®¾ç½® Nginx å¯ä»¥ç§¯ç´¯çš„å“åº”æ•°æ®å¤§å°ã€‚é»˜è®¤ä¸º <code>proxy_buffers</code> ä¸­æ¯ä¸ªç¼“å†²åŒºçš„å¤§å°ã€‚ä½¿ç”¨ç¤ºä¾‹ï¼š<code>proxy_busy_buffers_size 32k;</code></li><li><code>proxy_ignore_headers</code>: è®¾ç½®è¦å¿½ç•¥çš„å“åº”å¤´å­—æ®µã€‚ä¾‹å¦‚ï¼š<code>proxy_ignore_headers X-Accel-Expires Expires Cache-Control;</code></li><li><code>proxy_intercept_errors</code>: å¯ç”¨æˆ–ç¦ç”¨æ‹¦æˆªæ¥è‡ªåç«¯æœåŠ¡å™¨çš„é”™è¯¯å“åº”ã€‚ä½¿ç”¨ç¤ºä¾‹ï¼š<code>proxy_intercept_errors on;</code></li><li><code>proxy_max_temp_file_size &lt;size&gt;</code>ï¼šè®¾ç½®ä»£ç†æ¨¡å—åœ¨å¤„ç†å“åº”æ—¶ï¼Œå…è®¸åˆ›å»ºçš„ä¸´æ—¶æ–‡ä»¶çš„æœ€å¤§å¤§å°ã€‚é»˜è®¤ï¼š1024MBã€‚ä½¿ç”¨ç¤ºä¾‹ï¼š<code>proxy_max_temp_file_size 512m;</code></li></ul><p>ä»£ç†ç›¸åº”å¸¸ç”¨æŒ‡ä»¤ï¼š</p><ul><li>1ï¼‰<code>add_header</code>ï¼š æ·»åŠ è‡ªå®šä¹‰å“åº”å¤´åˆ°æœåŠ¡å™¨çš„å“åº”ä¸­ã€‚ä¾‹å¦‚è·¨åŸŸé…ç½®ï¼Œå¦‚ä¸‹ï¼š</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Origin *;</span><br><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Methods <span class="string">"GET, POST, OPTIONS, PUT, DELETE"</span>;</span><br><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Headers <span class="string">"Authorization, Content-Type, X-Requested-With"</span>;</span><br><span class="line"><span class="attribute">add_header</span> Access-Control-Max-Age <span class="number">86400</span>;</span><br><span class="line"><span class="attribute">if</span> (<span class="variable">$request_method</span> = <span class="string">'OPTIONS'</span>) &#123;</span><br><span class="line">    <span class="attribute">add_header</span> Access-Control-Allow-Origin *;</span><br><span class="line">    <span class="attribute">add_header</span> Access-Control-Allow-Methods <span class="string">"GET, POST, OPTIONS, PUT, DELETE"</span>;</span><br><span class="line">    <span class="attribute">add_header</span> Access-Control-Allow-Headers <span class="string">"Authorization, Content-Type, X-Requested-With"</span>;</span><br><span class="line">    <span class="attribute">add_header</span> Access-Control-Max-Age <span class="number">86400</span>;</span><br><span class="line">    <span class="attribute">add_header</span> Content-Length <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">add_header</span> Content-Type <span class="string">"text/plain charset=UTF-8"</span>;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><h3 id="2-ç®€å•çš„åå‘ä»£ç†é…ç½®"><a class="header-anchor" href="#2-ç®€å•çš„åå‘ä»£ç†é…ç½®">Â¶</a>2. ç®€å•çš„åå‘ä»£ç†é…ç½®</h3><h4 id="1-åå‘ä»£ç†ç›¸å…³é…ç½®"><a class="header-anchor" href="#1-åå‘ä»£ç†ç›¸å…³é…ç½®">Â¶</a>1ï¼‰åå‘ä»£ç†ç›¸å…³é…ç½®</h4><p>nginx é…ç½®ç›¸å…³å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸Šæ¸¸æœåŠ¡å™¨é…ç½®ï¼ˆåç«¯æœåŠ¡å™¨ï¼‰</span></span><br><span class="line"><span class="attribute">upstream</span> ops_load &#123;</span><br><span class="line">    <span class="comment">#è´Ÿè½½å‡è¡¡é…ç½®</span></span><br><span class="line">        <span class="comment">#é…ç½®å¤šä¸ªhttpæœåŠ¡å™¨å³å¯å®ç°è´Ÿè½½å‡è¡¡ï¼Œå…¶ä¸­httpæœåŠ¡å™¨å¯ä¸ºæœ¬æœºï¼Œä¹Ÿå¯ä»¥ä¸ºå…¶ä»–æœåŠ¡å™¨</span></span><br><span class="line">        <span class="comment">#é»˜è®¤è´Ÿè½½å‡è¡¡çš„è°ƒåº¦æ¨¡å¼ä¸ºè½®è¯¢æ–¹å¼</span></span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.101</span>::<span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.102:8080</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="comment">#åå‘ä»£ç†</span></span><br><span class="line">        <span class="comment">#proxy_pass http://localhost:8081; #å¦‚æœåªéœ€è¦ä»£ç†åˆ°ä¸€ä¸ªæœåŠ¡å™¨ï¼Œåˆ™å¯ä»¥å¦‚æ­¤é…ç½®</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://ops_load; <span class="comment">#å¦‚æœåªéœ€è¦ä»£ç†åˆ°å¤šä¸ªæœåŠ¡å™¨ï¼Œåˆ™å¯ä»¥é…ç½®upstreamæ¥è®¾ç½®å¤šä¸ªæœåŠ¡å™¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-åå‘ä»£ç†æµ‹è¯•ç¤ºä¾‹"><a class="header-anchor" href="#2-åå‘ä»£ç†æµ‹è¯•ç¤ºä¾‹">Â¶</a>2ï¼‰åå‘ä»£ç†æµ‹è¯•ç¤ºä¾‹</h4><blockquote><p>æµ‹è¯•ç¤ºä¾‹éœ€æ±‚ï¼šåœ¨æœ¬åœ°çš„ nginx ä¸­æ¨¡æ‹Ÿåå‘ä»£ç†åˆ°æœ¬åœ°ä¸åŒç«¯å£çš„ä¸Šæ¸¸æœåŠ¡å™¨ã€‚</p></blockquote><p>ï¼ˆ1ï¼‰åˆ›å»ºnginxé…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/nginx/conf/conf.d/load_balance.conf</span><br></pre></td></tr></table></figure><p>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸Šæ¸¸æœåŠ¡å™¨é…ç½®ï¼ˆåç«¯æœåŠ¡å™¨ï¼‰</span></span><br><span class="line"><span class="attribute">upstream</span> ops_load &#123;</span><br><span class="line">    <span class="attribute">server</span> localhost:<span class="number">8081</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8082</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8083</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://ops_load;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¨¡æ‹Ÿ3ä¸ªä¸Šæ¸¸æœåŠ¡å™¨</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8081</span>;</span><br><span class="line">    <span class="attribute">root</span> /opt/nginx/html/node1;</span><br><span class="line">    <span class="attribute">index</span> index.html;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8082</span>;</span><br><span class="line">    <span class="attribute">root</span> /opt/nginx/html/node2;</span><br><span class="line">    <span class="attribute">index</span> index.html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line">    <span class="attribute">root</span> /opt/nginx/html/node3;</span><br><span class="line">    <span class="attribute">index</span> index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰æœåŠ¡èŠ‚ç‚¹å·®å¼‚è®¾ç½®</p><p>ä¸ºäº†æ›´ç›´è§‚çš„æµ‹è¯•è´Ÿè½½å‡è¡¡æ•ˆæœï¼Œå¯ç»™ä¸åŒçš„æœåŠ¡èŠ‚ç‚¹çš„è®¿é—®é¡µé¢åšä¸€äº›å·®å¼‚å†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/nginx/html/&#123;node1,node2,node3&#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"node1"</span> &gt; /opt/nginx/html/node1/index.html</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"node2"</span> &gt; /opt/nginx/html/node2/index.html</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"node3"</span> &gt; /opt/nginx/html/node3/index.html</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰é…ç½®é˜²ç«å¢™å’Œé‡è½½ nginx é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é˜²ç«å¢™å¼€æ”¾ç›¸å…³ç›‘å¬ç«¯å£</span></span><br><span class="line">firewall-cmd --permanent --add-port=8080/tcp</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡è½½é…ç½®</span></span><br><span class="line">/opt/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰æµ‹è¯•</p><blockquote><p>è®¾æœåŠ¡å™¨ IP åœ°å€ä¸ºï¼š<code>198.23.188.200</code>ï¼Œåˆ™è®¿é—®åœ°å€ï¼š<a href="http://198.23.188.200:8080" target="_blank" rel="noopener">http://198.23.188.200:8080</a></p><p>æç¤ºï¼šæµè§ˆå™¨è¦è®¾ç½®â€œåœç”¨ç¼“å­˜â€ï¼Œå¦åˆ™å¯èƒ½ä¸€ç›´è§‚å¯Ÿåˆ°çš„éƒ½æ˜¯ä¸€ä¸ªå†…å®¹ã€‚</p></blockquote><h3 id="3-é«˜çº§çš„åå‘ä»£ç†é…ç½®"><a class="header-anchor" href="#3-é«˜çº§çš„åå‘ä»£ç†é…ç½®">Â¶</a>3. é«˜çº§çš„åå‘ä»£ç†é…ç½®</h3><h4 id="1-è´Ÿè½½å‡è¡¡è°ƒåº¦æ¨¡å¼é…ç½®"><a class="header-anchor" href="#1-è´Ÿè½½å‡è¡¡è°ƒåº¦æ¨¡å¼é…ç½®">Â¶</a>1ï¼‰è´Ÿè½½å‡è¡¡è°ƒåº¦æ¨¡å¼é…ç½®</h4><p>åœ¨Nginxä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ç§è´Ÿè½½å‡è¡¡è°ƒåº¦æ¨¡å¼ï¼š</p><blockquote><ol><li>è½®è¯¢ï¼ˆRound Robinï¼‰ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒNginxä½¿ç”¨è½®è¯¢æ¨¡å¼è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚å®ƒæŒ‰ç…§æ¯ä¸ªåç«¯æœåŠ¡å™¨çš„é¡ºåºä¾æ¬¡åˆ†é…è¯·æ±‚ï¼Œç¡®ä¿æ¯ä¸ªåç«¯æœåŠ¡å™¨å¹³å‡åˆ†æ‹…è´Ÿè½½ã€‚</li><li>åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robinï¼‰ï¼šå¯ä»¥ä¸ºæ¯ä¸ªåç«¯æœåŠ¡å™¨åˆ†é…ä¸åŒçš„æƒé‡ï¼Œä»¥è°ƒæ•´å®ƒä»¬æ¥æ”¶è¯·æ±‚çš„æ¯”ä¾‹ã€‚è¾ƒé«˜æƒé‡çš„æœåŠ¡å™¨å°†è·å¾—æ›´å¤šçš„è¯·æ±‚ã€‚</li><li>IPå“ˆå¸Œï¼ˆIP Hashï¼‰ï¼šåŸºäºå®¢æˆ·ç«¯IPåœ°å€å¯¹è¯·æ±‚è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå°†ç›¸åŒIPçš„è¯·æ±‚å§‹ç»ˆè½¬å‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ã€‚è¿™å¯¹äºéœ€è¦ä¿æŒä¼šè¯æˆ–çŠ¶æ€çš„åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ã€‚</li><li>æœ€å°‘è¿æ¥ï¼ˆLeast Connectionsï¼‰ï¼šå°†è¯·æ±‚åˆ†é…ç»™å½“å‰è¿æ¥æ•°æœ€å°‘çš„åç«¯æœåŠ¡å™¨ã€‚è¿™æœ‰åŠ©äºå¹³è¡¡æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¿æ¥è¾ƒå°‘çš„æœåŠ¡å™¨ï¼Œä»¥ç¡®ä¿æ›´å‡åŒ€çš„è´Ÿè½½åˆ†å¸ƒã€‚</li><li>URLå“ˆå¸Œï¼ˆURL Hashï¼‰ï¼šåŸºäºè¯·æ±‚çš„URLå¯¹åç«¯æœåŠ¡å™¨è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œä½¿ç›¸åŒURLçš„è¯·æ±‚æ€»æ˜¯è½¬å‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ã€‚è¿™å¯¹äºéœ€è¦ç¼“å­˜æˆ–ç‰¹å®šå¤„ç†é€»è¾‘çš„åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ã€‚</li></ol></blockquote><p>nginx é…ç½®ç›¸å…³å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ï¼ˆ1ï¼‰è½®è¯¢ï¼ˆRound Robinï¼‰æ¨¡å¼</span></span><br><span class="line"><span class="attribute">upstream</span> backend-rr &#123;</span><br><span class="line">    <span class="comment">#é»˜è®¤çš„è´Ÿè½½å‡è¡¡è°ƒåº¦æ¨¡å¼å³ä¸ºè½®è¯¢æ¨¡å¼ï¼Œä¸éœ€è¦æ˜¾å¼åœ°é…ç½®</span></span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.101</span>::<span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.102:8080</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ï¼ˆ2ï¼‰åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robinï¼‰æ¨¡å¼</span></span><br><span class="line"><span class="attribute">upstream</span> backend-wrr &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.101</span>::<span class="number">8080</span> weight=<span class="number">5</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.102:8080</span> weight=<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ï¼ˆ3ï¼‰IPå“ˆå¸Œï¼ˆIP Hashï¼‰æ¨¡å¼</span></span><br><span class="line"><span class="attribute">upstream</span> backend-ih &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.101</span>::<span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.102:8080</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ï¼ˆ4ï¼‰æœ€å°‘è¿æ¥ï¼ˆLeast Connectionsï¼‰æ¨¡å¼</span></span><br><span class="line"><span class="attribute">upstream</span> backend-lc &#123;</span><br><span class="line">    least_conn;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.101</span>::<span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.102:8080</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ï¼ˆ5ï¼‰URLå“ˆå¸Œï¼ˆURL Hashï¼‰æ¨¡å¼</span></span><br><span class="line"><span class="attribute">upstream</span> backend-uh &#123;</span><br><span class="line">    <span class="attribute">hash</span> <span class="variable">$request_uri</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.101</span>::<span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.102:8080</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://backend-rr;</span><br><span class="line">        <span class="comment"># proxy_pass http://backend-wrr;</span></span><br><span class="line">        <span class="comment"># proxy_pass http://backend-ih;</span></span><br><span class="line">        <span class="comment"># proxy_pass http://backend-lc;</span></span><br><span class="line">        <span class="comment"># proxy_pass http://backend-uh;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-è´Ÿè½½å‡è¡¡å¥åº·æ£€æŸ¥é…ç½®"><a class="header-anchor" href="#2-è´Ÿè½½å‡è¡¡å¥åº·æ£€æŸ¥é…ç½®">Â¶</a>2ï¼‰è´Ÿè½½å‡è¡¡å¥åº·æ£€æŸ¥é…ç½®</h4><h5 id="1-ç®€è¦è¯´æ˜"><a class="header-anchor" href="#1-ç®€è¦è¯´æ˜">Â¶</a>ï¼ˆ1ï¼‰ç®€è¦è¯´æ˜</h5><p>Nginxå¥åº·æ£€æŸ¥çš„ä½œç”¨ï¼š</p><blockquote><p>Nginx çš„å¥åº·æ£€æŸ¥åŠŸèƒ½ä¸»è¦ç”¨äºç›‘æ§åç«¯æœåŠ¡å™¨çš„å¯ç”¨æ€§å’ŒçŠ¶æ€ï¼Œä»¥ç¡®ä¿è¯·æ±‚è¢«æ­£ç¡®åœ°è½¬å‘ç»™å¯ç”¨çš„æœåŠ¡å™¨ã€‚å…·ä½“ä½œç”¨å¦‚ä¸‹ï¼š</p><ol><li>ç¡®ä¿æœåŠ¡å¯ç”¨æ€§ï¼šé€šè¿‡å®šæœŸå‘åç«¯æœåŠ¡å™¨å‘é€å¥åº·æ£€æŸ¥è¯·æ±‚ï¼ŒNginxå¯ä»¥æ£€æµ‹åˆ°æœåŠ¡å™¨æ˜¯å¦åœ¨çº¿ã€å“åº”æ­£å¸¸ä»¥åŠæœåŠ¡æ˜¯å¦å¯ç”¨ã€‚å¦‚æœæŸä¸ªæœåŠ¡å™¨å®•æœºæˆ–æ— æ³•æ­£å¸¸å“åº”è¯·æ±‚ï¼ŒNginxå°†è‡ªåŠ¨å°†è¯·æ±‚è½¬å‘ç»™å…¶ä»–å¯ç”¨çš„æœåŠ¡å™¨ï¼Œç¡®ä¿æœåŠ¡çš„æŒç»­å¯ç”¨æ€§ã€‚</li><li>åŠ¨æ€è´Ÿè½½å‡è¡¡ï¼šå¥åº·æ£€æŸ¥åŠŸèƒ½å¯ä»¥è®©Nginxæ ¹æ®åç«¯æœåŠ¡å™¨çš„çŠ¶æ€è‡ªåŠ¨è°ƒæ•´è¯·æ±‚çš„è½¬å‘ç­–ç•¥ã€‚å½“æŸä¸ªæœåŠ¡å™¨å‡ºç°æ•…éšœæˆ–æ€§èƒ½ä¸‹é™æ—¶ï¼ŒNginxå¯ä»¥æš‚æ—¶å°†è¯·æ±‚ä»æ•…éšœçš„æœåŠ¡å™¨è½¬å‘åˆ°å…¶ä»–å¥åº·çš„æœåŠ¡å™¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡å¹¶é¿å…å‘ä¸å¯ç”¨çš„æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚</li><li>æ•…éšœè‡ªåŠ¨æ¢å¤ï¼šå¥åº·æ£€æŸ¥è¿˜èƒ½å¤Ÿå¸®åŠ©Nginxæ£€æµ‹åˆ°åç«¯æœåŠ¡å™¨çš„æ¢å¤æƒ…å†µã€‚ä¸€æ—¦æŸä¸ªæœåŠ¡å™¨æ¢å¤æ­£å¸¸ï¼Œå¥åº·æ£€æŸ¥ä¼šå°†å…¶æ ‡è®°ä¸ºå¥åº·ï¼Œå¹¶é‡æ–°å°†è¯·æ±‚è½¬å‘åˆ°è¯¥æœåŠ¡å™¨ä¸Šï¼Œå®ç°æ•…éšœè‡ªåŠ¨æ¢å¤ã€‚</li><li>é¿å…æœåŠ¡é›ªå´©æ•ˆåº”ï¼šé€šè¿‡å®šæœŸæ£€æŸ¥åç«¯æœåŠ¡å™¨çš„çŠ¶æ€ï¼ŒNginxå¯ä»¥åŠæ—¶å‘ç°æ•…éšœæœåŠ¡å™¨ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°å…¶ä»–å¯ç”¨çš„æœåŠ¡å™¨ä¸Šã€‚è¿™æœ‰åŠ©äºé¿å…ç”±äºæ•…éšœæœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚è€Œå¯¼è‡´çš„æœåŠ¡é›ªå´©æ•ˆåº”ï¼Œæé«˜æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</li></ol><p>æ€»çš„æ¥è¯´ï¼ŒNginxçš„å¥åº·æ£€æŸ¥åŠŸèƒ½å¯ä»¥æå‡åç«¯æœåŠ¡å™¨çš„å¯ç”¨æ€§ã€ä¼˜åŒ–è´Ÿè½½å‡è¡¡ç­–ç•¥ã€è‡ªåŠ¨æ¢å¤æ•…éšœæœåŠ¡å™¨ï¼Œå¹¶æé«˜æ•´ä¸ªç³»ç»Ÿçš„å¯é æ€§å’Œæ€§èƒ½ã€‚</p></blockquote><p>Nginxå¥åº·æ£€æŸ¥çš„ç±»å‹ï¼š</p><blockquote><p>ğŸ’â€â™‚ Nginx æ”¯æŒä¸¤ç§ç±»å‹çš„å¥åº·æ£€æŸ¥ï¼šè¢«åŠ¨å¥åº·æ£€æŸ¥å’Œä¸»åŠ¨å¥åº·æ£€æŸ¥ã€‚</p><ul><li><p>è¢«åŠ¨å¥åº·æ£€æŸ¥ï¼ˆPassive Health Checksï¼‰ï¼š è¢«åŠ¨å¥åº·æ£€æŸ¥æ˜¯æŒ‡Nginxé€šè¿‡ç›‘æ§åç«¯æœåŠ¡å™¨çš„è¯·æ±‚å“åº”æ¥ç¡®å®šæœåŠ¡å™¨çš„å¥åº·çŠ¶æ€ã€‚å½“Nginxå‘åç«¯æœåŠ¡å™¨è½¬å‘è¯·æ±‚æ—¶ï¼Œå®ƒä¼šç­‰å¾…ä¸€æ®µæ—¶é—´æ¥æ¥æ”¶æœåŠ¡å™¨çš„å“åº”ã€‚å¦‚æœæœåŠ¡å™¨åœ¨è§„å®šæ—¶é—´å†…æˆåŠŸå“åº”è¯·æ±‚ï¼ŒNginxå°†è®¤ä¸ºæœåŠ¡å™¨æ˜¯å¥åº·çš„ï¼Œå¹¶ç»§ç»­å°†è¯·æ±‚è½¬å‘åˆ°è¯¥æœåŠ¡å™¨ã€‚å¦‚æœæœåŠ¡å™¨åœ¨è§„å®šæ—¶é—´å†…æ— æ³•å“åº”è¯·æ±‚ï¼ˆä¾‹å¦‚è¿”å›é”™è¯¯çŠ¶æ€ç æˆ–è¿æ¥è¶…æ—¶ï¼‰ï¼ŒNginxå°†è®¤ä¸ºæœåŠ¡å™¨æ˜¯ä¸å¥åº·çš„ï¼Œå¹¶åœæ­¢å°†è¯·æ±‚è½¬å‘åˆ°è¯¥æœåŠ¡å™¨ï¼Œç›´åˆ°ä¸‹æ¬¡å¥åº·æ£€æŸ¥é‡æ–°ç¡®å®šå…¶å¥åº·çŠ¶æ€ã€‚</p></li><li><p>ä¸»åŠ¨å¥åº·æ£€æŸ¥ï¼ˆActive Health Checksï¼‰ï¼š ä¸»åŠ¨å¥åº·æ£€æŸ¥æ˜¯æŒ‡Nginxå®šæœŸä¸»åŠ¨å‘åç«¯æœåŠ¡å™¨å‘é€å¥åº·æ£€æŸ¥è¯·æ±‚æ¥ç¡®å®šæœåŠ¡å™¨çš„å¥åº·çŠ¶æ€ã€‚Nginxä¼šæŒ‰ç…§é¢„è®¾çš„æ—¶é—´é—´éš”å‘é€å¥åº·æ£€æŸ¥è¯·æ±‚åˆ°åç«¯æœåŠ¡å™¨ï¼Œå¹¶ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ã€‚å¦‚æœæœåŠ¡å™¨æˆåŠŸå“åº”äº†å¥åº·æ£€æŸ¥è¯·æ±‚ï¼ŒNginxå°†è®¤ä¸ºæœåŠ¡å™¨æ˜¯å¥åº·çš„ï¼Œå¹¶ç»§ç»­å°†è¯·æ±‚è½¬å‘åˆ°è¯¥æœåŠ¡å™¨ã€‚å¦‚æœæœåŠ¡å™¨æ— æ³•å“åº”å¥åº·æ£€æŸ¥è¯·æ±‚ï¼ˆä¾‹å¦‚è¿”å›é”™è¯¯çŠ¶æ€ç æˆ–è¿æ¥è¶…æ—¶ï¼‰ï¼ŒNginxå°†è®¤ä¸ºæœåŠ¡å™¨æ˜¯ä¸å¥åº·çš„ï¼Œå¹¶åœæ­¢å°†è¯·æ±‚è½¬å‘åˆ°è¯¥æœåŠ¡å™¨ï¼Œç›´åˆ°ä¸‹æ¬¡å¥åº·æ£€æŸ¥é‡æ–°ç¡®å®šå…¶å¥åº·çŠ¶æ€ã€‚ä¸»åŠ¨å¥åº·æ£€æŸ¥ç›¸å¯¹äºè¢«åŠ¨å¥åº·æ£€æŸ¥å¯ä»¥æ›´å¿«åœ°æ¢å¤æ•…éšœæœåŠ¡å™¨çš„æµé‡åˆ†å‘ï¼Œè¿™æ˜¯å› ä¸ºå®ƒå¯ä»¥ä¸»åŠ¨ç›‘æ§å’Œæ£€æµ‹åç«¯æœåŠ¡å™¨çš„å¥åº·çŠ¶æ€ã€‚</p></li></ul><p>ğŸ’â€â™‚ è¢«åŠ¨å¥åº·æ£€æŸ¥çš„ä¸»åŠ¨å¥åº·æ£€æŸ¥çš„é€‰æ‹©ï¼š</p><ul><li><p>ä½¿ç”¨è¢«åŠ¨å¥åº·æ£€æŸ¥æ—¶ï¼ŒNginx åªèƒ½åœ¨æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚æ—¶æ‰èƒ½æ£€æµ‹åç«¯æœåŠ¡å™¨çš„çŠ¶æ€ã€‚å¦‚æœåç«¯æœåŠ¡å™¨å‡ºç°æ•…éšœæˆ–å˜å¾—ä¸å¯ç”¨ï¼ŒNginx éœ€è¦ç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾å¹¶åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ­£ç¡®çš„å“åº”ï¼Œæ‰ä¼šæš‚æ—¶å°†æµé‡åœæ­¢å‘é€åˆ°è¯¥æœåŠ¡å™¨ã€‚è¿™æ„å‘³ç€åœ¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œå­˜åœ¨ä¸€å®šçš„å»¶è¿Ÿæ—¶é—´ï¼ˆé€šå¸¸æ˜¯å‡ ç§’é’Ÿï¼‰æ‰èƒ½åˆ‡æ¢æµé‡åˆ°å…¶ä»–å¯ç”¨çš„æœåŠ¡å™¨ä¸Šã€‚å…¶é€‚ç”¨äºå¯¹æ•…éšœæ¢å¤é€Ÿåº¦è¦æ±‚ä¸é«˜çš„æƒ…å†µã€‚</p></li><li><p>ä½¿ç”¨ä¸»åŠ¨å¥åº·æ£€æŸ¥æ—¶ï¼Œå…¶å…è®¸ Nginx å®šæœŸå‘é€å¥åº·æ£€æŸ¥è¯·æ±‚åˆ°åç«¯æœåŠ¡å™¨ã€‚å¦‚æœæœåŠ¡å™¨æ— æ³•æ­£å¸¸å“åº”æˆ–è¿”å›é”™è¯¯çš„å“åº”ï¼ŒNginx å°†ç«‹å³æ„è¯†åˆ°è¯¥æœåŠ¡å™¨çš„æ•…éšœï¼Œå¹¶åœæ­¢å°†æµé‡å‘é€åˆ°è¯¥æœåŠ¡å™¨ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚ã€‚è¿™ä½¿å¾—æ•…éšœæœåŠ¡å™¨çš„æ¢å¤é€Ÿåº¦æ›´å¿«ï¼Œå› ä¸º Nginx å¯ä»¥æ›´å¿«åœ°æ£€æµ‹åˆ°æ•…éšœå¹¶å°†æµé‡è½¬ç§»åˆ°å…¶ä»–å¥åº·çš„æœåŠ¡å™¨ä¸Šã€‚é€šè¿‡ä¸»åŠ¨å¥åº·æ£€æŸ¥ï¼ŒNginx å¯ä»¥æ›´åŠæ—¶åœ°å‘ç°æ•…éšœï¼Œå¹¶ä¸”å¯ä»¥æ›´å¿«åœ°å°†æµé‡ä»æ•…éšœæœåŠ¡å™¨åˆ‡æ¢åˆ°å…¶ä»–å¯ç”¨æœåŠ¡å™¨ä¸Šï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ•…éšœæ¢å¤é€Ÿåº¦ã€‚å…¶é€‚ç”¨äºå¯¹æ•…éšœæ¢å¤é€Ÿåº¦è¦æ±‚æ¯”è¾ƒé«˜çš„æƒ…å†µã€‚</p></li></ul></blockquote><h5 id="2-è¢«åŠ¨å¥åº·æ£€æŸ¥é…ç½®"><a class="header-anchor" href="#2-è¢«åŠ¨å¥åº·æ£€æŸ¥é…ç½®">Â¶</a>ï¼ˆ2ï¼‰è¢«åŠ¨å¥åº·æ£€æŸ¥é…ç½®</h5><p>Nginx é»˜è®¤æ˜¯æ”¯æŒåŸºç¡€çš„è¢«åŠ¨å¥åº·æ£€æŸ¥çš„ï¼ˆç”±<code>ngx_http_upstream_module</code>æ¨¡å—æ”¯æŒï¼‰ï¼Œä½¿ç”¨é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> ops_load &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.101:8080</span> max_fails=<span class="number">1</span> fail_timeout=<span class="number">10s</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.102:8080</span> max_fails=<span class="number">1</span> fail_timeout=<span class="number">10s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://ops_load;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>max_fails=1 fail_timeout=10s</code> è¯´æ˜ï¼šå¦‚æœåç«¯æœåŠ¡å™¨åœ¨ä¸€æ¬¡å¥åº·æ£€æŸ¥å‘¨æœŸå†…ï¼ˆç”±Nginxé…ç½®ä¸­çš„<code>check interval</code>æŒ‡å®šï¼‰å¤±è´¥ä¸€æ¬¡æˆ–æ›´å¤šï¼Œåˆ™å°†å…¶æ ‡è®°ä¸ºä¸å¥åº·çŠ¶æ€ã€‚ä¸€æ—¦æ ‡è®°ä¸ºä¸å¥åº·çŠ¶æ€ï¼ŒNginxå°†æš‚æ—¶å°†å…¶æ’é™¤åœ¨è´Ÿè½½å‡è¡¡èŒƒå›´ä¹‹å¤–çš„æ—¶é—´ï¼ˆç”±<code>fail_timeout</code>æŒ‡å®šï¼‰ï¼Œåœ¨æ­¤æœŸé—´ä¸ä¼šå°†è¯·æ±‚è½¬å‘ç»™è¯¥æœåŠ¡å™¨ã€‚è¿‡äº†æŒ‡å®šçš„æ—¶é—´åï¼ŒNginxå°†é‡æ–°å°è¯•å°†è¯·æ±‚è½¬å‘ç»™è¯¥æœåŠ¡å™¨ã€‚</p><ul><li><code>max_fails=1</code>ï¼šè¡¨ç¤ºåœ¨ä¸€æ¬¡å¥åº·æ£€æŸ¥å‘¨æœŸå†…ï¼Œå…è®¸çš„æœ€å¤§å¤±è´¥æ¬¡æ•°ã€‚å¦‚æœåœ¨ä¸€æ¬¡å¥åº·æ£€æŸ¥å‘¨æœŸå†…ï¼Œè¯¥æœåŠ¡å™¨çš„å¤±è´¥æ¬¡æ•°è¾¾åˆ°æˆ–è¶…è¿‡è®¾å®šçš„æœ€å¤§å¤±è´¥æ¬¡æ•°ï¼Œåˆ™è¯¥æœåŠ¡å™¨å°†è¢«æ ‡è®°ä¸ºä¸å¥åº·çŠ¶æ€ã€‚</li><li><code>fail_timeout=10s</code>ï¼šè¡¨ç¤ºåœ¨æœåŠ¡å™¨è¢«æ ‡è®°ä¸ºä¸å¥åº·çŠ¶æ€åï¼Œæš‚æ—¶å°†å…¶æ’é™¤åœ¨è´Ÿè½½å‡è¡¡èŒƒå›´ä¹‹å¤–çš„æ—¶é—´ã€‚åœ¨æŒ‡å®šçš„æ—¶é—´æ®µå†…ï¼ŒNginxä¸ä¼šå°†è¯·æ±‚è½¬å‘ç»™è¯¥æœåŠ¡å™¨ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨è¢«æ ‡è®°ä¸ºä¸å¥åº·çŠ¶æ€ï¼Œå°†åœ¨10ç§’åé‡æ–°å°è¯•å°†è¯·æ±‚è½¬å‘ç»™è¯¥æœåŠ¡å™¨ã€‚</li></ul></blockquote><h5 id="3-ä¸»åŠ¨å¥åº·æ£€æŸ¥"><a class="header-anchor" href="#3-ä¸»åŠ¨å¥åº·æ£€æŸ¥">Â¶</a>ï¼ˆ3ï¼‰ä¸»åŠ¨å¥åº·æ£€æŸ¥</h5><p>Nginx é»˜è®¤ä¸æ”¯æŒä¸»åŠ¨å¥åº·æ£€æŸ¥ï¼Œéœ€ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—æ¥æ”¯æŒï¼Œå¯ä½¿ç”¨å¼€æºçš„ <a href="https://github.com/yaoweibin/nginx_upstream_check_module" target="_blank" rel="noopener">nginx_upstream_check_module</a> æ¨¡å—æ¥å®ç°ä¸»åŠ¨å¥åº·æ£€æŸ¥ï¼Œé‡æ–°ç¼–è¯‘å®‰è£… nginx å¯¼å…¥å¯¼å…¥è¯¥æ¨¡å—ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ï¼ˆ1ï¼‰ä¸‹è½½nginx_upstream_check_moduleæ¨¡å—æºç </span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/yaoweibin/nginx_upstream_check_module.git /tmp/nginx_upstream_check_module</span><br><span class="line"><span class="comment">#git clone https://ghproxy.com/https://github.com/yaoweibin/nginx_upstream_check_module.git /tmp/nginx_upstream_check_module</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ï¼ˆ2ï¼‰ä¸‹è½½nginxæºç åŒ…</span></span><br><span class="line">wget http://nginx.org/download/nginx-1.20.1.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#ï¼ˆ3ï¼‰è§£å‹nginxæºç åŒ…</span></span><br><span class="line">tar zxvf nginx-1.20.1.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#ï¼ˆ4ï¼‰è¿›å…¥è§£å‹å¥½çš„nginxæºç ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span>  nginx-1.20.1</span><br><span class="line"></span><br><span class="line"><span class="comment">#ï¼ˆ5ï¼‰ï¼ˆå¯é€‰ï¼‰å¦‚æœéœ€è¦ä½¿ç”¨å¥åº·ç›‘æ§é¡µé¢ï¼Œåˆ™éœ€è¦ä½¿ç”¨nginx_upstream_check_moduleæ¨¡å—çš„è¡¥ä¸æ–‡ä»¶ç»™nginxæºç æ‰“è¡¥ä¸ï¼ˆä¿®æ”¹nginxæºç ï¼‰</span></span><br><span class="line">yum install -y patch</span><br><span class="line">patch -p1 &lt; /tmp/nginx_upstream_check_module/check_1.20.1+.patch <span class="comment">#æŒ‡å®šç‰¹å®šnginxç‰ˆæœ¬çš„è¡¥ä¸æ–‡ä»¶ç»™nginxæºç æ‰“è¡¥ä¸</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ï¼ˆ6ï¼‰æŒ‡å®šnginx_upstream_check_moduleæ¨¡å—è·¯å¾„ç”Ÿæˆnginxçš„ç¼–è¯‘é…ç½®æ–‡ä»¶MakeFile</span></span><br><span class="line">./configure \</span><br><span class="line">--prefix=/opt/nginx \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_v2_module \</span><br><span class="line">--with-http_sub_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--add-module=/tmp/nginx_upstream_check_module</span><br><span class="line"></span><br><span class="line"><span class="comment">#ï¼ˆ7ï¼‰ç¼–è¯‘å¹¶å®‰è£…</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šnginx å„ç‰ˆæœ¬ç¼–è¯‘<code>nginx_upstream_check_module</code>æ¨¡å—åå³å¯æ­£å¸¸ä½¿ç”¨ä¸»åŠ¨å¥åº·æ£€æŸ¥é…ç½®ï¼Œä½†æ˜¯è¦ä½¿ç”¨è¯¥æ¨¡å—çš„å¥åº·ç›‘æ§é¡µé¢åŠŸèƒ½ï¼ˆç”±æ¨¡å—çš„<code>check_status</code>æŒ‡ä»¤æ”¯æŒï¼‰ï¼Œåˆ™éœ€è¦å®‰è£…æ¨¡å—ä¸­è¡¥ä¸æ”¯æŒçš„ç‰¹å®šç‰ˆæœ¬ nginxï¼ˆæ”¯æŒç‰ˆæœ¬å¯åœ¨æ¨¡å—æºç ä¸­æŸ¥çœ‹ï¼Œä¾‹å¦‚æºç ä¸­æœ‰<code>check_1.20.1+.patch</code>è¿™ä¸ªè¡¥ä¸æ–‡ä»¶ï¼Œåˆ™è¯´æ˜å…¶æ”¯æŒ nginx çš„<code>1.20.1</code>ç‰ˆæœ¬ï¼‰ï¼Œå¹¶ä½¿ç”¨æ¨¡å—ä¸­ç‰¹å®šç‰ˆæœ¬çš„è¡¥ä¸ä¿®æ”¹ nginx æºç ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°è®¿é—®å¥åº·ç›‘æ§é¡µé¢å¤±è´¥çš„é—®é¢˜ã€‚æç¤ºï¼šå¥åº·ç›‘æ§é¡µé¢æ˜¯å¦èƒ½ç”¨ä¸å½±å“ä¸»åŠ¨å¥åº·æ£€æŸ¥åŠŸèƒ½çš„ä½¿ç”¨ï¼Œæ•…æ‰“ä¸æ‰“è¡¥ä¸æ ¹æ®éœ€æ±‚æ¥å†³å®šã€‚</p></blockquote><p>nginx ä½¿ç”¨é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> ops_load &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.101:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.60.102:8080</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#ä»¥10sä¸ºä¸€ä¸ªå‘¨æœŸï¼Œæ¯éš”10sï¼Œnginxä¼šè‡ªåŠ¨å‘ä¸Šæ¸¸æœåŠ¡å™¨å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œå¦‚æœè¶…è¿‡5sè¶…æ—¶ä¸”è¾¾åˆ°3æ¬¡ï¼Œåˆ™è¯¥æœåŠ¡å™¨æ ‡è®°ä¸ºä¸å¯ç”¨ï¼›</span></span><br><span class="line">    <span class="comment">#å¦‚æœè¯·æ±‚æ¬¡æ•°æœ‰1æ¬¡ä»¥ä¸Šæ²¡æœ‰è¶…æ—¶ï¼Œè¿™æ ‡è®°ä¸ºå¯ç”¨</span></span><br><span class="line">    <span class="attribute">check</span> interval=<span class="number">10000</span> rise=<span class="number">1</span> fall=<span class="number">3</span> timeout=<span class="number">5000</span> type=tcp default_down=<span class="literal">true</span>;</span><br><span class="line">    <span class="attribute">check_http_send</span> <span class="string">"HEAD / HTTP/1.1\r\nConnection: keep-alive\r\n\r\n"</span>;</span><br><span class="line">    <span class="attribute">check_http_expect_alive</span> http_2xx http_3xx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://ops_load;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¥åº·ç›‘æ§é¡µé¢</span></span><br><span class="line">    <span class="attribute">location</span> /status &#123;</span><br><span class="line">        check_status;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">        <span class="comment">#allow 127.0.0.1;</span></span><br><span class="line">        <span class="comment">#deny all;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>nginx_upstream_check_module</code> æ¨¡å—ä¸­ç›¸å…³æŒ‡ä»¤è¯´æ˜:</p><ul><li><code>check</code>ï¼šå¥åº·æ£€æŸ¥è§„åˆ™</li></ul><p>è¯­æ³•ï¼š<code>check interval=milliseconds [fall=count] [rise=count] [timeout=milliseconds] [default_down=true|false] [type=tcp|http|ssl_hello|mysql|ajp|fastcgi]</code></p><p>å¦‚æœçœç•¥å‚æ•°ï¼Œåˆ™é»˜è®¤å‚æ•°ä¸º <code>interval=30000 fall=5 rise=2 timeout=1000 default_down=true type=tcp</code></p><p>ç›¸å…³å‚æ•°è¯´æ˜ï¼š</p><ul><li><p><code>interval</code>ï¼šæ£€æŸ¥è¯·æ±‚çš„é—´éš”æ—¶é—´</p></li><li><p><code>rise</code>ï¼šå¦‚æœè¯·æ±‚æ¬¡æ•°æœ‰æŒ‡å®šæ¬¡æ•°ä»¥ä¸Šæ²¡æœ‰è¶…æ—¶ï¼Œè¿™æ ‡è®°ä¸ºå¯ç”¨çŠ¶æ€</p></li><li><p><code>fall</code>ï¼šè¾¾åˆ°çš„æŒ‡å®šå¤±è´¥æ¬¡æ•°åˆ™æ ‡è®°ä¸ºä¸å¯ç”¨çŠ¶æ€</p></li><li><p><code>timeout</code>ï¼šè¯·æ±‚è¾¾åˆ°æŒ‡å®šçš„è¶…æ—¶æ—¶é—´åˆ™æ ‡è®°ä¸ºä¸å¯ç”¨çŠ¶æ€</p></li><li><p><code>type</code>ï¼šæ£€æŸ¥åè®®ç±»å‹ï¼ˆtcpã€ssl_helloã€httpã€mysqlã€ajpã€fastcgiï¼‰</p></li><li><p><code>default_down</code>ï¼šè®¾ç½®åç«¯æœåŠ¡å™¨çš„åˆå§‹çŠ¶æ€ï¼ˆ<code>false</code>ï¼šå¯ç”¨ï¼Œé»˜è®¤ï¼›<code>true</code>ï¼šä¸å¯ç”¨ï¼‰</p></li><li><p><code>port</code>ï¼šæŒ‡å®šåç«¯æœåŠ¡å™¨çš„æ£€æŸ¥ç«¯å£ã€‚æœ‰å¯èƒ½ä¸åŸå§‹æœåŠ¡å™¨ç«¯å£ä¸åŒã€‚é»˜è®¤ç«¯å£ä¸º 0ï¼Œè¡¨ç¤ºä¸åŸæ¥çš„åç«¯æœåŠ¡å™¨ç›¸åŒ</p></li><li><p><code>check_http_send</code>ï¼šå‘é€ç»™åç«¯æœåŠ¡å™¨çš„è¯·æ±‚æ•°æ®æŠ¥æ–‡</p></li><li><p><code>check_http_expect_alive</code>ï¼šåˆ¤æ–­åç«¯æœåŠ¡å™¨ä¸ºå¥åº·çš„ç›¸åº”çŠ¶æ€ç </p></li><li><p><code>check_status</code>ï¼šé€šè¿‡ HTTP æ–¹å¼æ˜¾ç¤ºå¥åº·æ£€æŸ¥æœåŠ¡å™¨çš„çŠ¶æ€ã€‚</p></li></ul><p>è®¾ Nginx æœåŠ¡å™¨ IP åœ°å€ä¸ºï¼š<code>192.168.60.156</code>ï¼Œåˆ™å¥åº·ç›‘æ§é¡µé¢çš„è®¿é—®åœ°å€ï¼š<a href="http://192.168.60.156:8080/status" target="_blank" rel="noopener">http://192.168.60.156:8080/status</a></p><p>å¯ä»¥æŒ‡å®šå¦‚ä¸‹ URL å‚æ•°æŒ‡å®šå¥åº·ç›‘æ§é¡µé¢å“åº”çš„æ•°æ®æ ¼å¼</p><ul><li><code>/status?format=html</code></li><li><code>/status?format=csv</code></li><li><code>/status?format=json</code></li></ul><p>å¥åº·ç›‘æ§é¡µé¢æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="/devops/../images/loading-post.gif" data-original="nginx/image-20230612161929459.png" alt="image-20230612161929459"></p></blockquote><h4 id="3-é€šè¿‡åå‘ä»£ç†å®ç°åŠ¨é™åˆ†ç¦»"><a class="header-anchor" href="#3-é€šè¿‡åå‘ä»£ç†å®ç°åŠ¨é™åˆ†ç¦»">Â¶</a>3ï¼‰é€šè¿‡åå‘ä»£ç†å®ç°åŠ¨é™åˆ†ç¦»</h4><p><img src="/devops/../images/loading-post.gif" data-original="nginx/image-20191125010102331.png" alt="image-20191125010102331"></p><blockquote><p>è¿™é‡Œçš„é™æ€èµ„æºç”¨å›¾ç‰‡æ¥è¡¨ç¤ºï¼Œè€ŒåŠ¨æ€èµ„æºç”¨ jsp æ¥è¡¨ç¤ºã€‚</p></blockquote><h5 id="1-ä½¿ç”¨tomcaté…ç½®åŠ¨æ€èµ„æº"><a class="header-anchor" href="#1-ä½¿ç”¨tomcaté…ç½®åŠ¨æ€èµ„æº">Â¶</a>1. ä½¿ç”¨tomcaté…ç½®åŠ¨æ€èµ„æº</h5><blockquote><p>è¯´æ˜ï¼š</p><ul><li>å®‰è£… jdk å¹¶é…ç½®ç¯å¢ƒå˜é‡</li><li>å®‰è£… tomcatï¼Œå®˜æ–¹ä¸‹è½½è§£å‹å³ç”¨ï¼ˆè®¾å®‰è£…è·¯å¾„ä¸ºï¼š<code>/opt/apache-tomcat-8.5.31</code>ï¼‰</li></ul></blockquote><p>ï¼ˆ1ï¼‰åœ¨ tomcat web æ ¹ç›®å½•é‡Œåˆ›å»ºä¸€ä¸ª jsp æµ‹è¯•æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/apache-tomcat-8.5.31/webapps/ROOT/java_test.jsp</span><br></pre></td></tr></table></figure><p>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"utf-8"</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;JSP Test Page&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">        Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">        out.println(<span class="string">"&lt;h2&gt;Random number:&lt;/h2&gt;"</span>);</span><br><span class="line">        out.println(rand.nextInt(<span class="number">99</span>)+<span class="number">100</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰è¿è¡Œ tomcat</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh /opt/apache-tomcat-8.5.31/bin/startup.sh</span><br></pre></td></tr></table></figure><h5 id="2-ä½¿ç”¨nginxé…ç½®é™æ€èµ„æºå’Œåå‘ä»£ç†"><a class="header-anchor" href="#2-ä½¿ç”¨nginxé…ç½®é™æ€èµ„æºå’Œåå‘ä»£ç†">Â¶</a>2. ä½¿ç”¨nginxé…ç½®é™æ€èµ„æºå’Œåå‘ä»£ç†</h5><p>ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ª nginx é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/nginx/conf/conf.d/dynamic_static.conf</span><br></pre></td></tr></table></figure><p>é…ç½®å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é™æ€èµ„æº</span></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span> /opt/nginx/html;</span><br><span class="line">        <span class="attribute">index</span> index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># åŠ¨æ€èµ„æº</span></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ .*\.jsp$</span> &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://192.168.60.102:8080; <span class="comment"># åå‘ä»£ç†åˆ° Tomcat</span></span><br><span class="line">        <span class="comment">#ä»£ç†åˆ°tomcatç­‰æœåŠ¡å™¨æ—¶æ³¨æ„è¦è®¾ç½®è¯·æ±‚å‚æ•°ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨è®¾ç½®æœ‰ç±»ä¼¼é˜²ç›—é“¾æˆ–è€…æ ¹æ®httpè¯·æ±‚å¤´ä¸­çš„hostå­—æ®µæ¥è¿›è¡Œè·¯ç”±æˆ–åˆ¤æ–­åŠŸèƒ½çš„è¯ï¼Œå¦‚æœåå‘ä»£ç†å±‚çš„nginxä¸é‡å†™è¯·æ±‚å¤´ä¸­çš„hostå­—æ®µï¼Œå°†ä¼šå¯¼è‡´è¯·æ±‚å¤±è´¥ï¼ŒæŠ¥400é”™è¯¯ã€‚æ•…è‡³å°‘è¦åŒ…å«proxy_set_header Host $http_host;ä¸ºäº†æ–¹ä¾¿ï¼Œä»¥ä¸‹é…ç½®äº†è·Ÿå¤šçš„è¯·æ±‚å‚æ•°ã€‚</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">        <span class="comment"># proxy_redirect default;</span></span><br><span class="line">        <span class="comment"># proxy_set_header X-Real-IP $remote_addr;</span></span><br><span class="line">        <span class="comment"># proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span><br><span class="line">        <span class="comment"># proxy_connect_timeout 30;</span></span><br><span class="line">        <span class="comment"># proxy_send_timeout 60;</span></span><br><span class="line">        <span class="comment"># proxy_read_timeout 60;</span></span><br><span class="line">        <span class="comment"># proxy_buffer_size 32k;</span></span><br><span class="line">        <span class="comment"># proxy_buffering on;</span></span><br><span class="line">        <span class="comment"># proxy_buffers 4 128k;</span></span><br><span class="line">        <span class="comment"># proxy_busy_buffers_size 256k;</span></span><br><span class="line">        <span class="comment"># proxy_max_temp_file_size 256k;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰ä¸Šä¼ ä¸€å¼ é™æ€èµ„æºæ–‡ä»¶å›¾ç‰‡ï¼ˆå¦‚ï¼š<code>logo.jpg</code>ï¼‰åˆ°é‡Œ <code>/opt/nginx/html</code> ç›®å½•é‡Œã€‚</p><p>ï¼ˆ3ï¼‰ä¸ºäº†èƒ½ä½“ç°å‡ºåŠ¨é™åˆ†ç¦»çš„æ•ˆæœï¼Œå¯åˆ›å»ºä¸€ä¸ªåŒæ—¶æœ‰é™æ€èµ„æºå†…å®¹åˆæœ‰é™æ€èµ„æºå†…å®¹çš„ html æµ‹è¯•æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/nginx/html/dynamic_static.html</span><br></pre></td></tr></table></figure><p>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>æµ‹è¯•nginxåŠ¨é™åˆ†ç¦»<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://libs.baidu.com/jquery/2.1.4/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">         $.ajax(&#123;</span></span><br><span class="line"><span class="actionscript">                type: <span class="string">"GET"</span>,</span></span><br><span class="line"><span class="actionscript">                url: <span class="string">"/java_test.jsp"</span>,</span></span><br><span class="line"><span class="actionscript">                success: <span class="function"><span class="keyword">function</span><span class="params">(data)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                        $(<span class="string">"#get_data"</span>).html(data)</span></span><br><span class="line">                &#125;,</span><br><span class="line"><span class="actionscript">                error: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                        alert(<span class="string">"fail!!,è¯·åˆ·æ–°å†è¯•!"</span>);</span></span><br><span class="line">                &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">"color: #0688e8;"</span>&gt;</span>æµ‹è¯•åŠ¨é™åˆ†ç¦»<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>é™æ€æ•°æ®:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/logo.jpg"</span> <span class="attr">height</span>=<span class="string">"200"</span> <span class="attr">width</span>=<span class="string">"200"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>åŠ¨æ€æ•°æ®:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"get_data"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰é…ç½®é˜²ç«å¢™å’Œé‡è½½ nginx é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é˜²ç«å¢™å¼€æ”¾ç›¸å…³ç›‘å¬ç«¯å£</span></span><br><span class="line">firewall-cmd --permanent --add-port=8080/tcp</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡è½½é…ç½®</span></span><br><span class="line">/opt/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure><h5 id="3-è®¿é—®æµ‹è¯•"><a class="header-anchor" href="#3-è®¿é—®æµ‹è¯•">Â¶</a>3. è®¿é—®æµ‹è¯•</h5><blockquote><p>è®¾æœåŠ¡å™¨ IP åœ°å€ä¸ºï¼š<code>198.23.188.200</code>ï¼Œåˆ™æµ‹è¯•å¦‚ä¸‹ï¼š</p><ul><li><p>è®¿é—®é™æ€èµ„æºï¼š<a href="http://198.23.188.200:8080/logo.jpg" target="_blank" rel="noopener">http://198.23.188.200:8080/logo.jpg</a></p></li><li><p>è®¿é—®åŠ¨æ€èµ„æºï¼š<a href="http://198.23.188.200:8080/java_test.jsp" target="_blank" rel="noopener">http://198.23.188.200:8080/java_test.jsp</a></p></li><li><p>è®¿é—®åŠ¨é™åˆ†ç¦»é¡µé¢ï¼š<a href="http://198.23.188.200:8080/dynamic_static.html" target="_blank" rel="noopener">http://198.23.188.200:8080/dynamic_static.html</a></p></li></ul></blockquote><h2 id="ä¹-é…ç½®sslè¯ä¹¦ä»¥ä½¿ç”¨https"><a class="header-anchor" href="#ä¹-é…ç½®sslè¯ä¹¦ä»¥ä½¿ç”¨https">Â¶</a>ä¹ã€é…ç½®sslè¯ä¹¦ä»¥ä½¿ç”¨https</h2><p>ä½¿ç”¨ https å°±éœ€è¦é…ç½® ssl è¯ä¹¦ã€‚ä¸€èˆ¬åœ°ï¼Œè·å– ssl è¯ä¹¦æœ‰ä¸¤ç§æ–¹å¼ï¼šè‡ªç­¾åå’Œè´­ä¹° CA é¢å‘çš„ ssl è¯ä¹¦ã€‚è‡ªç­¾åçš„è¯ä¹¦å¯èƒ½ä¼šè¢«æµè§ˆå™¨æ‹¦æˆªå¹¶æç¤ºä¸å—ä¿¡ä»»ï¼Œå› æ­¤å»ºè®®é‡‡ç”¨æ¯”è¾ƒå¯é çš„å•†ä¸šé¢å‘æœºæ„è´­ä¹°ï¼ˆå¦‚ Comodoã€Symantec ç­‰ï¼‰æˆ–è€…å…è´¹çš„ Letâ€™s Encrypt ç­¾å‘çš„è¯ä¹¦ã€‚å¯ä»¥ä½¿ç”¨ certbot å·¥å…·æ¥ç”³è¯·å¾—åˆ°å…è´¹ Letâ€™ s Encrypt SSL è¯ä¹¦ã€‚å…·ä½“æ“ä½œå¯å‚è€ƒ<a href="../tools/certbot.html" name="../tools/certbot.md" id="hexo-md-link">ã€Šé€šè¿‡certbotå·¥å…·ç”Ÿæˆsslè¯ä¹¦ã€‹</a>ã€‚å‡è®¾è¿™é‡Œå·²ç»ç”³è¯·å¾—åˆ°äº† Letâ€™ s Encrypt SSL è¯ä¹¦ï¼Œä¸‹æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨ nginx ä¸­é…ç½® ssl è¯ä¹¦ä»¥ä½¿ç”¨ https ã€‚</p><h3 id="1-åˆ›å»ºnginxé…ç½®æ–‡ä»¶"><a class="header-anchor" href="#1-åˆ›å»ºnginxé…ç½®æ–‡ä»¶">Â¶</a>1. åˆ›å»ºnginxé…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/nginx/conf/conf.d/https.conf</span><br></pre></td></tr></table></figure><p>é…ç½®å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> example.com;</span><br><span class="line">    <span class="comment">#ssl_certificate /path/cert.pem;</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /path/fullchain.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /path/privkey.pem;</span><br><span class="line">    <span class="comment">#ssl_trusted_certificate /path/chain.pem;</span></span><br><span class="line">    <span class="comment">#ssl_trusted_certificate /path/fullchain.pem;</span></span><br><span class="line">    <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># httpèµ„æºæœåŠ¡</span></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span> /opt/nginx/html;</span><br><span class="line">        <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åå‘ä»£ç†</span></span><br><span class="line">    <span class="comment"># location ^~ /app &#123;</span></span><br><span class="line">    <span class="comment">#     proxy_pass http://127.0.0.1:8080;</span></span><br><span class="line">    <span class="comment">#     proxy_set_header Host $host:$server_port;</span></span><br><span class="line">    <span class="comment">#     proxy_set_header X-Real-IP $remote_addr;</span></span><br><span class="line">    <span class="comment">#     proxy_set_header REMOTE-HOST $remote_addr;</span></span><br><span class="line">    <span class="comment">#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span><br><span class="line">    <span class="comment">#     client_max_body_size 100m;</span></span><br><span class="line">    <span class="comment"># &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ğŸ’â€â™‚ nginx SSL è¯ä¹¦é…ç½®è¯´æ˜ï¼š</p><ul><li><p><code>ssl_certificate</code>ï¼šSSLè¯ä¹¦è·¯å¾„ã€‚ï¼ˆå¯é…ç½®ä¸ºæœåŠ¡ç«¯è¯ä¹¦æˆ–å…¨é“¾è¯ä¹¦ï¼‰</p></li><li><p><code>ssl_certificate_key</code>ï¼šç§é’¥æ–‡ä»¶è·¯å¾„ã€‚</p></li><li><p><code>ssl_trusted_certificate</code>ï¼šå¯ä¿¡ä»»çš„è¯ä¹¦é“¾æ–‡ä»¶è·¯å¾„ã€‚ï¼ˆå¯é…ç½®ä¸ºä¸­é—´è¯ä¹¦æˆ–å…¨é“¾è¯ä¹¦ï¼‰</p></li></ul><p>å¦‚æœ<code>ssl_certificate</code>é…ç½®çš„è¯ä¹¦ä¸ºæœåŠ¡ç«¯è¯ä¹¦è€Œä¸åŒ…å«ä¸­é—´è¯ä¹¦ï¼Œåˆ™åº”è¯¥é…ç½® <code>ssl_trusted_certificate</code> æ¥æŒ‡å®šå¯ä¿¡ä»»çš„è¯ä¹¦é“¾æ–‡ä»¶ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯èƒ½å¤Ÿæ­£ç¡®éªŒè¯æœåŠ¡ç«¯è¯ä¹¦çš„çœŸå®æ€§ã€‚ä½†ç”±äºç›®å‰ä¸»æµCAæœåŠ¡å•†ï¼ˆåŒ…æ‹¬ Letâ€™s Encrypt ï¼‰çš„æ ¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦éƒ½å·²ç»è¢«å¤§å¤šæ•°å®¢æˆ·ç«¯ï¼ˆå¦‚ï¼šä¸»æµçš„æµè§ˆå™¨ï¼‰çš„è¯ä¹¦ä¿¡ä»»åˆ—è¡¨æ‰€æ¥å—ï¼Œæ‰€ä»¥æœåŠ¡ç«¯é…ç½®ä¸­å³ä½¿ç¼ºå°‘ä¸­é—´è¯ä¹¦å’Œæ ¹è¯ä¹¦ï¼Œå®¢æˆ·ç«¯ä»ç„¶å¯ä»¥æ­£ç¡®åœ°éªŒè¯æœåŠ¡å™¨è¯ä¹¦çš„çœŸå®æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>ssl_certificate</code> é…ç½® ä¸»æµCAç­¾å‘çš„ SSL è¯ä¹¦æ—¶ï¼Œå³ä½¿ä¸æ˜¯å…¨é“¾è¯ä¹¦ä¹Ÿèƒ½è¢«å¤§å¤šæ•°ä¸»æµçš„å®¢æˆ·ç«¯ä¿¡ä»»ã€‚</p><p>ğŸ’â€â™‚ å…³äºè¯ä¹¦é“¾çš„è¯´æ˜ï¼š</p><ul><li>å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨è¯ä¹¦çš„çœŸå®æ€§æ˜¯é€šè¿‡è¯ä¹¦é“¾æ¥å®ç°çš„ã€‚å¦‚æœè¯ä¹¦é“¾ä¸­æœ€é¡¶å±‚çš„è¯ä¹¦ï¼ˆå³CAæ ¹è¯ä¹¦ï¼‰åœ¨å®¢æˆ·ç«¯çš„ä¿¡ä»»åˆ—è¡¨é‡Œï¼Œå®¢æˆ·ç«¯ä¼šä»ä¸Šå¾€ä¸‹æŒ‰åºéªŒè¯æ¯å±‚è¯ä¹¦çš„çœŸå®æ€§ï¼Œæ¯ä¸€å±‚éƒ½ä½¿ç”¨ä¸Šä¸€å±‚è¯ä¹¦çš„å…¬é’¥æ¥éªŒè¯ä¸‹ä¸€å±‚è¯ä¹¦çš„ç­¾åï¼Œç›´åˆ°éªŒè¯åˆ°æœåŠ¡å™¨è¯ä¹¦ä¸ºæ­¢ã€‚å¦‚æœè¯ä¹¦é“¾ç¼ºå°‘ä¸­é—´è¯ä¹¦ï¼Œåˆ™å®¢æˆ·ç«¯æ— æ³•éªŒè¯è¯¥è¯ä¹¦é“¾çš„å®Œæ•´æ€§ï¼Œä¹Ÿå°±æ— æ³•éªŒè¯æœåŠ¡ç«¯è¯ä¹¦çš„çœŸå®æ€§ã€‚å› æ­¤ï¼Œå¿…é¡»åŒ…æ‹¬æ‰€æœ‰ä¸­é—´è¯ä¹¦ä»¥åŠæ ¹è¯ä¹¦æ‰èƒ½æ„å»ºå®Œæ•´çš„è¯ä¹¦é“¾ã€‚åªæœ‰åœ¨è¯ä¹¦é“¾å®Œæ•´ä¸”éªŒè¯æˆåŠŸçš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æ‰èƒ½ä¿¡ä»»æœåŠ¡å™¨è¯ä¹¦å¹¶ä¸å…¶å»ºç«‹å®‰å…¨è¿æ¥ã€‚</li><li>å®¢æˆ·ç«¯çš„ä¿¡ä»»åˆ—è¡¨ä¸€èˆ¬åŒ…æ‹¬æœ‰æ ¹è¯ä¹¦ã€ä¸­é—´è¯ä¹¦ä»¥åŠå…¶ä»–å¯ä¿¡ä»»çš„è¯ä¹¦ç­‰ã€‚</li></ul></blockquote><h3 id="2-é…ç½®é˜²ç«å¢™å’Œé‡è½½nginxé…ç½®"><a class="header-anchor" href="#2-é…ç½®é˜²ç«å¢™å’Œé‡è½½nginxé…ç½®">Â¶</a>2. é…ç½®é˜²ç«å¢™å’Œé‡è½½nginxé…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é˜²ç«å¢™å¼€æ”¾ç›¸å…³ç›‘å¬ç«¯å£</span></span><br><span class="line">firewall-cmd --permanent --add-port=443/tcp</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡è½½é…ç½®ï¼ˆé‡æ–°åŠ è½½ nginx é…ç½®ä»¥ä½¿å¾— SSL è¯ä¹¦ç”Ÿæ•ˆï¼‰</span></span><br><span class="line">/opt/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure><h3 id="3-æµ‹è¯•httpsè®¿é—®"><a class="header-anchor" href="#3-æµ‹è¯•httpsè®¿é—®">Â¶</a>3. æµ‹è¯•httpsè®¿é—®</h3><p>åˆ›å»ºä¸€ä¸ªå¾…æµ‹è¯•çš„htmlé™æ€èµ„æºæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;h1&gt;Hi, Nginx !&lt;/h1&gt;"</span> &gt;&gt; /opt/nginx/html/<span class="built_in">test</span>-https.html</span><br></pre></td></tr></table></figure><blockquote><p>è®¿é—®åœ°å€ä¸ºï¼š<a href="https://example.com/test-https.html" target="_blank" rel="noopener">https://example.com/test-https.html</a></p></blockquote><h2 id="å-é…ç½®nginxè¿›ç¨‹å’Œå…¶æ‰§è¡Œç”¨æˆ·"><a class="header-anchor" href="#å-é…ç½®nginxè¿›ç¨‹å’Œå…¶æ‰§è¡Œç”¨æˆ·">Â¶</a>åã€é…ç½®nginxè¿›ç¨‹å’Œå…¶æ‰§è¡Œç”¨æˆ·</h2><h3 id="1-nginxè¿›ç¨‹"><a class="header-anchor" href="#1-nginxè¿›ç¨‹">Â¶</a>1. nginxè¿›ç¨‹</h3><p>åœ¨ Nginx çš„ä¸»è¿›ç¨‹å¯åŠ¨åï¼Œä¼šåˆ›å»ºå¤šä¸ªå­è¿›ç¨‹æ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚å’Œå…¶ä»–ä»»åŠ¡ã€‚è¿™äº›å­è¿›ç¨‹é€šå¸¸ç”± Nginx ä¸»è¿›ç¨‹è´Ÿè´£ç®¡ç†ã€è°ƒåº¦å’Œç›‘æ§ã€‚</p><blockquote><p>Nginx å­è¿›ç¨‹é€šå¸¸åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><ul><li><code>master process</code>ï¼ˆä¸»è¿›ç¨‹ï¼‰ï¼šNginx çš„ä¸»è¿›ç¨‹ï¼Œè´Ÿè´£ç®¡ç†æ‰€æœ‰å­è¿›ç¨‹ï¼Œæ¥æ”¶å’Œå¤„ç†æ¥è‡ªå‘½ä»¤è¡Œçš„ä¿¡å·ï¼Œå¹¶å¯åŠ¨æ•´ä¸ª Nginx æœåŠ¡ã€‚</li><li><code>worker process</code>ï¼ˆå·¥ä½œè¿›ç¨‹ï¼‰ï¼šNginx çš„å·¥ä½œè¿›ç¨‹ï¼Œè´Ÿè´£å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚å’Œå…¶ä»–ä»»åŠ¡ï¼Œæ¯ä¸ªå·¥ä½œè¿›ç¨‹éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚</li><li><code>cache loader process</code>ï¼ˆç¼“å­˜åŠ è½½è¿›ç¨‹ï¼‰ï¼šç”¨äºåŠ è½½å’Œé¢„çƒ­ç¼“å­˜æ•°æ®çš„è¿›ç¨‹ï¼Œåªæœ‰åœ¨å¼€å¯ç¼“å­˜åŠŸèƒ½æ—¶æ‰ä¼šå¯åŠ¨ã€‚</li><li><code>cache manager process</code>ï¼ˆç¼“å­˜ç®¡ç†è¿›ç¨‹ï¼‰ï¼šç”¨äºç®¡ç†ç¼“å­˜æ•°æ®å’Œå¤„ç†ç¼“å­˜æ¸…ç†çš„è¿›ç¨‹ï¼Œåªæœ‰åœ¨å¼€å¯ç¼“å­˜åŠŸèƒ½æ—¶æ‰ä¼šå¯åŠ¨ã€‚</li></ul></blockquote><p>é€šå¸¸é…ç½®å·¥ä½œè¿›ç¨‹ä»¥æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŒ‡å®šå¯åŠ¨çš„å·¥ä½œè¿›ç¨‹æ•°é‡ï¼ˆé»˜è®¤å€¼ä¸ºï¼šautoï¼Œè¡¨ç¤ºä»¥CPUæ ¸å¿ƒæ•°å†³å®šå·¥ä½œè¿›ç¨‹æ•°é‡ï¼‰</span></span><br><span class="line"><span class="attribute">worker_processes</span> <span class="number">2</span>;</span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="comment">#è®¾ç½®æ¯ä¸ªå·¥ä½œè¿›ç¨‹ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„æœ€å¤§è¿æ¥æ•°ï¼ˆé»˜è®¤å€¼ä¸ºï¼š512ï¼‰</span></span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä»¥ä¸‹ä¸ºå…¶ä»–æ— å…³é…ç½®...</span></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">   <span class="comment"># å…¶ä»–é…ç½®é¡¹...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-nginxè¿›ç¨‹æ‰§è¡Œç”¨æˆ·"><a class="header-anchor" href="#2-nginxè¿›ç¨‹æ‰§è¡Œç”¨æˆ·">Â¶</a>2. nginxè¿›ç¨‹æ‰§è¡Œç”¨æˆ·</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNginx å¯åŠ¨åä¼šåˆ›å»ºä¸€ä¸ªä¸»è¿›ç¨‹å’Œå¤šä¸ªå·¥ä½œè¿›ç¨‹ï¼Œå…¶ä¸­ä¸»è¿›ç¨‹ä¸ºè¿è¡ŒnginxæœåŠ¡çš„linuxç”¨æˆ·ï¼ˆé€šå¸¸æ˜¯ root ç”¨æˆ·ï¼‰ï¼Œè€Œæ¯ä¸ªå·¥ä½œè¿›ç¨‹éƒ½æ˜¯ä»¥æŒ‡å®šç”¨æˆ·èº«ä»½æ¥æ‰§è¡Œçš„ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ä»¥ <code>nobody</code> ç”¨æˆ·èº«ä»½è¿è¡Œã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ <code>user</code> æŒ‡ä»¤æ¥æ”¹å˜å·¥ä½œè¿›ç¨‹çš„æ‰§è¡Œç”¨æˆ·ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p><p>(1) åˆ›å»ºnginxå·¥ä½œè¿›ç¨‹çš„æ‰§è¡Œç”¨æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ›å»ºnginxç”¨æˆ·å’ŒåŒåç”¨æˆ·ç»„ï¼Œä¸è‡ªåŠ¨åˆ›å»ºç”¨æˆ·ä¸»ç›®å½•ï¼Œç¦æ­¢è¯¥ç”¨æˆ·ç™»å½•ç³»ç»Ÿ</span></span><br><span class="line">useradd -U -M -s /usr/sbin/nologin nginx</span><br></pre></td></tr></table></figure><p>(2) ä¿®æ”¹ nginx ä¸»é…ç½®æ–‡ä»¶<code>nginx.conf</code>ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¿®æ”¹useræŒ‡ä»¤å³å¯</span></span><br><span class="line"><span class="attribute">user</span>  nginx; <span class="comment">#nginxå·¥ä½œè¿›ç¨‹çš„æ‰§è¡Œç”¨æˆ·</span></span><br><span class="line"><span class="comment">#user  nginx nginx; #æŒ‡å®šç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šç”¨æˆ·ç»„ï¼Œåˆ™ä½¿ç”¨é»˜è®¤ç”¨æˆ·ç»„</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä»¥ä¸‹ä¸ºå…¶ä»–æ— å…³é…ç½®...</span></span><br><span class="line"><span class="attribute">worker_processes</span> <span class="number">1</span>;</span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment"># å…¶ä»–é…ç½®é¡¹...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä¿®æ”¹ nginx ç”¨æˆ·åéœ€è¦æ³¨æ„ä¹Ÿè¦åŒæ—¶ä¿®æ”¹ä¸€äº› nginx ç›¸å…³çš„ä¸´æ—¶æ–‡ä»¶æƒé™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown -R nginx:nginx /opt/nginx/proxy_temp</span><br><span class="line">chown -R nginx:nginx /opt/nginx/logs</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰é‡è½½nginxé…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é‡è½½é…ç½®</span></span><br><span class="line">/opt/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure><h2 id="åä¸€-é…ç½®æ–‡ä»¶æ¨¡å—åŒ–"><a class="header-anchor" href="#åä¸€-é…ç½®æ–‡ä»¶æ¨¡å—åŒ–">Â¶</a>åä¸€ã€é…ç½®æ–‡ä»¶æ¨¡å—åŒ–</h2><h3 id="ç®€è¦æ¦‚è¿°"><a class="header-anchor" href="#ç®€è¦æ¦‚è¿°">Â¶</a>ç®€è¦æ¦‚è¿°</h3><p>åœ¨ Nginx é…ç½®æ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>include</code> æŒ‡ä»¤æ¥å®ç°æ¨¡å—åŒ–ã€‚ä»è€Œè®©é…ç½®æ–‡ä»¶å…·æœ‰å¯å¤ç”¨æ€§å’Œæ›´æ˜“ç»´æŠ¤æ€§ã€‚</p><p>å…·ä½“è¡¨ç°ä¸ºï¼šå…è®¸ç”¨æˆ·å°†é…ç½®æ–‡ä»¶æ‹†åˆ†ä¸ºæ›´å°çš„é…ç½®æ–‡ä»¶ï¼Œä½¿é…ç½®æ›´åŠ æ¸…æ™°å’Œå¯ç»´æŠ¤ã€‚ç„¶åé€šè¿‡ <code>include</code> æŒ‡ä»¤æ¥åŒ…å«è¿™äº›è¢«æ‹†åˆ†çš„é…ç½®æ–‡ä»¶åˆ°æŸä¸ªé…ç½®æ–‡ä»¶ä¸­ã€‚</p><h3 id="include-æŒ‡ä»¤çš„è¯­æ³•"><a class="header-anchor" href="#include-æŒ‡ä»¤çš„è¯­æ³•">Â¶</a>include æŒ‡ä»¤çš„è¯­æ³•</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">include</span> file | mask;</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­ï¼š</p><ul><li><code>file</code> æ˜¯è¦åŒ…å«çš„å•ä¸ªæ–‡ä»¶çš„è·¯å¾„ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹äº Nginx é…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚</li><li><code>mask</code> æ˜¯ä¸€ä¸ªé€šé…ç¬¦è¡¨è¾¾å¼ï¼Œç”¨äºåŒ¹é…å¤šä¸ªæ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨é€šé…ç¬¦å­—ç¬¦ <code>*</code> å’Œ <code>?</code>ã€‚</li></ul></blockquote><h3 id="include-æŒ‡ä»¤ä½¿ç”¨ç¤ºä¾‹"><a class="header-anchor" href="#include-æŒ‡ä»¤ä½¿ç”¨ç¤ºä¾‹">Â¶</a>include æŒ‡ä»¤ä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åŒ…å«å•ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="attribute">include</span> /path/to/file.conf;</span><br><span class="line"></span><br><span class="line"><span class="comment">#åŒ…å«å¤šä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨é€šé…ç¬¦åŒ¹é…</span></span><br><span class="line"><span class="attribute">include</span> /path/to/conf.d/<span class="regexp">*.conf</span>;</span><br></pre></td></tr></table></figure><blockquote><p>è¯·æ³¨æ„ï¼Œ<code>include</code> æŒ‡ä»¤å¯ä»¥å‡ºç°åœ¨ä»»ä½•é€‚å½“çš„ä½ç½®ï¼Œä»¥åŒ…å«å…¶ä»–é…ç½®æ–‡ä»¶çš„å†…å®¹ã€‚å½“ Nginx è¯»å–é…ç½®æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šæŒ‰ç…§æŒ‡ä»¤çš„é¡ºåºé€è¡Œè§£æï¼Œå¹¶å°†åŒ…å«çš„æ–‡ä»¶å†…å®¹åˆå¹¶åˆ°æœ€ç»ˆçš„é…ç½®ä¸­ã€‚</p></blockquote><h2 id="åä¸€-é…ç½®æ—¥å¿—"><a class="header-anchor" href="#åä¸€-é…ç½®æ—¥å¿—">Â¶</a>åä¸€ã€é…ç½®æ—¥å¿—</h2><p>Nginx é»˜è®¤æœ‰ä¸¤ç§æ—¥å¿—æ–‡ä»¶çš„è®°å½•ï¼Œå³ <code>error_log</code>ï¼ˆé”™è¯¯æ—¥å¿—ï¼‰å’Œ <code>access_log</code>ï¼ˆè®¿é—®æ—¥å¿—ï¼‰ã€‚ç”¨æˆ·å¯ä»¥åˆ†åˆ«å¯¹è¿™ä¸¤ç§æ—¥å¿—æ–‡ä»¶è¿›è¡Œç›¸å…³è‡ªå®šä¹‰é…ç½®ã€‚</p><h3 id="error-log-é”™è¯¯æ—¥å¿—é…ç½®"><a class="header-anchor" href="#error-log-é”™è¯¯æ—¥å¿—é…ç½®">Â¶</a><code>error_log</code> é”™è¯¯æ—¥å¿—é…ç½®</h3><p><code>error_log</code> å‘½ä»¤ç”¨äºè®°å½• Nginx çš„é”™è¯¯ä¿¡æ¯ï¼Œå¯ä»¥é…ç½® <code>off</code>åœæ­¢æ—¥å¿—è®°å½•ï¼Œæˆ–è€…é…ç½®æ—¥å¿—è·¯å¾„å’Œé”™è¯¯çº§åˆ«è¿›è¡Œæ—¥å¿—è®°å½•ï¼Œé»˜è®¤æ”¯æŒçš„é”™è¯¯çº§åˆ«å¦‚ä¸‹ï¼š</p><blockquote><ul><li><code>error</code>ï¼šè®°å½•é”™è¯¯æ¶ˆæ¯ã€‚</li><li><code>warn</code>ï¼šè®°å½•è­¦å‘Šæ¶ˆæ¯å’Œé”™è¯¯æ¶ˆæ¯ã€‚</li><li><code>notice</code>ï¼šè®°å½•æ™®é€šä½†é‡è¦çš„ä¿¡æ¯ã€‚</li><li><code>info</code>ï¼šè®°å½•æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œé€šå¸¸ç”¨äºè°ƒè¯•ã€‚</li><li><code>debug</code>ï¼šè®°å½•è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œé€šå¸¸ç”¨äºè¯¦å°½çš„æ•…éšœæ’é™¤ã€‚</li></ul></blockquote><p>ä½¿ç”¨æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">error_log</span>  logs/error.log  <span class="literal">error</span>;</span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"><span class="comment">#error_log off; #åœæ­¢é”™è¯¯æ—¥å¿—è®°å½•</span></span><br></pre></td></tr></table></figure><h3 id="access-log-è®¿é—®æ—¥å¿—é…ç½®"><a class="header-anchor" href="#access-log-è®¿é—®æ—¥å¿—é…ç½®">Â¶</a><code>access_log</code> è®¿é—®æ—¥å¿—é…ç½®</h3><p><code>access_log</code> å‘½ä»¤ç”¨äºè®°å½•å®¢æˆ·ç«¯è¯·æ±‚çš„è®¿é—®æ—¥å¿—ï¼Œå¯ä»¥é…ç½® <code>off</code>åœæ­¢æ—¥å¿—è®°å½•ï¼Œæˆ–è€…é…ç½®æ—¥å¿—è·¯å¾„å’Œæ—¥å¿—æ ¼å¼è¿›è¡Œæ—¥å¿—è®°å½•ï¼Œé»˜è®¤æ”¯æŒï¼š<code>combined</code>ï¼ˆé»˜è®¤ï¼Œå³éƒ½ä¸é…ç½®æ—¥å¿—çš„æƒ…å†µï¼‰ã€<code>main</code>ï¼ˆå®‰è£…åé€šå¸¸è‡ªåŠ¨ä½¿ç”¨çš„æ ¼å¼ï¼‰ è¿™äº›æ—¥å¿—æ ¼å¼ï¼Œå½“ç„¶ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">log_format</span> custom  <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" '</span></span><br><span class="line">                   <span class="string">'<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span><br><span class="line">                   <span class="string">'"<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span><br><span class="line"><span class="comment">#log_format custom 'è¯·æ±‚æ—¶é—´=$time_iso8601 | è¯·æ±‚IP=$remote_addr | è¯·æ±‚URL=$request | è¯·æ±‚æ•°æ®ç±»å‹=$http_content_type | è¯·æ±‚ä»£ç†=$http_user_agent | è¯·æ±‚å¤´å¤§å°=$body_bytes_sent | æ¥æºURLåœ°å€=$http_referer | å®¢æˆ·ç«¯çš„çœŸå®IP=$http_x_forwarded_for | å“åº”çŠ¶æ€ç =$status | å“åº”æ•°æ®ç±»å‹=$sent_http_content_type | å“åº”æ—¶é—´=$upstream_response_time';</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">access_log</span>  logs/access.log  custom;</span><br><span class="line"></span><br><span class="line"><span class="comment">#access_log off; #åœæ­¢è®¿é—®æ—¥å¿—è®°å½•</span></span><br></pre></td></tr></table></figure><h3 id="æŒ‰ç…§æ—¥æœŸæ ¼å¼é…ç½®æ—¥å¿—æ–‡ä»¶åç§°"><a class="header-anchor" href="#æŒ‰ç…§æ—¥æœŸæ ¼å¼é…ç½®æ—¥å¿—æ–‡ä»¶åç§°">Â¶</a>æŒ‰ç…§æ—¥æœŸæ ¼å¼é…ç½®æ—¥å¿—æ–‡ä»¶åç§°</h3><p>éšç€ nginx é•¿æ—¶é—´è¿è¡Œï¼Œæ—¥å¿—æ–‡ä»¶ä¹Ÿä¼šå˜å¾—è¶Šæ¥è¶Šå¤šï¼Œç”šè‡³å‡ ä¸ªæœˆå°±è¾¾åˆ°äº†å‡ ä¸ª GB çš„å¤§å°ï¼Œè¿™ä¼šå¯¼è‡´åœ¨æ’æŸ¥æ—¥å¿—æ—¶ä¼šç”±äºå†…å®¹å¤ªå¤šè€Œä¸å¥½å®šä½ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é…ç½® nginx è®°å½•æ—¥å¿—æ—¶æŒ‰ç…§æ—¥æœŸè®°å½•åˆ°ä¸åŒçš„æ–‡ä»¶é‡Œï¼Œä»è€Œå®ç°æ—¥å¿—åˆ‡å‰²çš„æ•ˆæœã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">log_format</span> custom  <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" '</span></span><br><span class="line">                   <span class="string">'<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span><br><span class="line">                   <span class="string">'"<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span><br><span class="line"><span class="comment">#log_format custom 'è¯·æ±‚æ—¶é—´=$time_iso8601 | è¯·æ±‚IP=$remote_addr | è¯·æ±‚URL=$request | è¯·æ±‚æ•°æ®ç±»å‹=$http_content_type | è¯·æ±‚ä»£ç†=$http_user_agent | è¯·æ±‚å¤´å¤§å°=$body_bytes_sent | æ¥æºURLåœ°å€=$http_referer | å®¢æˆ·ç«¯çš„çœŸå®IP=$http_x_forwarded_for | å“åº”çŠ¶æ€ç =$status | å“åº”æ•°æ®ç±»å‹=$sent_http_content_type | å“åº”æ—¶é—´=$upstream_response_time';</span></span><br><span class="line"><span class="attribute">map</span> <span class="variable">$time_iso8601</span> <span class="variable">$logdate</span> &#123;</span><br><span class="line">    '~^(?&lt;year&gt;\d&#123;4&#125;)-(?&lt;month&gt;\d&#123;2&#125;)-(?&lt;day&gt;\d&#123;2&#125;)' $year-$month-$day;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">access_log</span> logs/access-<span class="variable">$logdate</span>.log custom;</span><br></pre></td></tr></table></figure><p>è®¾ logs ç›®å½•è·¯å¾„ä¸ºï¼š<code>/opt/nginx/logs</code>ï¼Œåˆ™éœ€è¦ç»™è¯¥ç›®å½•èµ‹äºˆ worker è¿›ç¨‹çš„ç”¨æˆ·æƒé™å’Œæ“ä½œæƒé™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown nginx:nginx /opt/nginx/logs</span><br><span class="line">chmod 755 /opt/nginx/logs</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é‡è½½é…ç½®</span></span><br><span class="line">/opt/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure></div><div><div><br><br><div style="text-align:center;color:#ccc;font-size:14px">----------- æœ¬æ–‡ç»“æŸ -----------</div><br><br><br><br></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>å¦‚æœä½ è§‰å¾—æˆ‘çš„æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä½ å¯ä»¥æ‰“èµæˆ‘å“¦~</div><button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'><span>æ‰“èµ</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="../images/loading-post.gif" data-original="/images/wechatpay.png" alt="Qcmoke å¾®ä¿¡æ”¯ä»˜"><p>å¾®ä¿¡æ”¯ä»˜</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/nginx/" rel="tag"><i class="fa fa-tag"></i> nginx</a></div><div class="post-widgets"><div class="wp_rating"><div id="wpac-rating"></div></div><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/devops/redis.html" rel="prev" title="rediså­¦ä¹ ç¬”è®°"><i class="fa fa-chevron-left"></i> rediså­¦ä¹ ç¬”è®°</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/javaee/springboot.html" rel="next" title="Spring Boot å­¦ä¹ ç¬”è®°">Spring Boot å­¦ä¹ ç¬”è®° <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div class="tablink-li"><button class="tablink" onclick='openPage("tabs-gitalk",this)' id="defaultOpen">Gitalk</button> <button class="tablink" onclick='openPage("tabs-valine",this)'>Valine</button></div><div class="tabcontent-li"><div id="tabs-gitalk" class="tabcontent"><div id="gitalk-container"></div></div><div id="tabs-valine" class="tabcontent"><div id="comments-valine"></div></div></div></div><script>function openPage(e,t){for(var n=document.getElementsByClassName("tabcontent"),l=0;l<n.length;l++)n[l].style.display="none";for(tablinks=document.getElementsByClassName("tablink"),l=0;l<tablinks.length;l++)tablinks[l].classList.remove("currentTabcontent");document.getElementById(e).style.display="block",t.classList.add("currentTabcontent")}document.getElementById("defaultOpen").click()</script></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">æ–‡ç« ç›®å½•</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">ç«™ç‚¹æ¦‚è§ˆ</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/"><img class="site-author-image" itemprop="image" src="../images/loading-post.gif" data-original="/images/logo.jpg" alt="Qcmoke"></a><p class="site-author-name" itemprop="name">Qcmoke</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">83</span> <span class="site-state-item-name">æ—¥å¿—</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">8</span> <span class="site-state-item-name">åˆ†ç±»</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">91</span> <span class="site-state-item-name">æ ‡ç­¾</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:qcmoke@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a> </span><span class="links-of-author-item"><a href="https://github.com/qcmoke" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://weibo.com/u/5469824288" target="_blank" title="weibo"><i class="fa fa-fw fa-weibo"></i>weibo</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> è¿‘æœŸæ–‡ç« </div><ul class="links-of-blogroll-list"><li class="recent_posts_li"><a href="/windows/clean_c_drive.html" title="Windowsç³»ç»ŸCç›˜æ¸…ç†" target="_blank">Windowsç³»ç»ŸCç›˜æ¸…ç†</a></li><li class="recent_posts_li"><a href="/devops/lvs.html" title="lvså­¦ä¹ ç¬”è®°" target="_blank">lvså­¦ä¹ ç¬”è®°</a></li><li class="recent_posts_li"><a href="/devops/mysql_ha.html" title="Keepalived+MySQLå®ç°é«˜å¯ç”¨" target="_blank">Keepalived+MySQLå®ç°é«˜å¯ç”¨</a></li><li class="recent_posts_li"><a href="/devops/keepalived.html" title="keepalivedå­¦ä¹ ç¬”è®°" target="_blank">keepalivedå­¦ä¹ ç¬”è®°</a></li><li class="recent_posts_li"><a href="/tools/pyenv.html" title="pythonç‰ˆæœ¬ç®¡ç†å·¥å…·pyenv" target="_blank">pythonç‰ˆæœ¬ç®¡ç†å·¥å…·pyenv</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸€-ç®€ä»‹"><span class="nav-text">ä¸€ã€ç®€ä»‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#äºŒ-åœ¨çº¿åŒ…ç®¡ç†å™¨å®‰è£…nginx"><span class="nav-text">äºŒã€åœ¨çº¿åŒ…ç®¡ç†å™¨å®‰è£…nginx</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-aptå®‰è£…nginx"><span class="nav-text">1. aptå®‰è£…nginx</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-å®‰è£…nginx"><span class="nav-text">ï¼ˆ1ï¼‰å®‰è£…nginx</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-å¸è½½nginx"><span class="nav-text">ï¼ˆ3ï¼‰å¸è½½nginx</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-yumå®‰è£…nginx"><span class="nav-text">2. yumå®‰è£…nginx</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-è®¾ç½®nginxå®˜æ–¹yumæº-å¯é€‰"><span class="nav-text">ï¼ˆ1ï¼‰è®¾ç½®nginxå®˜æ–¹yumæºï¼ˆå¯é€‰ï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-å®‰è£…nginx"><span class="nav-text">ï¼ˆ2ï¼‰å®‰è£…nginx</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-æŸ¥çœ‹nginxå®‰è£…ä¿¡æ¯"><span class="nav-text">ï¼ˆ3ï¼‰æŸ¥çœ‹nginxå®‰è£…ä¿¡æ¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-å¸è½½nginx"><span class="nav-text">ï¼ˆ4ï¼‰å¸è½½nginx</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-åœ¨çº¿åŒ…ç®¡ç†å™¨å®‰è£…nginxè·¯å¾„"><span class="nav-text">3. åœ¨çº¿åŒ…ç®¡ç†å™¨å®‰è£…nginxè·¯å¾„</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#äºŒ-æºç ç¼–è¯‘å®‰è£…nginx"><span class="nav-text">äºŒã€æºç ç¼–è¯‘å®‰è£…nginx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸‰-nginxå¸¸ç”¨å‘½ä»¤"><span class="nav-text">ä¸‰ã€nginxå¸¸ç”¨å‘½ä»¤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#äº”-nginxå†…ç½®å˜é‡"><span class="nav-text">äº”ã€nginxå†…ç½®å˜é‡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å…­-è‡ªå®šä¹‰nginxé…ç½®æ–‡ä»¶"><span class="nav-text">å…­ã€è‡ªå®šä¹‰nginxé…ç½®æ–‡ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸ƒ-é…ç½®httpæœåŠ¡"><span class="nav-text">ä¸ƒã€é…ç½®httpæœåŠ¡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å…«-é…ç½®åå‘ä»£ç†"><span class="nav-text">å…«ã€é…ç½®åå‘ä»£ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-åå‘ä»£ç†å¸¸ç”¨æŒ‡ä»¤"><span class="nav-text">1. åå‘ä»£ç†å¸¸ç”¨æŒ‡ä»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-ç®€å•çš„åå‘ä»£ç†é…ç½®"><span class="nav-text">2. ç®€å•çš„åå‘ä»£ç†é…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-åå‘ä»£ç†ç›¸å…³é…ç½®"><span class="nav-text">1ï¼‰åå‘ä»£ç†ç›¸å…³é…ç½®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-åå‘ä»£ç†æµ‹è¯•ç¤ºä¾‹"><span class="nav-text">2ï¼‰åå‘ä»£ç†æµ‹è¯•ç¤ºä¾‹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-é«˜çº§çš„åå‘ä»£ç†é…ç½®"><span class="nav-text">3. é«˜çº§çš„åå‘ä»£ç†é…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-è´Ÿè½½å‡è¡¡è°ƒåº¦æ¨¡å¼é…ç½®"><span class="nav-text">1ï¼‰è´Ÿè½½å‡è¡¡è°ƒåº¦æ¨¡å¼é…ç½®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-è´Ÿè½½å‡è¡¡å¥åº·æ£€æŸ¥é…ç½®"><span class="nav-text">2ï¼‰è´Ÿè½½å‡è¡¡å¥åº·æ£€æŸ¥é…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-ç®€è¦è¯´æ˜"><span class="nav-text">ï¼ˆ1ï¼‰ç®€è¦è¯´æ˜</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-è¢«åŠ¨å¥åº·æ£€æŸ¥é…ç½®"><span class="nav-text">ï¼ˆ2ï¼‰è¢«åŠ¨å¥åº·æ£€æŸ¥é…ç½®</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-ä¸»åŠ¨å¥åº·æ£€æŸ¥"><span class="nav-text">ï¼ˆ3ï¼‰ä¸»åŠ¨å¥åº·æ£€æŸ¥</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-é€šè¿‡åå‘ä»£ç†å®ç°åŠ¨é™åˆ†ç¦»"><span class="nav-text">3ï¼‰é€šè¿‡åå‘ä»£ç†å®ç°åŠ¨é™åˆ†ç¦»</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-ä½¿ç”¨tomcaté…ç½®åŠ¨æ€èµ„æº"><span class="nav-text">1. ä½¿ç”¨tomcaté…ç½®åŠ¨æ€èµ„æº</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-ä½¿ç”¨nginxé…ç½®é™æ€èµ„æºå’Œåå‘ä»£ç†"><span class="nav-text">2. ä½¿ç”¨nginxé…ç½®é™æ€èµ„æºå’Œåå‘ä»£ç†</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-è®¿é—®æµ‹è¯•"><span class="nav-text">3. è®¿é—®æµ‹è¯•</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¹-é…ç½®sslè¯ä¹¦ä»¥ä½¿ç”¨https"><span class="nav-text">ä¹ã€é…ç½®sslè¯ä¹¦ä»¥ä½¿ç”¨https</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-åˆ›å»ºnginxé…ç½®æ–‡ä»¶"><span class="nav-text">1. åˆ›å»ºnginxé…ç½®æ–‡ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-é…ç½®é˜²ç«å¢™å’Œé‡è½½nginxé…ç½®"><span class="nav-text">2. é…ç½®é˜²ç«å¢™å’Œé‡è½½nginxé…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-æµ‹è¯•httpsè®¿é—®"><span class="nav-text">3. æµ‹è¯•httpsè®¿é—®</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å-é…ç½®nginxè¿›ç¨‹å’Œå…¶æ‰§è¡Œç”¨æˆ·"><span class="nav-text">åã€é…ç½®nginxè¿›ç¨‹å’Œå…¶æ‰§è¡Œç”¨æˆ·</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-nginxè¿›ç¨‹"><span class="nav-text">1. nginxè¿›ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-nginxè¿›ç¨‹æ‰§è¡Œç”¨æˆ·"><span class="nav-text">2. nginxè¿›ç¨‹æ‰§è¡Œç”¨æˆ·</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åä¸€-é…ç½®æ–‡ä»¶æ¨¡å—åŒ–"><span class="nav-text">åä¸€ã€é…ç½®æ–‡ä»¶æ¨¡å—åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ç®€è¦æ¦‚è¿°"><span class="nav-text">ç®€è¦æ¦‚è¿°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#include-æŒ‡ä»¤çš„è¯­æ³•"><span class="nav-text">include æŒ‡ä»¤çš„è¯­æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#include-æŒ‡ä»¤ä½¿ç”¨ç¤ºä¾‹"><span class="nav-text">include æŒ‡ä»¤ä½¿ç”¨ç¤ºä¾‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åä¸€-é…ç½®æ—¥å¿—"><span class="nav-text">åä¸€ã€é…ç½®æ—¥å¿—</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#error-log-é”™è¯¯æ—¥å¿—é…ç½®"><span class="nav-text">error_log é”™è¯¯æ—¥å¿—é…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#access-log-è®¿é—®æ—¥å¿—é…ç½®"><span class="nav-text">access_log è®¿é—®æ—¥å¿—é…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æŒ‰ç…§æ—¥æœŸæ ¼å¼é…ç½®æ—¥å¿—æ–‡ä»¶åç§°"><span class="nav-text">æŒ‰ç…§æ—¥æœŸæ ¼å¼é…ç½®æ—¥å¿—æ–‡ä»¶åç§°</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Qcmoke</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv">æœ¬ç«™è®¿å®¢æ•° <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> äººæ¬¡ </span><span class="site-pv">æœ¬ç«™æ€»è®¿é—®é‡ <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> æ¬¡</span></div><a href="https://beian.miit.gov.cn/" target="_blank">é»”ICPå¤‡20002951å·-1</a></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><i id="darkmode" class="fa fa-lightbulb-o" aria-hidden="true"></i><script>var body=$("body"),darkmode=$("#darkmode");!matchMedia("(prefers-color-scheme: dark)").matches&&"1"!==localStorage.getItem("darkmode")||"1"===localStorage.getItem("noDark")||body.addClass("dark"),body.hasClass("dark")?darkmode.removeClass("fa-moon-o").addClass("fa-lightbulb-o"):darkmode.removeClass("fa-lightbulb-o").addClass("fa-moon-o"),darkmode.click(function(){body.hasClass("dark")?(darkmode.removeClass("fa-lightbulb-o").addClass("fa-moon-o"),body.removeClass("dark"),localStorage.setItem("darkmode","0"),localStorage.setItem("noDark","1")):(darkmode.removeClass("fa-moon-o").addClass("fa-lightbulb-o"),body.addClass("dark"),localStorage.setItem("darkmode","1"),localStorage.setItem("noDark","0"))})</script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/clipboard.min.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/highlight-wrap.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script src="/js/src/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">for(var emoticonList=[],i=1;i<=164;i++)emoticonList.push("aru ("+i+").png");new Valine({lang:"zh-cn",admin_email:"qcmoke@gmail.com",el:"#comments-valine",appId:"6LNbUERxbG0OAnWfmJSbmXiW-MdYXbMMI",appKey:"d2FLy9fmXOTiM8TrokuIuDWx",placeholder:"ç•™ä¸‹ä½ çš„å°çˆªå°å§~",serverURLs:"https://leancloud.qcmoke.cn"})</script><script>var checkExist;window.location.hash&&(checkExist=setInterval(function(){$(window.location.hash).length&&($("html, body").animate({scrollTop:$(window.location.hash).offset().top-90},1e3),clearInterval(checkExist))},100))</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script type="text/javascript">const gitalk=new Gitalk({clientID:"d933e443cdfe503ce05a",clientSecret:"149d163f4b10cedf7a68993289da9c0f0836bd34",repo:"mygitalk",owner:"qcmoke",admin:"qcmoke".split(","),id:location.pathname,distractionFreeMode:"true",createIssueManually:"true"});gitalk.render("gitalk-container")</script><script type="text/javascript">var isfetched=!1,isXml=!0,search_path="search.xml",path=(0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1),"/"+search_path),onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")};function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var searchFunc=function(t,s,a){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");function e(){var e,m=n.value.trim().toLowerCase(),x=m.split(/[\s\-]+/),w=(1<x.length&&x.push(m),[]);0<m.length&&o.forEach(function(t){var e=!1,o=0,h=0,n=t.title.trim(),r=n.toLowerCase(),s=t.content.trim().replace(/<[^>]+>/g,""),a=s.toLowerCase(),i=decodeURIComponent(t.url),c=[],l=[];if(""!=n&&(x.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r,s=0,a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());-1<(r=e.indexOf(t,s));)a.push({position:r,word:t}),s=r+n;return a}c=c.concat(e(t,r,!1)),l=l.concat(e(t,a,!1))}),0<c.length||0<l.length)&&(e=!0,o=c.length+l.length),e){function p(t,e,o,n){for(var r=n[n.length-1],s=r.position,a=r.word,i=[],c=0;s+a.length<=o&&0!=n.length;){a===m&&c++,i.push({position:s,length:a.length});var l=s+a.length;for(n.pop();0!=n.length&&(s=(r=n[n.length-1]).position,a=r.word,s<l);)n.pop()}return h+=c,{hits:i,start:e,end:o,searchTextCount:c}}[c,l].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});for(var t=[],u=(0!=c.length&&t.push(p(0,0,n.length,c)),[]);0!=l.length;){var f=l[l.length-1],d=f.position,f=f.word,g=d-20,v=d+80;g<0&&(g=0),(v=v<d+f.length?d+f.length:v)>s.length&&(v=s.length),u.push(p(0,g,v,l))}u.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});e=parseInt("1");function $(o,t){var n="",r=t.start;return t.hits.forEach(function(t){n+=o.substring(r,t.position);var e=t.position+t.length;n+='<b class="search-keyword">'+o.substring(t.position,e)+"</b>",r=e}),n+=o.substring(r,t.end)}0<=e&&(u=u.slice(0,e));var C="";C+=0!=t.length?"<li><a href='"+i+"' class='search-result-title'>"+$(n,t[0])+"</a>":"<li><a href='"+i+"' class='search-result-title'>"+n+"</a>",u.forEach(function(t){C+="<a href='"+i+'\'><p class="search-result">'+$(s,t)+"...</p></a>"}),C+="</li>",w.push({item:C,searchTextCount:h,hitCount:o,id:w.length})}}),1===x.length&&""===x[0]?r.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>':0===w.length?r.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>':(w.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id}),e='<ul class="search-result-list">',w.forEach(function(t){e+=t.item}),e+="</ul>",r.innerHTML=e)}var o=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,n=document.getElementById(s),r=document.getElementById(a);n.addEventListener("input",e),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script>function addCount(n){var t=$(".leancloud_visitors"),o=t.attr("id").trim(),i=t.attr("data-flag-title").trim();n("get","/classes/Counter",{where:JSON.stringify({url:o})}).done(function({results:t}){var e;0<t.length?(e=t[0],n("put","/classes/Counter/"+e.objectId,JSON.stringify({time:{__op:"Increment",amount:1}})).done(function(){$(document.getElementById(o)).find(".leancloud-visitors-count").text(e.time+1)}).fail(function({responseJSON:t}){console.log("Failed to save Visitor num, with error message: "+t.error)})):n("post","/classes/Counter",JSON.stringify({title:i,url:o,time:1})).done(function(){$(document.getElementById(o)).find(".leancloud-visitors-count").text(1)}).fail(function(){console.log("Failed to create")})}).fail(function({responseJSON:t}){console.log("LeanCloud Counter Error: "+t.code+" "+t.error)})}$(function(){$.get("https://app-router.leancloud.cn/2/route?appId=6LNbUERxbG0OAnWfmJSbmXiW-MdYXbMMI").done(function({}){/http:\/\/(localhost|127.0.0.1|0.0.0.0)/.test(document.URL)||addCount(function(t,e,n){return $.ajax({method:t,url:"https://leancloud.qcmoke.cn/1.1"+e,headers:{"X-LC-Id":"6LNbUERxbG0OAnWfmJSbmXiW-MdYXbMMI","X-LC-Key":"d2FLy9fmXOTiM8TrokuIuDWx","Content-Type":"application/json"},data:n})})})})</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"default",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions)</script><script type="text/javascript">(wpac_init=window.wpac_init||[]).push({widget:"Rating",id:23769,el:"wpac-rating",color:"fc6423"}),function(){var e,t;"WIDGETPACK_LOADED"in window||(WIDGETPACK_LOADED=!0,(e=document.createElement("script")).type="text/javascript",e.async=!0,e.src="//embed.widgetpack.com/widget.js",(t=document.getElementsByTagName("script")[0]).parentNode.insertBefore(e,t.nextSibling))}()</script><script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],0<=(n=t.getBoundingClientRect()).top&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"left","width":80,"height":130},"mobile":{"show":false},"log":false});</script></body></html>