<!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.jpg?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.jpg?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="javaee,高级框架,"><meta name="description" content="¶一、Spring¶1. 概念Spring 框架运行时1 test: spring 提供测试功能2 Core Container:核心容器.Spring 启动最基本的条件.2.1 Beans : Spring 负责创建类对象并管理对象2.2 Core: 核心类2.3 Context: 上下文参数.获取外部资源或这管理注解等2.4 SpEl: expression.jar3 AOP: 实现 aop"><meta property="og:type" content="article"><meta property="og:title" content="java高级框架学习笔记"><meta property="og:url" content="https://www.qcmoke.cn/javaee/frameworks.html"><meta property="og:site_name" content="Qcmoke&#39;s Blog"><meta property="og:description" content="¶一、Spring¶1. 概念Spring 框架运行时1 test: spring 提供测试功能2 Core Container:核心容器.Spring 启动最基本的条件.2.1 Beans : Spring 负责创建类对象并管理对象2.2 Core: 核心类2.3 Context: 上下文参数.获取外部资源或这管理注解等2.4 SpEl: expression.jar3 AOP: 实现 aop"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="article:published_time" content="2019-03-08T18:09:32.000Z"><meta property="article:modified_time" content="2022-05-24T03:50:17.675Z"><meta property="article:author" content="Qcmoke"><meta property="article:tag" content="javaee"><meta property="article:tag" content="高级框架"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.qcmoke.cn/images/loading-post.gif"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"hide",offset:12,b2t:!1,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://www.qcmoke.cn/javaee/frameworks.html"><title>java高级框架学习笔记 | Qcmoke's Blog</title><meta name="generator" content="Hexo 4.2.1"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Qcmoke's Blog</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Peace & Love ! Learning to think independently !</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-热文"><a href="/top/" rel="section"><i class="menu-item-icon fa fa-fw fa-fire"></i><br>热文</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="menu-item-icon fa fa-fw fa-link"></i><br>友链</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.qcmoke.cn/javaee/frameworks.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Qcmoke"><meta itemprop="description" content=""><meta itemprop="image" content="/images/logo.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Qcmoke's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">java高级框架学习笔记</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-09T02:09:32+08:00">2019-03-09 </time><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于&#58;</span> <time title="更新于" itemprop="dateModified" datetime="2022-05-24T11:50:17+08:00">2022-05-24 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/javaee/" itemprop="url" rel="index"><span itemprop="name">javaee</span> </a></span></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/javaee/frameworks.html#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/javaee/frameworks.html" itemprop="commentCount"></span> </a></span><span id="/javaee/frameworks.html" class="leancloud_visitors" data-flag-title="java高级框架学习笔记"><span class="post-meta-divider">|</span> <span class="lv-inline-block" style="display:inline-block"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数&#58;</span> <span class="leancloud-visitors-count"></span></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">9.8k </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">45</span></div></div></header><div class="post-body" itemprop="articleBody"><a id="more"></a><h2 id="一-spring"><a class="header-anchor" href="#一-spring">¶</a>一、Spring</h2><h3 id="1-概念"><a class="header-anchor" href="#1-概念">¶</a>1. 概念</h3><p>Spring 框架运行时</p><p><img src="/javaee/../images/loading-post.gif" data-original="frameworks/springruntime.jpg" alt="springruntime"></p><blockquote><p>1 test: spring 提供测试功能<br>2 Core Container:核心容器.Spring 启动最基本的条件.<br>2.1 Beans : Spring 负责创建类对象并管理对象<br>2.2 Core: 核心类<br>2.3 Context: 上下文参数.获取外部资源或这管理注解等<br>2.4 SpEl: expression.jar<br>3 AOP: 实现 aop 功能需要依赖<br>4 Aspects: 切面 AOP 依赖的包<br>5 Data Access/Integration : spring 封装数据访问层相关内容<br>5.1 JDBC : Spring 对 JDBC 封装后的代码.<br>5.2 ORM: 封装了持久层框架的代码.例如 Hibernate<br>5.3 transactions:对应 spring-tx.jar,声明式事务使</p></blockquote><p>1.什么是Spring：Spring是一个基于IOC和AOP的结构J2EE系统的框架 。</p><p>2.容器(Container): Spring可以理解成一个管理类对象的大容器.<br>3 ApplicationContext 接口,是 BeanFactory 子接口.BeanFactory 的功能在 ApplicationContext 中都有.（BeanFactory 是老版本Spring的主要信息获得接口.）<br>4.从 Spring3 开始把 Spring 框架的功能拆分成多个 jar. Spring2 及以前就一个 jar</p><p>核心功能</p><ul><li><p>IoC/DI 控制反转(IoC)/依赖注入(DI) ——解耦</p></li><li><p>AOP 面向切面编程 ——扩展</p></li><li><p>声明式事务</p></li></ul><h3 id="2-ioc-di"><a class="header-anchor" href="#2-ioc-di">¶</a>2. IoC/DI</h3><h4 id="2-1-ioc控制反转"><a class="header-anchor" href="#2-1-ioc控制反转">¶</a>2.1 IoC控制反转</h4><ul><li>不用通过new 实例化对象,而是将创建对象的控制权反转给Spring来处理。</li><li>最大的作用: 解耦。</li></ul><p>IoC创建对象的三种方式</p><p>（1）通过构造方法创建</p><p>两种构造方法创建方式</p><ul><li>无参构造创建:默认情况</li><li>有参构造创建:需要明确配置</li></ul><p>使用步骤：</p><p>①需要在类中提供有参构造方法</p><p>②在 <code>applicationContext.xml</code>中设置调用哪个构造方法创建对象，可以通过<code>&lt;constructor-arg&gt;</code>指定构造方法</p><blockquote><p>配置参数：</p><p>index : 参数的索引,从 0 开始<br>name: 参数名<br>type:类型(区分开关键字和封装类，如： int 和 Integer)<br>如果设定的条件匹配多个构造方法执行最后的构造方法</p></blockquote><p>（2）通过实例工厂创建</p><p>需要先创建工厂,才能生产对象。</p><p>使用步骤：</p><p>①编写实例工厂</p><p>②在<code>applicationContext.xml</code>中配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"factory"</span> <span class="attr">class</span>=<span class="string">"com.qcmoke.pojo.PeopleFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"peofactory"</span> <span class="attr">factory-bean</span>=<span class="string">"factory"</span> <span class="attr">factory-method</span>=<span class="string">"newInstance"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>（3） 通过静态工厂创建</p><p>不需要创建工厂,快速创建对象<br>使用步骤：<br>（1）编写一个静态工厂(在方法上添加 static)<br>（2）在<code>applicationContext.xml</code> 中配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"peostatic"</span> <span class="attr">class</span>=<span class="string">"com.qcmoke.pojo.PeopleStaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"newInstance"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-2-di依赖注入"><a class="header-anchor" href="#2-2-di依赖注入">¶</a>2.2 DI依赖注入</h4><ul><li>可以为Bean注入普通数据类型属性值，还可以注入其他Bean的引用。</li></ul><h4 id="2-3-案例"><a class="header-anchor" href="#2-3-案例">¶</a>2.3 案例</h4><p>①导包:四个核心包一个日志包(commons-logging)</p><blockquote><p>commons-logging-1.1.3.jar<br>spring-beans-4.1.6.RELEASE.jar<br>spring-context-4.1.6.RELEASE.jar<br>spring-core-4.1.6.RELEASE.jar<br>spring-expression-4.1.6.RELEASE.jar</p></blockquote><p>②在 src 下新建 applicationContext.xml (文件名称和路径自定义)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"peo"</span> <span class="attr">class</span>=<span class="string">"com.qcmoke.pojo.People"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		  通过&lt;bean/&gt; 创建对象.</span></span><br><span class="line"><span class="comment">	    id 表示获取到对象标识</span></span><br><span class="line"><span class="comment">	    class 需要创建实例的全限定类名</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>默认配置文件被加载时创建对象.</p><p>③通过ApplicationContext容器调用applicationContext.xml 里配置的信息</p><p>通过调用<code>getBean(“bean标签 id 值”,返回值类型)</code>来获取对象;如果没有第二个参数,默认是 Object</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">People people = ac.getBean(<span class="string">"peo"</span>,People<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure><h3 id="2-aop"><a class="header-anchor" href="#2-aop">¶</a>2. AOP</h3><h4 id="2-1-概念"><a class="header-anchor" href="#2-1-概念">¶</a>2.1 概念</h4><p>AOP(Aspect Oriented Programming 面向切面编程)。 在程序原有纵向执行流程中,针对某一个或某一些方法添加通知,形成横切面的过程就叫做面向切面编程。</p><p>传统程序执行流程都是纵向执行流程，在原有纵向执行流程中添加横切面，不需要修改原有纵向程序代码就能实现原程序的扩展。</p><p><img src="/javaee/../images/loading-post.gif" data-original="frameworks/1551936068843.png" alt="1551936068843"></p><blockquote><p>原有功能: 切点, pointcut</p><p>前置通知: 在切点之前执行的功能. before advice</p><p>后置通知: 在切点之后执行的功能,after advice</p><p>如果切点执行过程中出现异常,会触发异常通知.throws advice</p><p>所有功能总称叫做切面.</p><p>织入: 把切面嵌入到原有功能的过程叫做织入</p></blockquote><p>特点：1.高扩展性	2.释放了部分逻辑.让职责更加明确</p><h4 id="2-3-实现方式"><a class="header-anchor" href="#2-3-实现方式">¶</a>2.3 实现方式</h4><p>有两种实现AOP的方式</p><ul><li>Schema-baed</li><li>AspectJ</li></ul><p>依赖：</p><blockquote><p>aopalliance.jar aspectjweaver.jar<br>commons-logging-1.1.3.jar<br>spring-aop-4.1.6.RELEASE.jar<br>spring-aspects-4.1.6.RELEASE.jar<br>spring-beans-4.1.6.RELEASE.jar<br>spring-context-4.1.6.RELEASE.jar<br>spring-core-4.1.6.RELEASE.jar<br>spring-expression-4.1.6.RELEASE.jar<br>spring-tx-4.1.6.RELEASE.jar</p></blockquote><h5 id="2-3-1-schema-based"><a class="header-anchor" href="#2-3-1-schema-based">¶</a>2.3.1 Schema-based</h5><p>（1）配置<strong>applicationContext.xml</strong></p><p>导入xml约束（命名空间）：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>（2）编写切点类</p><p><strong>Demo.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切点类</span></span><br><span class="line"><span class="comment"> * 	</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> qcmoke</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"demo1"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> </span>&#123; <span class="comment">//原有功能（切点）</span></span><br><span class="line">		System.out.println(<span class="string">"demo2"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"demo3"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">function</span><span class="params">(Demo demo)</span> </span>&#123;</span><br><span class="line">		demo.demo1();</span><br><span class="line">		demo.demo2();</span><br><span class="line">		demo.demo3();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（3）编写通知类</p><p><strong>MyBeforeAdvice.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.advice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.MethodBeforeAdvice;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 前置通知类(需要实现 MethodBeforeAdvice接口)</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> qcmoke</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeforeAdvice</span> <span class="keyword">implements</span> <span class="title">MethodBeforeAdvice</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* 前置通知</span></span><br><span class="line"><span class="comment">	 * 	第0个参数：切点方法对象</span></span><br><span class="line"><span class="comment">	 * 	第1个参数：切点方法参数</span></span><br><span class="line"><span class="comment">	 * 	第2个参数：切点方法所在的对象</span></span><br><span class="line"><span class="comment">	 * */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Method arg0, Object[] arg1, Object arg2)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">		System.out.println(<span class="string">"\n执行前置通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>MyAfterAdvice.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.advice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.AfterReturningAdvice;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后置通知类(需要实现AfterReturningAdvice接口)</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> qcmoke</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAfterAdvice</span> <span class="keyword">implements</span> <span class="title">AfterReturningAdvice</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* 后置通知 </span></span><br><span class="line"><span class="comment">	 *  第0个参数：切点方法返回值</span></span><br><span class="line"><span class="comment">	 * 	第1个参数：切点方法对象</span></span><br><span class="line"><span class="comment">	 * 	第2个参数：切点方法参数</span></span><br><span class="line"><span class="comment">	 * 	第3个参数：切点方法所在的对象</span></span><br><span class="line"><span class="comment">	 * */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(Object arg0, Method arg1, Object[] arg2, Object arg3)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"执行后置通知\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（4） 在applicationContext.xml配置文件里配置<code>&lt;aop:config&gt;</code>配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置 Demo 类,测试使用 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.qcmoke.test.Demo"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置通知类对象,在切面中引入 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mybefore"</span> <span class="attr">class</span>=<span class="string">"com.qcmoke.advice.MyBeforeAdvice"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myafter"</span> <span class="attr">class</span>=<span class="string">"com.qcmoke.advice.MyAfterAdvice"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置切面 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置切点 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.qcmoke.test.Demo.demo2())"</span> <span class="attr">id</span>=<span class="string">"mypoint"</span> /&gt;</span><span class="comment">&lt;!-- 注意星号后要有空格 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 通知 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"mybefore"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"myafter"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>（5）编写测试类</p><p><strong>AopTest.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 要求：在不改动AopDemo类的情况下,在Demo#function()里添加其他功能。</span></span><br><span class="line"><span class="comment"> * 		比如：AopDemo#demo2()方法前后输出“\n执行前置通知”和“执行后置通知\n”</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> qcmoke</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"resource"</span>)</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUseAop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		Demo demo = ac.getBean(<span class="string">"demo"</span>, Demo<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		demo.function(demo);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNoAop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Demo demo = <span class="keyword">new</span> Demo();</span><br><span class="line">		demo.function(demo);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-3-2-aspectj"><a class="header-anchor" href="#2-3-2-aspectj">¶</a>2.3.2 AspectJ</h5><p>（1）配置<strong>applicationContext.xml</strong></p><p>需要将xml约束加入到applicationContext.xml文件开头。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>（2）编写切点类</p><p><strong>PointObject.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PointObject</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">function</span><span class="params">()</span></span>&#123;<span class="comment">// 原有功能（切点）</span></span><br><span class="line">		System.out.println(<span class="string">"执行原有功能（切点）"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（3）编写通知类</p><p><strong>MyAspectJAdvice.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.advice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspectJAdvice</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforefunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"执行前置通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterfunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"执行后置通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（4） 在applicationContext.xml配置文件里配置<code>&lt;aop:config&gt;</code>配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置切点类 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"pointObject"</span> <span class="attr">class</span>=<span class="string">"com.qcmoke.test.PointObject"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置通知类 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"aspectJAdvice"</span> <span class="attr">class</span>=<span class="string">"com.qcmoke.advice.MyAspectJAdvice"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置通知关联切点 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"aspectJAdvice"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.qcmoke.test.PointObject.function())"</span> <span class="attr">id</span>=<span class="string">"mypoint"</span>/&gt;</span> <span class="comment">&lt;!-- 配置切点方法 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"beforefunction"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span>/&gt;</span><span class="comment">&lt;!-- 配置前置通知 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"afterfunction"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span>/&gt;</span><span class="comment">&lt;!-- 配置后置通知 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>（5）编写测试类</p><p><strong>AopTest.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		PointObject demo = ac.getBean(<span class="string">"pointObject"</span>, PointObject<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		demo.function();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-4-注解方式使用aop"><a class="header-anchor" href="#2-4-注解方式使用aop">¶</a>2.4 注解方式使用AOP</h4><p>通过注解实现AOP的方式其实是基于AspectJ的方式。</p><p>实现步骤：</p><p>（1）导包:</p><blockquote><p>aopalliance.jar<br>aspectjweaver.jar<br>commons-logging-1.1.3.jar<br>spring-aop-4.1.6.RELEASE.jar<br>spring-aspects-4.1.6.RELEASE.jar<br>spring-beans-4.1.6.RELEASE.jar<br>spring-context-4.1.6.RELEASE.jar<br>spring-core-4.1.6.RELEASE.jar<br>spring-expression-4.1.6.RELEASE.jar<br>spring-tx-4.1.6.RELEASE.jar</p></blockquote><p>（2）配置<strong>applicationContext.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>（3）编写切点类</p><p>假设如下：</p><p><strong>PointObject.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 	1. 需要通过<span class="doctag">@Component</span>声明需要被扫描的类组件,相当于&lt;bean/&gt;</span></span><br><span class="line"><span class="comment"> * 		如果没有参数: <span class="doctag">@Component</span> 那么扫描后形成的Spring管理对象名称默认是首字母小写的类名</span></span><br><span class="line"><span class="comment"> *		如果有参数: <span class="doctag">@Component</span>("自定义的名称"),相当于&lt;bean id="自定义的名称"/&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *	2.  需要通过<span class="doctag">@Pointcut</span>("execution(* 切点名称)")指定切点方法,并给切点指定名称，一般就是方法的全限定路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> qcmoke</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PointObject</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Pointcut</span>(<span class="string">"execution(* com.qcmoke.test.PointObject.function())"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">function</span><span class="params">()</span></span>&#123;<span class="comment">// 原有功能（切点）</span></span><br><span class="line">		System.out.println(<span class="string">"执行原有功能（切点）"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（4）编写通知类</p><p><strong>MyAdvice.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.advice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 	1. 需要通过<span class="doctag">@Component</span>声明需要被扫描的类组件,相当于&lt;bean/&gt;</span></span><br><span class="line"><span class="comment"> * 		如果没有参数: <span class="doctag">@Component</span> 那么扫描后形成的Spring管理对象名称默认是首字母小写的类名</span></span><br><span class="line"><span class="comment"> *		如果有参数: <span class="doctag">@Component</span>("自定义的名称"),相当于&lt;bean id="自定义的名称"/&gt;</span></span><br><span class="line"><span class="comment"> *	2. 需要通过<span class="doctag">@Aspect</span>。相当于&lt;aop:aspect/&gt;,表示通知方法在当前类中</span></span><br><span class="line"><span class="comment"> *	3. 通过<span class="doctag">@Before</span>("切点名称");<span class="doctag">@AfterReturning</span>("切点名称").....等指定通知方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> qcmoke</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdvice</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Before</span>(<span class="string">"com.qcmoke.test.PointObject.function()"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforefunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"执行前置通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@AfterReturning</span>(<span class="string">"com.qcmoke.test.PointObject.function()"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterfunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"执行后置通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（5） 配置applicationContext.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 扫描含有注解的包,将包路径放到base-package属性值里，如果需要扫描多个包，包路径之间可以通过逗号分隔 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.qcmoke.advice,com.qcmoke.test"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--注解都是使用cglib动态代理方式。 proxy-target-class的值为true表示cglib动态代理；为false表示jdk动态代理 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>（6）编写测试类</p><p><strong>AopTest.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">viewAllNames</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		String[] names = ac.getBeanDefinitionNames();</span><br><span class="line">		<span class="keyword">for</span> (String name : names) &#123;</span><br><span class="line">			System.out.println(name);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testForAdvice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		PointObject pointObject = (PointObject) ac.getBean(<span class="string">"pointObject"</span>);</span><br><span class="line">		pointObject.function();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-声明式事务"><a class="header-anchor" href="#3-声明式事务">¶</a>3. 声明式事务</h3><p>编程式事务和声明式事务的区别：</p><h4 id="3-1-概念"><a class="header-anchor" href="#3-1-概念">¶</a>3.1 概念</h4><ol><li><p>编程式事务是由程序员编程事务控制代码，而声明式事务得事务控制代码已经由 spring 写好，程序员只需要简单声明出哪些方法需要进行事务控制和如何进行事务控制即可。</p></li><li><p>声明式事务针对的都是 ServiceImpl 类下需要事务处理的方法.</p></li><li><p>事务管理器基于通知(advice)的（即AOP）.</p></li></ol><h4 id="3-2-实现步骤"><a class="header-anchor" href="#3-2-实现步骤">¶</a>3.2 实现步骤</h4><h4 id="3-3-声明式事务中属性解释"><a class="header-anchor" href="#3-3-声明式事务中属性解释">¶</a>3.3 声明式事务中属性解释</h4><ol><li>**name=”” *<em>哪些方法需要有事务控制<br>1.1 支持</em>通配符</li><li>**readonly=”boolean” **是否是只读事务.<br>2.1 如果为 true,告诉数据库此事务为只读事务.数据化优化,会对<br>性能有一定提升,所以只要是查询的方法,建议使用此数据.<br>2.2 如果为 false(默认值),事务需要提交的事务.建议新增,删除,修<br>改.</li><li><strong>propagation</strong> 控制事务传播行为.（针对多个增删改互相调用的情况）<br>3.1 当一个具有事务控制的方法被另一个有事务控制的方法调用<br>后,需要如何管理事务(新建事务?在事务中执行?把事务挂起?报异<br>常?)<br>3.2 REQUIRED (默认值): 如果当前有事务,就在事务中执行,如果当<br>前没有事务,新建一个事务.<br>3.3 SUPPORTS:如果当前有事务就在事务中执行,如果当前没有事<br>务,就在非事务状态下执行.<br>3.4 MANDATORY:必须在事务内部执行,如果当前有事务,就在事务<br>中执行,如果没有事务,报错.<br>3.5 REQUIRES_NEW:必须在事务中执行,如果当前没有事务,新建事<br>务,如果当前有事务,把当前事务挂起.<br>3.6 NOT_SUPPORTED:必须在非事务下执行,如果当前没有事务,正<br>常执行,如果当前有事务,把当前事务挂起.<br>3.7 NEVER:必须在非事务状态下执行,如果当前没有事务,正常执行,<br>如果当前有事务,报错.<br>3.8 NESTED:必须在事务状态下执行.如果没有事务,新建事务,如果<br>当前有事务,创建一个嵌套事务.</li><li><strong>isolation=””</strong> 事务隔离级别<br>4.1 在多线程或并发访问下如何保证访问到的数据具有完整性的.<br>4.2 <strong>脏读:</strong><br>4.2.1 一个事务(A)读取到另一个事务(B)中未提交的数据,另一<br>个事务中数据可能进行了改变,此时A事务读取的数据可能和数据<br>库中数据是不一致的,此时认为数据是脏数据,读取脏数据过程叫<br>做脏读.<br>4.3 <strong>不可重复读:</strong><br>4.3.1 主要针对的是某行数据.(或行中某列)<br>4.3.2 主要针对的操作是修改操作.<br>4.3.3 两次读取在同一个事务内<br>4.3.4 当事务A第一次读取事务后,事务B对事务A读取的淑君<br>进行修改,事务 A 中再次读取的数据和之前读取的数据不一致,过<br>程不可重复读.<br>4.4 <strong>幻读:</strong><br>4.4.1 主要针对的操作是新增或删除<br>4.4.2 两次事务的结果.<br>4.4.3 事务A按照特定条件查询出结果,事务B新增了一条符合<br>条件的数据.事务 A 中查询的数据和数据库中的数据不一致的,事<br>务 A 好像出现了幻觉,这种情况称为幻读.<br>4.5 <strong>DEFAULT:</strong> 默认值,由底层数据库自动判断应该使用什么隔离界<br>别<br>4.6 **READ_UNCOMMITTED: **可以读取未提交数据,可能出现脏读,不<br>重复读,幻读.<br>4.6.1 效率最高.<br>4.7 **READ_COMMITTED:**只能读取其他事务已提交数据.可以防止脏<br>读,可能出现不可重复读和幻读.<br>4.8 **REPEATABLE_READ: **读取的数据被添加锁,防止其他事务修改<br>此数据,可以防止不可重复读.脏读,可能出现幻读.<br>4.9 **SERIALIZABLE: **排队操作,对整个表添加锁.一个事务在操作数<br>据时,另一个事务等待事务操作完成后才能操作这个表.<br>4.9.1 最安全的<br>4.9.2 效率最低的.</li><li><strong>rollback-for=”异常类型全限定路径”</strong><br>5.1 当出现什么异常时需要进行回滚<br>5.2 建议:给定该属性值.<br>5.2.1 手动抛异常一定要给该属性值.</li><li><strong>no-rollback-for=””</strong><br>6.1 当出现什么异常时不滚回事务.</li></ol><h3 id="4-常用注解总结"><a class="header-anchor" href="#4-常用注解总结">¶</a>4. 常用注解总结</h3><p>注意：</p><ol><li><p>使用注解一定要添加扫描的类所在的包路径</p></li><li><p>并且尽量开启cglib动态代理，（在使用AOP时，cglib兼容service接口接收代理对象，也兼容以service实现类接收代理对象；而jdk动态代理只兼容service接口接收代理对象）</p></li><li><p>使用注解后<code>default-autowire</code>全局<strong>自动注入</strong>配置就不生效了。</p></li><li></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 扫描含有注解的包,将包路径放到base-package属性值里，如果需要扫描多个包，包路径之间可以通过逗号分隔 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.qcmoke.advice,com.qcmoke.test"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">&lt;!--注解都是使用cglib动态代理方式。 proxy-target-class的值为true表示cglib动态代理；为false表示jdk动态代理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li><code>@Component</code> 创建类对象,相当于配置<code>&lt;bean/&gt;</code></li><li><code>@Service</code> 与<code>@Component</code> 功能相同.<br>2.1 <code>@Service</code>一般写在 <code>ServiceImpl</code>类上.</li><li><code>@Repository</code>与<code>@Component</code> 功能相同.<br>3.1 <code>@Repository</code>一般写在数据访问层类上.</li><li><code>@Controller</code> 与<code>@Component</code> 功能相同.<br>4.1 <code>@Controller</code>一般写在控制器类上.</li><li><code>@Resource</code>(不需要写对象的 <code>get/set</code>)<br>5.1 java 中jdk自带的注解<br>5.2 默认按照 <code>byName</code> 注入,如果没有名称对象,按照 <code>byType</code>注入<br>5.2.1 建议把对象名称和 spring 容器中对象名相同</li><li><code>@Autowired</code>(不需要写对象的 get/set)<br>6.1 spring 自带的注解<br>6.2 默认按照 <code>byType</code> 注入.</li><li><code>@Value()</code> 获取 properties 文件中内容</li><li><code>@Pointcut()</code>定义切点</li><li><code>@Aspect()</code> 定义切面类</li><li><code>@Before()</code>前置通知</li><li><code>@After</code> 后置通知</li><li><code>@AfterReturning</code> 后置通知,必须切点正确执行</li><li><code>@AfterThrowing</code> 异常通知</li><li><code>@Arround</code> 环绕通知</li></ol><h2 id="二-springmvc"><a class="header-anchor" href="#二-springmvc">¶</a>二、Springmvc</h2><p><strong>MVC</strong>的概念：</p><ul><li><p><strong>M</strong>指的是module（模型）</p></li><li><p><strong>V</strong>指的是view（视图）</p></li><li><p><strong>C</strong>指的是controller（控制器）</p></li></ul><p>传统的MVC开发模式中：</p><p>​	M包括service，dao，pojo，bean等</p><p>​	V包括jsp，html等</p><p>​	C包括servlet</p><p>而springmvc，不同的是springmvc是不包括传统mvc开发模型的service和dao的。而是对控制层进行mvc化封装。</p><h3 id="1-重要核心组件"><a class="header-anchor" href="#1-重要核心组件">¶</a>1. 重要核心组件</h3><ul><li>DispatcherServlet 前端控制器(分发器、请求入口，负责分发请求，接收所有请求，如果配置/不包含 jsp)</li><li>HandlerMapping 处理器映射器（解析url请求，负责请求和控制器建立一一对应的关系以此来查找Controller）</li><li>HandlAdapter：处理器适配器（ 负责调用具体的法（Handler）.）</li><li>Controller（Handler）后端控制器（后端处理器）</li><li>ViewResolver　　　　视图解析器（定位和跳转页面，解析不同的文件</li></ul><h3 id="2-环境搭建"><a class="header-anchor" href="#2-环境搭建">¶</a>2 环境搭建</h3><h4 id="2-1-纯配置文件配置"><a class="header-anchor" href="#2-1-纯配置文件配置">¶</a>2.1 纯配置文件配置</h4><p>（1）导包</p><blockquote><p>commons-logging-1.1.3.jar<br>spring-aop-4.1.6.RELEASE.jar<br>spring-aspects-4.1.6.RELEASE.jar<br>spring-beans-4.1.6.RELEASE.jar<br>spring-context-4.1.6.RELEASE.jar<br>spring-core-4.1.6.RELEASE.jar<br>spring-expression-4.1.6.RELEASE.jar<br>spring-jdbc-4.1.6.RELEASE.jar<br>spring-tx-4.1.6.RELEASE.jar<br>spring-web-4.1.6.RELEASE.jar<br>spring-webmvc-4.1.6.RELEASE.jar</p></blockquote><p>（2） 配置前端控制器 (在<strong>web.xml</strong>中)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置前端控制器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 由于spring不能控制servlet容器，故不能控制传统的servlet。 解决方式： 只需要在web.xml中配置前端控制器DispatcherServle生效 </span></span><br><span class="line"><span class="comment">			,然后在DispatcherServle中获取所有前端发送的请求， 再将请求进行解析分配给对应的后端控制器，这些后端控制器由于不是直接受到servlet容器的控制，所以这些spring容器能够管理这些后端容器。 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc123<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置springmvc文件路径和名称，让spring来管理后端控制器 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span><span class="comment">&lt;!-- 让前端控制器自启动 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc123<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>（3）创建后端控制器</p><p><strong>DemoController.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.Controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoController</span> <span class="keyword">implements</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * http://localhost:8080/springmvc01_纯配置文件环境搭建/demo</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"执行了springmvc的控制器"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//执行跳转，默认是转发到main.jsp</span></span><br><span class="line">		ModelAndView mav = <span class="keyword">new</span> ModelAndView(<span class="string">"main"</span>);</span><br><span class="line">		<span class="keyword">return</span> mav;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（4）在src下配置<strong>springmvc.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">&lt;!-- 后端控制器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demoController"</span> <span class="attr">class</span>=<span class="string">"com.qcmoke.controller.DemoController"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--  处理器映射器（解析请求) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span>  <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"urlMap"</span>&gt;</span></span><br><span class="line">    		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">   				key:控制器逻辑名，相当于servlet类的@WebServlet("/key")</span></span><br><span class="line"><span class="comment">   				value-ref:控制器对象,相当于servlet对象</span></span><br><span class="line"><span class="comment">    	    --&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"demo"</span> <span class="attr">value-ref</span>=<span class="string">"demoController"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 处理器适配器（ 负责调用具体的方法.），需要创建Controller（Handler）后端控制器来让处理器适配器来执行 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  	 </span><br><span class="line">  	 </span><br><span class="line">   	<span class="comment">&lt;!-- 视图解析器（定位和跳转页面） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-2-注解搭建环境"><a class="header-anchor" href="#2-2-注解搭建环境">¶</a>2.2 注解搭建环境</h4><p>（1）导包</p><blockquote><p>commons-logging-1.1.3.jar<br>spring-aop-4.1.6.RELEASE.jar<br>spring-aspects-4.1.6.RELEASE.jar<br>spring-beans-4.1.6.RELEASE.jar<br>spring-context-4.1.6.RELEASE.jar<br>spring-core-4.1.6.RELEASE.jar<br>spring-expression-4.1.6.RELEASE.jar<br>spring-jdbc-4.1.6.RELEASE.jar<br>spring-tx-4.1.6.RELEASE.jar<br>spring-web-4.1.6.RELEASE.jar<br>spring-webmvc-4.1.6.RELEASE.jar</p></blockquote><p>（2）配置前端控制器 (在<strong>web.xml</strong>中)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>myspringmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>myspringmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>（3）创建后端控制器</p><p><strong>DemoController.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 返回值表示跳转到的页面 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"demo"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">demo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"执行了demo"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"/main.jsp"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"demo2"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"执行了demo2"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"/main.jsp"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（4）在src下配置<strong>springmvc.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">	<span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">		1. 配置spring-mvc xml约束</span></span><br><span class="line"><span class="comment">		2. 注解扫描包名</span></span><br><span class="line"><span class="comment">		3. 配置注解驱动</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	--&gt;</span>    </span><br><span class="line">	 </span><br><span class="line">	<span class="comment">&lt;!--  注解扫描包名 </span></span><br><span class="line"><span class="comment">			扫描后对象放置到springmvc容器中。</span></span><br><span class="line"><span class="comment">			注意：springmvc是spring容器的子容器</span></span><br><span class="line"><span class="comment">	--&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.qcmoke.controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span>  </span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- 注解驱动 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!--  配置注解驱动相当于配置以下：</span></span><br><span class="line"><span class="comment">	 		1.HandlAdapter</span></span><br><span class="line"><span class="comment">	 		2.HandlerMapping</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 放行静态资源，防止把静态文件当作控制器来处理 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/js/"</span> <span class="attr">mapping</span>=<span class="string">"/js/**"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/css/"</span> <span class="attr">mapping</span>=<span class="string">"/css/**"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/images/"</span> <span class="attr">mapping</span>=<span class="string">"/images/**"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-传参"><a class="header-anchor" href="#3-传参">¶</a>3. 传参</h3><p>针对于后端控制器处理方法的参数</p><p>默认要求前端传入的name名称要和控制器HandlerMethod的参数名称相同。返回值表示跳转到的页面</p><p>spring会自动将请求的数据值注入到方法的参数中，即使是bean对象，也同样会根据bean对象的get/set 方法进行注入。</p><ol><li><p>参数是基本数据类型：<br>默认保证参数名称和请求中传递的参数名相同即可注入<br>如果请求参数名和方法参数名不对应使用@RequestParam(“请求的数据名称”)赋值，此外@RequestParam(defaultValue=“值”)可以设置参数默认值</p><p>@RequestParam(required=true)要求请求必须传入值，否则出错</p></li></ol><ol start="2"><li><p>参数是对象类型</p><p>根据请求参数名和对象中属性名对应(get/set 方法)进行注入</p></li></ol><ol start="3"><li><p>参数是集合类型（请求数据为多个同名参数，如复选框）</p><p>参数使用集合即可获取注入的请求数据</p><p>必须使用@RequestParam()</p></li></ol><h3 id="4-设置字符编码"><a class="header-anchor" href="#4-设置字符编码">¶</a>4. 设置字符编码</h3><p>需要在web.xml文件中添加以下过滤器配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置字符编码过滤器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter</span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="三-mybatis"><a class="header-anchor" href="#三-mybatis">¶</a>三、Mybatis</h2><h3 id="spring整合mybatis"><a class="header-anchor" href="#spring整合mybatis">¶</a>spring整合mybatis</h3><h5 id="1-5-1-环境搭建"><a class="header-anchor" href="#1-5-1-环境搭建">¶</a>1.5.1 环境搭建:</h5><p><strong>(1) 导包</strong></p><p>导 入 mybatis 所 有 jar 和 spring 基 本包,还有</p><blockquote><p>spring-jdbc</p><p>spring-tx</p><p>spring-aop</p><p>spring-web</p><p>另外还要spring 整合 mybatis 的包mybatis-spring等</p></blockquote><p><strong>(2)配置 web.xml</strong></p><p>目的是让tomcat启动时加载web.xml后自动加载applicationContext.xml文件(3)编写 spring 配置文件 applicationContext.xml<br>目的是让spring IOC/DI的作用来管理mybatis和service</p><h5 id="1-5-2-编写代码"><a class="header-anchor" href="#1-5-2-编写代码">¶</a>1.5.2 编写代码</h5><p>(1)正常编写 pojo</p><p>(2)编写 mapper,必须使用接口绑定方案或注解方案(必须有接口)</p><p>(4)正常编写 Service 接口和 Service 实现类</p><p>(5)需要在 Service 实现类中声明 Mapper 接口对象,并生成get/set 方法</p><h2 id="四-struts"><a class="header-anchor" href="#四-struts">¶</a>四、Struts</h2><p>struts执行流程简单描述图:</p><p><img src="/javaee/../images/loading-post.gif" data-original="frameworks/1553446030661.png" alt="1553446030661"></p><p>搭建步骤：</p><p><strong>1.拷贝Struts2的核心Jar包到WEB-INF/lib/下</strong></p><blockquote><p>asm-3.3.jar<br>asm-commons-3.3.jar<br>asm-tree-3.3.jar<br>commons-fileupload-1.3.1.jar 用于实现文件上传功能的jar包。<br>commons-io-2.2.jar<br>commons-lang3-3.2.jar<br>freemarker-2.3.22.jar reemarker是比jsp更简单好用，功能更加强大的表现层技术，用来替代jsp的。 在Struts2中提倡使用 freemarker模板，但实际项目中使用jsp也很多。<br>javassist-3.11.0.GA.jar<br>log4j-api-2.2.jar<br>log4j-core-2.2.jar<br>ognl-3.0.6.jar 用来支持ognl表达式的，类似于EL表达式，功能比EL表达式强大的多。<br>struts2-core-2.3.24.jar 核心包<br>xwork-core-2.3.24.jar Struts2核心包，是WebWork内核。</p></blockquote><p><strong>2.在web.xml配置前端控制器FilterDispatcher</strong></p><p>前端控制器实际上是一个过滤器，是所有请求的入口。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置前端控制器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span></span><br><span class="line">			org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</span><br><span class="line">		<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>3.在src下配置名称为struts.xml</strong></p><p>名称一定要是struts.xml，这是约束条件。</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE struts PUBLIC</span><br><span class="line">    <span class="string">"-//Apache Software Foundation//DTD Struts Configuration 2.1.7//EN"</span></span><br><span class="line">    <span class="string">"http://struts.apache.org/dtds/struts-2.1.7.dtd"</span>&gt;</span><br><span class="line">&lt;struts&gt;</span><br><span class="line">	&lt;!--</span><br><span class="line">		<span class="keyword">package</span>：包，用于对Action进行封装。 <span class="number">1</span>、name：包名，根元素下可以有多个包，彼此之间不能重名。</span><br><span class="line">		<span class="number">2</span>、extends：继承，用于指定继承的包，相当于将继承包下的配置信息复制到了当前包下。</span><br><span class="line">		<span class="number">3</span>、namespace：命名空间，用于规定Action的访问路径，可以是<span class="string">"/"</span>,也可以是<span class="string">"/路径名"</span>必须以“/”开头。 </span><br><span class="line">		<span class="number">4</span>、请求Action时，按照如下格式拼写URL：</span><br><span class="line">	--&gt;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	&lt;<span class="keyword">package</span> name=<span class="string">"day01"</span> namespace=<span class="string">"/demo"</span> extends=<span class="string">"struts-default"</span>&gt;</span><br><span class="line">		&lt;!-- action：业务控制器，用于注册业务控制器组件（类）。 </span><br><span class="line">			<span class="number">1</span>、name：action名称，用于规定Action的访问路径。</span><br><span class="line">			一个包下可以有多个action，彼此之间不能重名。 </span><br><span class="line">				namespace属性值和action标签里面的name属性值构成访问路径</span><br><span class="line">				如果命名空间是<span class="string">"/"</span>时：http:<span class="comment">//IP:PORT/ProjectName/NAMESPACE/ACTIONNAME或者http://IP:PORT/ProjectName/NAMESPACE/ACTIONNAME.action</span></span><br><span class="line">				如果命名空间是<span class="string">"/NAMESPACE"</span>时：http:<span class="comment">//IP:PORT/ProjectName/NAMESPACE/ACTIONNAME或者http://IP:PORT/ProjectName/NAMESPACE/ACTIONNAME.action</span></span><br><span class="line">			</span><br><span class="line">			<span class="number">2</span>、<span class="class"><span class="keyword">class</span>：业务控制器组件，用于指定业务控制器对应的类。</span></span><br><span class="line"><span class="class">			</span></span><br><span class="line"><span class="class">			3、<span class="title">method</span>：方法，用于指定访问当前<span class="title">action</span>时要调用的方法。如果不配置默认执行的方法<span class="title">execute</span>方法--&gt;</span></span><br><span class="line"><span class="class">			</span></span><br><span class="line"><span class="class">		&lt;<span class="title">action</span> <span class="title">name</span></span>=<span class="string">"hello"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.qcmoke.action.HelloAction"</span> method=<span class="string">"sayHello"</span>&gt;</span><br><span class="line">			&lt;!--配置action方法返回值对应的页面</span><br><span class="line">				result：输出组件，用于转发、重定向、直接输出。 </span><br><span class="line">				<span class="number">1</span>、name：名称，一个action下可以有多个result，彼此之间不能重名。</span><br><span class="line">				<span class="number">2</span>、默认做转发，标记内容设置成转发的页面。--&gt;</span><br><span class="line">			&lt;result name=<span class="string">"success"</span> type=<span class="string">"dispatcher"</span>&gt;</span><br><span class="line">				&lt;!--   name属性：和方法返回值一样，默认值为 success</span><br><span class="line">					   type属性：指定转发或者重定向，默认值做转发操作</span><br><span class="line">						    dispatcher（请求转发）</span><br><span class="line">							redirect（重定向到页面）</span><br><span class="line">							redirectAction（重定向到Action）</span><br><span class="line">							chain（解决重定向request作用域失效） --&gt;</span><br><span class="line">				</span><br><span class="line">				/hello.jsp</span><br><span class="line">            &lt;/result&gt;</span><br><span class="line">		&lt;/action&gt;</span><br><span class="line">	&lt;/package&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 由于day02的包继承自day01，并且没有扩展功能，故day01和day02是等价的，即以下链接效果是一样的</span><br><span class="line"> 		http:<span class="comment">//localhost:8080/struts02/demo/hello.action?realName=zhangsan&amp;age=21&amp;user.userName=zhangsan&amp;user.password=123456</span></span><br><span class="line"> 		http:<span class="comment">//localhost:8080/struts02/demo2/hello.action?realName=zhangsan&amp;age=21&amp;user.userName=zhangsan&amp;user.password=123456</span></span><br><span class="line">	 --&gt;</span><br><span class="line">	&lt;package name="day02" namespace="/demo2" extends="day01"&gt;&lt;/package&gt; </span><br><span class="line">&lt;/struts&gt;</span><br></pre></td></tr></table></figure><p><strong>4.创建action</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qcmoke.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 案例1 </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloAction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义实体对象属性，接收表单参数：用户名、密码</span></span><br><span class="line">	<span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"注入对象user..."</span>);</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">HelloAction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"实例化Action..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义基本类型属性，接收表单参数：姓名</span></span><br><span class="line">	<span class="keyword">private</span> String realName;</span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getRealName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> realName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRealName</span><span class="params">(String realName)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"注入参数realName..."</span>);</span><br><span class="line">		<span class="keyword">this</span>.realName = realName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 在业务方法中输出“Hello，Action.”</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		System.out.println(<span class="string">"Hello,Action."</span>);</span><br><span class="line">		<span class="comment">// 输出基本类型数据</span></span><br><span class="line">		System.out.println(<span class="string">"姓名："</span> + realName);</span><br><span class="line">		<span class="comment">// 输出域模型方式注入的参数</span></span><br><span class="line"></span><br><span class="line">		System.out.println(<span class="string">"用户名："</span> + user.getUserName());</span><br><span class="line">		System.out.println(<span class="string">"密码："</span> + user.getPassword());</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用到的pojo类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String userName;<span class="comment">// 用户名</span></span><br><span class="line">	<span class="keyword">private</span> String password;<span class="comment">// 密码</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.userName = userName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>转发到的页面：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> pageEncoding=<span class="string">"utf-8"</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Hello,Struts2.&lt;/h1&gt;</span><br><span class="line">    &lt;h1&gt;姓名：$&#123;realName&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;h1&gt;用户名：$&#123;user.userName &#125;&lt;/h1&gt;</span><br><span class="line">    &lt;h1&gt;密码：$&#123;user.password &#125;&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h2 id="五-hibernate"><a class="header-anchor" href="#五-hibernate">¶</a>五、Hibernate</h2><h3 id="1-定义"><a class="header-anchor" href="#1-定义">¶</a>1. 定义</h3><p>Hibernate是一个开源，轻量级的ORM(对象关系映射)工具（框架）</p><p>对象关系映射技术ORM简化了数据创建，数据处理和数据访问。它是将对象映射到数据库中存储的数据(表)的编程技术。 不需要编写数据库特定的sql语句就能完成对数据库数据的操控，一定程度上摆脱了不同数据库sql差异带来的不便。</p><p><img src="/javaee/../images/loading-post.gif" data-original="frameworks/604080357_24119.jpg" alt="img"></p><p><strong>orm思想</strong></p><p>（1）让实体类和数据库表进行一一对应关系（使用配置文件完成对应联系）</p><ul><li><p>让实体类和数据库表对应</p></li><li><p>让实体类属性和表字段对应</p></li></ul><p>（2）不需要用sql语句直接操作数据库表，而是通过操控实体类对象间接操控数据表。</p><h3 id="2-环境搭建-v2"><a class="header-anchor" href="#2-环境搭建-v2">¶</a>2. 环境搭建</h3><p>下面以用户管理的案例搭建java工程项目的方式来说明步骤。</p><p>项目结果如下：</p><h4 id="2-1-数据库准备"><a class="header-anchor" href="#2-1-数据库准备">¶</a>2.1 数据库准备</h4><p>这里使用的是mysql作为数据库来进行讲解。首先在数据库中创建一个数据库用来存Hibernate生成的表。</p><p><strong>sql:</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database ssh;</span><br></pre></td></tr></table></figure><h4 id="2-2-导包"><a class="header-anchor" href="#2-2-导包">¶</a>2.2 导包</h4><blockquote><p>antlr-2.7.7.jar<br>dom4j-1.6.1.jar<br>geronimo-jta_1.1_spec-1.1.1.jar<br>hibernate-commons-annotations-5.0.1.Final.jar<br>hibernate-core-5.0.7.Final.jar<br>hibernate-entitymanager-5.0.7.Final.jar<br>hibernate-jpa-2.1-api-1.0.0.Final.jar<br>jandex-2.0.0.Final.jar<br>javassist-3.18.1-GA.jar<br>jboss-logging-3.3.0.Final.jar<br>log4j-1.2.16.jar<br>mysql-connector-java-5.0.4-bin.jar<br>slf4j-api-1.6.1.jar<br>slf4j-log4j12-1.7.2.jar</p></blockquote><h4 id="2-3-创建实体类和对应的映射文件"><a class="header-anchor" href="#2-3-创建实体类和对应的映射文件">¶</a>2.3 创建实体类和对应的映射文件</h4><p><strong>实体类src/com/qcmoke/entity/User.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* hibernate要求实体类有一个属性唯一的 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> uid;</span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getUid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> uid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUid</span><span class="params">(<span class="keyword">int</span> uid)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.uid = uid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> address;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.address = address;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>映射配置文件src/com/qcmoke/entity/User.hbm.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">hibernate-mapping</span> <span class="meta-keyword">PUBLIC</span> </span></span><br><span class="line"><span class="meta">    <span class="meta-string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 1 配置类和表对应 </span></span><br><span class="line"><span class="comment">		class标签</span></span><br><span class="line"><span class="comment">			name属性：实体类全路径</span></span><br><span class="line"><span class="comment">			table属性：数据库表名称</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.qcmoke.entity.User"</span> <span class="attr">table</span>=<span class="string">"t_user"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 2 配置实体类id和表id对应 </span></span><br><span class="line"><span class="comment">			hibernate要求实体类有一个属性唯一值</span></span><br><span class="line"><span class="comment">			hibernate要求表有字段作为唯一值</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- id标签</span></span><br><span class="line"><span class="comment">			name属性：实体类里面id属性名称</span></span><br><span class="line"><span class="comment">			column属性：生成的表字段名称</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"uid"</span> <span class="attr">column</span>=<span class="string">"uid"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- generator:设置数据库表id增长策略 </span></span><br><span class="line"><span class="comment">				native:生成表id值就是主键自动增长</span></span><br><span class="line"><span class="comment">				uuid:使用uuid生成的不同随机值作为增长策略，需要实体类id属性是String类型--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- &lt;generator class="uuid"&gt;&lt;/generator&gt; --&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置其他属性和表字段对应 </span></span><br><span class="line"><span class="comment">			name属性：实体类属性名称</span></span><br><span class="line"><span class="comment">			column属性：生成表字段名称;column属性可以省略的,不写默认和name属性值一样的</span></span><br><span class="line"><span class="comment">			type属性:设置生成表字段的类型(Java类型，也可以是Hibernate预置的类型)，不写默认自动对应类型,一般不会去配置</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">column</span>=<span class="string">"password"</span> <span class="attr">type</span>=<span class="string">"string"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-4-核心配置文"><a class="header-anchor" href="#2-4-核心配置文">¶</a>2.4 核心配置文</h4><p><strong>src/hibernate.cfg.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">hibernate-configuration</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">	<span class="meta-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span></span><br><span class="line"><span class="meta">	<span class="meta-string">"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 第一部分： 配置数据库信息 必须的 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql:///ssh<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 第二部分： 配置hibernate信息  可选的--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span> <span class="comment">&lt;!-- 输出底层sql语句 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span> <span class="comment">&lt;!-- 输出底层sql语句格式 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="comment">&lt;!-- 配置hibernate.hbm2ddl.auto之后，hibernate会自动创建表 。update: 如果已经有表，更新，如果没有，创建--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="comment">&lt;!-- 配置数据库方言。让hibernate框架识别不同数据库的自己特有的语句，比如分页语句--&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 第三部分： 把映射文件放到核心配置文件中 必须的--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/qcmoke/entity/User.hbm.xml"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-5-测试类"><a class="header-anchor" href="#2-5-测试类">¶</a>2.5 测试类</h4><p><strong>src/com/qcmoke/hibernatetest/HibernateTest.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qcmoke.hibernatetest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qcmoke.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">/** 第一步 加载hibernate核心配置文件 */</span></span><br><span class="line">		<span class="comment">// 到src下面找到名称hibernate.cfg.xml配置文件，创建对象，把配置文件标签放到对象里面</span></span><br><span class="line">		Configuration cfg = <span class="keyword">new</span> Configuration();</span><br><span class="line">		cfg.configure();</span><br><span class="line"></span><br><span class="line">		<span class="comment">/** 第二步 创建SessionFactory对象 */</span></span><br><span class="line">		<span class="comment">// 读取hibernate核心配置文件内容，创建sessionFactory;在过程中，根据映射关系，在配置数据库里面把表创建。一个项目一般创建一个sessionFactory对象</span></span><br><span class="line">		SessionFactory sessionFactory = cfg.buildSessionFactory();</span><br><span class="line"></span><br><span class="line">		<span class="comment">/** 第三步 使用SessionFactory创建session对象，session对象是单线程对象,常用方法有（1）添加 save方法;（2）修改 update方法（3）删除 delete方法（4）根据id查询 get方法 */</span></span><br><span class="line">		Session session = sessionFactory.openSession(); <span class="comment">// 类似于连接</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">/** 第四步 开启事务 */</span></span><br><span class="line">		Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">		<span class="comment">/** 第五步 写具体逻辑 crud操作 */</span></span><br><span class="line">		<span class="comment">// 添加功能</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			User user = <span class="keyword">new</span> User();</span><br><span class="line">			user.setUsername(<span class="string">"qcmoke"</span>);</span><br><span class="line">			user.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">			user.setAddress(<span class="string">"贵州"</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 调用session的方法实现添加</span></span><br><span class="line">			session.save(user);</span><br><span class="line"></span><br><span class="line">			<span class="comment">/** 第六步 提交事务 */</span></span><br><span class="line">			tx.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			tx.rollback(); <span class="comment">// 回滚事务</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">/** 第七步 关闭资源 */</span></span><br><span class="line">			session.close();</span><br><span class="line">			sessionFactory.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-三大查询对象"><a class="header-anchor" href="#3-三大查询对象">¶</a>3. 三大查询对象</h3><ul><li>Query</li><li>Criteria</li><li>SQLQuery</li></ul><h4 id="3-1-query"><a class="header-anchor" href="#3-1-query">¶</a>3.1 Query</h4><p>1 使用query对象，可以不写sql语句，但是写hql语句</p><p>（1）hql：hibernate query language，hibernate提供查询语言，这个hql语句和普通sql语句很相似</p><p>（2）hql和sql语句区别：</p><ul><li><p>使用sql操作表和表字段</p></li><li><p>使用hql操作实体类和属性</p></li></ul><p>2 查询所有hql语句：</p><p>（1）from 实体类名称</p><p>3 Query对象使用</p><p>（1）创建Query对象</p><p>（2）调用query对象里面的方法得到结果</p></div><div><div><br><br><div style="text-align:center;color:#ccc;font-size:14px">----------- 本文结束 -----------</div><br><br><br><br></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>如果你觉得我的文章对你有帮助，你可以打赏我哦~</div><button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'><span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="../images/loading-post.gif" data-original="/images/wechatpay.png" alt="Qcmoke 微信支付"><p>微信支付</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/javaee/" rel="tag"><i class="fa fa-tag"></i> javaee</a> <a href="/tags/%E9%AB%98%E7%BA%A7%E6%A1%86%E6%9E%B6/" rel="tag"><i class="fa fa-tag"></i> 高级框架</a></div><div class="post-widgets"><div class="wp_rating"><div id="wpac-rating"></div></div><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/tools/svn.html" rel="prev" title="svn学习笔记"><i class="fa fa-chevron-left"></i> svn学习笔记</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/windows/win.html" rel="next" title="windows那些操作玩意">windows那些操作玩意 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div class="tablink-li"><button class="tablink" onclick='openPage("tabs-gitalk",this)' id="defaultOpen">Gitalk</button> <button class="tablink" onclick='openPage("tabs-valine",this)'>Valine</button></div><div class="tabcontent-li"><div id="tabs-gitalk" class="tabcontent"><div id="gitalk-container"></div></div><div id="tabs-valine" class="tabcontent"><div id="comments-valine"></div></div></div></div><script>function openPage(e,t){for(var n=document.getElementsByClassName("tabcontent"),l=0;l<n.length;l++)n[l].style.display="none";for(tablinks=document.getElementsByClassName("tablink"),l=0;l<tablinks.length;l++)tablinks[l].classList.remove("currentTabcontent");document.getElementById(e).style.display="block",t.classList.add("currentTabcontent")}document.getElementById("defaultOpen").click()</script></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/"><img class="site-author-image" itemprop="image" src="../images/loading-post.gif" data-original="/images/logo.jpg" alt="Qcmoke"></a><p class="site-author-name" itemprop="name">Qcmoke</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">83</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">8</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">91</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:qcmoke@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a> </span><span class="links-of-author-item"><a href="https://github.com/qcmoke" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://weibo.com/u/5469824288" target="_blank" title="weibo"><i class="fa fa-fw fa-weibo"></i>weibo</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li class="recent_posts_li"><a href="/windows/clean_c_drive.html" title="Windows系统C盘清理" target="_blank">Windows系统C盘清理</a></li><li class="recent_posts_li"><a href="/devops/lvs.html" title="lvs学习笔记" target="_blank">lvs学习笔记</a></li><li class="recent_posts_li"><a href="/devops/mysql_ha.html" title="Keepalived+MySQL实现高可用" target="_blank">Keepalived+MySQL实现高可用</a></li><li class="recent_posts_li"><a href="/devops/keepalived.html" title="keepalived学习笔记" target="_blank">keepalived学习笔记</a></li><li class="recent_posts_li"><a href="/tools/pyenv.html" title="python版本管理工具pyenv" target="_blank">python版本管理工具pyenv</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一-spring"><span class="nav-text">一、Spring</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-概念"><span class="nav-text">1. 概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-ioc-di"><span class="nav-text">2. IoC&#x2F;DI</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-ioc控制反转"><span class="nav-text">2.1 IoC控制反转</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-di依赖注入"><span class="nav-text">2.2 DI依赖注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-案例"><span class="nav-text">2.3 案例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-aop"><span class="nav-text">2. AOP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-概念"><span class="nav-text">2.1 概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-实现方式"><span class="nav-text">2.3 实现方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-3-1-schema-based"><span class="nav-text">2.3.1 Schema-based</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-3-2-aspectj"><span class="nav-text">2.3.2 AspectJ</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-注解方式使用aop"><span class="nav-text">2.4 注解方式使用AOP</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-声明式事务"><span class="nav-text">3. 声明式事务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-概念"><span class="nav-text">3.1 概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-实现步骤"><span class="nav-text">3.2 实现步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-声明式事务中属性解释"><span class="nav-text">3.3 声明式事务中属性解释</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-常用注解总结"><span class="nav-text">4. 常用注解总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二-springmvc"><span class="nav-text">二、Springmvc</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-重要核心组件"><span class="nav-text">1. 重要核心组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-环境搭建"><span class="nav-text">2 环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-纯配置文件配置"><span class="nav-text">2.1 纯配置文件配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-注解搭建环境"><span class="nav-text">2.2 注解搭建环境</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-传参"><span class="nav-text">3. 传参</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-设置字符编码"><span class="nav-text">4. 设置字符编码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三-mybatis"><span class="nav-text">三、Mybatis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#spring整合mybatis"><span class="nav-text">spring整合mybatis</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-5-1-环境搭建"><span class="nav-text">1.5.1 环境搭建:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-5-2-编写代码"><span class="nav-text">1.5.2 编写代码</span></a></li></ol></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#四-struts"><span class="nav-text">四、Struts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五-hibernate"><span class="nav-text">五、Hibernate</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-定义"><span class="nav-text">1. 定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-环境搭建-v2"><span class="nav-text">2. 环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-数据库准备"><span class="nav-text">2.1 数据库准备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-导包"><span class="nav-text">2.2 导包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-创建实体类和对应的映射文件"><span class="nav-text">2.3 创建实体类和对应的映射文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-核心配置文"><span class="nav-text">2.4 核心配置文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-测试类"><span class="nav-text">2.5 测试类</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-三大查询对象"><span class="nav-text">3. 三大查询对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-query"><span class="nav-text">3.1 Query</span></a></li></ol></li></ol></li></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Qcmoke</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv">本站访客数 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人次 </span><span class="site-pv">本站总访问量 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div><a href="https://beian.miit.gov.cn/" target="_blank">黔ICP备20002951号-1</a></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><i id="darkmode" class="fa fa-lightbulb-o" aria-hidden="true"></i><script>var body=$("body"),darkmode=$("#darkmode");!matchMedia("(prefers-color-scheme: dark)").matches&&"1"!==localStorage.getItem("darkmode")||"1"===localStorage.getItem("noDark")||body.addClass("dark"),body.hasClass("dark")?darkmode.removeClass("fa-moon-o").addClass("fa-lightbulb-o"):darkmode.removeClass("fa-lightbulb-o").addClass("fa-moon-o"),darkmode.click(function(){body.hasClass("dark")?(darkmode.removeClass("fa-lightbulb-o").addClass("fa-moon-o"),body.removeClass("dark"),localStorage.setItem("darkmode","0"),localStorage.setItem("noDark","1")):(darkmode.removeClass("fa-moon-o").addClass("fa-lightbulb-o"),body.addClass("dark"),localStorage.setItem("darkmode","1"),localStorage.setItem("noDark","0"))})</script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/clipboard.min.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/highlight-wrap.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script src="/js/src/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">for(var emoticonList=[],i=1;i<=164;i++)emoticonList.push("aru ("+i+").png");new Valine({lang:"zh-cn",admin_email:"qcmoke@gmail.com",el:"#comments-valine",appId:"6LNbUERxbG0OAnWfmJSbmXiW-MdYXbMMI",appKey:"d2FLy9fmXOTiM8TrokuIuDWx",placeholder:"留下你的小爪印吧~",serverURLs:"https://leancloud.qcmoke.cn"})</script><script>var checkExist;window.location.hash&&(checkExist=setInterval(function(){$(window.location.hash).length&&($("html, body").animate({scrollTop:$(window.location.hash).offset().top-90},1e3),clearInterval(checkExist))},100))</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script type="text/javascript">const gitalk=new Gitalk({clientID:"d933e443cdfe503ce05a",clientSecret:"149d163f4b10cedf7a68993289da9c0f0836bd34",repo:"mygitalk",owner:"qcmoke",admin:"qcmoke".split(","),id:location.pathname,distractionFreeMode:"true",createIssueManually:"true"});gitalk.render("gitalk-container")</script><script type="text/javascript">var isfetched=!1,isXml=!0,search_path="search.xml",path=(0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1),"/"+search_path),onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")};function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var searchFunc=function(t,s,a){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");function e(){var e,m=n.value.trim().toLowerCase(),x=m.split(/[\s\-]+/),w=(1<x.length&&x.push(m),[]);0<m.length&&o.forEach(function(t){var e=!1,o=0,h=0,n=t.title.trim(),r=n.toLowerCase(),s=t.content.trim().replace(/<[^>]+>/g,""),a=s.toLowerCase(),i=decodeURIComponent(t.url),c=[],l=[];if(""!=n&&(x.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r,s=0,a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());-1<(r=e.indexOf(t,s));)a.push({position:r,word:t}),s=r+n;return a}c=c.concat(e(t,r,!1)),l=l.concat(e(t,a,!1))}),0<c.length||0<l.length)&&(e=!0,o=c.length+l.length),e){function p(t,e,o,n){for(var r=n[n.length-1],s=r.position,a=r.word,i=[],c=0;s+a.length<=o&&0!=n.length;){a===m&&c++,i.push({position:s,length:a.length});var l=s+a.length;for(n.pop();0!=n.length&&(s=(r=n[n.length-1]).position,a=r.word,s<l);)n.pop()}return h+=c,{hits:i,start:e,end:o,searchTextCount:c}}[c,l].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});for(var t=[],u=(0!=c.length&&t.push(p(0,0,n.length,c)),[]);0!=l.length;){var f=l[l.length-1],d=f.position,f=f.word,g=d-20,v=d+80;g<0&&(g=0),(v=v<d+f.length?d+f.length:v)>s.length&&(v=s.length),u.push(p(0,g,v,l))}u.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});e=parseInt("1");function $(o,t){var n="",r=t.start;return t.hits.forEach(function(t){n+=o.substring(r,t.position);var e=t.position+t.length;n+='<b class="search-keyword">'+o.substring(t.position,e)+"</b>",r=e}),n+=o.substring(r,t.end)}0<=e&&(u=u.slice(0,e));var C="";C+=0!=t.length?"<li><a href='"+i+"' class='search-result-title'>"+$(n,t[0])+"</a>":"<li><a href='"+i+"' class='search-result-title'>"+n+"</a>",u.forEach(function(t){C+="<a href='"+i+'\'><p class="search-result">'+$(s,t)+"...</p></a>"}),C+="</li>",w.push({item:C,searchTextCount:h,hitCount:o,id:w.length})}}),1===x.length&&""===x[0]?r.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>':0===w.length?r.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>':(w.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id}),e='<ul class="search-result-list">',w.forEach(function(t){e+=t.item}),e+="</ul>",r.innerHTML=e)}var o=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,n=document.getElementById(s),r=document.getElementById(a);n.addEventListener("input",e),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script>function addCount(n){var t=$(".leancloud_visitors"),o=t.attr("id").trim(),i=t.attr("data-flag-title").trim();n("get","/classes/Counter",{where:JSON.stringify({url:o})}).done(function({results:t}){var e;0<t.length?(e=t[0],n("put","/classes/Counter/"+e.objectId,JSON.stringify({time:{__op:"Increment",amount:1}})).done(function(){$(document.getElementById(o)).find(".leancloud-visitors-count").text(e.time+1)}).fail(function({responseJSON:t}){console.log("Failed to save Visitor num, with error message: "+t.error)})):n("post","/classes/Counter",JSON.stringify({title:i,url:o,time:1})).done(function(){$(document.getElementById(o)).find(".leancloud-visitors-count").text(1)}).fail(function(){console.log("Failed to create")})}).fail(function({responseJSON:t}){console.log("LeanCloud Counter Error: "+t.code+" "+t.error)})}$(function(){$.get("https://app-router.leancloud.cn/2/route?appId=6LNbUERxbG0OAnWfmJSbmXiW-MdYXbMMI").done(function({}){/http:\/\/(localhost|127.0.0.1|0.0.0.0)/.test(document.URL)||addCount(function(t,e,n){return $.ajax({method:t,url:"https://leancloud.qcmoke.cn/1.1"+e,headers:{"X-LC-Id":"6LNbUERxbG0OAnWfmJSbmXiW-MdYXbMMI","X-LC-Key":"d2FLy9fmXOTiM8TrokuIuDWx","Content-Type":"application/json"},data:n})})})})</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"default",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions)</script><script type="text/javascript">(wpac_init=window.wpac_init||[]).push({widget:"Rating",id:23769,el:"wpac-rating",color:"fc6423"}),function(){var e,t;"WIDGETPACK_LOADED"in window||(WIDGETPACK_LOADED=!0,(e=document.createElement("script")).type="text/javascript",e.async=!0,e.src="//embed.widgetpack.com/widget.js",(t=document.getElementsByTagName("script")[0]).parentNode.insertBefore(e,t.nextSibling))}()</script><script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],0<=(n=t.getBoundingClientRect()).top&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"left","width":80,"height":130},"mobile":{"show":false},"log":false});</script></body></html>