<!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.jpg?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.jpg?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="linux,ubuntu,"><meta name="description" content="这个笔记比较全面的记录了本人学习Linux的过程，内容还是比较系统、全面的。学习参考的文档以及教程来源繁多，但都吸取了其中比较好的精华，并在此基础上有所拓展深入。本次笔记更多还是在于Linux命令使用上的总结，对于日后的运维学习必定有所帮助…"><meta property="og:type" content="article"><meta property="og:title" content="linux学习笔记"><meta property="og:url" content="https://www.qcmoke.cn/linux/to_learn_linux.html"><meta property="og:site_name" content="Qcmoke&#39;s Blog"><meta property="og:description" content="这个笔记比较全面的记录了本人学习Linux的过程，内容还是比较系统、全面的。学习参考的文档以及教程来源繁多，但都吸取了其中比较好的精华，并在此基础上有所拓展深入。本次笔记更多还是在于Linux命令使用上的总结，对于日后的运维学习必定有所帮助…"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="og:image" content="https://www.qcmoke.cn/images/loading-post.gif"><meta property="article:published_time" content="2018-12-03T17:35:00.000Z"><meta property="article:modified_time" content="2024-07-28T01:10:22.453Z"><meta property="article:author" content="Qcmoke"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.qcmoke.cn/images/loading-post.gif"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"hide",offset:12,b2t:!1,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://www.qcmoke.cn/linux/to_learn_linux.html"><title>linux学习笔记 | Qcmoke's Blog</title><meta name="generator" content="Hexo 4.2.1"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Qcmoke's Blog</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Peace & Love ! Learning to think independently !</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-热文"><a href="/top/" rel="section"><i class="menu-item-icon fa fa-fw fa-fire"></i><br>热文</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="menu-item-icon fa fa-fw fa-link"></i><br>友链</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.qcmoke.cn/linux/to_learn_linux.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Qcmoke"><meta itemprop="description" content=""><meta itemprop="image" content="/images/logo.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Qcmoke's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">linux学习笔记</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-04T01:35:00+08:00">2018-12-04 </time><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于&#58;</span> <time title="更新于" itemprop="dateModified" datetime="2024-07-28T09:10:22+08:00">2024-07-28 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span> </a></span></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/linux/to_learn_linux.html#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/linux/to_learn_linux.html" itemprop="commentCount"></span> </a></span><span id="/linux/to_learn_linux.html" class="leancloud_visitors" data-flag-title="linux学习笔记"><span class="post-meta-divider">|</span> <span class="lv-inline-block" style="display:inline-block"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数&#58;</span> <span class="leancloud-visitors-count"></span></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">54.6k </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">215</span></div></div></header><div class="post-body" itemprop="articleBody"><p>这个笔记比较全面的记录了本人学习Linux的过程，内容还是比较系统、全面的。学习参考的文档以及教程来源繁多，但都吸取了其中比较好的精华，并在此基础上有所拓展深入。本次笔记更多还是在于Linux命令使用上的总结，对于日后的运维学习必定有所帮助…</p><a id="more"></a><h2 id="一-概念"><a class="header-anchor" href="#一-概念">¶</a>一、概念</h2><p>Linux 是一套免费使用和自由传播的类 Unix 操作系统，是一个基于 POSIX 和 UNIX 的多用户、多任务、支持多线程和多 CPU 的操作系统。</p><p>目前市面上较知名的发行版有：Ubuntu、RedHat、CentOS、Debian、Fedora、SuSE、OpenSUSE、Arch Linux、SolusOS 等。但大体上分类为RedHat系列和Debian系列。所以本文档主要是使用CentOS并辅助性地掺杂Ubuntu一起进行讲述的。</p><h3 id="1-终端命令格式"><a class="header-anchor" href="#1-终端命令格式">¶</a>1. 终端命令格式</h3><p>Linux 刚面世时并没有图形界面，所有的操作全靠命令完成。对于命令的使用需要注意其格式。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span> [-options] [parameter]</span><br></pre></td></tr></table></figure><p>说明：</p><ul><li><p><code>command</code>：命令名，相应功能的英文单词或单词的缩写</p></li><li><p><code>[-options]</code>：选项，可用来对命令进行控制，也可以省略</p></li><li><p><code>parameter</code>：传给命令的参数，可以是 <strong>零个</strong>、<strong>一个</strong> 或者 <strong>多个</strong></p></li><li><p><code>[]</code> 代表可选</p></li></ul><h3 id="2-查阅命令的帮助文档信息"><a class="header-anchor" href="#2-查阅命令的帮助文档信息">¶</a>2. 查阅命令的帮助文档信息</h3><p>可通过在命令后加<code>--help</code>选项或者在命令的前面添加<code>man</code>命令来查看相关命令的帮助文档信息。</p><h4 id="2-1-help"><a class="header-anchor" href="#2-1-help">¶</a>2.1 <code>--help</code></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示command命令的帮助信息</span></span><br><span class="line"><span class="built_in">command</span> --<span class="built_in">help</span></span><br><span class="line"><span class="comment">#--help可简写为-h</span></span><br><span class="line"><span class="built_in">command</span> -h</span><br></pre></td></tr></table></figure><h4 id="2-2-man"><a class="header-anchor" href="#2-2-man">¶</a>2.2 man</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查阅command命令的使用手册</span></span><br><span class="line">man <span class="built_in">command</span></span><br></pre></td></tr></table></figure><blockquote><p><code>man</code> 是 <strong>manual</strong> 的缩写，是 Linux 提供的一个 <strong>手册</strong>，包含了绝大部分的命令、函数的详细使用说明</p></blockquote><p>使用 <code>man</code> 时的操作键：</p><table><thead><tr><th>操作键</th><th>功能</th></tr></thead><tbody><tr><td>空格键</td><td>显示手册页的下一屏</td></tr><tr><td>Enter 键</td><td>一次滚动手册页的一行</td></tr><tr><td>b</td><td>回滚一屏</td></tr><tr><td>f</td><td>前滚一屏</td></tr><tr><td>q</td><td>退出</td></tr><tr><td>/word</td><td>搜索 <strong>word</strong> 字符串</td></tr></tbody></table><blockquote><p>💡 提示：</p><p>初级阶段只需要 <strong>知道</strong> 通过以下两种方式可以查询命令的帮助信息</p><p>先学习<strong>常用命令</strong>及<strong>常用选项</strong>的使用即可，工作中如果遇到问题可以借助 <strong>网络搜索</strong></p></blockquote><h2 id="二-基础命令"><a class="header-anchor" href="#二-基础命令">¶</a>二、基础命令</h2><p>由于Linux命令实在太多，下面先介绍最最常用的通用基本操作命令。后面章节会扩展性地讲述其他命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前文件夹下的内容,list</span></span><br><span class="line">ls</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看当前所在文件夹,print wrok directory</span></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#切换文件夹,change directory</span></span><br><span class="line"><span class="built_in">cd</span> [目录名]</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果文件不存在，新建文件,touch</span></span><br><span class="line">touch [文件名]</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建目录,make directory</span></span><br><span class="line">mkdir [目录名]</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除指定的文件名,remove</span></span><br><span class="line">rm [文件名]</span><br><span class="line"></span><br><span class="line"><span class="comment">#清屏,clear</span></span><br><span class="line">clear</span><br></pre></td></tr></table></figure><h2 id="三-命令操作技巧"><a class="header-anchor" href="#三-命令操作技巧">¶</a>三、命令操作技巧</h2><p>在使用终端命令的过程中，使用一些操作技巧可以辅助我们更有效率地完成工作。</p><h3 id="1-放大终端窗口的字体显示"><a class="header-anchor" href="#1-放大终端窗口的字体显示">¶</a>1. 放大终端窗口的字体显示</h3><p><code>ctrl + shift + =</code></p><h3 id="2-缩小终端窗口的字体显示"><a class="header-anchor" href="#2-缩小终端窗口的字体显示">¶</a>2. 缩小终端窗口的字体显示</h3><p><code>ctrl + -</code></p><h3 id="3-自动补全"><a class="header-anchor" href="#3-自动补全">¶</a>3. 自动补全</h3><p>在敲出 <code>文件</code>／<code>目录</code>／<code>命令</code> 的前几个字母之后，按下 <code>tab</code> 键。如果输入的没有歧义，系统会自动补全，如果还存在其他 <code>文件</code>／<code>目录</code>／<code>命令</code>，再按一下 <code>tab</code>键，系统会提示可能存在的命令。</p><h3 id="4-终端历史命令切换"><a class="header-anchor" href="#4-终端历史命令切换">¶</a>4. 终端历史命令切换</h3><p>按 <code>上</code>／<code>下</code> 光标键可以在曾经使用过的命令之间来回切换</p><h3 id="5-退出执行中的命令"><a class="header-anchor" href="#5-退出执行中的命令">¶</a>5. 退出执行中的命令</h3><p>如果想要退出选择，并且不想执行当前选中的命令，可以按 <code>ctrl + c</code></p><h2 id="四-文件管理"><a class="header-anchor" href="#四-文件管理">¶</a>四、文件管理</h2><h3 id="1-文件系统"><a class="header-anchor" href="#1-文件系统">¶</a>1. 文件系统</h3><h4 id="windows-文件系统"><a class="header-anchor" href="#windows-文件系统">¶</a>Windows 文件系统</h4><ul><li>在 <code>Windows</code> 下，打开 “计算机”，我们看到的是一个个的驱动器盘符：</li></ul><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1541824004536.png" alt="001_Windows下的多个盘"></p><ul><li>每个驱动器都有自己的根目录结构，这样形成了多个树并列的情形，如图所示：</li></ul><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1541824026962.png" alt="001-Windows下多个盘为节点的目录分支"></p><h4 id="linux-文件系统"><a class="header-anchor" href="#linux-文件系统">¶</a>Linux 文件系统</h4><h5 id="linux目录结构"><a class="header-anchor" href="#linux目录结构">¶</a>Linux目录结构</h5><ul><li>在 <code>Linux</code> 下，我们是看不到这些驱动器盘符，我们看到的是文件夹（目录）：</li></ul><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1541824061423.png" alt="002_Ubuntu文件目录"></p><ul><li><code>Ubuntu</code> 没有盘符这个概念，只有一个根目录 <code>/</code>，所有子目录和文件都在它下面</li></ul><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1541824072966.png" alt="003-Linux的树形示意图"></p><h5 id="linux主要目录介绍"><a class="header-anchor" href="#linux主要目录介绍">¶</a>Linux主要目录介绍</h5><ul><li><p><code>/</code>：根目录，在 linux 下有且只有一个根目录，所有的东西都是从这里开始，当在终端里输入 <code>/home</code>，其实是在告诉电脑，先从 <code>/</code>（根目录）开始，再进入到 <code>home</code> 目录。</p></li><li><p><code>/bin</code>、<code>/usr/bin</code>：可执行二进制文件的目录，如常用的命令<code>ls</code>、<code>tar</code>、<code>mv</code>、<code>cat</code>等。</p></li><li><p><code>/boot</code>：放置 linux 系统启动时用到的一些文件，如 linux 的内核文件：<code>/boot/vmlinuz</code>，系统引导管理器：<code>/boot/grub</code>。</p></li><li><p><code>/dev</code>：存放linux系统下的设备文件，访问该目录下某个文件，相当于访问某个设备，常用的是挂载光驱。</p></li><li><p><code>/etc</code>：系统配置文件存放的目录，不建议在此目录下存放可执行文件，重要的配置文件有：</p><blockquote><p><code>/etc/inittab</code></p><p><code>/etc/fstab</code></p><p><code>/etc/init.d</code></p><p><code>/etc/X11</code></p><p><code>/etc/sysconfig</code></p><p><code>/etc/xinetd.d</code></p></blockquote></li><li><p><code>/home</code>：存放系统中用户的主目录。</p><blockquote><p>新增用户账号时，用户的主目录默认为<code>/home</code>目录下的一个用户同名的子目录中。如Linux系统存在用户test，则test用户的主目录为： <code>/home/test</code></p><p><code>~</code> 符号表示当前用户的主目录路径。</p></blockquote></li><li><p><code>/lib</code>、<code>/usr/lib</code>、<code>/usr/local/lib</code>：系统使用的函数库的目录，程序在执行过程中，需要调用一些额外的参数时需要函数库的协助。</p></li><li><p><code>/lost+fount</code>：系统异常产生错误时，会将一些遗失的片段放置于此目录下。</p></li><li><p><code>/mnt</code> 、<code>/media</code>：光盘默认挂载点，通常光盘挂载于 <code>/mnt/cdrom</code>下，但也不一定，可以选择任意位置进行挂载。</p></li><li><p><code>/opt</code>：给主机额外安装软件所摆放的目录</p></li><li><p><code>/proc</code>：此目录的数据都在内存中，如系统核心，外部设备，网络状态，由于数据都存放于内存中，所以不占用磁盘空间，比较重要的文件有：</p><blockquote><p><code>/proc/cpuinfo</code></p><p><code>/proc/interrupts</code></p><p><code>/proc/dma</code></p><p><code>/proc/ioports</code></p><p><code>/proc/net/</code></p></blockquote></li><li><p><code>/root</code>：系统管理员root的主要目录。</p></li><li><p><code>/sbin</code>、<code>/usr/sbin</code>、<code>/usr/local/sbin</code>：放置系统管理员使用的可执行命令，如 <code>fdisk</code>、<code>shutdown</code>、<code>mount</code>等。与<code>/bin</code> 不同的是，这几个目录是给系统管理员 root 使用的命令，一般用户只能&quot;查看&quot;而不能设置和使用。</p></li><li><p><code>/tmp</code>：一般用户或正在执行的程序临时存放文件的目录，任何人都可以访问，重要数据不可放置在此目录下。</p></li><li><p><code>/srv</code>：服务启动之后需要访问的数据目录，如 www 服务需要访问的网页数据存放在 <code>/srv/www</code> 内。</p></li><li><p><code>/usr</code>：应用程序存放目录：</p><blockquote><p><code>/usr/bin</code>：存放应用程序</p><p><code>/usr/share</code>：存放共享数据</p><p><code>/usr/lib</code>：存放不能直接运行的，却是许多程序运行所必需的一些函数库文件</p><p><code>/usr/local</code>：存放软件升级包</p><p><code>/usr/share/doc</code>：系统说明文件存放目录</p><p><code>/usr/share/man</code>：程序说明文件存放目录</p></blockquote></li><li><p><code>/var</code>：放置系统执行过程中经常变化的文件：</p><blockquote><p><code>/var/log</code>：随时更改的日志文件</p><p><code>/var/spool/mail</code>：邮件存放的目录</p><p><code>/var/run</code>：程序或服务启动后，其 PID 存放在该目录下</p></blockquote></li></ul><h3 id="2-常用命令"><a class="header-anchor" href="#2-常用命令">¶</a>2. 常用命令</h3><h4 id="1-列出目录文件-ls-tree"><a class="header-anchor" href="#1-列出目录文件-ls-tree">¶</a>1）列出目录文件（ls、tree）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列出目录文件</span></span><br><span class="line">ls</span><br><span class="line"></span><br><span class="line"><span class="comment">#树状形式列出目录文件</span></span><br><span class="line"><span class="comment">#选择-d：只显示目录</span></span><br><span class="line">tree</span><br></pre></td></tr></table></figure><blockquote><p><code>ls</code> 是英文单词 <strong>list</strong> 的简写，其功能为列出目录的内容，是用户最常用的命令之一，类似于 <strong>DOS</strong>下的 <code>dir</code> 命令</p><p>常用选项：</p><ul><li><code>-a</code>：显示指定目录下所有子目录与文件，包括隐藏文件</li><li><code>-l</code>：以列表方式显示文件的详细信息</li><li><code>-h</code>：配合 <code>-l</code> 以人性化的方式显示文件大小</li></ul><p>通配符的使用：</p><ul><li><code>*</code>：代表任意个数个字符</li><li><code>?</code>：代表任意一个字符，至少 1 个</li><li><code>[abc]</code>：匹配 a、b、c 中的任意一个</li><li><code>[a-f]</code>：匹配从 a 到 f 范围内的的任意一个字符</li></ul><p>Linux 下文件和目录的特点：</p><ul><li>Linux <strong>文件</strong> 或者 <strong>目录</strong> 名称最长可以有 <code>256</code> 个字符</li><li>以 <code>.</code> 开头的文件为隐藏文件，需要用 <code>-a</code>参数才能显示</li><li><code>.</code>代表当前目录</li><li><code>..</code> 代表上一级目录</li></ul></blockquote><p><strong>计算机中文件大小的表示方式</strong></p><table><thead><tr><th>单位</th><th>英文</th><th>含义</th></tr></thead><tbody><tr><td>字节</td><td>B（Byte）</td><td>在计算机中作为一个数字单元，一般为 8 位二进制数</td></tr><tr><td>千</td><td>K（Kibibyte）</td><td>1 KB = 1024 B，千字节 （1024 = 2 ** 10）</td></tr><tr><td>兆</td><td>M（Mebibyte）</td><td>1 MB = 1024 KB，百万字节</td></tr><tr><td>千兆</td><td>G（Gigabyte）</td><td>1 GB = 1024 MB，十亿字节，千兆字节</td></tr><tr><td>太</td><td>T（Terabyte）</td><td>1 TB = 1024 GB，万亿字节，太字节</td></tr><tr><td>拍</td><td>P（Petabyte）</td><td>1 PB = 1024 TB，千万亿字节，拍字节</td></tr><tr><td>艾</td><td>E（Exabyte）</td><td>1 EB = 1024 PB，百亿亿字节，艾字节</td></tr><tr><td>泽</td><td>Z（Zettabyte）</td><td>1 ZB = 1024 EB，十万亿亿字节，泽字节</td></tr><tr><td>尧</td><td>Y（Yottabyte）</td><td>1 YB = 1024 ZB，一亿亿亿字节，尧字节</td></tr></tbody></table><h4 id="2-切换目录-cd"><a class="header-anchor" href="#2-切换目录-cd">¶</a>2）切换目录（ cd ）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#切换到/usr/local/share目录里</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/share</span><br><span class="line"><span class="comment">#切换到当前用户的主目录(/home/用户目录)</span></span><br><span class="line"><span class="built_in">cd</span> ~	<span class="comment">#或：cd</span></span><br><span class="line"><span class="comment">#保持在当前目录不变</span></span><br><span class="line"><span class="built_in">cd</span> .</span><br><span class="line"><span class="comment">#切换到上级目录</span></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="comment">#在最近两次工作目录之间来回切换</span></span><br><span class="line"><span class="built_in">cd</span> -</span><br></pre></td></tr></table></figure><blockquote><ul><li><code>cd</code> 是英文单词 <strong>change directory</strong> 的简写，其功能为更改当前的工作目录，也是用户最常用的命令之一。</li><li>注意：Linux 所有的 <strong>目录</strong> 和 <strong>文件名</strong> 都是大小写敏感的。</li><li>关于相对路径和绝对路径的说明：</li><li><strong>相对路径</strong> 在输入路径时，最前面不是 <code>/</code> 或者<code>**~**</code>，表示相对 <strong>当前目录</strong> 所在的目录位置</li><li><strong>绝对路径</strong> 在输入路径时，最前面是 <code>/</code>或者<code>~</code>，表示从 <strong>根目录/家目录</strong> 开始的具体目录位置</li></ul></blockquote><h4 id="3-创建和删除操作-touch-mkdir-rm"><a class="header-anchor" href="#3-创建和删除操作-touch-mkdir-rm">¶</a>3）创建和删除操作（touch、mkdir、rm）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建文件</span></span><br><span class="line">touch filename.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建目录</span></span><br><span class="line">mkdir <span class="built_in">test</span>-dir</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除文件或目录</span></span><br><span class="line"><span class="comment">#-f：强制删除，忽略不存在的文件，无需提示</span></span><br><span class="line"><span class="comment">#-r：递归地删除目录下的内容，删除文件夹时必须加此选项</span></span><br><span class="line">rm -f filename.txt	<span class="comment">#强制删除filename.txt文件</span></span><br><span class="line">rm -rf <span class="built_in">test</span>-dir	<span class="comment">#强制删除目录以及其内容</span></span><br></pre></td></tr></table></figure><h4 id="4-拷贝和移动文件-cp-mv"><a class="header-anchor" href="#4-拷贝和移动文件-cp-mv">¶</a>4）拷贝和移动文件（cp、mv）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##复制文件或者目录</span></span><br><span class="line"><span class="comment">#-i：覆盖文件前提示</span></span><br><span class="line"><span class="comment">#-r：若给出的源文件是目录文件，则 cp 将递归复制该目录下的所有子目录和文件，目标文件必须为一个目录名</span></span><br><span class="line">cp 源文件 目标文件</span><br><span class="line"></span><br><span class="line"><span class="comment">##移动文件或者目录 或 重命名</span></span><br><span class="line"><span class="comment"># mv命令（mv英文：move）可以用来移动文件或目录，也可以给文件或目录重命名</span></span><br><span class="line"><span class="comment">#-i：覆盖文件前提示</span></span><br><span class="line">mv 源文件 目标文件</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例 1：将一个目录移动为另一个目录</span></span><br><span class="line">	<span class="comment">#如果目标目录已经存在，则将原目录移动到已存在的目标目录里面</span></span><br><span class="line">	<span class="comment">#如果目标目录不存在，则将原目录移动为一个新的目标目录（即目录重命名）</span></span><br><span class="line">mv source_dir dest_dir	<span class="comment">#移动过程包括所有文件（含隐藏文件）</span></span><br><span class="line"><span class="comment">#示例 2：将一个目录中的所有文件（包括隐藏文件）移动到另一个目录</span></span><br><span class="line">mv source_dir/* dest_dir/	<span class="comment">#移动过程包括仅包括所有非隐藏文件</span></span><br><span class="line">mv source_dir/.* dest_dir/	<span class="comment">#移动过程包括仅包括所有隐藏文件</span></span><br></pre></td></tr></table></figure><h4 id="5-查看文件内容-cat-more-grep-tail"><a class="header-anchor" href="#5-查看文件内容-cat-more-grep-tail">¶</a>5）查看文件内容（cat、more 、grep、tail）</h4><h5 id="1-cat-查看文件的所有内容"><a class="header-anchor" href="#1-cat-查看文件的所有内容">¶</a>（1）cat 查看文件的所有内容</h5><p><code>cat</code> （concatenate）命令可以用来 <strong>查看文件内容</strong>、<strong>创建文件</strong>、<strong>文件合并</strong>、<strong>追加文件内容</strong> 等功能。</p><p><code>cat</code> 会一次显示所有的内容，适合 <strong>查看内容较少</strong> 的文本文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看hello.txt文件的所有内容</span></span><br><span class="line">cat hello.txt</span><br></pre></td></tr></table></figure><blockquote><p>常用选项：</p><ul><li><code>-b</code>：覆对非空输出行编号</li><li><code>-n</code>：对输出的所有行编号</li></ul><p>Linux 中还有一个 <code>nl</code> 的命令和 <code>cat -b</code> 的效果等价</p></blockquote><h5 id="2-more-分屏显示文件内容"><a class="header-anchor" href="#2-more-分屏显示文件内容">¶</a>（2）more 分屏显示文件内容</h5><p><code>more</code> 命令可以用于分屏显示文件内容，每次只显示一页内容</p><p>适合于 <strong>查看内容较多</strong>的文本文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#分屏显示hello.txt文件内容</span></span><br><span class="line">more hello.txt</span><br></pre></td></tr></table></figure><p>使用 <code>more</code> 的操作键：</p><table><thead><tr><th>操作键</th><th>功能</th></tr></thead><tbody><tr><td>空格键</td><td>显示手册页的下一屏</td></tr><tr><td>Enter 键</td><td>一次滚动手册页的一行</td></tr><tr><td>b</td><td>回滚一屏</td></tr><tr><td>f</td><td>前滚一屏</td></tr><tr><td>q</td><td>退出</td></tr><tr><td>/word</td><td>搜索 <strong>word</strong> 字符串</td></tr></tbody></table><h5 id="3-grep-搜索文本文件内容"><a class="header-anchor" href="#3-grep-搜索文本文件内容">¶</a>（3）grep 搜索文本文件内容</h5><p>Linux 系统中 <code>grep</code> 命令是一种强大的文本搜索工具。</p><p><code>grep</code>允许对文本文件进行 <strong>模式</strong>查找，所谓模式查找，又被称为正则表达式。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示匹配包含qcmoke字符串的行及行号</span></span><br><span class="line">grep -n qcmoke hello.txt</span><br></pre></td></tr></table></figure><blockquote><p>命令选项：</p><ul><li><code>-n</code>：显示匹配行及行号</li><li><code>-v</code>：显示不包含匹配文本的所有行（相当于求反）</li><li><code>-i</code>：忽略大小写</li></ul><p>常用的两种模式查找：</p><ul><li><code>^a</code>： 行首，搜寻以 <strong>a</strong> 开头的行</li><li><code>ke$</code>：行尾，搜寻以 <strong>ke</strong> 结束的行</li></ul></blockquote><h5 id="4-tail-取出文件后面几行"><a class="header-anchor" href="#4-tail-取出文件后面几行">¶</a>（4）tail 取出文件后面几行</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#取出文件后面10行</span></span><br><span class="line">tail hello.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认的情况中，显示最后的十行！若要显示最后的 20 行，就得要这样：</span></span><br><span class="line">tail -n 20  /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#侦测文件尾部10行</span></span><br><span class="line">tail -n 10 -f  ~/logs/web2019-10-10.log</span><br></pre></td></tr></table></figure><blockquote><p>命令选项：</p><ul><li><code>-n</code>：后面接数字，代表显示几行的意思</li><li><code>-f</code>：侦测文件尾部，要等到按下[ctrl]-c才会结束tail的侦测即，如果文件尾部内容被更改，也会随着显示最新尾部内容，常用于查看日志。</li></ul></blockquote><h4 id="6-查找文件-find"><a class="header-anchor" href="#6-查找文件-find">¶</a>6）查找文件（ find ）</h4><p><code>find</code> 命令功能非常强大，通常用来在 <strong>特定的目录下</strong> <strong>搜索</strong> 符合条件的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#搜索主目录下，文件名包含hello的文件</span></span><br><span class="line">find ~ -name <span class="string">"hello*"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#搜索/etc目录下，所有以.conf为扩展名的文件</span></span><br><span class="line">find /etc -name <span class="string">"*.conf"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#搜索/home目录下，以数字1开头的文件</span></span><br><span class="line">find /home ~ -name <span class="string">"1*"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-type f: 只查找普通文件；-not -name 排除文件名包含 “test” 字符串的文件</span></span><br><span class="line">find /path/to/dir -<span class="built_in">type</span> f -name <span class="string">"*.txt"</span> -not -name <span class="string">"*test*"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用 -not -path 参数排除不符合条件的目录</span></span><br><span class="line">find .  -name <span class="string">"node_modules"</span> -not -path <span class="string">"./test/*"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查找出当前目录及所有子目录下的文件大小大于1G且小于3G的所有文件，并显示出其文件大小</span></span><br><span class="line">    <span class="comment"># -type d 表示查找的对象是目录</span></span><br><span class="line">    <span class="comment"># -exec du -h &#123;&#125; \; 表示对找到的每个目录执行 du -h 命令，&#123;&#125; 会被替换为找到的目录路径。</span></span><br><span class="line">find . -<span class="built_in">type</span> f -size +1G -size -3G -<span class="built_in">exec</span> du -h &#123;&#125; \;</span><br></pre></td></tr></table></figure><blockquote><p>说明：</p><ul><li><code>-name pattern</code>: #按照文件名匹配模式查找文件。例如 -name “*.txt” 查找扩展名为 .txt 的文件。</li><li><code>-iname pattern</code>: #类似 -name，但是不区分大小写。</li><li><code>-type type</code>: #根据文件类型查找文件，type 可以为 f (普通文件)、d (目录)、l (符号链接) 等。</li><li><code>-mtime n</code>: #查找在 n 天前被修改过的文件，n 为负数表示查找 n 天内被修改过的文件。</li><li><code>-size n[bck]</code>: #查找文件大小为 n 的文件，单位为字节（默认）、块或千字节。b 表示块，c 表示千字节。</li><li><code>-user name</code>: #查找属于指定用户名的文件。</li><li><code>-group name</code>: #查找属于指定用户组的文件。</li><li><code>-perm mode</code>: #查找权限与指定参数 mode 匹配的文件。mode 可以为类似 644 这样的八进制数，也可以为类似 u=rw,g=r,o=r 这样的符号表示法。</li><li><code>-exec command {} \;</code>: #对每个找到的文件执行 command 命令。其中 {} 表示当前匹配到的文件名，; 表示命令结束。</li><li><code>-not expr</code>: #对表达式 expr 求反，即排除满足条件的文件。</li><li><code>-path pattern</code>: #查找路径名匹配模式的文件。例如 -path “/home/user/*.txt” 查找 /home/user/ 目录下所有扩展名为 .txt 的文件。</li><li>如果省略路径，表示在当前文件夹下查找</li></ul></blockquote><h4 id="7-查看目录或文件占用大小-du"><a class="header-anchor" href="#7-查看目录或文件占用大小-du">¶</a>7）查看目录或文件占用大小（ du ）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#递归查看目录及其子目录的大小（不含非目录的文件大小）</span></span><br><span class="line">du -h [目录名]</span><br><span class="line"><span class="comment">#查看指定目录的总大小（不含子目录和文件大小）</span></span><br><span class="line">du -sh [目录名]</span><br><span class="line"><span class="comment">#查看目录、子目录、文件的大小</span></span><br><span class="line">du -ah [目录名]</span><br><span class="line"><span class="comment">#查看目录下所有一级子目录、文件的大小</span></span><br><span class="line">du -ah --max-depth=1 [目录名]</span><br><span class="line"><span class="comment">#查看目录下所有一级子目录、文件的大小，并进行倒序排序</span></span><br><span class="line">du -ah --max-depth=1|sort -nr [目录名]</span><br></pre></td></tr></table></figure><blockquote><p>说明：</p><ul><li><code>-s</code>：只显目录的总大小，不显示每个子目录和文件的大小。</li><li><code>-a</code>：列出所有文件和子目录的大小，而不仅仅是目录。</li><li><code>-h</code>：以人类可读的方式显示文件大小，例如：1K、4.5M、2G 等。</li><li><code>-b</code>：以字节为单位显示文件大小。</li><li><code>-c</code>：同时显示多个文件或目录的总大小。</li><li><code>-x</code>：不递归处理指定目录下的子目录。</li></ul></blockquote><h4 id="8-链接-ln"><a class="header-anchor" href="#8-链接-ln">¶</a>8）链接（ ln ）</h4><h5 id="简要概述"><a class="header-anchor" href="#简要概述">¶</a>简要概述</h5><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/001_%E6%96%87%E4%BB%B6%E8%BD%AF%E7%A1%AC%E9%93%BE%E6%8E%A5%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="001_文件软硬链接示意图"></p><h5 id="软链接"><a class="header-anchor" href="#软链接">¶</a>软链接</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建文件的软链接，用通俗的方式讲类似于Windows下的快捷方式。</span></span><br><span class="line"><span class="comment">#删除软链接不会影响源文件，但源文件被删除了，那么软连接就不可用了</span></span><br><span class="line">ln -s &lt;被链接的源文件绝对路径&gt; &lt;链接文件路径&gt;</span><br></pre></td></tr></table></figure><blockquote><ul><li>软链接的特点：</li></ul><p>（1）软链接，以路径的形式存在。类似于Windows操作系统中的快捷方式</p><p>（2）软链接可以 跨文件系统 ，硬链接不可以</p><p>（3）软链接可以对一个不存在的文件名进行链接</p><p>（4）软链接可以对目录进行链接</p><ul><li>注意：</li></ul><p>（1）没有 <code>-s</code> 选项建立的是一个 硬链接文件（对于硬链接文件，两个文件占用相同大小的硬盘空间，工作中几乎不会建立文件的硬链接）</p><p>（2）被链接的源文件要使用绝对路径，不能使用相对路径，这样可以方便移动链接文件后，仍然能够正常使用</p></blockquote><h5 id="硬链接"><a class="header-anchor" href="#硬链接">¶</a>硬链接</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除硬链接，不会影响源文件,同样的删除源文件也不会影响硬链接,只删除一个连接并不影响索引节点本身和其它的连接，只有当最后一个连接被删除后，文件的数据块及目录的连接才会被释放</span></span><br><span class="line">ln 被链接的源文件 链接文件</span><br></pre></td></tr></table></figure><blockquote><ul><li>硬链接的特点：</li></ul><p>（1）硬链接，以文件副本的形式存在。但不占用实际空间。</p><p>（2）不允许给目录创建硬链接</p><p>（3）硬链接只有在同一个文件系统中才能创建</p><ul><li>说明：</li></ul><p>在 Linux 中，<strong>文件名</strong> 和 <strong>文件的数据</strong> 是分开存储的</p><p>在 Linux 中，只有文件的 <code>硬链接数 == 0</code> 才会被删除</p><p>使用 <code>ls -l</code> 可以查看一个文件的硬链接的数量</p><p>在日常工作中，几乎不会建立文件的硬链接，知道即可</p></blockquote><h4 id="9-打包-和-解包-tar"><a class="header-anchor" href="#9-打包-和-解包-tar">¶</a>9）打包 和 解包（ tar ）</h4><p><code>tar</code> 是 Linux 中最常用的 <strong>备份</strong>工具，此命令可以 <strong>把一系列文件</strong> 打包到 <strong>一个大文件中</strong>，也可以把一个 <strong>打包的大文件恢复成一系列文件</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打包文件（不压缩）</span></span><br><span class="line">tar -cvf 打包文件.tar 被打包的文件／路径...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解包文件</span></span><br><span class="line">tar -xvf 打包文件.tar</span><br></pre></td></tr></table></figure><blockquote><p>选项说明</p><ul><li><code>c</code>：生成档案文件，创建打包文件</li><li><code>x</code>：解开档案文件</li><li><code>v</code>：列出归档解档的详细过程，显示进度</li><li><code>f</code>：指定档案文件名称，f 后面一定是 .tar 文件，所以必须放选项最后</li></ul><p>注意：<code>f</code> 选项必须放在最后，其他选项顺序可以随意</p></blockquote><h4 id="10-压缩-和-解压缩"><a class="header-anchor" href="#10-压缩-和-解压缩">¶</a>10）压缩 和 解压缩</h4><h5 id="1-gzip"><a class="header-anchor" href="#1-gzip">¶</a>（1）gzip</h5><p>gzip 是linux中常见的压缩/解压工具，最常见的使用对象是*.gz格式的文件。</p><blockquote><p><strong>OPTIONS</strong><br>-c --stdout --to-stdout 结果写到标准输出，原文件保持不变<br>-d --decompress --uncompress 解压<br>-k --keep 压缩或者解压过程中，保留原文件<br>-r --recursive<br>-t --test 检查压缩文件的完整性<br>-v --verbose 显示每个文件的名子和压缩率<br>-&lt;压缩效率&gt; 　压缩效率是一个介于1－9的数值，预设值为&quot;6&quot;，指定愈大的数值，压缩效率就会愈高。</p><ul><li>–best 　此参数的效果和指定&quot;-9&quot;参数相同。</li><li>–fast 　此参数的效果和指定&quot;-1&quot;参数相同。</li></ul></blockquote><hr><p>示例1，压缩文件<br>原文件名为file1.txt，压缩后原文件消失，压缩后文件名为file1.txt.gz</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp<span class="comment"># ls -l file1.*</span></span><br><span class="line">-rw-r--r-- 1 root root 12383865 Aug 21 08:08 file1.txt</span><br><span class="line">root@ubuntu:/tmp<span class="comment"># gzip file1.txt</span></span><br><span class="line">root@ubuntu:/tmp<span class="comment"># ls -l file1.*</span></span><br><span class="line">-rw-r--r-- 1 root root 134416 Aug 21 08:08 file1.txt.gz</span><br></pre></td></tr></table></figure><p>示例2，解压文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp<span class="comment"># gzip -d file1.txt.gz</span></span><br><span class="line">root@ubuntu:/tmp<span class="comment"># ls -lh file1.*</span></span><br><span class="line">-rw-r--r-- 1 root root 12M Aug 21 08:08 file1.txt</span><br></pre></td></tr></table></figure><p>示例3，压缩的时候，显示压缩率</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp<span class="comment"># gzip -v file1.txt</span></span><br><span class="line">file1.txt: 98.9% -- replaced with file1.txt.gz</span><br></pre></td></tr></table></figure><p>示例4，一条命令压缩多个文件，压缩之后，是各自分开的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp<span class="comment"># gzip file1.txt file2.txt</span></span><br><span class="line">root@ubuntu:/tmp<span class="comment"># ls -l</span></span><br><span class="line">total 1348</span><br><span class="line">-rw-r--r-- 1 root root 134416 Aug 21 08:08 file1.txt.gz</span><br><span class="line">-rw-r--r-- 1 root root 392 Aug 21 08:15 file2.txt.gz</span><br></pre></td></tr></table></figure><p>示例5，压缩过程中，保留原文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp<span class="comment"># gzip -k file1.txt</span></span><br><span class="line">root@ubuntu:/tmp<span class="comment"># ls file1.*</span></span><br><span class="line">file1.txt file1.txt.gz</span><br></pre></td></tr></table></figure><p>示例6，压缩到标准输出中<br>可以连接两个文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp<span class="comment"># cat file1.txt file2.txt | gzip &gt; foo.gz</span></span><br><span class="line">或者</span><br><span class="line">root@ubuntu:/tmp<span class="comment"># gzip -c file1.txt file2.txt &gt; foo.gz</span></span><br></pre></td></tr></table></figure><h5 id="2-gunzip"><a class="header-anchor" href="#2-gunzip">¶</a>（2）gunzip</h5><p>解压gz格式文件（不保留压缩文件）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ls</span></span><br><span class="line">test1.txt.gz  test2.txt.gz</span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># gunzip  test1.txt.gz  test2.txt.gz </span></span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ls</span></span><br><span class="line">test1.txt  test2.txt</span><br></pre></td></tr></table></figure><h5 id="3-tar-和-gzip"><a class="header-anchor" href="#3-tar-和-gzip">¶</a>（3）tar 和 gzip</h5><p>命令结合可以使用实现文件打包和压缩</p><ul><li><code>tar</code> 只负责打包文件，但不压缩</li><li>用 <code>gzip</code> 压缩 <code>tar</code> 包后，其扩展名一般用 <code>xxx.tar.gz</code></li></ul><blockquote><p>在 <code>Linux</code> 中，最常见的压缩文件格式就是 <code>xxx.tar.gz</code></p></blockquote><ul><li>在 <code>tar</code> 命令中有一个选项 <strong>-z</strong> 可以调用 <code>gzip</code>，从而可以方便的实现压缩和解压缩的功能</li><li>命令格式如下：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#压缩文件</span></span><br><span class="line">gzip test1.txt test2.txt <span class="comment">#会生成 test1.txt.gz  test2.txt.gz</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#压缩tar包</span></span><br><span class="line">gzip 打包文件名.tar  <span class="comment">#从tar包变成tar.gz压缩包，这个过程不会保留原来放入tar包</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打包并压缩文件</span></span><br><span class="line">tar -zcvf 打包文件名.tar.gz 被压缩的文件／路径...  <span class="comment">#自动先完成将各个文件打包生成xxx.tar，后压缩生成xxx.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压缩并解包</span></span><br><span class="line">tar -zxvf 打包文件名.tar.gz    <span class="comment">#自动先完成将xxx.tar.gz解压缩生成xxx.tar，后完成解包生成各个文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压缩并解包，解压时去除一个顶级目录层次</span></span><br><span class="line">tar -zxvf 打包文件名.tar.gz --strip-components=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压缩并解包到指定路径</span></span><br><span class="line">tar -zxvf 打包文件名.tar.gz -C 目标路径</span><br></pre></td></tr></table></figure><blockquote><p>常用选项：</p><ul><li><code>-C</code>：解压缩到指定目录，注意：要解压缩的目录必须存在</li><li><code>--strip-components=1</code>：解压时去除一个顶级目录层次</li></ul></blockquote><h5 id="4-bzip2"><a class="header-anchor" href="#4-bzip2">¶</a>（4）bzip2</h5><ul><li><code>tar</code> 与 <code>bzip2</code> 命令结合可以使用实现文件 <strong>打包和压缩</strong>（用法和 <code>gzip</code> 类似）<ul><li><code>tar</code> 只负责打包文件，但不压缩，</li><li>用 <code>bzip2</code> 压缩 <code>tar</code> 打包后的文件，其扩展名一般用 <code>xxx.tar.bz2</code></li></ul></li><li>在 <code>tar</code> 命令中有一个选项 <strong>-j</strong> 可以调用 <code>bzip2</code>，从而可以方便的实现压缩和解压缩的功能</li><li>命令格式如下：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 压缩文件</span></span><br><span class="line">tar -jcvf 打包文件.tar.bz2 被压缩的文件／路径...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压缩文件</span></span><br><span class="line">tar -jxvf 打包文件.tar.bz2</span><br></pre></td></tr></table></figure><h5 id="5-zip-和-unzip"><a class="header-anchor" href="#5-zip-和-unzip">¶</a>（5）zip 和 unzip</h5><p><code>zip</code> 是一个常用的命令行工具，用于在 Linux 和类Unix系统上创建和管理ZIP压缩文件。</p><blockquote><p>命令常用选项</p><ul><li><code>-r</code>：递归压缩，即压缩目录</li><li><code>-j</code>：仅存储文件，不包含目录路径。在压缩包中只保留文件名。</li><li><code>-u</code>：仅更新压缩包中的新文件和修改过的文件。</li><li><code>-d</code>：从压缩包中删除指定的文件或目录。</li><li><code>-l</code>：显示压缩包中的文件列表，不解压缩。</li><li><code>-q</code>：安静模式，不显示任何输出。</li><li><code>-v</code>：显示详细的压缩过程信息。</li><li><code>-C &lt;目录&gt;</code>：在创建压缩包之前切换到指定目录。</li><li><code>-x &lt;模式&gt;</code>：排除匹配模式的文件或目录。</li><li><code>-z</code>：压缩时显示进度百分比。</li><li><code>-e</code>：加密压缩包。</li><li><code>-P &lt;密码&gt;</code>：设置压缩包的密码。</li><li><code>-T</code>：测试压缩包的完整性。</li></ul></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#压缩文件</span></span><br><span class="line">zip  test.zip  test1.txt test2.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#递归压缩目录</span></span><br><span class="line">zip -r test.zip /opt/<span class="built_in">test</span>/</span><br><span class="line"><span class="comment">#注意压缩目录，压缩包里的目录结构会默认保留目标目录的完整路径，如果希望使用想对路径，那么应该cd到目标目录后再通过相对路径来压缩</span></span><br><span class="line"><span class="built_in">cd</span> /opt &amp;&amp; zip -r test.zip <span class="built_in">test</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment">#加密压缩</span></span><br><span class="line">zip -r -e -P 123456 my_archive.zip my_directory</span><br><span class="line"></span><br><span class="line"><span class="comment">#实战示例</span></span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">rm -f backup-*</span><br><span class="line">zip -r -e -P 123456 <span class="string">"backup-<span class="variable">$(date +'%Y%m%d%H%M%S')</span>.zip"</span> \</span><br><span class="line">./* \</span><br><span class="line">-x <span class="string">"./containerd/*"</span> \</span><br><span class="line">-x <span class="string">"./blog/*"</span> \</span><br><span class="line">-x <span class="string">"./temp/*"</span> \</span><br><span class="line">-x <span class="string">"*/logs/*"</span> \</span><br><span class="line">-x <span class="string">"*/log/*"</span></span><br></pre></td></tr></table></figure><p><code>unzip</code> 是一个常用的命令行工具，用于解压缩 ZIP 压缩包</p><blockquote><p>常用选项：</p><ul><li><code>-d &lt;目标目录&gt;</code>：指定解压缩的目标目录，将压缩包中的文件提取到指定目录。</li><li><code>-l</code>：显示压缩包中的文件列表，不解压缩。</li><li><code>-o</code>：覆盖目标目录中已存在的文件，而不进行确认提示。</li><li><code>-q</code>：安静模式，减少输出信息。</li><li><code>-v</code>：显示详细的解压缩过程信息。</li><li><code>-x &lt;模式&gt;</code>：排除匹配模式的文件，不进行解压缩。</li><li><code>-P &lt;密码&gt;</code>：指定密码来解压缩。</li><li><code>-j</code>：解压缩时跳过目录路径，将文件直接提取到当前目录。</li></ul></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#默认解压到当前目录</span></span><br><span class="line">unzip  test.zip</span><br><span class="line"><span class="comment">#解压到指定目录</span></span><br><span class="line">unzip test.zip -d path</span><br><span class="line"></span><br><span class="line"><span class="comment">#解密并解压缩</span></span><br><span class="line">unzip -P 123456 my_archive.zip</span><br></pre></td></tr></table></figure><h4 id="11-重定向-和"><a class="header-anchor" href="#11-重定向-和">¶</a>11）重定向（ <code>&gt;</code> 和 <code>&gt;&gt;</code> ）</h4><p>Linux 允许将命令执行结果重定向到一个文件，将本应显示在终端上的内容输出或者追加到指定文件中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#覆盖输出内容到文件中</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"hello"</span> &gt; test.txt</span><br><span class="line"><span class="comment">#追加内容到文件中</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"hello"</span> &gt;&gt; test.txt</span><br></pre></td></tr></table></figure><blockquote><ul><li><code>&gt;</code> 表示输出，会覆盖文件原有的内容</li><li><code>&gt;&gt;</code> 表示追加，会将内容追加到已有文件的末尾</li></ul></blockquote><h4 id="12-管道"><a class="header-anchor" href="#12-管道">¶</a>12）管道（ <code>|</code> ）</h4><p>Linux 允许将 一个命令的输出可以通过管道做为另一个命令的输入。使用操作如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep nginx</span><br><span class="line">more test.txt | grep hello</span><br></pre></td></tr></table></figure><blockquote><p>可以理解现实生活中的管子，管子的一头塞东西进去，另一头取出来，这里 <code>|</code> 的左右分为两端，左端塞东西（写），右端取东西（读）</p></blockquote><h4 id="13-统计-wc"><a class="header-anchor" href="#13-统计-wc">¶</a>13）统计（ <code>wc</code> ）</h4><p><code>wc</code>（Word Count）命令用于统计文件的行数、单词数和字节数等信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">wc [选项] 文件列表</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##示例1：</span></span><br><span class="line">wc example.txt</span><br><span class="line"><span class="comment">#输出如下：</span></span><br><span class="line"><span class="comment"># 2  5 28 example.txt</span></span><br><span class="line"><span class="comment">#分别表示 2 行、5 个单词、28 个字节。</span></span><br><span class="line"><span class="comment">#如果执行 wc -l example.txt，则只输出行数，如下：</span></span><br><span class="line"><span class="comment"># 2 example.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##示例2：</span></span><br><span class="line"><span class="comment">#统计某个目录下的所有以 .mp4 结尾的文件数量</span></span><br><span class="line">ls -l /path/to/dir | grep <span class="string">'\.mp4$'</span> | wc -l</span><br><span class="line"><span class="comment">#递归地统计某个目录下的所有以 .mp4 结尾的文件数量</span></span><br><span class="line">find /path/to/dir -<span class="built_in">type</span> f -name <span class="string">"*.mp4"</span> | wc -l</span><br></pre></td></tr></table></figure><blockquote><p>常用选项：</p><ul><li><code>-l</code>：只显示行数。</li><li><code>-w</code>：只显示单词数。</li><li><code>-c</code>：只显示字节数。</li></ul></blockquote><h3 id="3-文件权限管理"><a class="header-anchor" href="#3-文件权限管理">¶</a>3. 文件权限管理</h3><p>在 Linux 系统中，不同的用户对于不同的系统资源拥有不同的使用权限。在 Linux 中，可以指定每一个用户针对不同的文件或者目录的不同权限。文件(目录)的权限包括如下：</p><table><thead><tr><th>序号</th><th>权限</th><th>英文</th><th>缩写</th><th>数字代号</th></tr></thead><tbody><tr><td>01</td><td>读</td><td>read</td><td>r</td><td>4</td></tr><tr><td>02</td><td>写</td><td>write</td><td>w</td><td>2</td></tr><tr><td>03</td><td>执行</td><td>excute</td><td>x</td><td>1</td></tr></tbody></table><h4 id="1-文件的详细信息"><a class="header-anchor" href="#1-文件的详细信息">¶</a>1. 文件的详细信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看文件夹下文件的详细信息（目录也是一种文件）</span></span><br><span class="line">ls -l</span><br></pre></td></tr></table></figure><p>打印结果从左到右依次是：</p><ul><li><p><strong>权限</strong>，第 1 个字符如果是 <code>d</code> 表示目录</p></li><li><p><strong>硬链接数</strong>，通俗地讲，就是有多少种方式，可以访问到当前目录／文件</p></li><li><p><strong>拥有者</strong>，家目录下 文件／目录 的拥有者通常都是当前用户</p></li><li><p><strong>组</strong>，在 Linux 中，很多时候，会出现组名和用户名相同的情况，后续会讲</p></li><li><p><strong>大小</strong></p></li><li><p><strong>最后修改时间</strong></p></li><li><p><strong>名称</strong></p></li></ul><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1541851399509.png" alt="1541851340006"><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1541851340006.png" alt="1541851399509"></p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1541783224649.png" alt="002_权限示意图"></p><h4 id="2-设置文件权限"><a class="header-anchor" href="#2-设置文件权限">¶</a>2. 设置文件权限</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置文件或目录的所属用户和用户组</span></span><br><span class="line">chown user:group file</span><br><span class="line"></span><br><span class="line"><span class="comment"># 递归修改文件|目录所属的用户组</span></span><br><span class="line">chgrp -R group file</span><br><span class="line"></span><br><span class="line"><span class="comment"># 递归修改文件或目录的操作权限</span></span><br><span class="line">chmod -R 755 file</span><br></pre></td></tr></table></figure><p><code>chmod</code> 在设置操作权限时，可以简单地使用三个数字分别对应：所属用户、所属用户组、 和其他用户的权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接修改文件|目录的 读|写|执行 权限，但是不能精确到 拥有者|组|其他</span></span><br><span class="line">chmod +/-rwx file</span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/004_%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="004_文件权限示意图"></p><p>常见数字组合有（<code>u</code>表示用户／<code>g</code>表示组／<code>o</code>表示其他）：</p><blockquote><p><code>777</code> ===&gt; <code>u=rwx,g=rwx,o=rwx</code></p><p><code>755</code> ===&gt; <code>u=rwx,g=rx,o=rx</code></p><p><code>644</code> ===&gt; <code>u=rw,g=r,o=r</code></p></blockquote><h4 id="3-文件属性模式"><a class="header-anchor" href="#3-文件属性模式">¶</a>3. 文件属性模式</h4><h5 id="lsattr"><a class="header-anchor" href="#lsattr">¶</a>lsattr</h5><p>lsattr 命令用于显示文件的属性，使用方式如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看file.sh 文件的属性</span></span><br><span class="line">lsattr file.sh</span><br><span class="line"><span class="comment"># 查看当前目录下所有文件以及文件夹的属性</span></span><br><span class="line">lsattr</span><br></pre></td></tr></table></figure><p>详细说明请参考：</p><p>📚<a href="https://www.runoob.com/linux/linux-comm-lsattr.html" target="_blank" rel="noopener">https://www.runoob.com/linux/linux-comm-lsattr.html</a></p><h5 id="chattr"><a class="header-anchor" href="#chattr">¶</a>chattr</h5><p>chattr 用于修改文件属性。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chattr [-RV][-v&lt;版本编号&gt;][+&#x2F;-&#x2F;&#x3D;&lt;属性&gt;][文件或目录...]</span><br></pre></td></tr></table></figure><blockquote><p>选项：</p><ul><li><code>-R</code> 递归处理，将指定目录下的所有文件及子目录一并处理。</li><li><code>-v</code> &lt;版本编号&gt; 设置文件或目录版本。</li><li><code>-V</code> 显示指令执行过程。</li><li><code>+&lt;属性&gt;</code> 开启文件或目录的该项属性。</li><li><code>-&lt;属性&gt;</code> 关闭文件或目录的该项属性。</li><li><code>=&lt;属性&gt;</code> 指定文件或目录的该项属性。</li></ul></blockquote><p>这项指令可改变存放在ext2文件系统上的文件或目录属性，这些属性共有以下几种模式：</p><blockquote><ul><li><code>a</code>：让文件或目录仅供附加用途。</li><li><code>b</code>：不更新文件或目录的最后存取时间。</li><li><code>c</code>：将文件或目录压缩后存放。</li><li><code>d</code>：将文件或目录排除在倾倒操作之外。</li><li><code>i</code>：不得任意更动文件或目录。</li><li><code>s</code>：保密性删除文件或目录。</li><li><code>S</code>：即时更新文件或目录。</li><li><code>u</code>：预防意外删除。</li></ul></blockquote><p>该命令请切换至 root 用户下使用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为 file.sh 文件增加 i 标识</span></span><br><span class="line">chattr +i file.sh</span><br><span class="line"><span class="comment"># 为 file.sh 文件去除 i 标识</span></span><br><span class="line">chattr -i file.sh</span><br><span class="line"><span class="comment"># 为 file.sh 增加 i, a 两个标识</span></span><br><span class="line">chattr +ia file.sh</span><br><span class="line"><span class="comment"># 为 file.sh 文件移除 i, a 两个标识</span></span><br><span class="line">chattr -ia file.sh</span><br></pre></td></tr></table></figure><blockquote><p>详细说明请参考：</p><p>📚<a href="https://baike.baidu.com/item/chattr/9841067?fr=aladdin" target="_blank" rel="noopener">https://baike.baidu.com/item/chattr/9841067?fr=aladdin</a></p><p>📚<a href="https://www.runoob.com/linux/linux-comm-chattr.html" target="_blank" rel="noopener">https://www.runoob.com/linux/linux-comm-chattr.html</a></p></blockquote><h5 id="文件属性模式相关问题"><a class="header-anchor" href="#文件属性模式相关问题">¶</a>文件属性模式相关问题</h5><p>Linux 文件/文件夹无法删除问题解决方案</p><p>服务器黑客攻击后，如果他们对某些文件（例如病毒文件）的属性模式进行修改，导致我们无法轻易删除这些文件，同时采用 root 用户也可能无法使用rm命令删除，那么这就会带来巨大的隐患问题。</p><p>案例：</p><p>假设黑客使用如下命令对文件的属性模式进行了修改。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chattr +ia file.sh</span><br></pre></td></tr></table></figure><p>那么使用如下rm命令是没有权限删除的。即使是 root 用户也无法删除。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf file.sh</span><br></pre></td></tr></table></figure><p>这种情况就涉及到chattr命令相关的文件属性模式了。</p><p>由上文中得知当文件设置 i 和 a 任意一个属性我们就无法对文件进行删除操作，那么只要我们移除掉 i, a 属性，然后执行rm命令删除就可以了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 移除 i, a 属性</span></span><br><span class="line">chattr -ia file.sh</span><br><span class="line"><span class="comment"># 查看是否移除成功</span></span><br><span class="line">lsattr file.sh</span><br><span class="line"><span class="comment"># 删除文件</span></span><br><span class="line">rm -rf file.sh</span><br></pre></td></tr></table></figure><p>如果文件还未删除成功，则我们需要考虑文件所属的文件夹是否设置了 i 或 a 属性（这一点确实很难发现）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 退回上一级</span></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="comment"># 直接使用 lsattr 命令，这样可以列出当前文件夹下所有文件和文件夹的属性</span></span><br><span class="line"><span class="comment"># 不要使用 lsattr 文件夹 这样的语法，这样是列出该文件夹下的文件的属性</span></span><br><span class="line">lsattr</span><br></pre></td></tr></table></figure><p>如果文件夹被设置则对文件夹的属性执行移除操作，然后再删除文件夹里面的文件</p><h2 id="五-用户管理"><a class="header-anchor" href="#五-用户管理">¶</a>五、用户管理</h2><h3 id="1-基本概念"><a class="header-anchor" href="#1-基本概念">¶</a>1. 基本概念</h3><p>在 Linux 系统中，不论是本机或是远程登录系统，每个系统都必须拥有至少一个用户。用户是 Linux 系统工作中重要的一环，用户管理包括用户与组管理。为了方便用户管理，Linux有组的概念，组的意义在实际应用中，可以预先针对组设置好权限，然后将不同的用户添加到对应的组中，从而不用依次为每一个用户设置权限。</p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/001_%E7%BB%84%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="001_组示意图"></p><h3 id="2-用户组维护"><a class="header-anchor" href="#2-用户组维护">¶</a>2. 用户组维护</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加组</span></span><br><span class="line">groupadd 组名</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除组</span></span><br><span class="line">groupdel 组名</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看组信息</span></span><br><span class="line">cat /etc/group</span><br></pre></td></tr></table></figure><blockquote><p>提示：用户组信息保存在 <code>/etc/group</code> 文件中。</p><p>在实际应用中，可以预先针对组设置好权限，然后将不同的用户添加到对应的组中，从而不用依次为每一个用户设置权限。</p></blockquote><h3 id="3-用户维护"><a class="header-anchor" href="#3-用户维护">¶</a>3. 用户维护</h3><h4 id="1-创建用户"><a class="header-anchor" href="#1-创建用户">¶</a>1）创建用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建用户</span></span><br><span class="line">useradd 用户名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#显式创建用户时自动创建用户同名的用户组并添加用户到该组中</span></span><br><span class="line">useradd -U 用户名</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建用户时不自动创建用户同名的用户组，则系统会默认添加用户到系统默认的组中</span></span><br><span class="line">useradd -N 用户名</span><br><span class="line"><span class="comment">#系统默认的组配置在/etc/default/useradd里，可通过如下命令查看：</span></span><br><span class="line">cat /etc/group | grep <span class="string">":<span class="variable">$(grep .*GROUP /etc/default/useradd |  sed 's/.*GROUP=//')</span>:"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建用户时指定用户组 </span></span><br><span class="line">	<span class="comment">#-g: 指定将用户添加到的组（默认为用户同名的用户组）</span></span><br><span class="line">	<span class="comment">#-G: 指定将用户添加到的多个组</span></span><br><span class="line">useradd -g 组 用户名</span><br><span class="line">useradd -G 组1,组2 用户名</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建用户时自动创建用户主目录</span></span><br><span class="line">useradd -m 用户名</span><br><span class="line"><span class="comment">#创建用户时不自动创建用户主目录</span></span><br><span class="line">useradd -M 用户名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建用户时配置登录的Shell路径</span></span><br><span class="line">useradd -s /bin/bash 用户名</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建用户时进行密码设置</span></span><br><span class="line">useradd -p 密码</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建用户时指定用户的主目录，可以使用-d或--home参数，后面跟上想设定的主目录路径，如下：</span></span><br><span class="line">useradd -m -d /你的路径/用户名 用户名</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建用户和同名用户组，不自动创建用户主目录，禁止该用户登录系统</span></span><br><span class="line">useradd -U -M -s /usr/sbin/nologin 用户名</span><br></pre></td></tr></table></figure><blockquote><p>关于<code>useradd</code>命令说明：</p><ul><li>自动创建用户同名的用户组：在<code>Redhat</code>类系统和<code>Debain</code>类系统中，都默认会自动创建用户同名的用户组并添加用户到该组中（如果不需要自动创建则需加选项：<code>-N</code>，则系统会默认添加用户到系统默认的组中）。</li><li>自动创建用户主目录：在<code>Redhat</code>类系统中，默认会自动创建用户主目录（如果不需要创建则加选项：<code>-M</code>），而<code>Debain</code>类系统中不会自动创建（如果需要自动创建则需加选项：<code>-m</code>）。</li><li>自动配置登录的 Shell 路径：在<code>Redhat</code>类系统和<code>Debain</code>类系统中，都默认会自动配置登录的 Shell 路径（默认为：<code>/bin/bash</code>，自定义登录的 Shell 路径可加选项及参数：<code>-s &lt;path&gt;</code>）</li><li>密码设置：在<code>Redhat</code>类系统和<code>Debain</code>类系统中，都默认不会进行密码设置（如果需要设置可加选项及参数：<code>-p &lt;password&gt;</code>）。</li></ul><p>关于<code>adduser</code>命令的说明：</p><ul><li>在<code>Redhat</code>类系统中，<code>adduser</code>与<code>useradd</code>两个命令是相同的。</li><li>在<code>Debain</code>类系统中，<code>adduser</code>与<code>useradd</code>有所不同，<code>adduser</code>是基于<code>useradd</code>的上层命令，主要表现在<code>adduser</code>默认会自动创建用户主目录，默认会提示密码设置。</li></ul></blockquote><h4 id="2-设置用户密码"><a class="header-anchor" href="#2-设置用户密码">¶</a>2）设置用户密码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置用户密码，如果是普通用户，直接用 passwd 可以修改自己的账户密码</span></span><br><span class="line">passwd 用户名</span><br></pre></td></tr></table></figure><h4 id="3-查看系统的用户信息"><a class="header-anchor" href="#3-查看系统的用户信息">¶</a>3）查看系统的用户信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看系统中的所有用户信息</span></span><br><span class="line">cat /etc/passwd </span><br><span class="line"></span><br><span class="line"><span class="comment">#新建用户后，用户信息会保存在 /etc/passwd 文件中</span></span><br><span class="line">cat /etc/passwd | grep 用户名</span><br></pre></td></tr></table></figure><blockquote><p>提示：<code>/etc/passwd</code> 是用于保存用户信息的文件；而<code>/usr/bin/passwd</code> 是用于修改用户密码的程序。</p></blockquote><p><code>/etc/passwd</code> 文件存放的是用户的信息，由 6 个分号组成的 7 个信息，分别是</p><blockquote><p>用户名</p><p>密码（x，表示加密的密码）</p><p>UID（用户标识）</p><p>GID（组标识）</p><p>用户全名或本地帐号</p><p>家目录</p><p>登录使用的 Shell，就是登录之后，使用的终端命令，<code>ubuntu</code> 默认是 <code>dash</code></p></blockquote><h4 id="4-删除用户"><a class="header-anchor" href="#4-删除用户">¶</a>4）删除用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除用户时（默认不会自动删除用户的主目录，默认会删除用户的同名用户组）</span></span><br><span class="line">userdel 用户名</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除用户时自动删除用户的主目录</span></span><br><span class="line">userdel -r 用户名</span><br></pre></td></tr></table></figure><h4 id="5-查看系统用户信息"><a class="header-anchor" href="#5-查看系统用户信息">¶</a>5）查看系统用户信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看用户 UID 和 GID 信息,默认当前用户</span></span><br><span class="line">id [用户名]</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看当前所有登录的用户列表</span></span><br><span class="line">who</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看当前登录用户的账户名</span></span><br><span class="line">whoami</span><br></pre></td></tr></table></figure><h4 id="6-修改用户组和登录的shell"><a class="header-anchor" href="#6-修改用户组和登录的shell">¶</a>6）修改用户组和登录的Shell</h4><p>usermod命令可以用来设置 用户的主组、附加组和登录的Shell，命令格式如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改用户的主组,通常在新建用户时指定，在/etc/passwd的第4列GID对应的组</span></span><br><span class="line">usermod -g 组 用户名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改用户的附加组,在/etc/group中最后一列表示该组的用户列表，用于指定用户的附加权限</span></span><br><span class="line">usermod -G 组 用户名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改用户登录 Shell</span></span><br><span class="line">usermod -s /bin/bash 用户名</span><br></pre></td></tr></table></figure><blockquote><p>提示：设置了用户的附加组之后，需要重新登录才能生效！</p></blockquote><h4 id="7-切换用户"><a class="header-anchor" href="#7-切换用户">¶</a>7）切换用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 1、切换用户（su）</span></span><br><span class="line">	<span class="comment">#su 是 substitute user 的缩写，表示切换用户，默认为 root</span></span><br><span class="line">	<span class="comment">#切换用户后，将启动新的 shell 会话，可通过命令 echo $$ 查看“当前会话 ID”的方式来验证</span></span><br><span class="line">	<span class="comment">#可指定 -, -l, --login 表示使用登录方式启动一个新的 shell 会话来来切换用户。</span></span><br><span class="line">		<span class="comment">#示例：su - 或 su - test1</span></span><br><span class="line">		<span class="comment">#如果不指定，则切换用户后新的 shell 会话仍然属于前一个用户，可通过命令 echo $USER 来查看“当前用户”的方式验证</span></span><br><span class="line">su [username]</span><br><span class="line"><span class="comment">#如：su test1 或 su - test1</span></span><br></pre></td></tr></table></figure><p><code>su</code> 切换用户示意图如下：</p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/003_su%E5%92%8Cexit%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="003_su和exit示意图"></p><h3 id="4-超级用户权限维护"><a class="header-anchor" href="#4-超级用户权限维护">¶</a>4. 超级用户权限维护</h3><p>Linux 系统中的 <code>root</code> 用户是超级用户，通常用于系统的维护和管理，对操作系统的所有资源具有所有访问权限，在大多数版本的 Linux 中，都不推荐直接使用 root 账号登录系统，在 Linux 安装的过程中，系统会自动创建一个用户账号，而这个默认的用户称为 “标准用户”。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 1、以超级用户权限执行（sudo）</span></span><br><span class="line">	<span class="comment">#sudo 表示以超级用户权限执行，即允许普通用户在不切换到超级用户（root）的情况下以 root 用户权限执行命令</span></span><br><span class="line">	<span class="comment">#执行 sudo 命令时，要求当前用户必须为 sudo 用户组</span></span><br><span class="line">	<span class="comment">#使用 sudo 命令时，必须先输入 root 用户的密码</span></span><br><span class="line">	<span class="comment">#使用 sudo 后有 5 分钟的有效期限，超过期限则必须重新输入密码</span></span><br><span class="line">sudo &lt;<span class="built_in">command</span>&gt;</span><br><span class="line"><span class="comment">#如：sudo ls /root</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2、添加某用户到 sudo 用户组</span></span><br><span class="line">	<span class="comment">#在 Debian 系列系统中，默认使用名为 sudo 的用户组来管理 sudo 访问权限；在 Red Hat 系列系统中，默认使用名为 wheel 的用户组来管理 sudo 访问权限</span></span><br><span class="line">	<span class="comment">#具体管理 sudo 访问权限的用户组名称可在 /etc/sudoers 文件中确定（可通过 visudo 命令直接打开该文件)</span></span><br><span class="line">	<span class="comment">#由于 Debian 系列系统和 Red Hat 系列系统管理 sudo 访问权限的用户组名称不同，所以对于不同发行版系统操作类似但不一定相同，具体如下：</span></span><br><span class="line"><span class="comment">#（1）先切换到 root 用户</span></span><br><span class="line">su</span><br><span class="line"><span class="comment">#（2）对于 Debian 系列系统 </span></span><br><span class="line">apt install -y sudo <span class="comment">#如果没有 sudo 命令，则需要先安装</span></span><br><span class="line">usermod -a -G sudo &lt;username&gt; <span class="comment">#添加某用户到 sudo 用户组，如：usermod -a -G sudo test1</span></span><br><span class="line"><span class="comment">#（3）对于 Redhat 系列系统 </span></span><br><span class="line">yum install -y sudo <span class="comment">#如果没有 sudo 命令，则需要先安装</span></span><br><span class="line">usermod -a -G wheel &lt;username&gt; <span class="comment">#添加某用户到 sudo 用户组，如：usermod -a -G wheel test1</span></span><br></pre></td></tr></table></figure><h3 id="5-用户登录维护"><a class="header-anchor" href="#5-用户登录维护">¶</a>5. 用户登录维护</h3><h4 id="1-查看当前登录到系统上的用户信息"><a class="header-anchor" href="#1-查看当前登录到系统上的用户信息">¶</a>1）查看当前登录到系统上的用户信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前登录到系统上的用户信息</span></span><br><span class="line">who</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@vm35218 ~]<span class="comment"># who</span></span><br><span class="line">root     pts/0        2023-06-17 09:45 (183.11.72.163)</span><br><span class="line">root     pts/1        2023-06-17 09:45 (183.11.72.163)</span><br><span class="line">qcmoke   pts/2        2023-06-17 10:00 (183.11.72.163)</span><br></pre></td></tr></table></figure><h4 id="2-查看系统中所有用户的最近登录信息"><a class="header-anchor" href="#2-查看系统中所有用户的最近登录信息">¶</a>2）查看系统中所有用户的最近登录信息</h4><blockquote><p><code>lastlog</code>命令可用于显示每个用户最后一次登录的日期、时间、终端位置和IP地址等信息。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看系统中所有用户的最近登录信息</span></span><br><span class="line">lastlog</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果执行命令失败，提示：/var/log/lastlog: 没有那个文件或目录。则如下解决：</span></span><br><span class="line">touch /var/<span class="built_in">log</span>/lastlog</span><br><span class="line">chgrp utmp /var/<span class="built_in">log</span>/lastlog</span><br><span class="line">chmod 664 /var/<span class="built_in">log</span>/lastlog</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@vm35218 ~]<span class="comment"># lastlog</span></span><br><span class="line">用户名           端口     来自             最后登陆时间</span><br><span class="line">root             pts/1    183.11.72.163    六 6月 17 09:45:58 +0800 2023</span><br><span class="line">bin                                        **从未登录过**</span><br><span class="line">daemon                                     **从未登录过**</span><br><span class="line">adm                                        **从未登录过**</span><br><span class="line">lp                                         **从未登录过**</span><br><span class="line">sync                                       **从未登录过**</span><br><span class="line">shutdown                                   **从未登录过**</span><br><span class="line">halt                                       **从未登录过**</span><br><span class="line">mail                                       **从未登录过**</span><br><span class="line">operator                                   **从未登录过**</span><br><span class="line">games                                      **从未登录过**</span><br><span class="line">ftp                                        **从未登录过**</span><br><span class="line">nobody                                     **从未登录过**</span><br><span class="line">systemd-network                            **从未登录过**</span><br><span class="line">dbus                                       **从未登录过**</span><br><span class="line">polkitd                                    **从未登录过**</span><br><span class="line">sshd                                       **从未登录过**</span><br><span class="line">postfix                                    **从未登录过**</span><br><span class="line">chrony                                     **从未登录过**</span><br><span class="line">gluster                                    **从未登录过**</span><br><span class="line">git                                        **从未登录过**</span><br><span class="line">qcmoke           pts/2    183.11.72.163    六 6月 17 10:00:40 +0800 2023</span><br><span class="line">dockremap                                  **从未登录过**</span><br><span class="line">nginx                                      **从未登录过**</span><br></pre></td></tr></table></figure><h4 id="3-查看系统中用户的完整登录历史记录"><a class="header-anchor" href="#3-查看系统中用户的完整登录历史记录">¶</a>3）查看系统中用户的完整登录历史记录</h4><blockquote><p><code>last</code>命令可用于显示每个用户最后一次登录的日期、时间、终端位置和IP地址等信息。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看系统中所有用户的完整登录历史记录</span></span><br><span class="line">last</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看系统中指定用户的完整登录历史记录</span></span><br><span class="line">last root</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@vm35218 ~]<span class="comment"># last</span></span><br><span class="line">qcmoke   pts/2        183.11.72.163    Sat Jun 17 10:00   still logged <span class="keyword">in</span>   </span><br><span class="line">root     pts/1        183.11.72.163    Sat Jun 17 09:45   still logged <span class="keyword">in</span>   </span><br><span class="line">root     pts/0        183.11.72.163    Sat Jun 17 09:45   still logged <span class="keyword">in</span>   </span><br><span class="line">root     pts/1        183.11.73.129    Thu Jun 15 23:39 - 00:22  (00:43)    </span><br><span class="line">root     pts/0        183.11.73.129    Thu Jun 15 23:39 - 00:22  (00:43)    </span><br><span class="line">root     pts/1        183.11.72.5      Mon Jun 12 21:54 - 21:54  (00:00)    </span><br><span class="line">root     pts/0        183.11.72.5      Mon Jun 12 21:54 - 21:54  (00:00)    </span><br><span class="line">root     pts/1        183.11.72.5      Mon Jun 12 21:32 - 21:32  (00:00)    </span><br><span class="line">root     pts/0        183.11.72.5      Mon Jun 12 21:32 - 21:32  (00:00)    </span><br><span class="line">root     pts/1        183.11.72.5      Mon Jun 12 12:45 - 15:02  (02:16)    </span><br><span class="line">root     pts/0        183.11.72.5      Mon Jun 12 12:45 - 15:02  (02:16)    </span><br><span class="line">root     pts/1        183.11.72.5      Mon Jun 12 02:38 - 06:33  (03:54)    </span><br><span class="line">root     pts/0        183.11.72.5      Mon Jun 12 02:38 - 06:33  (03:54)    </span><br><span class="line">root     pts/1        183.11.75.79     Sun Jun 11 19:03 - 19:03  (00:00)    </span><br><span class="line">root     pts/0        183.11.75.79     Sun Jun 11 19:03 - 19:03  (00:00)    </span><br><span class="line">root     pts/1        183.11.75.79     Sun Jun 11 18:43 - 18:43  (00:00)    </span><br><span class="line">root     pts/0        183.11.75.79     Sun Jun 11 18:43 - 18:43  (00:00)    </span><br><span class="line">qcmoke   pts/2        183.11.75.79     Sun Jun 11 03:49 - 03:49  (00:00)    </span><br><span class="line">root     pts/1        183.11.75.79     Sun Jun 11 02:12 - 04:32  (02:19)    </span><br><span class="line">root     pts/0        183.11.75.79     Sun Jun 11 02:12 - 04:32  (02:19)    </span><br><span class="line">root     pts/1        183.11.75.79     Sun Jun 11 00:18 - 02:12  (01:53)    </span><br><span class="line">root     pts/0        183.11.75.79     Sun Jun 11 00:18 - 02:12  (01:53)    </span><br><span class="line">reboot   system boot  5.13.5-1.el7.elr Sun Jun 11 00:18 - 10:17 (6+09:59)   </span><br><span class="line">root     pts/2        183.11.75.79     Sun Jun 11 00:01 - down   (00:16)    </span><br><span class="line">root     pts/0        183.11.75.79     Sun Jun 11 00:01 - down   (00:16)    </span><br><span class="line">root     pts/2        183.11.75.79     Sat Jun 10 19:31 - 00:01  (04:30)    </span><br><span class="line">root     pts/0        183.11.75.79     Sat Jun 10 19:31 - 00:01  (04:30)    </span><br><span class="line">root     pts/2        183.11.75.79     Sat Jun 10 16:08 - 19:31  (03:22)    </span><br><span class="line">root     pts/0        183.11.75.79     Sat Jun 10 16:08 - 19:31  (03:22)    </span><br><span class="line">root     pts/2        183.11.75.79     Sat Jun 10 15:53 - 16:06  (00:12)    </span><br><span class="line">root     pts/0        183.11.75.79     Sat Jun 10 15:53 - 16:06  (00:12)    </span><br><span class="line">root     pts/2        183.11.75.79     Sat Jun 10 14:25 - 15:48  (01:23)    </span><br><span class="line">root     pts/0        183.11.75.79     Sat Jun 10 14:25 - 15:48  (01:23)    </span><br><span class="line">root     pts/2        183.11.75.79     Sat Jun 10 11:01 - 12:37  (01:36)    </span><br><span class="line">root     pts/0        183.11.75.79     Sat Jun 10 11:01 - 12:37  (01:36)</span><br></pre></td></tr></table></figure><h4 id="4-踢出登录用户"><a class="header-anchor" href="#4-踢出登录用户">¶</a>4） 踢出登录用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#选择登录终端并强制踢出，例如选择踢出使用终端pts/1登录的用户。</span></span><br><span class="line"><span class="comment">#方法一：</span></span><br><span class="line">pkill -<span class="built_in">kill</span> -t pts/1</span><br><span class="line"><span class="comment">#方法二：</span></span><br><span class="line">fuser -k /dev/pts/1</span><br></pre></td></tr></table></figure><p>案例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先列举当前登录的系统用户</span></span><br><span class="line">[root@VM_0_6_centos ~]<span class="comment"># who</span></span><br><span class="line">root     pts/0        2020-02-28 10:50 (163.125.117.95)</span><br><span class="line">root     pts/1        2020-02-28 10:49 (163.125.117.95)</span><br><span class="line"><span class="comment">#选择登录终端并强制踢出,可以给他发送后再踢出</span></span><br><span class="line">[root@VM_0_6_centos ~]<span class="comment"># echo "你被管理员踢出了" &gt; /dev/pts/1 &amp;&amp; fuser -k /dev/pts/1</span></span><br><span class="line">/dev/pts/1:          23381</span><br></pre></td></tr></table></figure><h2 id="六-软件管理"><a class="header-anchor" href="#六-软件管理">¶</a>六、软件管理</h2><h3 id="1-软件管理简介"><a class="header-anchor" href="#1-软件管理简介">¶</a>1. 软件管理简介</h3><h4 id="1-1-包全名与包名"><a class="header-anchor" href="#1-1-包全名与包名">¶</a>1.1 包全名与包名</h4><blockquote><ul><li>包全名：操作的包是没有安装的软件包时，使用包全名。</li><li>包名：操作已经安装的软件包时使用的包名。linux安装后包名都存在/var/lib/rpm/中的数据库</li></ul></blockquote><h4 id="1-2-linux包依赖性"><a class="header-anchor" href="#1-2-linux包依赖性">¶</a>1.2 Linux包依赖性</h4><blockquote><ul><li>树形依赖：a&gt;b&gt;c</li><li>环形依赖：a&gt;b&gt;c&gt;a</li><li>模块依赖：模块依赖</li></ul></blockquote><p>软件安装的过程：</p><blockquote><ul><li>（1）cp类库到系统目录中</li><li>（2）cp可执行程序和配置文件到系统目录中</li><li>（3）根据需要选择性配置和启动服务（程序）</li></ul></blockquote><p><em>对于windows系统还会多出一个步骤，那就是到把启动配置或者程序依赖的配置放到注册表中。</em></p><h4 id="1-3-常见软件包命名原则"><a class="header-anchor" href="#1-3-常见软件包命名原则">¶</a>1.3 常见软件包命名原则</h4><p>（1）Debian 软件包格式：<code>apache2_2.4.18-2ubuntu3_amd64.deb</code></p><blockquote><ul><li><code>apache2</code>：软件包名</li><li><code>2.4.18</code> ：软件版本</li><li><code>2</code>：软件发布的次数</li><li><code>ubuntu3</code>：适合的系统版本</li><li><code>amd64</code>：适合的硬件平台</li><li><code>deb</code>：Debian 软件包扩展名</li></ul></blockquote><p>（2）RPM 软件包格式：<code>httpd-2.2.15-15.el6.centos.1.i686.rpm</code></p><blockquote><ul><li><code>httpd</code>：软件包名</li><li><code>2.2.15</code>：软件版本</li><li><code>15</code>：软件发布的次数</li><li><code>el6.centos</code>：适合的系统版本</li><li><code>i686</code>：适合的硬件平台</li><li><code>.rpm</code>：RPM 软件包扩展名</li></ul></blockquote><h4 id="1-4-linux软件包优先级"><a class="header-anchor" href="#1-4-linux软件包优先级">¶</a>1.4 linux软件包优先级</h4><table><thead><tr><th>Required</th><th>该级别软件包是保证系统正常运行所必须的，如果缺失，系统将毁坏</th><th>系统工具，比如bash，mount…</th></tr></thead><tbody><tr><td>Important</td><td>若缺少该软件包，系统讲运行困难</td><td>实现系统底层功能的一些程序，比如aptitude,apt-get</td></tr><tr><td>Standard</td><td>linux系统的标准件</td><td>常规安装软件，如telnet.tp</td></tr><tr><td>Optional</td><td>该软件包是否安装不影响linux运行</td><td>用于用户特定的需求，比如×11，mysql，openofice，自开发软件等</td></tr><tr><td>Extra</td><td>该级别可能与高级软件包存冲突</td><td></td></tr></tbody></table><h3 id="2-debain-系列系统的软件管理"><a class="header-anchor" href="#2-debain-系列系统的软件管理">¶</a>2. Debain 系列系统的软件管理</h3><h4 id="1-dpkg-本地包管理器"><a class="header-anchor" href="#1-dpkg-本地包管理器">¶</a>1）dpkg 本地包管理器</h4><h5 id="1-安装"><a class="header-anchor" href="#1-安装">¶</a>（1）安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#i表示install</span></span><br><span class="line">dpkg -i 软件包全名</span><br></pre></td></tr></table></figure><h5 id="2-卸载"><a class="header-anchor" href="#2-卸载">¶</a>（2）卸载</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#r表示remove</span></span><br><span class="line">dpkg -r 软件包名   <span class="comment">#移除包不移除配置文件</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-P等价于--purg，表示移除包和配置文件</span></span><br><span class="line">dpkg -P 软件包名 <span class="comment">#移除包和配置文件</span></span><br></pre></td></tr></table></figure><h5 id="3-查询"><a class="header-anchor" href="#3-查询">¶</a>（3）查询</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l  软件包名 <span class="comment">#列出当前系统中已经安装的包，包括软件的版本，可以使用dpkg -l | grep 关键字来查询</span></span><br><span class="line">dpkg -L 软件包名  <span class="comment">#列出已安装的包的内容，或者安装位置</span></span><br><span class="line">dpkg -c 软件包全名 <span class="comment">#列出deb包的内容</span></span><br><span class="line">dpkg -s 软件包名 <span class="comment">#查看系统中软件的详细信息 （包含依赖信息）</span></span><br><span class="line">dpkg --info 软件包全名  <span class="comment">#查看未安装的包的信息（包含依赖信息）</span></span><br></pre></td></tr></table></figure><h4 id="2-apt-在线包管理器"><a class="header-anchor" href="#2-apt-在线包管理器">¶</a>2）apt 在线包管理器</h4><p>APT（Advanced Package Tool）是基于 dpkg 的在线包管理工具，它提供了高级的软件包管理功能，包括包的安装、升级、删除和依赖解决等。APT 通过与软件包仓库进行交互，从远程仓库获取软件包信息并管理软件包的安装和更新。</p><blockquote><p>APT 提供了一些常用的命令行工具：</p><ol><li><code>apt-get</code>：用于安装、升级、卸载软件包，以及处理依赖关系和软件包的下载等。</li><li><code>apt-cache</code>：用于查询软件包的信息，如版本、依赖关系、提供的文件等。</li><li><code>apt-config</code>：用于管理 APT 的配置文件。</li><li><code>apt-key</code>：用于管理软件包的数字签名和密钥。</li><li><code>apt-file</code>：用于查询软件包中的文件列表。</li><li><code>aptitude</code>：一个功能更强大的终端界面的包管理工具，提供交互式的软件包管理功能。</li></ol><p>由于 APT 提供的工具集太多，使用太繁杂，故而新版 Debian 系列系统使用 <code>apt</code> 命令来包含囊括<code>apt-get</code> 、<code>apt-cache</code> 命令，故而现在推荐使用<code>apt</code>命令来替代<code>apt-get</code>等命令。</p></blockquote><h5 id="1-apt-软件源"><a class="header-anchor" href="#1-apt-软件源">¶</a>（1） apt 软件源</h5><h6 id="1-1-修改-ubuntu-软件源为国内源"><a class="header-anchor" href="#1-1-修改-ubuntu-软件源为国内源">¶</a>（1.1）修改 Ubuntu 软件源为国内源</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##切换到root用户</span></span><br><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line"><span class="comment">##安装相关依赖（如系统未安装）</span></span><br><span class="line">apt update</span><br><span class="line">apt install -y ca-certificates</span><br><span class="line"></span><br><span class="line"><span class="comment">##备份</span></span><br><span class="line">cp /etc/apt/sources.list /etc/apt/sources.list_backup</span><br><span class="line"></span><br><span class="line"><span class="comment">##替换软件源（支持所有ubuntu18.04或更高的系统版本）</span></span><br><span class="line">MIRRORS_URL=https://mirrors.aliyun.com <span class="comment">#阿里源（推荐）</span></span><br><span class="line"><span class="comment">#MIRRORS_URL=https://mirrors.163.com #网易源</span></span><br><span class="line">VERSION_CODENAME=$(cat /etc/os-release | grep VERSION_CODENAME | sed <span class="string">'s/.*=//'</span>) <span class="comment">#系统版本代号</span></span><br><span class="line"></span><br><span class="line">cat &gt; /etc/apt/sources.list &lt;&lt; EOF</span><br><span class="line">deb <span class="variable">$MIRRORS_URL</span>/ubuntu/ <span class="variable">$VERSION_CODENAME</span> main restricted universe multiverse</span><br><span class="line">deb-src <span class="variable">$MIRRORS_URL</span>/ubuntu/ <span class="variable">$VERSION_CODENAME</span> main restricted universe multiverse</span><br><span class="line">deb <span class="variable">$MIRRORS_URL</span>/ubuntu/ <span class="variable">$VERSION_CODENAME</span>-security main restricted universe multiverse</span><br><span class="line">deb-src <span class="variable">$MIRRORS_URL</span>/ubuntu/ <span class="variable">$VERSION_CODENAME</span>-security main restricted universe multiverse</span><br><span class="line">deb <span class="variable">$MIRRORS_URL</span>/ubuntu/ <span class="variable">$VERSION_CODENAME</span>-updates main restricted universe multiverse</span><br><span class="line">deb-src <span class="variable">$MIRRORS_URL</span>/ubuntu/ <span class="variable">$VERSION_CODENAME</span>-updates main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb $MIRRORS_URL/ubuntu/ $VERSION_CODENAME-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="comment"># deb-src $MIRRORS_URL/ubuntu/ $VERSION_CODENAME-proposed main restricted universe multiverse</span></span><br><span class="line">deb <span class="variable">$MIRRORS_URL</span>/ubuntu/ <span class="variable">$VERSION_CODENAME</span>-backports main restricted universe multiverse</span><br><span class="line">deb-src <span class="variable">$MIRRORS_URL</span>/ubuntu/ <span class="variable">$VERSION_CODENAME</span>-backports main restricted universe multiverse</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">##更新软件源</span></span><br><span class="line">apt update</span><br></pre></td></tr></table></figure><blockquote><p>参考：<a href="https://developer.aliyun.com/mirror/ubuntu?spm=a2c6h.13651102.0.0.1ecc1b11jbngYS" target="_blank" rel="noopener">https://developer.aliyun.com/mirror/ubuntu?spm=a2c6h.13651102.0.0.1ecc1b11jbngYS</a></p><p>通过<code>apt update</code>更新软件源到本地并在本地建立新远程软件库所有软件包对应的索引表(数据库形式)，所有存放在<code>/var/lib/apt/lists/*</code></p></blockquote><h6 id="1-2-修改-debian-软件源为国内源"><a class="header-anchor" href="#1-2-修改-debian-软件源为国内源">¶</a>（1.2）修改 Debian 软件源为国内源</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##切换到root用户</span></span><br><span class="line"><span class="comment">#如果sudo命令没有，则通过root用户安装sudo，如：apt install sudo</span></span><br><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line"><span class="comment">##安装相关依赖（如系统未安装）</span></span><br><span class="line">apt update</span><br><span class="line">apt install -y ca-certificates</span><br><span class="line"></span><br><span class="line"><span class="comment">##备份</span></span><br><span class="line">cp /etc/apt/sources.list /etc/apt/sources.list_backup</span><br><span class="line"></span><br><span class="line"><span class="comment">##替换软件源（支持所有debian系统版本）</span></span><br><span class="line">MIRRORS_URL=https://mirrors.aliyun.com <span class="comment">#阿里源（推荐）</span></span><br><span class="line"><span class="comment">#MIRRORS_URL=https://mirrors.163.com #网易源</span></span><br><span class="line"><span class="comment">#MIRRORS_URL=http://deb.debian.org #官方源</span></span><br><span class="line">VERSION_CODENAME=$(cat /etc/os-release | grep VERSION_CODENAME | sed <span class="string">'s/.*=//'</span>) <span class="comment">#系统版本代号</span></span><br><span class="line">cat &gt; /etc/apt/sources.list &lt;&lt; EOF</span><br><span class="line">deb <span class="variable">$MIRRORS_URL</span>/debian/ <span class="variable">$VERSION_CODENAME</span> main non-free contrib</span><br><span class="line">deb-src <span class="variable">$MIRRORS_URL</span>/debian/ <span class="variable">$VERSION_CODENAME</span> main non-free contrib</span><br><span class="line">deb <span class="variable">$MIRRORS_URL</span>/debian-security/ <span class="variable">$VERSION_CODENAME</span>-security main</span><br><span class="line">deb-src <span class="variable">$MIRRORS_URL</span>/debian-security/ <span class="variable">$VERSION_CODENAME</span>-security main</span><br><span class="line">deb <span class="variable">$MIRRORS_URL</span>/debian/ <span class="variable">$VERSION_CODENAME</span>-updates main non-free contrib</span><br><span class="line">deb-src <span class="variable">$MIRRORS_URL</span>/debian/ <span class="variable">$VERSION_CODENAME</span>-updates main non-free contrib</span><br><span class="line">deb <span class="variable">$MIRRORS_URL</span>/debian/ <span class="variable">$VERSION_CODENAME</span>-backports main non-free contrib</span><br><span class="line">deb-src <span class="variable">$MIRRORS_URL</span>/debian/ <span class="variable">$VERSION_CODENAME</span>-backports main non-free contrib</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">##更新软件源</span></span><br><span class="line">apt update</span><br></pre></td></tr></table></figure><blockquote><p>参考：</p><ul><li><a href="https://www.cnblogs.com/liuguanglin/p/debian11_repo.html" target="_blank" rel="noopener">https://www.cnblogs.com/liuguanglin/p/debian11_repo.html</a></li><li><a href="https://developer.aliyun.com/article/765348" target="_blank" rel="noopener">https://developer.aliyun.com/article/765348</a></li><li><a href="https://developer.aliyun.com/mirror/debian?spm=a2c6h.13651102.0.0.7fb11b11YdBUCM" target="_blank" rel="noopener">https://developer.aliyun.com/mirror/debian?spm=a2c6h.13651102.0.0.7fb11b11YdBUCM</a></li><li><a href="https://mirrors.ustc.edu.cn/repogen/" target="_blank" rel="noopener">https://mirrors.ustc.edu.cn/repogen/</a></li></ul></blockquote><h5 id="2-查询"><a class="header-anchor" href="#2-查询">¶</a>（2）查询</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#根据关键字搜索可用软件包（等价：apt-cache search 软件包关键字）</span></span><br><span class="line">apt search 软件包关键字</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询某个命令所属的安装包（命令所属的软件包安装或未安装都可以查询）</span></span><br><span class="line">apt install apt-file</span><br><span class="line">apt-file update</span><br><span class="line">apt-file search 命令路径 <span class="comment">#如：apt-file search /sbin/ifconfig（注意：apt-file search 不支持使用通配符查询）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#列出所有可用软件包</span></span><br><span class="line">apt list</span><br><span class="line"><span class="comment">#列出已经安装的所有软件包</span></span><br><span class="line">apt list --installed</span><br><span class="line"><span class="comment">#列出已经安装的指定软件包</span></span><br><span class="line">apt list --installed &lt;package-name&gt;	<span class="comment">#或者apt list --installed | grep 关键字</span></span><br><span class="line"><span class="comment">#列出可更新的所有软件包</span></span><br><span class="line">apt list --upgradable</span><br><span class="line"></span><br><span class="line"><span class="comment">##查看安装包的信息（包括：名称、版本、安装源、包大小、依赖关系、描述等）</span></span><br><span class="line">apt show &lt;package-name&gt;</span><br><span class="line"><span class="comment">##查看软件包政策（包括版本信息、源信息等）</span></span><br><span class="line">apt policy &lt;package-name&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#检查当前apt的依赖情况</span></span><br><span class="line">apt check</span><br><span class="line"><span class="comment">#查看系统中软件的依赖（正向依赖）</span></span><br><span class="line">apt depends &lt;package-name&gt;</span><br><span class="line"><span class="comment">#查看系统中软件的依赖（反向依赖）</span></span><br><span class="line">apt rdepends &lt;package-name&gt;</span><br></pre></td></tr></table></figure><blockquote><p>可使用<code>apt-cache</code>子命令来实现查询功能，推荐使用<code>apt</code>命令来查询，其兼容<code>apt-cache</code>。</p></blockquote><h5 id="3-安装"><a class="header-anchor" href="#3-安装">¶</a>（3） 安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装指定的软件包（选项：-y 自动回答yes）</span></span><br><span class="line">	<span class="comment">#该命令安装包前不会自动检测软件源的本地缓存，故安装前最好手动执行apt update命令</span></span><br><span class="line">apt install &lt;package-name&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#修复系统中存在的依赖关系问题（尝试安装缺失的依赖包、删除不再需要的依赖包、修复已损坏的依赖关系等）</span></span><br><span class="line">apt -f install</span><br><span class="line"></span><br><span class="line"><span class="comment">#获得包的源码</span></span><br><span class="line">apt <span class="built_in">source</span> &lt;package-name&gt;</span><br></pre></td></tr></table></figure><blockquote><p><code>apt install</code>工作步骤</p><ul><li><p>扫描本地软件列表</p></li><li><p>软件包依赖检查</p></li><li><p>从软件包指定的 apt 源中下载软件包</p></li><li><p>解压软件包并完成配置</p></li></ul></blockquote><p>默认情况下，<code>apt install</code> 在成功安装软件包后会自动删除下载的软件包文件。如果需要获取软件包文件可如下操作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方式1：下载软件包</span></span><br><span class="line">    <span class="comment">#下载路径为：/var/cache/apt/archives/ （不能修改）</span></span><br><span class="line">    <span class="comment">#该命令下载软件包会强制包括依赖包</span></span><br><span class="line">    <span class="comment">#该命令只下载不安装</span></span><br><span class="line">    <span class="comment">#只有在系统未安装有软件包时才能下载，如果已经安装了，则无法下载。如果非要下载则只能改用apt download命令，或者卸载包后再下载。</span></span><br><span class="line">apt install -d &lt;package-name&gt;</span><br><span class="line"><span class="comment">#等同：apt install --download-only &lt;package-name&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#方式2：下载软件包</span></span><br><span class="line">	<span class="comment">#下载路径为：当前目录（不能修改）</span></span><br><span class="line">	<span class="comment">#该命令下载软件包不会包括依赖包，如需下载依赖包请选用apt install -d &lt;package-name&gt;</span></span><br><span class="line">	<span class="comment">#无论系统是否已经安装有软件包都能下载</span></span><br><span class="line">apt download &lt;package-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例：</span></span><br><span class="line">apt install -d nginx</span><br><span class="line">apt download nginx</span><br></pre></td></tr></table></figure><h5 id="4-更新"><a class="header-anchor" href="#4-更新">¶</a>（4） 更新</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#更新软件源的本地缓存（本地缓存：源的软件列表和包的元数据，元数据：包的信息和包的依赖关系，包的信息：版本号、更新日期、作者、描述等）</span></span><br><span class="line">apt update</span><br><span class="line"><span class="comment">#升级更新指定软件包</span></span><br><span class="line">apt upgrade &lt;package-name&gt;</span><br><span class="line"><span class="comment">#升级更新系统所有软件包（升级已安装的软件包，但不会删除或安装其他依赖包）</span></span><br><span class="line">apt upgrade</span><br><span class="line"><span class="comment">#升级更新系统所有软件包（除了升级已安装的软件包，会删除或安装其他依赖包）</span></span><br><span class="line">apt dist-upgrade</span><br></pre></td></tr></table></figure><blockquote><p>💁‍♂ 提示：以上更新升级操作只是升级当前系统版本的软件包（包括内核版本，通常升级的默认内核版本一般都较低，如需升级更高版本的内核则需要手动安装）。需要说明的是不会升级系统的版本，如果要升级系统版本则需要使用新版本的系统镜像重装系统。</p></blockquote><h5 id="5-卸载"><a class="header-anchor" href="#5-卸载">¶</a>（5） 卸载</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#卸载软件包（不含配置文件）</span></span><br><span class="line">apt remove &lt;package-name&gt;</span><br><span class="line"><span class="comment">#卸载软件包（含配置文件）,命令等价：apt remove --purge &lt;package-name&gt;</span></span><br><span class="line">apt purge &lt;package-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#卸载指定的软件包，并自动删除其依赖包中不再需要的依赖包</span></span><br><span class="line">apt remove --auto-remove &lt;package-name&gt;</span><br><span class="line"><span class="comment">#卸载系统中所有不再需要的依赖包</span></span><br><span class="line">apt auto-remove</span><br><span class="line"><span class="comment">#清除已下载的软件包文件的缓存</span></span><br><span class="line">	<span class="comment">#这些包文件通常被存储在 /var/cache/apt/archives 目录下。执行 apt clean 会删除该目录中的所有 .deb 文件</span></span><br><span class="line">	<span class="comment">#在Debian系列系统中，通过apt安装或更新的软件，默认会自动保留.deb包缓存文件在缓存目录中。如果希望自定义是否默认保留包缓存文件可参考：https://blog.csdn.net/FoxBryant/article/details/123226245</span></span><br><span class="line">apt clean</span><br></pre></td></tr></table></figure><blockquote><p>💁‍♂ 提示：不再需要的依赖包是指不再被其他软件包所依赖的包。</p></blockquote><h3 id="3-redhat-系列系统的软件管理"><a class="header-anchor" href="#3-redhat-系列系统的软件管理">¶</a>3. Redhat 系列系统的软件管理</h3><h4 id="1-rpm-本地包管理器"><a class="header-anchor" href="#1-rpm-本地包管理器">¶</a>1）rpm 本地包管理器</h4><h5 id="1-安装-v2"><a class="header-anchor" href="#1-安装-v2">¶</a>（1）安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-i（install）安装; -v（verbose）显示详细信息; -h（hash）显示进度; -nodeps 不检测依赖性</span></span><br><span class="line">rpm -ivh &lt;package-name&gt;</span><br></pre></td></tr></table></figure><h5 id="2-升级"><a class="header-anchor" href="#2-升级">¶</a>（2）升级</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-U（upgrade）升级(更新的是已安装版本的包)</span></span><br><span class="line">rpm -Uvh &lt;package-name&gt;</span><br></pre></td></tr></table></figure><h5 id="3-卸载"><a class="header-anchor" href="#3-卸载">¶</a>（3）卸载</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-e（erase）卸载; -nodeps 不检查依赖性</span></span><br><span class="line">rpm -e &lt;package-name&gt;</span><br></pre></td></tr></table></figure><h5 id="4-查询包是否安装"><a class="header-anchor" href="#4-查询包是否安装">¶</a>（4）查询包是否安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-q 查询（query）; -a 所有（all）</span></span><br><span class="line">rpm -q &lt;package-name&gt;   <span class="comment">#查询已经安装的具体包（不能使用通配符）</span></span><br><span class="line">rpm -qa <span class="comment">#查询所有已经安装的包（可使用通配符筛选查询，如：rpm -qa kernel* 或 rpm -qa kernel kernel-*）</span></span><br></pre></td></tr></table></figure><h5 id="5-查询软件包详细信息"><a class="header-anchor" href="#5-查询软件包详细信息">¶</a>（5） 查询软件包详细信息</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-q 查询（query）; -i 查询软件信息（information）; -p 查询未安装包信息（package）</span></span><br><span class="line">rpm -qi &lt;package-name&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment">#例如：</span></span><br><span class="line">rpm -qi zip  <span class="comment">#查看系统中已经安装存在的包信息</span></span><br><span class="line">rpm -qip zip-3.0-23.fc29.x86_64.rpm  <span class="comment">#查看未安装包信息</span></span><br></pre></td></tr></table></figure><h5 id="6-查询软件包安装位置"><a class="header-anchor" href="#6-查询软件包安装位置">¶</a>（6）查询软件包安装位置</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-q 查询（query）-l 列表（list）; -p 查询未安装包信息，用来查看未安装的软件包打算安装到哪些目录里</span></span><br><span class="line">rpm -ql &lt;package-name&gt;  <span class="comment">#查询已安装的软件安装到了哪些目录里</span></span><br><span class="line">rpm -qlp &lt;package-name&gt;  <span class="comment">#查询未安装的软件包打算安装到哪些目录里</span></span><br></pre></td></tr></table></figure><p>如果忘记包名，可以通过<code>rpm -qa | grep 包名</code>关键字先查看系统中已经安装的相关软件，然后再执行<code>rpm -ql 包名</code>来查看具体路径</p><h5 id="7-查询系统文件所属的软件包"><a class="header-anchor" href="#7-查询系统文件所属的软件包">¶</a>（7）查询系统文件所属的软件包</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-f 查询系统文件属于哪个软件包（file）</span></span><br><span class="line">rpm -qf 系统文件名</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例：</span></span><br><span class="line">rpm -qf /usr/bin/bash</span><br><span class="line">rpm -qf /etc/yum.conf</span><br></pre></td></tr></table></figure><h5 id="8-查询软件包的依赖性"><a class="header-anchor" href="#8-查询软件包的依赖性">¶</a>（8） 查询软件包的依赖性</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-R 查询软件包的依赖性（requires）;-p 查询未安装包信息（package）</span></span><br><span class="line">rpm -qR &lt;package-name&gt;   <span class="comment">#查询已安装包信息</span></span><br><span class="line">rpm -qRp &lt;package-name&gt;   <span class="comment">#查询未安装包信息</span></span><br></pre></td></tr></table></figure><h5 id="9-软件包完整性校验"><a class="header-anchor" href="#9-软件包完整性校验">¶</a>（9） 软件包完整性校验</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#比较已安装软件包的文件与原始软件包中的文件属性（例如文件大小、权限、MD5 校验和等）差异，如果有任何文件被修改、删除或者权限被更改，命令会显示出这些变化。</span></span><br><span class="line"><span class="comment">#选项：-V 校验指定软件包中的文件（verify）</span></span><br><span class="line">rpm -V &lt;package-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例：修改httpd的配置文件后，查看是否被修改</span></span><br><span class="line">$ yum install -y httpd</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">""</span> &gt;&gt; /etc/httpd/conf/httpd.conf</span><br><span class="line">$ rpm -V httpd</span><br><span class="line">S.5....T.  c /etc/httpd/conf/httpd.conf</span><br></pre></td></tr></table></figure><blockquote><p>验证内容中的8个信息的具体内容如下：</p><ul><li>S：文件大小是否改变</li><li>M：文件的类型或文件的权限（rwx）是否被改变</li><li>5：文件MD5校验和是否改变（可以看成文件内容是否改变）</li><li>D：设备的中，从代码是否改变</li><li>L：文件路径是否改变</li><li>U：文件的属主（所有者）是否改变</li><li>G：文件的属组是否改变</li><li>T：文件的修改时间是否改变</li></ul><p>文件类型</p><ul><li>c：配置文件（config file）</li><li>d：普通文档（documentation）</li><li>g：幽灵文件（ghost file），幽灵文件是指在 RPM 数据库中存在记录但在实际文件系统中不存在的文件</li><li>l：授权文件（license file）</li><li>r：描述文件（read me）</li></ul></blockquote><p>软件包文件的完整性验证（注意和软件包完整性校验的区别）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#验证软件包文件的完整性（注意是软件包文件，即：“.rpm文件”，主要检查软件包的签名）</span></span><br><span class="line">rpm --checksig &lt;package_file.rpm&gt;</span><br></pre></td></tr></table></figure><h5 id="10-从rpm包中提取文件"><a class="header-anchor" href="#10-从rpm包中提取文件">¶</a>（10）从RPM包中提取文件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#提取软件包中的指定文件到当前目录</span></span><br><span class="line">rpm2cpio .rpm包文件的文件路径 | cpio -idv  .rpm包文件中所需提取的文件的路径（可解压查看）</span><br></pre></td></tr></table></figure><blockquote><p>rpm2cpio 是将rpm包转换为cpio格式的命令，cpio 是一个标准工具，它用于创建软件档案文件和从档案文件中提取文件</p></blockquote><p>从RPM包中提取文件可以用来解决误删除系统文件后的补救方法，如下示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看ls命令文件所属的软件包（如：coreutils-8.22-24.el7_9.2.x86_64）</span></span><br><span class="line">rpm -qf /bin/ls</span><br><span class="line"></span><br><span class="line"><span class="comment">#将ls命令到临时目录里，造成误删假象</span></span><br><span class="line">mv /bin/ls /tmp/</span><br><span class="line"></span><br><span class="line"><span class="comment">#下载指定版本的软件包到当前目录</span></span><br><span class="line">yumdownloader coreutils-8.22-24.el7_9.2.x86_64</span><br><span class="line"><span class="comment"># 可通过 yumdownloader -q --urls coreutils-8.22-24.el7_9.2.x86_64 获得软件包URL地址。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#提取ls命令文件到当前目录下（-idv 后接的路径必须与rpm包中的路径相对应）</span></span><br><span class="line">rpm2cpio ./coreutils-8.22-24.el7_9.2.x86_64.rpm | cpio -idv ./usr/bin/ls</span><br><span class="line"></span><br><span class="line"><span class="comment">#把ls命令复制/bin/目录，恢复丢失的文件</span></span><br><span class="line">cp ./usr/bin/ls /bin/</span><br></pre></td></tr></table></figure><h4 id="2-yum-线包管理器"><a class="header-anchor" href="#2-yum-线包管理器">¶</a>2）yum 线包管理器</h4><p>yum 是基于 rpm 的在线包管理工具，它提供了高级的软件包管理功能，包括包的安装、升级、删除和依赖解决等。yum 通过与软件包仓库进行交互，从远程仓库获取软件包信息并管理软件包的安装和更新。</p><h5 id="1-yum软件源"><a class="header-anchor" href="#1-yum软件源">¶</a>（1）yum软件源</h5><p>centos 默认软件源改为阿里源（以 centos7 为例）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先确保安装wget用于下载yum源文件</span></span><br><span class="line">yum install -y wget</span><br><span class="line"><span class="comment">#备份旧的配置文件</span></span><br><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</span><br><span class="line"><span class="comment">#下载阿里源的文件</span></span><br><span class="line"><span class="comment">#centos7</span></span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"><span class="comment">#或者 curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line">sed -i -e <span class="string">'/mirrors.cloud.aliyuncs.com/d'</span> -e <span class="string">'/mirrors.aliyuncs.com/d'</span> /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line"></span><br><span class="line"><span class="comment">#清理本地缓存（可选）</span></span><br><span class="line"><span class="comment">#yum clean all</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#更新软件源的本地缓存（本地缓存：源的软件列表和包的元数据，元数据：包的信息和包的依赖关系，包的信息：版本号、更新日期、作者、描述等）</span></span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><blockquote><p>参考：<a href="https://developer.aliyun.com/mirror/centos?spm=a2c6h.13651102.0.0.534d1b11Q4rbUO" target="_blank" rel="noopener">https://developer.aliyun.com/mirror/centos?spm=a2c6h.13651102.0.0.534d1b11Q4rbUO</a></p><p>yum 源配置说明：</p><ul><li><code>[base]</code>	容器名称，一定要放在[ ]中,从以上文件可以看出centos7默认配置有4个容器，一般是第一个起作用</li><li><code>name</code>	容器说明，可以自己随便写</li><li><code>mirrorlist</code> 镜像站点，这个可以注释掉</li><li><code>baseurl</code> 我们的yum源服务器的地址。默认是CentOS官方的yum源服务器，是可以使用的，如果你觉得慢可以改成你喜欢的yum源地址</li><li><code>enabled</code> 此容器是否生效，如果不写或写成enable=1都是生效，写成enable=0就是不生效</li><li><code>gpgcheck</code> 如果是1是指RPM的数字证书生效，如果是0则不生效</li><li><code>gpgkey</code> 数字证书的公钥文件保存位置。不用修改</li></ul></blockquote><p>安装 epel 源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yum install -y epel-release</span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line"><span class="comment">#以上默认安装的 epel 源是国外的，速度比较慢，推荐改用国内的 epel 源（可选，推荐）</span></span><br><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/</span><br><span class="line">mkdir backup</span><br><span class="line">mv epel*.repo backup</span><br><span class="line">wget -O epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><blockquote><p>参考：</p><ul><li><a href="https://developer.aliyun.com/mirror/centos?spm=a2c6h.13651102.0.0.3e221b11oOAPGq" target="_blank" rel="noopener">https://developer.aliyun.com/mirror/centos?spm=a2c6h.13651102.0.0.3e221b11oOAPGq</a></li><li><a href="https://developer.aliyun.com/mirror/epel?spm=a2c6h.13651102.0.0.1d2e1b11NAraP4" target="_blank" rel="noopener">https://developer.aliyun.com/mirror/epel?spm=a2c6h.13651102.0.0.1d2e1b11NAraP4</a></li></ul></blockquote><h5 id="2-查询-v2"><a class="header-anchor" href="#2-查询-v2">¶</a>（2）查询</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#根据关键字搜索可用软件包</span></span><br><span class="line">yum search 关键字</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询某个命令所属的安装包（命令所属的软件包安装或未安装都可以查询）</span></span><br><span class="line">yum provides 命令路径  <span class="comment">#如：yum provides */ifconfig</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#列出所有可用软件包</span></span><br><span class="line">yum list</span><br><span class="line"><span class="comment">#列出已安装的所有软件包</span></span><br><span class="line">yum list installed</span><br><span class="line"><span class="comment">#列出已安装的指定软件包（可用于查看软件包是否已安装）</span></span><br><span class="line">yum list installed &lt;package-name&gt;	<span class="comment">#或者 yum list | grep 关键字</span></span><br><span class="line"><span class="comment">##列出可更新的所有软件包</span></span><br><span class="line">yum list updates</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看安装包的信息（包括：名称、架构、版本、安装源、包大小、简介、描述等）</span></span><br><span class="line">yum info &lt;package-name&gt;</span><br></pre></td></tr></table></figure><h5 id="3-安装-v2"><a class="header-anchor" href="#3-安装-v2">¶</a>（3）安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装指定的软件包（选项：-y 自动回答yes）</span></span><br><span class="line">	<span class="comment">#该命令安装包前会自动检测软件源的本地缓存，如果过期则会自动更新软件源的本地缓存，故而不需要再手动执行yum makecache命令</span></span><br><span class="line">yum install &lt;package-name&gt;</span><br></pre></td></tr></table></figure><p>默认情况下，<code>yum install</code> 在成功安装软件包后会自动删除下载的 rpm 软件包文件。如果需要获取 rpm 软件包文件可如下操作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方式1：下载软件包</span></span><br><span class="line">    <span class="comment">#如不指定下载路径，则默认下载路径为当前目录</span></span><br><span class="line">    <span class="comment">#该命令下载软件包默认不会包括依赖包，如需依赖包则加选项：--resolve</span></span><br><span class="line">yumdownloader --destdir=/path/to/directory &lt;package-name&gt;</span><br><span class="line">yumdownloader --destdir=/path/to/directory --resolve &lt;package-name&gt;</span><br><span class="line"><span class="comment">#获得软件包URL地址</span></span><br><span class="line">yumdownloader -q --urls &lt;package-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#方式2：下载软件包</span></span><br><span class="line">    <span class="comment">#如不指定下载路径，则默认下载路径为：/var/cache/yum/的子目录中，如centos764位系统为：/var/cache/yum/x86_64/7/updates/packages/</span></span><br><span class="line">    <span class="comment">#该命令下载软件包会强制包括依赖包</span></span><br><span class="line">    <span class="comment">#该命令只下载不安装</span></span><br><span class="line">yum install --downloadonly --downloaddir=/path/to/directory &lt;package-name&gt;</span><br></pre></td></tr></table></figure><h5 id="4-更新-v2"><a class="header-anchor" href="#4-更新-v2">¶</a>（4）更新</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#升级更新指定的软件包（选项：-y 自动回答yes）</span></span><br><span class="line">yum update &lt;package-name&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#升级更新系统所有软件包（默认自动删除旧版包）</span></span><br><span class="line">	<span class="comment">#是否自动删除旧版包由/etc/yum.conf配置文件的obsoletes决定，1表示更新旧的rpm包的同时会删除旧包，0表示更新的时候不会删除旧包，</span></span><br><span class="line">yum update</span><br><span class="line"></span><br><span class="line"><span class="comment">#升级更新系统所有软件包（自动删除旧版包）</span></span><br><span class="line">	<span class="comment">#yum upgrade等价于打开obsoletes配置的yum update</span></span><br><span class="line">yum upgrade</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#升级更新系统所有软件包并排除某些包的更新</span></span><br><span class="line"><span class="comment">#以下是单次更新时排除更新包，如果需要不加参数自动排除的话需要编辑/etc/yum.conf配置文件。在[main]的作用域内里加上这样一句话exclude=*NetworkManager*</span></span><br><span class="line">yum --exclude=exclude=*NetworkManager*,*firewalld* update</span><br></pre></td></tr></table></figure><blockquote><p>💁‍♂ 提示：以上更新升级操作只是升级当前系统版本的软件包（包括内核版本，通常升级的默认内核版本一般都较低，如需升级更高版本的内核则需要手动安装）。需要说明的是不会升级系统的版本，如果要升级系统版本则需要使用新版本的系统镜像重装系统。</p><p>💁‍♂ 提示：更新升级常见失败问题：</p><p>如：<code>yum update</code> 出现 <code>Multilib version problems</code> 问题的解决方法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="comment"># 1、安装yum-complete-transaction</span></span><br><span class="line">&gt;yum install yum-utils</span><br><span class="line">&gt;<span class="comment"># 2、运行yum-complete-transaction</span></span><br><span class="line">&gt;yum-complete-transaction –cleanup-only</span><br><span class="line">&gt;<span class="comment"># 3、清除重复的包</span></span><br><span class="line">&gt;package-cleanup --dupes</span><br><span class="line">&gt;<span class="comment">#清除重复包的老版本：</span></span><br><span class="line">&gt;package-cleanup --cleandupes</span><br><span class="line">&gt;<span class="comment"># 4、清除损坏的包</span></span><br><span class="line">&gt;package-cleanup --problems</span><br><span class="line">&gt;<span class="comment">#5、解决依赖冲突：如出现：firewalld-filesystem-0.6.3-13.el7_9.noarch 有已安装冲突 firewalld &lt; ('0', '0.3.13', None): firewalld-0.3.9-7.el7.noarch</span></span><br><span class="line">&gt;<span class="comment"># 查询出重复的软件包,会查出来两个包含版本的完整包名</span></span><br><span class="line">&gt;rpm -q 冲突的包名称</span><br><span class="line">&gt;<span class="comment"># 删除冲突包（一般是旧版本）</span></span><br><span class="line">&gt;rpm -e 包含版本的完整包名</span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">## 以下是示例：</span></span><br><span class="line">&gt;<span class="comment"># 查询重复的软件包(假设systemd-libs出现了冲突)</span></span><br><span class="line">&gt;$ rpm -q systemd-libs</span><br><span class="line">&gt;systemd-libs-219-30.el7.x86_64</span><br><span class="line">&gt;systemd-libs-219-42.el7_4.1.x86_64</span><br><span class="line">&gt;<span class="comment"># 删除旧版</span></span><br><span class="line">&gt;$ rpm -e systemd-libs-219-30.el7.x86_64</span><br><span class="line">&gt;error: Failed dependencies:</span><br><span class="line">systemd-libs = 219-30.el7 is needed by (installed) libgudev1-219-30.el7.x86_64</span><br><span class="line">&gt;<span class="comment"># 仍然出现依赖问题，继续查询libgudev1的版本信息</span></span><br><span class="line">&gt;$ rpm -q libgudev1</span><br><span class="line">&gt;libgudev1-219-30.el7.x86_64</span><br><span class="line">&gt;<span class="comment"># 发现只有一个版本，升级试一下</span></span><br><span class="line">&gt;$ yum update libgudev1</span><br><span class="line">&gt;......</span><br><span class="line">&gt;Updated:</span><br><span class="line">libgudev1.x86_64 0:219-42.el7_4.1                              </span><br><span class="line">&gt;Complete!</span><br><span class="line">&gt;$ rpm -q libgudev1</span><br><span class="line">&gt;libgudev1-219-42.el7_4.1.x86_64</span><br><span class="line">&gt;<span class="comment"># 升级完成后，删除旧版本的systemd-libs</span></span><br><span class="line">&gt;$ rpm -e systemd-libs-219-30.el7.x86_64</span><br><span class="line">&gt;$ rpm -q systemd-libs</span><br></pre></td></tr></table></figure></blockquote><h5 id="5-卸载-v2"><a class="header-anchor" href="#5-卸载-v2">¶</a>（5） 卸载</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#卸载指定的软件包</span></span><br><span class="line">	<span class="comment">#提示：</span></span><br><span class="line">    <span class="comment">#该命令会自动删除其依赖包中不再需要的依赖包（类似于：apt remove --auto-remove &lt;package-name&gt; ）</span></span><br><span class="line">    <span class="comment">#该命令默认情况下不会自动删除软件包的配置文件。如果希望删除则只能进行手动删除操作（配置文件通常位于/etc目录下）</span></span><br><span class="line">yum remove -y &lt;package-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#卸载系统中所有不再需要的依赖包</span></span><br><span class="line">yum autoremove</span><br></pre></td></tr></table></figure><blockquote><p>💁‍♂ 提示：不再需要的依赖包是指不再被其他软件包所依赖的包。</p></blockquote><h5 id="6-软件组安装卸载"><a class="header-anchor" href="#6-软件组安装卸载">¶</a>（6）软件组安装卸载</h5><p>组名可以由grouplist查询出来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列出所有可用的软件组</span></span><br><span class="line">yum grouplist</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装指定软件组</span></span><br><span class="line">yum groupinstall 软件组名</span><br><span class="line"><span class="comment">#如：yum groupinstall "Development tools"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#卸载指定软件组</span></span><br><span class="line">yum  groupremove  软件组名</span><br><span class="line"></span><br><span class="line"><span class="comment">#清除已下载的软件包文件的缓存（可选）</span></span><br><span class="line">	<span class="comment">#删除/var/cache/yum目录里所有软件源对应packages目录里的RPM包文件</span></span><br><span class="line">	<span class="comment">#提示：与Debian系列系统不同，在Redhat系列系统中，通过yum安装或更新的软件，默认会自动删除掉RPM包缓存文件，而不会保留在缓存目录里。是否保留由/etc/yum.conf配置文件里的keepcache字段决定（1：保留，0：不保留，默认）</span></span><br><span class="line"><span class="comment">#yum clean packages</span></span><br></pre></td></tr></table></figure><h3 id="4-snap-在线包管理器"><a class="header-anchor" href="#4-snap-在线包管理器">¶</a>4. Snap 在线包管理器</h3><h4 id="1-安装-snap"><a class="header-anchor" href="#1-安装-snap">¶</a>1）安装 Snap</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##（1）安装snapd</span></span><br><span class="line"><span class="comment"># apt安装（提示：ubuntu16.04之后的版本已经内置了snap，在debian系统上则需要手动安装）</span></span><br><span class="line">apt update</span><br><span class="line">apt install -y snapd</span><br><span class="line"></span><br><span class="line"><span class="comment"># yum安装（操作命令相对会多一些）</span></span><br><span class="line">yum install -y epel-release</span><br><span class="line">yum install -y snapd</span><br><span class="line"></span><br><span class="line"><span class="comment">##（2）启动snad的套接字单元</span></span><br><span class="line"><span class="comment"># 启动snapd套接字单元（注意套接字单元是snapd.socket，而不是snapd.service，其中snapd.service可简写为snapd）</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now snapd.socket <span class="comment">#等同于 systemctl enable snapd.socket &amp;&amp; systemctl start snapd.socket</span></span><br><span class="line"><span class="comment"># 查看是否成功启动snapd</span></span><br><span class="line">systemctl status snapd.socket</span><br><span class="line"></span><br><span class="line"><span class="comment">##（3）需要注销并重新登录（重新打开终端即可）或重新启动系统以确保正确更新snap的路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##（4）安装snap核心包</span></span><br><span class="line"><span class="comment"># 安装snap核心包</span></span><br><span class="line">snap install core</span><br><span class="line">snap refresh core</span><br><span class="line"></span><br><span class="line"><span class="comment">##（5）配置支持snap经典模式安装（仅yum安装snap时需要）</span></span><br><span class="line"><span class="comment"># 说明：由于snap经典模式安装需要操作/snap目录。通过yum安装snapd时，snap所安装的经典包存放在/var/lib/snapd/snap目录中而非/snap目录，所以需要创建一个符号链接/snap指向到/var/lib/snapd/snap，否则snap只能安装标准包而无法安装经典包。而使用apt安装snapd时，snap所安装的经典包就存放在/snap目录中，故而不需要创建符号链接。</span></span><br><span class="line">ln -s /var/lib/snapd/snap /snap</span><br></pre></td></tr></table></figure><blockquote><p>Snap 安装参考：<a href="https://snapcraft.io/docs/installing-snapd" target="_blank" rel="noopener">https://snapcraft.io/docs/installing-snapd</a></p></blockquote><h4 id="2-snap-常用命令"><a class="header-anchor" href="#2-snap-常用命令">¶</a>2）Snap 常用命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#搜索 Snap 软件包</span></span><br><span class="line">snap find package-name</span><br><span class="line"></span><br><span class="line"><span class="comment">##安装标准的 Snap 软件包</span></span><br><span class="line"><span class="comment">#Snap 软件包通常是以沙箱方式运行的，这意味着它们受到严格的限制以增强安全性和隔离性。使用此命令安装的软件包将按照 Snap 的默认策略进行沙箱化。</span></span><br><span class="line">snap install package-name</span><br><span class="line"></span><br><span class="line"><span class="comment">##安装经典 Snap 软件包</span></span><br><span class="line"><span class="comment">#经典 Snap 软件包是一种特殊类型的 Snap 软件包，它们不会受到严格的沙箱限制。它们可以访问系统上的更多资源和文件，因此更接近传统的非 Snap 软件包。这种类型的 Snap 软件包通常用于需要更多系统级访问权限的应用程序，比如开发工具或服务器软件。</span></span><br><span class="line">snap install --classic package-name</span><br><span class="line"></span><br><span class="line"><span class="comment">#卸载 Snap 软件包</span></span><br><span class="line">snap remove package-name</span><br><span class="line"></span><br><span class="line"><span class="comment">#列出已安装的 Snap 软件包</span></span><br><span class="line">snap list</span><br><span class="line"></span><br><span class="line"><span class="comment">#更新所有已安装的 Snap 软件包</span></span><br><span class="line">snap refresh</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看 Snap 版本信息</span></span><br><span class="line">snap version</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看 Snap 软件包信息</span></span><br><span class="line">snap info package-name</span><br><span class="line"></span><br><span class="line"><span class="comment">#管理 Snap 服务</span></span><br><span class="line">snap <span class="built_in">enable</span> service-name	<span class="comment">#启用 Snap 服务</span></span><br><span class="line">snap <span class="built_in">disable</span> service-name	<span class="comment">#禁用 Snap 服务</span></span><br><span class="line">snap services				<span class="comment">#查看 Snap 服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#管理 Snap 用户权限</span></span><br><span class="line">snap connections package-name						<span class="comment"># 查看 Snap 软件包的连接信息</span></span><br><span class="line">snap connect package-name:interface-name		<span class="comment"># 允许 Snap 软件包访问特定接口</span></span><br><span class="line">snap disconnect package-name:interface-name	<span class="comment"># 禁止 Snap 软件包访问特定接口</span></span><br></pre></td></tr></table></figure><h4 id="3-卸载-snap"><a class="header-anchor" href="#3-卸载-snap">¶</a>3）卸载 Snap</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#关闭snapd套接字单元（卸载前先停掉snapd套接字单元，否则卸载失败）</span></span><br><span class="line">systemctl stop snapd.socket</span><br><span class="line"></span><br><span class="line"><span class="comment">##卸载snap</span></span><br><span class="line"><span class="comment">#1、yum卸载</span></span><br><span class="line">yum remove -y snapd</span><br><span class="line"><span class="comment">#删除残余目录或文件</span></span><br><span class="line">rm -rf /var/lib/snapd /snap ~/snap</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、apt卸载</span></span><br><span class="line">apt remove --purge -y snapd	<span class="comment">#如果不加--purge则需要手动删除/var/lib/snapd和/snap</span></span><br><span class="line"><span class="comment">#删除残余目录或文件</span></span><br><span class="line">rm -rf ~/snap</span><br></pre></td></tr></table></figure><h3 id="5-源码包安装卸载-待续"><a class="header-anchor" href="#5-源码包安装卸载-待续">¶</a>5. 源码包安装卸载（待续···）</h3><h3 id="6-通用更换系统软件源脚本-支持大部分-linux-系统"><a class="header-anchor" href="#6-通用更换系统软件源脚本-支持大部分-linux-系统">¶</a>6. 通用更换系统软件源脚本（支持大部分 Linux 系统）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 中国大陆（默认）</span></span><br><span class="line"><span class="comment"># 执行命令后会交互式地提示选择软件源（可选源：阿里云、网易、清华大学源等）</span></span><br><span class="line">bash &lt;(curl -sSL https://linuxmirrors.cn/main.sh)</span><br><span class="line"><span class="comment">#或者：</span></span><br><span class="line"><span class="comment">#bash &lt;(curl -sSL https://raw.githubusercontent.com/SuperManito/LinuxMirrors/main/ChangeMirrors.sh)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 中国大陆教育网（可选源：清华大学、北京大学、南京大学等）</span></span><br><span class="line">bash &lt;(curl -sSL https://linuxmirrors.cn/main.sh) --edu</span><br><span class="line"></span><br><span class="line"><span class="comment"># 海外地区（可选源：亚洲|香港|xTom、北美|美国|Linux Kernel、欧洲|英国|Vorboss Ltd 等）</span></span><br><span class="line">bash &lt;(curl -sSL https://linuxmirrors.cn/main.sh) --abroad</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##常见选项说明：</span></span><br><span class="line">--abroad	<span class="comment">#使用海外软件源（选项值：无）</span></span><br><span class="line">--edu	<span class="comment">#使用中国大陆教育网软件源（选项值：无）</span></span><br><span class="line">--abroad	<span class="comment">#使用海外软件源（选项值：无）</span></span><br><span class="line">--use-official-source <span class="comment">#使用操作系统官方软件源（选项值：无）</span></span><br><span class="line">--install-epel <span class="comment">#安装 EPEL 附加软件包（选项值：true 或 false）</span></span><br><span class="line">--only-epel	<span class="comment">#仅更换 EPEL 软件源模式（选项值：无）</span></span><br><span class="line">--clean-cache <span class="comment">#清理下载缓存（选项值：true 或 false）</span></span><br><span class="line"><span class="comment">#更多选项参考：https://linuxmirrors.cn/use/command-options/</span></span><br></pre></td></tr></table></figure><blockquote><p>适配 Linux 系统：Debian（8.0 ~ 13）、Ubuntu（14.04 ~ 24）、CentOS（7.0 ~ 8.5 / Stream 8 ~ 9）、 Rocky Linux（8 ~ 9）、Deepin（all）等</p><p>参考：</p><ul><li>项目地址：<a href="https://github.com/SuperManito/LinuxMirrors" target="_blank" rel="noopener">https://github.com/SuperManito/LinuxMirrors</a></li><li>官方文档：<a href="https://linuxmirrors.cn" target="_blank" rel="noopener">https://linuxmirrors.cn</a></li></ul></blockquote><h2 id="七-进程管理"><a class="header-anchor" href="#七-进程管理">¶</a>七、进程管理</h2><p>所谓 进程，通俗地说就是当前正在执行的一个程序。</p><h3 id="1-列出当前进程信息-ps"><a class="header-anchor" href="#1-列出当前进程信息-ps">¶</a>1. 列出当前进程信息 <code>ps</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列出当前进程信息</span></span><br><span class="line"><span class="comment">#-a或者-e:显示终端上的所有进程，包括其他用户的进程；-u:显示进程的详细状态；-x:显示没有控制终端的进程；-f:显示程序间的关系</span></span><br><span class="line">ps -aux</span><br><span class="line">ps -ef</span><br><span class="line"></span><br><span class="line"><span class="comment">#根据进程号查看进程的文件路径、启动命令的完整路径等等信息（比如nginx）</span></span><br><span class="line">ps -ef | grep nginx</span><br><span class="line">ls -l /proc/10383</span><br><span class="line"><span class="comment">#有几个主要的文件我们可以关注下：</span></span><br><span class="line"><span class="comment">#cwd：文件所在目录</span></span><br><span class="line"><span class="comment">#exe：执行命令的完整路径</span></span><br><span class="line"><span class="comment">#environ：执行命令时的环境变量</span></span><br></pre></td></tr></table></figure><blockquote><p>提示：ps 默认只会显示当前用户通过终端启动的应用程序。</p><p><code>ps</code> 命令主要显示的信息：</p><ul><li>PID：进程 ID，每个进程都有一个唯一的 PID。</li><li>TTY：与进程关联的终端设备或伪终端。</li><li>TIME：已经使用的 CPU 时间（或者启动时间），显示该进程占用 CPU 的时间量。</li><li>CMD：命令名称或完整的命令行。</li></ul><p>选项说明：</p><ul><li><code>-a</code>：显示所有用户的进程。这包括与终端关联的进程以及与其他用户关联的进程。</li><li><code>-x</code>：显示没有控制终端的进程。</li><li><code>-u</code>：显示指定用户的进程信息</li><li><code>-e</code>：显示系统中所有的进程</li><li><code>-f</code>：显示完整的格式，包括命令行</li><li><code>-l</code>：使用长格式显示进程信息</li><li><code>aux</code>：显示系统中所有用户的所有进程</li></ul></blockquote><h3 id="2-查看系统内存使用情况-free"><a class="header-anchor" href="#2-查看系统内存使用情况-free">¶</a>2. 查看系统内存使用情况 <code>free</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示系统的内存使用情况</span></span><br><span class="line">	<span class="comment">#以更易读的方式展示出来。参数 -h 用于以人类可读的格式显示输出，例如以 GB、MB 等为单位。</span></span><br><span class="line">free -h</span><br></pre></td></tr></table></figure><h3 id="3-系统负载监控-top"><a class="header-anchor" href="#3-系统负载监控-top">¶</a>3. 系统负载监控 <code>top</code></h3><p>可实时查看系统的 CPU 使用率、内存使用量（含 Swap 虚拟内存使用量）、进程列表（程序允许命令）等，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#top 与 ps 命令很相似。它们都用来显示正在执行的进程。Top 与 ps 最大的不同之处，在于top 在执行一段时间可以更新正在运行的的进程。</span></span><br><span class="line"><span class="comment">#要退出可以直接输入q</span></span><br><span class="line">top</span><br><span class="line"><span class="comment">#每隔10秒自动更新</span></span><br><span class="line">top -d 10</span><br></pre></td></tr></table></figure><blockquote><p>常用的 top 快捷键：</p><p><strong>切换排序</strong>：</p><ul><li><code>P</code>（即：<code>Shift + p</code>）：按 CPU 使用率进行排序</li><li><code>M</code>（即：<code>Shift + m</code>）：按内存使用量进行排序（按 <code>e</code> 键可以调整内存占用单位，比如以 MB 或 GB 为单位展示会更人性化 ）</li></ul><p><strong>进程操作</strong>：</p><ul><li><code>k</code>：杀死一个进程（需要输入相应的 PID）</li><li><code>r</code>：更改进程的优先级</li></ul><p><strong>布局和显示</strong>：</p><ul><li><code>f</code>：打开字段管理器，可以选择要显示的字段</li><li><code>o</code>：更改排序字段</li><li><code>b</code>：切换是否显示底部摘要信息</li></ul><p><strong>全局操作</strong>：</p><ul><li><code>q</code>：退出 top 命令</li></ul></blockquote><h3 id="4-通过监听端口查询对应进程信息"><a class="header-anchor" href="#4-通过监听端口查询对应进程信息">¶</a>4. 通过监听端口查询对应进程信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##使用 netstat 命令来查看端口的对应进程信息（如：名称、PID 等）</span></span><br><span class="line">	<span class="comment">#-tuln 选项用于显示 TCP 和 UDP 监听状态的端口</span></span><br><span class="line">netstat -tuln | grep &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">##使用 lsof 命令来查看端口的占用情况</span></span><br><span class="line">apt install lsof <span class="comment"># Debian/Ubuntu</span></span><br><span class="line">yum install lsof <span class="comment"># Red Hat/CentOS</span></span><br><span class="line">lsof -i :&lt;port&gt;</span><br></pre></td></tr></table></figure><h3 id="5-终止进程-kill"><a class="header-anchor" href="#5-终止进程-kill">¶</a>5. 终止进程 kill</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-9表示强行终止</span></span><br><span class="line"><span class="built_in">kill</span> [-9] 进程代号</span><br></pre></td></tr></table></figure><blockquote><p>提示：使用 <code>kill</code> 命令时，最好只终止由当前用户开启的进程，而不要终止 <code>root</code> 身份开启的进程，否则可能导致系统崩溃。</p></blockquote><h3 id="6-通过-pid-找出进程的对应文件路径"><a class="header-anchor" href="#6-通过-pid-找出进程的对应文件路径">¶</a>6. 通过 PID 找出进程的对应文件路径</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ls -l /proc/&lt;port&gt;/exe</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例（查询 sshd 服务的 PID，然后通过 PID 查询出 sshd 的完整文件路径）：</span></span><br><span class="line">$ ps -ef | grep sshd</span><br><span class="line"><span class="comment">#root       14368       1  0 08:21 ?        00:00:00 sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups</span></span><br><span class="line">$ ls -l /proc/14368/exe</span><br><span class="line"><span class="comment">#lrwxrwxrwx 1 root root 0 Jan 19 03:45 /proc/14368/exe -&gt; /usr/sbin/sshd</span></span><br></pre></td></tr></table></figure><h3 id="7-查看命令路径-which"><a class="header-anchor" href="#7-查看命令路径-which">¶</a>7. 查看命令路径 which</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">which</span> 命令名称</span><br><span class="line"></span><br><span class="line"><span class="comment">#例如：</span></span><br><span class="line">$ <span class="built_in">which</span> useradd</span><br><span class="line">/usr/sbin/useradd</span><br></pre></td></tr></table></figure><blockquote><p>在 <code>Linux</code> 中，绝大多数可执行文件都是保存在 <code>/bin</code>、<code>/sbin</code>、<code>/usr/bin</code>、<code>/usr/sbin</code></p><ul><li><code>/bin</code>（<code>binary</code>）是二进制执行文件目录，主要用于具体应用</li><li><code>/sbin</code>（<code>system binary</code>）是系统管理员专用的二进制代码存放目录，主要用于系统管理</li><li><code>/usr/bin</code>（<code>user commands for applications</code>）后期安装的一些软件</li><li><code>/usr/sbin</code>（<code>super user commands for applications</code>）超级用户的一些管理程序</li></ul><p>提示：<code>cd</code> 这个终端命令是内置在系统内核中的，没有独立的文件，因此用 <code>which</code> 无法找到 <code>cd</code> 命令的位置</p></blockquote><h3 id="8-查看进程树-pstree"><a class="header-anchor" href="#8-查看进程树-pstree">¶</a>8. 查看进程树 pstree</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装pstree安装包</span></span><br><span class="line">apt install psmisc</span><br><span class="line"><span class="comment">#yum install psmisc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-p :显示进程的PID -u :显示进程的所属用户</span></span><br><span class="line"><span class="comment">#树状的形式显示进程和pid</span></span><br><span class="line">pstree -p</span><br><span class="line"><span class="comment">#树状的形式进程和对应操作用户</span></span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/image-20240116031624714.png" alt="image-20240116031624714"></p><h3 id="9-系统监控实用工具"><a class="header-anchor" href="#9-系统监控实用工具">¶</a>9. 系统监控实用工具</h3><h4 id="1-iftop"><a class="header-anchor" href="#1-iftop">¶</a>1）iftop</h4><p>iftop可测量通过每一个套接字连接传输的数据。iftop使用pcap库来捕获进出网络适配器的数据包，然后汇总数据包大小和数量，搞清楚总的带宽使用情况。</p><p>虽然iftop报告每个连接所使用的带宽，但它无法报告参与某个套按字连接的进程名称/编号（ID）。不过由于基于pcap库，iftop能够过滤流量，并报告由过滤器指定的所选定主机连接的带宽使用情况。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装</span></span><br><span class="line">apt install iftop</span><br><span class="line"><span class="comment">#yum install iftop</span></span><br><span class="line"><span class="comment">#使用</span></span><br><span class="line">iftop -n</span><br></pre></td></tr></table></figure><p>n选项可以防止iftop将IP地址解析成主机名，解析本身就会带来额外的网络流量。</p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/image-20240116031546216.png" alt="image-20240116031546216"></p><h4 id="2-nload"><a class="header-anchor" href="#2-nload">¶</a>2）nload</h4><p>nload是一个命令行工具，让用户可以分开来监控入站流量和出站流量。它还可以绘制图表以显示入站流量和出站流量，视图比例可以调整。用起来很简单。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装</span></span><br><span class="line">apt install nload</span><br><span class="line"><span class="comment">#yum install nload</span></span><br><span class="line"><span class="comment">#使用</span></span><br><span class="line">nload</span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/image-20240116031407371.png" alt="image-20240116031407371"></p><h4 id="3-htop"><a class="header-anchor" href="#3-htop">¶</a>3）htop</h4><p>htop是top的扩展版本，有更丰富的概貌（例如全命令、可视化、图形用户界面gui和用户界面ui），有鼠标点击交互（译者注：看下面的截图，指的是最上面的列标题如CPU%、MEM%等可以通过鼠标点击切换以显示不同的功能），也有许多的指导教你如何做进程管理。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装</span></span><br><span class="line">apt install htop</span><br><span class="line"><span class="comment">#yum install htop</span></span><br><span class="line"><span class="comment">#运行</span></span><br><span class="line">htop</span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/image-20240116031200476.png" alt="image-20240116031200476"></p><h4 id="4-iotop"><a class="header-anchor" href="#4-iotop">¶</a>4）iotop</h4><p>iotop – 简单的类似top的I/O监控器。</p><p>iotop是IO实时监控器。使用它们附属的详细输入输出（IO）使用方法可以展示出你系统中每个进程线程的信息。</p><p>该命令可以与$ tcpdump（响应网络流量的命令）一起使用。如果你发现你的web服务器上有程序在运行，你可以，比如运行$ tcpdump port 80检查端口80（标准的http端口）的网络流量来观察细节。</p><p>最有用的信息可能是DISK WRITE这一列，从该列你可以准确的看到每个IO使用了多少个进程，单位为K/s。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装</span></span><br><span class="line">apt install iotop</span><br><span class="line"><span class="comment">#yum install iotop</span></span><br><span class="line"><span class="comment">#运行 </span></span><br><span class="line">iotop</span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/image-20240116031221046.png" alt="image-20240116031221046"></p><h4 id="5-glances"><a class="header-anchor" href="#5-glances">¶</a>5）glances</h4><p>glances是一款由python开发的系统监控工具，可以实时查看CPU、内存、网络、IO、进程、磁盘空间使用率的使用情况，并且支持三种运行模式，个人感觉比top命令使用更便捷，有三种运行模式：Standalone、Client/Server、Web server。</p><h5 id="安装"><a class="header-anchor" href="#安装">¶</a>安装</h5><p>多种安装方式可选，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yum 安装</span></span><br><span class="line">yum -y install glances</span><br><span class="line"><span class="comment">#apt 安装</span></span><br><span class="line">apt install glances	<span class="comment">#提示：如果 Debain 无法找到软件包，需添加 bullseye-backports 源</span></span><br><span class="line"><span class="comment">#pip 安装</span></span><br><span class="line">pip install --user <span class="string">'glances[all]'</span></span><br><span class="line"><span class="comment">#一键脚本安装</span></span><br><span class="line">curl -L https://bit.ly/glances | /bin/bash</span><br></pre></td></tr></table></figure><blockquote><p>参考：<a href="https://github.com/nicolargo/glances" target="_blank" rel="noopener">https://github.com/nicolargo/glances</a></p></blockquote><h5 id="standalone-模式"><a class="header-anchor" href="#standalone-模式">¶</a>Standalone 模式</h5><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1171094-20191022172458481-1927476558.png" alt="img"></p><blockquote><p>可以查看系统运行详细情况。</p></blockquote><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1171094-20191022172520017-392023090.png" alt="img"></p><blockquote><p>在运行<code>glances</code>时可以使用<code>h</code>键来查看<code>glances</code>快捷键使用方法。</p></blockquote><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1171094-20191022172543214-426222242.png" alt="img"></p><blockquote><p>运行过程中，直接按回车键可以对进程进行过滤，查看指定进程。</p></blockquote><h5 id="client-server-模式"><a class="header-anchor" href="#client-server-模式">¶</a>Client / Server 模式</h5><p>Server端：<code>glances -s -B 192.168.1.1</code><br>Client端：<code>glances -c 192.168.1.1</code></p><blockquote><p>无须去指定服务器上运行，通过Client/Server端模式快速查看。-B：指定绑定的IP地址，如果不指定Server端运行端口默认端口为：61209，如果使用默认端口则用-c指定客户端时不需要额外使用-P参数来指定Server端的端口号。需要注意的是防火墙设置，确认两台主机之间端口可通。</p></blockquote><h5 id="web-server-模式"><a class="header-anchor" href="#web-server-模式">¶</a>Web server 模式</h5><p><code>glances -w</code><br><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1171094-20191022172602929-1304526389.png" alt="img"></p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1171094-20191022172615979-906022360.png" alt="img"></p><p>这个功能就很贴心了，我可以将集群中所有服务器上后台运行Web Server端，后续防火墙开放指定IP查看集群中服务器的运行状态，美滋滋。</p><p>如果启动Web Server端时出现**“Bottle module not found. Glances cannot start in web server mode.”**报错，执行安装bottle即可解决。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install bottle</span><br></pre></td></tr></table></figure><h5 id="配置文件"><a class="header-anchor" href="#配置文件">¶</a>配置文件</h5><blockquote><p>glances是支持设置配置文件的，但是不一定要有配置文件才能使用glances，Linux中配置文件可以新建位置到<code>/etc/glances/glances.conf</code>，窗口中的不同颜色是由阈值来设定的，我们可以在配置文件中修改各监控项的阈值来实现不同级别不同颜色的展示情况。</p></blockquote><h6 id="颜色级别定义"><a class="header-anchor" href="#颜色级别定义">¶</a>颜色级别定义</h6><ul><li>绿色：正常(OK)</li><li>蓝色：小心(CAREFUL)，需要注意</li><li>紫色：警告（WARNING）</li><li>红色：问题严重（CRITICAL）</li></ul><h6 id="配置文件示例"><a class="header-anchor" href="#配置文件示例">¶</a>配置文件示例</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/glances/glances.conf</span><br><span class="line">[quicklook]</span><br><span class="line">cpu_careful=50</span><br><span class="line">cpu_warning=70</span><br><span class="line">cpu_critical=1</span><br><span class="line">mem_careful=50</span><br><span class="line">mem_warning=1</span><br><span class="line">mem_critical=90</span><br><span class="line">swap_careful=1</span><br><span class="line">swap_warning=70</span><br><span class="line">swap_critical=90</span><br></pre></td></tr></table></figure><p>这里我们为了展示出颜色的差异，特别修改了几个为1的值，实际使用中修改到需要的值即可。<br><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1171094-20191022174050345-2010570099.png" alt="img"></p><p>最终展示界面如上图所示。</p><h2 id="八-系统管理"><a class="header-anchor" href="#八-系统管理">¶</a>八、系统管理</h2><h3 id="1-关机和重启"><a class="header-anchor" href="#1-关机和重启">¶</a>1. 关机和重启</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shutdown命令可用于关闭或重启系统（-r表示重启，不指定则表示1分钟后自动关闭系统）</span></span><br><span class="line">shutdown [-r] [时间]</span><br><span class="line"><span class="comment"># 例如：</span></span><br><span class="line"><span class="comment">#不指定-r则表示1分钟后自动关闭系统</span></span><br><span class="line">shutdown</span><br><span class="line"><span class="comment"># 重新启动操作系统，其中 now 表示现在</span></span><br><span class="line">shutdown -r now</span><br><span class="line"><span class="comment"># 立刻关机，其中 now 表示现在</span></span><br><span class="line">shutdown now</span><br><span class="line"><span class="comment"># 系统在今天的 20:25 会关机</span></span><br><span class="line">shutdown 20:25</span><br><span class="line"><span class="comment"># 系统再过十分钟后自动关机</span></span><br><span class="line">shutdown +10</span><br><span class="line"><span class="comment"># 取消之前指定的关机计划</span></span><br><span class="line">shutdown -c</span><br><span class="line"></span><br><span class="line"><span class="comment"># reboot命令可用于重启系统</span></span><br><span class="line">reboot	<span class="comment">#等效于shutdown -r now</span></span><br></pre></td></tr></table></figure><h3 id="2-查看系统配置"><a class="header-anchor" href="#2-查看系统配置">¶</a>2. 查看系统配置</h3><p>查看CPU信息：</p><ul><li>使用<code>lscpu</code>命令可以显示有关CPU架构和相关信息。</li><li>使用<code>cat /proc/cpuinfo</code>命令可以查看更详细的CPU信息。</li></ul><p>查看内存信息：</p><ul><li>使用<code>free -h</code>命令可以查看系统中的内存使用情况。</li><li>使用<code>cat /proc/meminfo</code>命令可以获取更多的内存详细信息。</li></ul><p>查看磁盘信息：</p><ul><li>使用<code>df -h</code>命令可以查看系统中各个磁盘分区的使用情况。</li><li>使用<code>lsblk</code>命令可以显示磁盘和分区的详细信息。</li></ul><h3 id="3-环境变量"><a class="header-anchor" href="#3-环境变量">¶</a>3. 环境变量</h3><h4 id="简要概述-v2"><a class="header-anchor" href="#简要概述-v2">¶</a>简要概述</h4><p>在 Linux 操作系统中设置环境变量，通常使用<code>export</code> 命令来实现。它可以将一个或多个变量从本地 shell （命令行解释器）的环境传递到子进程的环境中，以便让这些子进程也可以使用这些变量。在 Linux 中，每个进程都有一组环境变量。这些变量存储在进程空间中，并且可以在运行时由进程读取和修改。当您启动一个新的 shell 会话或者在当前 shell 会话中运行一个新的脚本时，该会话会继承父 shell 的环境变量。然而，如果您希望将变量传递给子进程，那么您需要将其标记为“导出”。</p><blockquote><p>💁‍♂ 变量和环境变量的区别：</p><p>变量是 Shell 编程中最基本的元素之一。它们是用户定义的名称，用于保存一个或多个值或字符串，并在 Shell 脚本或命令中进行引用。变量的值可以是数字、字符串、文件名、路径名等。</p><p>例如，在 Bash shell 中，您可以通过以下语法来定义变量：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="string">"Alice"</span></span><br></pre></td></tr></table></figure><p>这将创建一个名为 <code>name</code> 的变量，并将其设置为 “Alice”。</p><p>环境变量是 Shell 环境中的特殊类型的变量，它们具有全局范围并可以被所有子进程访问。环境变量通常用于存储 Shell 和其他程序所需的共享信息，例如路径、语言设置、用户信息等。</p><p>例如，在 Bash shell 中，您可以使用以下语法来设置环境变量：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/bin</span><br></pre></td></tr></table></figure><p>这会将 <code>/usr/local/bin</code> 目录添加到系统的 PATH 环境变量中，以便 Shell 可以搜索该目录中的可执行文件。</p><p>因此，变量和环境变量具有不同的作用和范围，并且通常用于不同的目的。</p></blockquote><p>在 Linux 中设置环境变量的方法有多种，下面将主要讲其中两种常见的方法。</p><h4 id="临时设置环境变量"><a class="header-anchor" href="#临时设置环境变量">¶</a>临时设置环境变量</h4><p>要在当前 shell 会话中设置一个临时环境变量，可以使用 <code>export</code> 命令。例如，要将 <code>MY_VAR</code> 的值设置为 <code>my_value</code>，可以执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> MY_VAR=my_value</span><br></pre></td></tr></table></figure><p>这将在当前 shell 会话中设置一个名为 <code>MY_VAR</code> 的环境变量，并将其值设置为 <code>my_value</code>。该变量只在当前会话中有效，关闭终端窗口或重启系统后就会自动清除。</p><h4 id="永久设置环境变量"><a class="header-anchor" href="#永久设置环境变量">¶</a>永久设置环境变量</h4><p>要在系统中永久设置一个环境变量，可以将其添加到 <code>~/.bashrc</code> 、 <code>~/.bash_profile</code>、<code>/etc/profile</code> 等脚本文件中，这样系统在某个特定情况下将会自动执行这些脚本以让脚本里设置的环境变量生效。</p><p>下面以添加环境变量到<code>~/.bashrc</code>脚本文件为例讲解配置过程：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在文件最后加入变量</span></span><br><span class="line">cat &gt;&gt; ~/.bashrc &lt;&lt; <span class="string">'EOF'</span></span><br><span class="line"><span class="built_in">export</span> MY_VAR=my_value</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#使配置文件修改生效</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$MY_VAR</span></span><br></pre></td></tr></table></figure><blockquote><p>💁‍♂ <code>/etc/profile</code> 等脚本文件说明：</p><ul><li><code>~/.bashrc</code>：打开新的 Bash shell 会话时自动执行该脚本。该文件只适用于当前用户的 Bash shell，通常用于设置用户环境变量等配置。</li><li><code>~/.bash_profile</code>：如果系统默认shell是bash，用户登录时将自动执行该脚本。该文件只适用于当前用户的 Bash shell，通常用于设置用户环境变量等配置。</li><li><code>/etc/profile</code>：在系统引导时自动执行该脚本。该文件适用于所有用户和所有 Bash shell，通常用于设置全局环境变量等配置。</li></ul><p>💁‍♂ 注意：只要执行<code>bash</code>命令就会打开新的 Bash shell 会话。</p><p>💁‍♂ 总结：开机启动系统，在系统引导时将自动执行<code>/etc/profile</code>脚本文件。等系统启动完成后用户就可以进行登录操作了，如果系统默认shell是bash，那么在用户登录时系统会自动执行<code>bash</code>命令来打开新的 Bash shell 会话，故而会自动执行<code>~/.bash_profile</code>和<code>~/.bashrc</code>脚本文件。但如果系统默认shell是sh、zsh等其他类型的shell，那么登录时将不会自动执行<code>~/.bash_profile</code>脚本，但当用户手动执行<code>bash</code>命令时是会自动执行<code>~/.bashrc</code>脚本文件的。</p><p>💁‍♂ 建议：在 Linux 中，虽然<code>~/.bashrc</code> 、 <code>~/.bash_profile</code>、<code>/etc/profile</code> 等脚本文件都能配置环境变量，但通常使用的话建议将环境变量配置到 <code>~/.bashrc</code> 文件中。</p></blockquote><h3 id="4-系统版本和内核版本"><a class="header-anchor" href="#4-系统版本和内核版本">¶</a>4. 系统版本和内核版本</h3><h4 id="1-查看系统版本"><a class="header-anchor" href="#1-查看系统版本">¶</a>1）查看系统版本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##（1）通过 lsb_release 命令查看方式</span></span><br><span class="line"><span class="comment">#安装依赖</span></span><br><span class="line">apt install lsb-release	<span class="comment">#Debian 系列系统（如：Debian、Ubuntu 等）</span></span><br><span class="line">yum install redhat-lsb-core <span class="comment">#Red Hat 系列系统（如：CentOS、Fedora 等）</span></span><br><span class="line"><span class="comment">#查看系统版本（通用，含系统名称、系统版本号、版本代号、描述等）</span></span><br><span class="line">lsb_release -a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##（2）通过系统配置文件查看方式</span></span><br><span class="line"><span class="comment">#查看系统版本（通用，含系统名称（ID）、系统版本号、版本代号、描述等）</span></span><br><span class="line">cat /etc/os-release</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#仅查看系统名称（ID）</span></span><br><span class="line">cat /etc/os-release | grep -oP <span class="string">'^ID=\K\S+'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#仅查看系统版本号</span></span><br><span class="line">cat /etc/os-release | grep VERSION_ID | cut -d <span class="string">'='</span> -f 2 | sed <span class="string">'s/"//g'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#仅查看系统版本代号</span></span><br><span class="line">cat /etc/os-release | grep VERSION_CODENAME | cut -d <span class="string">'='</span> -f 2</span><br><span class="line"><span class="comment">#cat /etc/os-release | grep VERSION_CODENAME | awk -F '=' '&#123;print $2&#125;'</span></span><br><span class="line"><span class="comment">#cat /etc/os-release | grep VERSION_CODENAME | sed 's/.*=//'</span></span><br></pre></td></tr></table></figure><h4 id="2-查看内核版本"><a class="header-anchor" href="#2-查看内核版本">¶</a>2）查看内核版本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure><h4 id="3-升级内核版本"><a class="header-anchor" href="#3-升级内核版本">¶</a>3）升级内核版本</h4><h5 id="简要说明"><a class="header-anchor" href="#简要说明">¶</a>简要说明</h5><blockquote><p>通过系统默认官方源在线升级的内核版本一般都不会太新，特别是一些老版本的系统（如：CentOS 7、Ubuntu 18.04 等）。由于为了让系统稳定，通常 Linux 发行商官方都会选择一些经过长期测试和使用的老版本内核，所以官方的软件源都不会提供太新的内核版本，如果非要使用更高版本的内核则应该通过其他方式安装升级，主要为如下几种方式：</p><ul><li>下载 Linux 新版内核进行编译安装</li><li>使用第三方源进行在线安装（如：elrepo 源、XanMod 源等）</li><li>使用已编译好的二进制包进行安装（建议通过一键脚本安装）</li></ul><p>温馨提示：使用非官方源安装的内核可能会导致系统不稳定，非必要情况当然更推荐使用官方源支持的内核版本，通常更高版本内核在对应 LInux 新版本中会得到更新的支持（如 Ubuntu 22.04 的官方源内核版本会比 Ubuntu 18.04 更新，如需更新内核版本应该考虑升级系统版本）。</p><p>参考：</p><ul><li><a href="https://juejin.cn/post/7007972621920780318" target="_blank" rel="noopener">Linux 内核在线升级、离线升级、定制升级</a></li><li><a href="https://zhuanlan.zhihu.com/p/75669680" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/75669680</a></li></ul></blockquote><h5 id="方式一：通过系统默认官方源在线升级的内核版本"><a class="header-anchor" href="#方式一：通过系统默认官方源在线升级的内核版本">¶</a>方式一：通过系统默认官方源在线升级的内核版本</h5><blockquote><p>这种方式升级的版本为系统发行方维护的版本，通常版本较低</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##（1）CentOS/RedHat</span></span><br><span class="line"><span class="comment">#更新内核版本</span></span><br><span class="line">yum update kernel</span><br><span class="line"><span class="comment">#更新引导加载程序（必选，即设置使用新版内核启动，CentOS/RedHat 安装新版内核不会自动更新引导加载程序为最新内核）</span></span><br><span class="line">    <span class="comment">#如果需要使用其他版本内核可通过执行：egrep ^menuentry /etc/grub2.cfg | cut -f 2 -d \' 命令查看已安装所有版本内核顺序（从0开始，默认最高版本在最前面）</span></span><br><span class="line">grub2-set-default 0</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg	<span class="comment">#用于传统的BIOS引导</span></span><br><span class="line"><span class="comment">#grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg	#用于UEFI引导（如果使用的是 UEFI 引导，则应该更新的是 UEFI GRUB 配置）</span></span><br><span class="line"><span class="comment">#重启服务器以使新版内核生效（必选）</span></span><br><span class="line">reboot</span><br><span class="line"><span class="comment">##删除无用的旧内核版本（可选，为了节省磁盘空间建议删除）</span></span><br><span class="line"><span class="comment">#查看已安装的所有内核版本</span></span><br><span class="line">rpm -qa kernel kernel-*</span><br><span class="line"><span class="comment">#确认当前正在使用的内核</span></span><br><span class="line">uname -r</span><br><span class="line"><span class="comment">#删除不需要的内核版本（将 &lt;kernel-package&gt; 替换为要删除的包名）</span></span><br><span class="line">yum remove &lt;kernel-package&gt;</span><br><span class="line"><span class="comment">#更新引导加载程序配置（如果使用 GRUB 引导）</span></span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##（2）Ubuntu/Debian</span></span><br><span class="line"><span class="comment">#列出可升级内核版本</span></span><br><span class="line">apt list --upgradable | grep linux-image</span><br><span class="line"><span class="comment">#安装支持的新版内核</span></span><br><span class="line">apt install linux-image-generic</span><br><span class="line"><span class="comment">#apt install linux-generic-hwe-18.04-edge #对于Ubuntu，在版本系统中可以安装指定系统版本（如Ubuntu 18.04）的hwe内核包，其版本通常比默认内核包版本高，但可能不稳定</span></span><br><span class="line"><span class="comment">#更新引导加载程序（可选，即设置使用新版内核启动，Ubuntu/Debian 安装新版内核会自动更新引导加载程序为最新内核）</span></span><br><span class="line">    <span class="comment">#通常情况下，新内核的 GRUB 引导项会自动成为默认的引导项。</span></span><br><span class="line">    <span class="comment">#如果需要使用其他版本内核可通过执行：grep 'menuentry' /boot/grub/grub.cfg 命令查看已安装所有版本内核顺序（从0开始，默认最高版本在最前面），然后修改 /etc/default/grub 中的 GRUB_DEFAULT 值（设要修改的内核索引顺序为 2，则修改为：GRUB_DEFAULT="1&gt; 2"），最后执行 update-grub 并 reboot 重启系统即可。参考：https://www.cnblogs.com/zzugyl/p/14588114.html</span></span><br><span class="line">    <span class="comment">#关机重启时一般会进入grub菜单，在菜单中可以选择指定版本的内核启动，如果启动时跳过不展示grub菜单，则可以在启动时按住Shift键或Esc键，直到出现GRUB菜单。</span></span><br><span class="line">update-grub</span><br><span class="line"><span class="comment">#重启服务器以使新版内核生效（必选）</span></span><br><span class="line">reboot</span><br><span class="line"><span class="comment">##删除无用的旧内核版本（可选，为了节省磁盘空间建议删除）</span></span><br><span class="line"><span class="comment">#查看已安装的所有内核版本</span></span><br><span class="line">dpkg --list | grep linux-image</span><br><span class="line"><span class="comment">#确认当前正在使用的内核</span></span><br><span class="line">uname -r</span><br><span class="line"><span class="comment">#删除不需要的内核版本（将 &lt;kernel-package&gt; 替换为要删除的包名）</span></span><br><span class="line">apt purge &lt;kernel-package&gt;</span><br><span class="line"><span class="comment">#更新引导加载程序配置</span></span><br><span class="line">update-grub</span><br></pre></td></tr></table></figure><h5 id="方式二：使用第三方源在线安装较新版本的内核"><a class="header-anchor" href="#方式二：使用第三方源在线安装较新版本的内核">¶</a>方式二：使用第三方源在线安装较新版本的内核</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##（1）CentOS/RedHat</span></span><br><span class="line">	<span class="comment">#参考：http://elrepo.org/tiki/HomePage、https://www.cccitu.com/oos583vx2.html</span></span><br><span class="line"><span class="comment">#安装 elrepo 第三方软件源</span></span><br><span class="line">yum install -y elrepo-release</span><br><span class="line"><span class="comment">#rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org	#导入公钥</span></span><br><span class="line"><span class="comment">#yum install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm	#安装 CentOS7/RedHat7 的 elrepo 源</span></span><br><span class="line"><span class="comment">#yum install https://www.elrepo.org/elrepo-release-8.el8.elrepo.noarch.rpm #安装 CentOS8/RedHat8 的 elrepo 源</span></span><br><span class="line"><span class="comment">#查看可更新内核版本</span></span><br><span class="line">yum --disablerepo=<span class="string">"*"</span> --enablerepo=<span class="string">"elrepo-kernel"</span> list available</span><br><span class="line"><span class="comment">#安装最新版本内核（elrepo源有ml、lt两种内核。ml(mainline)为最新版本的内核，lt为长期支持的内核。）</span></span><br><span class="line">yum --enablerepo=elrepo-kernel install -y kernel<span class="_">-lt</span></span><br><span class="line"><span class="comment">#更新引导加载程序（必选，即设置使用新版内核启动，CentOS/RedHat 安装新版内核不会自动更新引导加载程序为最新内核）</span></span><br><span class="line">    <span class="comment">#如果需要使用其他版本内核可通过执行：egrep ^menuentry /etc/grub2.cfg | cut -f 2 -d \' 命令查看已安装所有版本内核顺序（从0开始，默认最高版本在最前面）</span></span><br><span class="line">grub2-set-default 0</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg	<span class="comment">#用于传统的BIOS引导</span></span><br><span class="line"><span class="comment">#grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg	#用于UEFI引导（如果使用的是 UEFI 引导，则应该更新的是 UEFI GRUB 配置）</span></span><br><span class="line"><span class="comment">#重启服务器以使新版内核生效（必选）</span></span><br><span class="line">reboot</span><br><span class="line"><span class="comment">##删除无用的旧内核版本（可选，为了节省磁盘空间建议删除）</span></span><br><span class="line"><span class="comment">#查看已安装的所有内核版本（仅含yum或rpm管理器安装的包，不含手动编译安装的包）</span></span><br><span class="line">rpm -qa kernel kernel-*</span><br><span class="line"><span class="comment">#确认当前正在使用的内核</span></span><br><span class="line">uname -r</span><br><span class="line"><span class="comment">#删除不需要的内核版本（将 &lt;kernel-package&gt; 替换为要删除的包名）</span></span><br><span class="line">yum remove &lt;kernel-package&gt;</span><br><span class="line"><span class="comment">#更新引导加载程序配置（如果使用 GRUB 引导）</span></span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment">##（2）Ubuntu/Debian</span></span><br><span class="line">	<span class="comment">#参考：https://xanmod.org</span></span><br><span class="line"><span class="comment">#安装 XanMod 源</span></span><br><span class="line">wget -qO - https://dl.xanmod.org/archive.key | gpg --dearmor -o /usr/share/keyrings/xanmod-archive-keyring.gpg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'deb [signed-by=/usr/share/keyrings/xanmod-archive-keyring.gpg] http://deb.xanmod.org releases main'</span> | tee /etc/apt/sources.list.d/xanmod-release.list</span><br><span class="line"><span class="comment">#安装最新版本内核</span></span><br><span class="line">apt update</span><br><span class="line">apt install linux-xanmod-x64v3</span><br><span class="line"><span class="comment">#更新引导加载程序（可选，即设置使用新版内核启动，Ubuntu/Debian 安装新版内核会自动更新引导加载程序为最新内核）</span></span><br><span class="line">    <span class="comment">#通常情况下，新内核的 GRUB 引导项会自动成为默认的引导项。</span></span><br><span class="line">    <span class="comment">#如果需要使用其他版本内核可通过执行：grep 'menuentry' /boot/grub/grub.cfg 命令查看已安装所有版本内核顺序（从0开始，默认最高版本在最前面），然后修改 /etc/default/grub 中的 GRUB_DEFAULT 值（设要修改的内核索引顺序为 2，则修改为：GRUB_DEFAULT="1&gt; 2"），最后执行 update-grub 并 reboot 重启系统即可。参考：https://www.cnblogs.com/zzugyl/p/14588114.html</span></span><br><span class="line">    <span class="comment">#关机重启时一般会进入grub菜单，在菜单中可以选择指定版本的内核启动，如果启动时跳过不展示grub菜单，则可以在启动时按住Shift键或Esc键，直到出现GRUB菜单。</span></span><br><span class="line">update-grub</span><br><span class="line"><span class="comment">#重启服务器以使新版内核生效（必选）</span></span><br><span class="line">reboot</span><br><span class="line"><span class="comment">##删除无用的旧内核版本（可选，为了节省磁盘空间建议删除）</span></span><br><span class="line"><span class="comment">#查看已安装的所有内核版本</span></span><br><span class="line">dpkg --list | grep linux-image</span><br><span class="line"><span class="comment">#确认当前正在使用的内核</span></span><br><span class="line">uname -r</span><br><span class="line"><span class="comment">#删除不需要的内核版本（将 &lt;kernel-package&gt; 替换为要删除的包名）</span></span><br><span class="line">apt purge &lt;kernel-package&gt;</span><br><span class="line"><span class="comment">#更新引导加载程序配置</span></span><br><span class="line">update-grub</span><br></pre></td></tr></table></figure><h5 id="方式三：使用已编译好的二进制包进行安装"><a class="header-anchor" href="#方式三：使用已编译好的二进制包进行安装">¶</a>方式三：使用已编译好的二进制包进行安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这里使用一键脚本安装方式</span></span><br><span class="line">	<span class="comment">#脚本项目地址：https://github.com/ylx2016/Linux-NetSpeed</span></span><br><span class="line">    <span class="comment">#原功能是一键安装 BBR/BBRplus/锐速，可用于升级系统内核</span></span><br><span class="line">    <span class="comment">#支持 CentOS 7/8，Debian/Ubuntu，OracleLinux</span></span><br><span class="line">    <span class="comment">#在国内执行脚本时可能无法正常下载新版内核等文件，故需要挂代理，并执行如下命令：</span></span><br><span class="line">        <span class="comment"># export http_proxy=http://192.168.31.74:1081</span></span><br><span class="line">        <span class="comment"># export https_proxy=http://192.168.31.74:1081</span></span><br><span class="line">    <span class="comment">#安装新版内核只需要选择 1. 安装 BBR原版内核，脚本会自动卸载旧版内核并安装最新版内核</span></span><br><span class="line"><span class="comment">#下载脚本</span></span><br><span class="line">wget -O tcp.sh <span class="string">"https://github.com/ylx2016/Linux-NetSpeed/raw/master/tcp.sh"</span></span><br><span class="line"><span class="comment">#执行脚本</span></span><br><span class="line">chmod +x tcp.sh</span><br><span class="line">./tcp.sh</span><br><span class="line"><span class="comment">#删除脚本（升级完成内核后可选择删除脚本）</span></span><br><span class="line">rm -f ./tcp.sh</span><br></pre></td></tr></table></figure><h5 id="方式四：下载内核源码手动编译安装"><a class="header-anchor" href="#方式四：下载内核源码手动编译安装">¶</a>方式四：下载内核源码手动编译安装</h5><blockquote><p>这种方式可安装最新版或任意版本内核。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、安装依赖</span></span><br><span class="line"><span class="comment">#Debian 系列系统安装所需依赖</span></span><br><span class="line">apt update</span><br><span class="line">apt install build-essential	<span class="comment">#包含 make、gcc、g++ 等基础编译工具</span></span><br><span class="line">apt install libncurses-dev bison flex libssl-dev libelf-dev dwarves bc</span><br><span class="line"></span><br><span class="line"><span class="comment">#RedHat 系列系统安装所需依赖</span></span><br><span class="line">yum groupinstall <span class="string">"Development Tools"</span> <span class="comment">#包含 make、gcc、g++ 等基础编译工具</span></span><br><span class="line">yum install ncurses-devel flex bison openssl openssl-devel elfutils-libelf-devel bc</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、下载指定版本的内核源码并解压	</span></span><br><span class="line">	<span class="comment">#到 Linux 内核官网 https://www.kernel.org 下载指定版本的内核源码包，建议下载 stable（稳定版）或者 longterm（长期维护版）</span></span><br><span class="line">	<span class="comment">#可使用代理下载：wget -e "https_proxy=http://192.168.31.74:1081" https://cdn.kernel.org/pub/linux/kernel/v6.x/linux-6.5.8.tar.xz</span></span><br><span class="line">wget https://cdn.kernel.org/pub/linux/kernel/v6.x/linux-6.5.8.tar.xz </span><br><span class="line">tar xvf linux-6.5.8.tar.xz</span><br><span class="line"><span class="built_in">cd</span> linux-6.5.8</span><br><span class="line"></span><br><span class="line"><span class="comment">#3、配置所编译的内核（交互式操作生成编译配置文件.config）</span></span><br><span class="line">    <span class="comment">#centos7 等 yum 默认安装的 gcc 版本太低可能无法编译新内核，则需要手动安装更新 gcc 版本，建议使用 scl 工具管理多版本 gcc，参考：https://cloud.tencent.com/developer/article/1626791</span></span><br><span class="line">	<span class="comment">#包括驱动、网络、文件系统等等</span></span><br><span class="line">	<span class="comment">#勾选说明：* 表示为编译到内核镜像（主要生成的文件如：arch/x86/boot/bzImage、vmlinux 等），M 表示编译到内核模块，空表示不编译。（内核模块的作用是启动内核镜像时按需从镜像文件外部加载内核模块，这样可以有效减小内核镜像的大小和启动时间）</span></span><br><span class="line">	<span class="comment">#通常执行该命令时会自动参考当前系统内核（即原版本内核，当前系统内核配置：/boot/config-&lt;当前系统内核&gt;）自动勾选配置，也就是说原版本内核有的功能或模块在编译选项里将会被勾选，而如果原本没有则不会自动勾选。故而即使是同一个版本的内核源码在不同内核的 Linux 系统中所展示的默认配置勾选也可能不同。</span></span><br><span class="line">    <span class="comment"># 1）通常使用原版本内核默认勾选的功能配置即可。</span></span><br><span class="line">    <span class="comment"># 2）编译的内核通常都默认带有调试信息，那么内核和模块的文件将会很大，占用很多磁盘空间。建议去除这些内核调试信息，可有效减小内核模块和内核大小，节省存储空间。菜单导航：Kernel hacking -&gt; Compile-time checks and compiler options -&gt; Debug information (Disable debug information)  -&gt; Disable debug information inking，按空格选择设置为 X 表示关闭调试信息，然后选择 Save -&gt; OK</span></span><br><span class="line">    <span class="comment"># 3）如果原本的系统内核功能不满足需求则需要额外勾选配置，常见功能如下：</span></span><br><span class="line">        <span class="comment">#（1）TCP BBR：需要内核为 4.9+，菜单导航：Networking support -&gt; Networking options -&gt; TCP: advanced congestion control -&gt; BBR TCP，按空格选择设置为 M 表示编译到内核模块，然后选择 Save -&gt; OK</span></span><br><span class="line">        <span class="comment">#（2）WireGuard：需要内核版本为 5.6+，菜单导航：Device Drivers -&gt; Network device support -&gt; Network core driver support  -&gt; WireGuard secure network tunnel，按空格选择设置为 M 表示编译到内核模块，然后选择 Save -&gt; OK</span></span><br><span class="line">    <span class="comment">#自定义内核版本名称（可选，如：linux-6.5.8-test，默认为内核原始版本号，如：6.5.8），菜单导航：General setup -&gt; Local version - append to kernel release，输入自定义的内核版本名称并保存即可</span></span><br><span class="line">    <span class="comment"># 4）菜单勾选确定后，选择 Exit 退出，选择 YES 保存配置到当期目录的 .config 文件里。</span></span><br><span class="line">make menuconfig</span><br><span class="line"></span><br><span class="line"><span class="comment">#4、编译内核</span></span><br><span class="line">	<span class="comment">#根据 .config 配置文件选择性进行编译</span></span><br><span class="line">	<span class="comment">#可使用 -j 指定线程数加快编译，或者通过处理器核心数指定线程数：make -j$(nproc)</span></span><br><span class="line">	<span class="comment">#如果之前编译过，再编译则会很快</span></span><br><span class="line">	<span class="comment">#可以通过 make clean 清理编译生成的临时文件（或者使用 make mrproper，区别是 make mrproper 会删除 .config 文件，而 make clean 不会）</span></span><br><span class="line">    <span class="comment">#内核编译时间通常都会比较久（通常需要几个小时，差不多2-3小时左右，计算机配置越高编译会越快，主要是CPU，如果使用虚拟机，最好分配多点核心数，如4个）</span></span><br><span class="line">    <span class="comment">#注意通常要求系统的磁盘剩余空间不低于 25G，否则编译产生的临时文件可能太多导致磁盘不够用而编译失败，建议总磁盘大小 40G 以上，当然，对于精简配置或者去除调试信息的情况对磁盘空间要求更低（如除调试信息的情况就只需要 10G 左右大小的磁盘剩余空间即可）。参考：https://forums.debiancn.org/t/topic/3120</span></span><br><span class="line">make -j4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#5、安装内核</span></span><br><span class="line">make modules_install <span class="comment">#安装内核模块（将相应的内核模块复制到系统/lib/modules/&lt;version&gt;目录里）</span></span><br><span class="line">make install <span class="comment">#安装内核镜像（将.config，vmlinuz，initrd.img（make install时会自动用mkinitramfs生成），System.map复制到系统/boot目录里，得到vmlinuz-&lt;version&gt;、initrd.img-&lt;version&gt;、System.map-&lt;version&gt;、config-&lt;version&gt;）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#6、更新引导加载程序配置</span></span><br><span class="line"><span class="comment">#（1）Ubuntu/Debian</span></span><br><span class="line"><span class="comment">#更新引导加载程序（可选，即设置使用新版内核启动，Ubuntu/Debian 安装新版内核会自动更新引导加载程序为最新内核）</span></span><br><span class="line">    <span class="comment">#通常情况下，新内核的 GRUB 引导项会自动成为默认的引导项。</span></span><br><span class="line">    <span class="comment">#如果需要使用其他版本内核可通过执行：grep 'menuentry' /boot/grub/grub.cfg 命令查看已安装所有版本内核顺序（从0开始，默认最高版本在最前面），然后修改 /etc/default/grub 中的 GRUB_DEFAULT 值（设要修改的内核索引顺序为 2，则修改为：GRUB_DEFAULT="1&gt; 2"），最后执行 update-grub 并 reboot 重启系统即可。参考：https://www.cnblogs.com/zzugyl/p/14588114.html</span></span><br><span class="line">    <span class="comment">#关机重启时一般会进入grub菜单，在菜单中可以选择指定版本的内核启动，如果启动时跳过不展示grub菜单，则可以在启动时按住Shift键或Esc键，直到出现GRUB菜单。</span></span><br><span class="line">update-grub</span><br><span class="line"></span><br><span class="line"><span class="comment">#（2）CentOS/RedHat</span></span><br><span class="line"><span class="comment">#更新引导加载程序（必选，即设置使用新版内核启动，CentOS/RedHat 安装新版内核不会自动更新引导加载程序为最新内核）</span></span><br><span class="line">    <span class="comment">#如果需要使用其他版本内核可通过执行：egrep ^menuentry /etc/grub2.cfg | cut -f 2 -d \' 命令查看已安装所有版本内核顺序（从0开始，默认最高版本在最前面）</span></span><br><span class="line">grub2-set-default 0</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg	<span class="comment">#用于传统的BIOS引导</span></span><br><span class="line"><span class="comment">#grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg	#用于UEFI引导</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#7、启服务器以使新版内核生效（必选）</span></span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#8、卸载编译安装的内核（如需要）</span></span><br><span class="line">	<span class="comment">#将 &lt;version&gt; 替换为对应内核版本号</span></span><br><span class="line"><span class="comment">#删除内核映像文件</span></span><br><span class="line">rm /boot/vmlinuz-&lt;version&gt;</span><br><span class="line">rm /boot/initrd.img-&lt;version&gt;</span><br><span class="line">rm /boot/System.map-&lt;version&gt;</span><br><span class="line">rm /boot/config-&lt;version&gt;</span><br><span class="line"><span class="comment">#删除模块文件</span></span><br><span class="line">	<span class="comment">#提示：实际模块文件在 /usr/lib/modules 目录里，由于 /lib 目录是 /usr/lib 目录的符号链接，故可以通过删除 /lib 里的内容从而实现删除 /usr/lib 里的内容</span></span><br><span class="line">rm -r /lib/modules/&lt;version&gt;</span><br><span class="line"><span class="comment">##更新引导加载程序配置</span></span><br><span class="line"><span class="comment">#Debian 系列系统更新引导加载程序配置（可选）</span></span><br><span class="line">update-grub</span><br><span class="line"><span class="comment">#RedHat 系列系统更新引导加载程序配置（必选）</span></span><br><span class="line">grub2-set-default 0</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg	<span class="comment">#用于传统的BIOS引导</span></span><br><span class="line"><span class="comment">#grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg	#用于UEFI引导</span></span><br><span class="line"><span class="comment">#重启</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><blockquote><p>提示：</p><p>（1）Ubuntu 编译报错提示：<code>make[2]: *** No rule to make target 'debian/canonical-certs.pem', needed by 'certs/x509_certificate_list'</code>（注意这个报错提示可能是出现在上文，应该终端中搜索查询一下），解决办法如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;scripts/config --<span class="built_in">set</span>-str SYSTEM_TRUSTED_KEYS <span class="string">""</span></span><br><span class="line">&gt;scripts/config --<span class="built_in">set</span>-str SYSTEM_REVOCATION_KEYS <span class="string">""</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">##对于Ubuntu，最好在 make menuconfig 执行完成后进行如上操作，防止编译报错</span></span><br></pre></td></tr></table></figure><p>以上命令执行后，然后重新编译。</p><p>参考：<a href="https://askubuntu.com/questions/1329538/compiling-the-kernel-5-11-11%E3%80%82" target="_blank" rel="noopener">https://askubuntu.com/questions/1329538/compiling-the-kernel-5-11-11。</a></p><p>（2）Ubuntu 编译安装内核完成并重启后，出现错误：<code>end Kernel panic - not syncing: System is deadlocked on memory</code>，这个原因通常是因为编译的内核过大，需要更多的内存加载。</p><ul><li>临时解决方法：在虚拟机选项中将内存改大一些，我改成 4GB 再重启就可以了。</li><li>彻底解决办法：减小内核大小，通常是去除内核的调试信息即可。</li></ul><p>（3）编译的内核通常都默认带有调试信息，那么内核和模块的文件将会很大，占用很多磁盘空间。去除这些内核调试信息，可有效减小内核模块和内核大小，节省存储空间。实现方式如下：</p><p>方式1：如果尚未编译，则可以在 <code>make menuconfig</code> 时，在交互菜单界面中选择关闭调试信息，菜单导航：<code>Kernel hacking -&gt; Compile-time checks and compiler options -&gt; Debug information (Disable debug information) -&gt; Disable debug information inking，按空格选择设置为 X 表示关闭调试信息，然后选择 Save -&gt; OK</code>。</p><p>方式2：如果尚未编译，则可以在 <code>make menuconfig</code> 生成<code>.config</code> 文件后，修改其调试参数来去除调试信息，然后再编译。（这种方式编译出来的内核和模块都会占用更小的空间）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;scripts/config --undefine GDB_SCRIPTS</span><br><span class="line">&gt;scripts/config --undefine DEBUG_INFO</span><br><span class="line">&gt;scripts/config --undefine DEBUG_INFO_SPLIT</span><br><span class="line">&gt;scripts/config --undefine DEBUG_INFO_REDUCED</span><br><span class="line">&gt;scripts/config --undefine DEBUG_INFO_COMPRESSED</span><br><span class="line">&gt;scripts/config --<span class="built_in">set</span>-val  DEBUG_INFO_NONE       y</span><br><span class="line">&gt;scripts/config --<span class="built_in">set</span>-val  DEBUG_INFO_DWARF5     n</span><br><span class="line">&gt;scripts/config --<span class="built_in">disable</span> DEBUG_INFO_DWARF_TOOLCHAIN_DEFAULT</span><br></pre></td></tr></table></figure><p>参考：<a href="https://superuser.com/questions/925079/compile-linux-kernel-deb-pkg-target-without-generating-dbg-package" target="_blank" rel="noopener">https://superuser.com/questions/925079/compile-linux-kernel-deb-pkg-target-without-generating-dbg-package</a></p><p>方式3：如果已经编译得到带有调试信息的内核和模块了，那么可以在安装内核和内核模块时加上 <code>INSTALL_MOD_STRIP=1</code> 参数来剥离调试信息，减小内核模块和内核大小，节省存储空间。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="comment">#安装时指定 INSTALL_MOD_STRIP=1 可剥离调试信息，减小内核模块和内核大小，节省存储空间</span></span><br><span class="line">&gt;make INSTALL_MOD_STRIP=1 modules_install</span><br><span class="line">&gt;make INSTALL_MOD_STRIP=1 install</span><br></pre></td></tr></table></figure><p>（4）更多问题和解决办法：<a href="https://blog.51cto.com/u_15127511/4320481" target="_blank" rel="noopener">https://blog.51cto.com/u_15127511/4320481</a></p></blockquote><h5 id="参考"><a class="header-anchor" href="#参考">¶</a>参考</h5><blockquote><ul><li><a href="https://juejin.cn/post/7245668131011838011" target="_blank" rel="noopener">Ubuntu22.04 编译内核</a></li><li><a href="http://kerneltravel.net/blog/2021/compile-kernel/" target="_blank" rel="noopener">Ubuntu18.04 编译内核5.4.0</a></li><li><a href="https://blog.csdn.net/feihe0755/article/details/125424910" target="_blank" rel="noopener">编译Ubuntu 20.04内核代码</a></li><li><a href="https://www.youtube.com/watch?v=uJ4HFAmOQCM" target="_blank" rel="noopener">https://www.youtube.com/watch?v=uJ4HFAmOQCM</a> （Ubuntu 更新内核）</li><li><a href="https://www.youtube.com/watch?v=TVmQhwSWuiM" target="_blank" rel="noopener">https://www.youtube.com/watch?v=TVmQhwSWuiM</a> （CentOS 更新内核，含 NTFS 支持）</li></ul></blockquote><h3 id="5-服务管理"><a class="header-anchor" href="#5-服务管理">¶</a>5. 服务管理</h3><h4 id="1-服务相关概念"><a class="header-anchor" href="#1-服务相关概念">¶</a>1）服务相关概念</h4><p>服务(service) 是一种开机自启动的后台运行程序，也称为守护进程（运行中的程序就叫进程）。通常会在系统启动时自动运行，并一直保持运行状态，以便用户和其他程序可以随时使用。常见的服务程序有 sshd、mysqld、httpd 等。</p><blockquote><p>💁‍♂ 程序的运行模式：</p><p>计算机程序的运行模式是指程序在计算机系统中的运行方式和状态。根据程序的运行模式不同，可以分为以下几种：</p><ol><li>前台模式</li></ol><p>前台模式（Foreground Mode）是指程序需要在用户界面上显示输出信息，等待用户输入或响应操作的模式。这些程序运行时会占用当前终端或图形界面的屏幕空间，并且随着用户的注销或关闭终端而结束。例如，文本编辑器、Web 浏览器、音乐播放器等都是前台模式下运行的程序。</p><ol start="2"><li>后台模式</li></ol><p>后台模式（Background Mode）是指程序不需要在用户界面上显示输出信息，它们会在系统后台默默地执行任务，不会占用当前终端或图形界面的屏幕空间，并且在用户注销或关闭终端时仍然可以继续运行。例如，服务程序、守护进程、定时任务等都是后台模式下运行的程序。</p><ol start="3"><li>守护进程模式</li></ol><p>守护进程模式（Daemon Mode），也称为服务模式（Service Mode），是一种特殊的后台模式，在系统启动时自动启动并一直保持运行状态，以提供某种特定的服务或功能。守护进程通常会监听某个网络端口或 Unix 套接字，等待客户端连接并处理请求。例如，Web 服务器、数据库服务器、邮件服务器等都是守护进程模式下运行的程序。</p><ol start="4"><li>嵌入式模式</li></ol><p>嵌入式模式（Embedded Mode）是指程序被嵌入到其他程序或系统中执行，以完成特定的任务或提供服务。嵌入式模式下运行的程序通常具有轻量化、高效性和实时性等特点，例如，操作系统内核、驱动程序、嵌入式应用程序等都是嵌入式模式下运行的程序。</p><p>总之，计算机程序的运行模式与程序本身的功能、特点和用途密切相关。不同的运行模式可以满足不同的需求和场景，理解这些运行模式对于程序设计、开发和管理都有重要作用。</p><p>💁‍♂ 关于服务程序的补充说明：</p><p>应用程序是否为服务程序，取决于其在系统中的运行模式是否是守护进程模式。也就是说只需设置为守护进程模式的应用程序才是服务程序。有些应用程序在安装时会自动设置为守护进程模式以实现开机程序自启动，并监听某些端口以供用户请求处理。例如通过包管理器默认安装方式安装sshd时（sshd属于openssh-server软件包的组件），会自动设置为守护进程模式以实现开机程序自启动，并监听默认的22端口以供用户通过ssh远程登录。</p></blockquote><h4 id="2-启动框架相关概念"><a class="header-anchor" href="#2-启动框架相关概念">¶</a>2）启动框架相关概念</h4><p>启动框架（Boot framework）是计算机操作系统启动时用于管理和控制服务、程序和进程的一组工具和机制。简单的说：启动框架就是一组服务管理工具。它能够帮助用户在系统启动过程中加载和启动必要的服务和程序，并确保这些服务和程序能够以正确的顺序和方式运行。启动框架包含有一些管理工具用于实现：查看服务运行状态、查看服务自启动状态、启动服务、关闭服务、开启服务自启动（即所谓的设置开机自启动）、关闭服务自启动 等功能。</p><p>在 Linux 操作系统中，启动框架通常被称为引导框架（boot loader），其作用类似于 Windows 系统中的 BOOTMGR 或 NTLDR。启动框架通常会在操作系统内核初始化之后自动启动，并负责加载和管理其他服务和程序。它们还会根据预定义的运行级别或用户自定义的配置来控制有哪些服务、程序和进程需要在系统启动时自动运行。</p><p>常见的启动框架包括：SysVinit、Upstart、Systemd 和 OpenRC 等。</p><blockquote><ol><li>SysVinit：SysVinit 是一种较早的 Linux 启动框架，它使用 <code>/etc/init.d/</code> 目录下的脚本文件来控制系统服务的启动和停止。在 SysVinit 中，服务的运行状态与系统运行级别（runlevel）直接关联，用户可以使用 <code>service</code> 和 <code>chkconfig</code> 等命令来管理服务。</li><li>Upstart：Upstart 是 Canonical 公司开发的一种 Linux 启动框架，其设计目标是提高启动速度并改善系统事件处理。Upstart 使用基于事件的模型代替了传统的 SysVinit 模型，并支持自动重启、故障恢复和进程监控等功能。</li><li>Systemd：Systemd 是一种由 Lennart Poettering 开发的 Linux 启动框架，已经成为许多主流 Linux 发行版的默认启动框架。与 SysVinit 不同，Systemd 使用单一的 <code>.service</code> 文件来描述服务，并支持依赖关系、并行启动、延迟启动和日志记录等功能。用户可以使用 <code>systemctl</code> 命令来管理服务和控制系统状态。</li><li>OpenRC：OpenRC 是 Gentoo Linux 发布版使用的一种 Linux 启动框架，也可以在其他 Linux 发行版中使用。OpenRC 使用 <code>/etc/init.d/</code> 目录下的脚本文件来控制服务的启动和停止，并支持并行启动、依赖关系和自定义运行级别等功能。</li></ol><p>提示：在 CentOS7.0 后 很多应用程序不再使用 SysVinit 而是使用 Systemd 来管理服务。</p></blockquote><h4 id="3-sysvinit-服务管理"><a class="header-anchor" href="#3-sysvinit-服务管理">¶</a>3）SysVinit 服务管理</h4><h5 id="简要概述-v3"><a class="header-anchor" href="#简要概述-v3">¶</a>简要概述</h5><p>SysVinit 是一种较早的 Linux 启动框架，它使用 <code>/etc/init.d/</code> 目录下的脚本文件来控制系统服务的启动和停止。在 SysVinit 中，服务的运行状态与系统运行级别（runlevel）直接关联，用户可以使用 <code>service</code> 和 <code>chkconfig</code> 等命令来管理服务。</p><h5 id="linux系统运行级别的概念"><a class="header-anchor" href="#linux系统运行级别的概念">¶</a>Linux系统运行级别的概念</h5><p>在SysVinit中有Linux系统运行级别的概念，Linux系统运行级别指的是系统启动时所处的运行状态，它决定了哪些服务、进程和资源会被启动或关闭。在 Linux 中，通常使用 SysV 初始化系统来管理运行级别。SysV 初始化系统其提供了 7 个运行级别，如下：</p><blockquote><ul><li>运行级别 0：系统停机状态，即关机。</li><li>运行级别 1：单用户模式，只有 root 用户可以登录终端，通常用于系统修复或恢复。</li><li>运行级别 2：多用户模式，但不带 NFS 功能。</li><li>运行级别 3：完全的多用户模式，通常是支持网络连接的服务器模式。</li><li>运行级别 4：保留，未使用。</li><li>运行级别 5：完全的多用户图形化模式，通常是桌面应用程序运行的模式。</li><li>运行级别 6：系统重启，即重新启动操作系统。</li></ul></blockquote><p>在 Linux 中，Linux 系统的默认运行级别通常是 3 或 5，具体取决于 Linux 发行版和系统配置。如果用户需要修改系统启动时默认的运行级别，可对 <code>/etc/inittab</code> 文件中的 <code>initdefault</code> 参数进行配置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改系统启动时默认的运行级别。配置initdefault参数</span></span><br><span class="line">vi /etc/inittab</span><br><span class="line"><span class="comment">#查看当前系统的运行级别</span></span><br><span class="line">runlevel</span><br></pre></td></tr></table></figure><h5 id="常用命令-service-和-chkconfig-update-rc-d"><a class="header-anchor" href="#常用命令-service-和-chkconfig-update-rc-d">¶</a>常用命令（<code>service</code> 和 <code>chkconfig</code>、<code>update-rc.d</code>）</h5><blockquote><p>提示：<code>service</code> 命令原本是用于管理 SysVinit 初始化管理的服务，但现在很多新系统改用 Systemd 初始化管理服务后，为了兼顾 <code>service</code> 的使用习惯，也同样支持用于管理 Systemd 启动的服务。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看SysVinit管理的服务</span></span><br><span class="line">service --status-all </span><br><span class="line"><span class="comment">#或者：ls -l /etc/init.d</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">service 服务名 start</span><br><span class="line"><span class="comment">#关闭服务</span></span><br><span class="line">service 服务名 stop</span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">service 服务名 restart</span><br><span class="line"><span class="comment">#重载服务配置</span></span><br><span class="line">service 服务名 reload</span><br><span class="line"><span class="comment">#查看服务运行状态</span></span><br><span class="line">service 服务名 status</span><br><span class="line"></span><br><span class="line"><span class="comment">#Debian系列系统</span></span><br><span class="line"><span class="comment">#开启服务自启动（即所谓的设置开机自启动）</span></span><br><span class="line">update-rc.d 服务名 defaults</span><br><span class="line"><span class="comment">#关闭服务自启动（-f: force）</span></span><br><span class="line">update-rc.d -f 服务名 remove</span><br><span class="line"></span><br><span class="line"><span class="comment">#Redhat系列系统</span></span><br><span class="line"><span class="comment">#设置服务的自启动状态（可通过--level指定某运行级别下服务的自启动状态，不指定--level选项则默认作用于所有运行级别）</span></span><br><span class="line">chkconfig --level &lt;level&gt; &lt;service_name&gt; &lt;on|off&gt;	<span class="comment">#如：chkconfig --level 3 httpd on</span></span><br><span class="line"><span class="comment">#开启服务自启动（即所谓的设置开机自启动）</span></span><br><span class="line">chkconfig 服务名 on</span><br><span class="line"><span class="comment">#关闭服务自启动</span></span><br><span class="line">chkconfig 服务名 off</span><br></pre></td></tr></table></figure><blockquote><ul><li><code>service</code>命令详解</li></ul><p><code>service</code> 命令是一种用于管理系统服务的工具。它可以启动、停止、重启以及查询系统服务的状态，作用于 <code>/etc/init.d</code> 目录下的服务脚本。是一种用于管理系统服务的工具。它可以启动、停止、重启以及查询系统服务的状态，作用于 <code>/etc/init.d</code> 目录下的服务脚本。</p><p>基本语法如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;service &lt;service_name&gt; &lt;action&gt;</span><br></pre></td></tr></table></figure><blockquote><p>其中，<code>&lt;service_name&gt;</code> 表示要操作的服务名称，例如 <code>httpd</code>、<code>sshd</code> 等；<code>&lt;action&gt;</code> 表示要执行的操作，例如 <code>start</code>、<code>stop</code>、<code>restart</code>、<code>status</code> 等。</p></blockquote><ul><li><code>chkconfig</code>命令详解</li></ul><p><code>chkconfig</code> 命令是 Linux 系统中用于管理 SysV 初始化脚本的命令之一。它可以让用户方便地设置某个服务在不同运行级别下的启动状态。</p><p>基本语法如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;chkconfig --level &lt;level&gt; &lt;service_name&gt; &lt;on|off&gt;</span><br></pre></td></tr></table></figure><blockquote><p>其中，<code>--level</code> 选项表示要设置的运行级别，例如 <code>3</code> 表示完全的多用户模式，不指定<code>--level</code>选项则默认作用于所有运行级别；<code>&lt;service_name&gt;</code> 表示要操作的服务名称；<code>&lt;on|off&gt;</code> 表示要执行的操作，即将服务设置为启动或停止状态。</p></blockquote><p>实现原理：</p><p>根据<code>/etc/init.d</code>目录的服务脚本创建相应的符号链接（软链接），然后把这个符号链接放到表示不同运行级别的目录里，系统启动时 SysV 根据当前运行级别情况运行对应目录里的服务脚本。</p><p>常规Linux 发行版会把符号链接会被存放在<code>/etc/rcN.d</code> 目录里，RHEL 等一些特定的 Linux 发行版会把符号链接会被存放在<code>/etc/rc.d/rcN.d</code> 目录里。其中N表示运行级别。这些链接文件通常以 <code>K</code> 或 <code>S</code> 字母开头，后面跟着服务名称和数字序列号，例如 <code>K01httpd</code> 或 <code>S99sshd</code>。其中，<code>K</code> 表示停止服务，<code>S</code> 表示启动服务，数字序列号表示启动或停止的先后顺序。</p><p>例如：如果想要在运行级别 3 中启动 Apache 服务，可以将 <code>/etc/init.d/httpd</code> 复制到 <code>/etc/rc3.d</code> 目录，并将其重命名为 <code>S80httpd</code>，命令操作如：<code>cp /etc/init.d/httpd /etc/rc3.d/S80httpd</code>。这样，在系统进入运行级别 3 时，就会自动启动 Apache 服务。</p><p>💁‍♂ 注意：</p><p><code>restart</code>和<code>reload</code>的区别：<code>restart = stop + start</code>，而 <code>reload = 重新读取配置文件</code></p></blockquote><h5 id="自定义服务"><a class="header-anchor" href="#自定义服务">¶</a>自定义服务</h5><p>在 SysVinit 启动框架下自定义服务，可以按照以下步骤进行：</p><ol><li><p>编写服务脚本（启动脚本）</p><p>在 <code>/etc/init.d</code> 目录下创建一个服务脚本文件，文件名为自定义的服务名称。如：<code>/etc/init.d/my_custom_service</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># chkconfig: 345 99 10</span></span><br><span class="line"><span class="comment"># description: My Custom Service</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        /usr/bin/my_custom_service &amp;</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        pkill my_custom_service</span><br><span class="line">        ;;</span><br><span class="line">    restart)</span><br><span class="line">        <span class="variable">$0</span> stop</span><br><span class="line">        sleep 5</span><br><span class="line">        <span class="variable">$0</span> start</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|restart&#125;"</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><blockquote><p>其中，<code>chkconfig: 345 99 10</code> 指定了运行级别和启动顺序。345 表示服务将在运行级别 3、4 和 5 中启动；99 表示启动顺序（数字越小越先启动）；10 表示停止顺序（数字越大越后停止）。</p></blockquote></li><li><p>启用服务</p><p>使用 <code>chkconfig</code> 命令将服务添加到系统启动项，并将其设置为开机自动启动。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /etc/init.d/my_custom_service</span><br><span class="line">chkconfig --add my_custom_service</span><br><span class="line">chkconfig my_custom_service on</span><br></pre></td></tr></table></figure></li><li><p>启动服务</p><p>使用 <code>service</code> 命令启动服务。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service my_custom_service start</span><br></pre></td></tr></table></figure></li></ol><h4 id="4-systemd-服务管理"><a class="header-anchor" href="#4-systemd-服务管理">¶</a>4）Systemd 服务管理</h4><h5 id="简要概述-v4"><a class="header-anchor" href="#简要概述-v4">¶</a>简要概述</h5><p>Systemd 是一种由 Lennart Poettering 开发的 Linux 启动框架，已经成为许多主流 Linux 发行版的默认启动框架。与 SysVinit 不同，Systemd 使用单一的 <code>.service</code> 文件来描述服务，并支持依赖关系、并行启动、延迟启动和日志记录等功能。用户可以使用 <code>systemctl</code> 命令来管理服务和控制系统状态。</p><h5 id="常用命令-systemctl"><a class="header-anchor" href="#常用命令-systemctl">¶</a>常用命令（systemctl）</h5><blockquote><p>提示：<code>systemctl</code> 命令不可以用于管理 <code>SysVinit</code> 启动的服务。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看Systemd管理的服务（Systemd会从以下目录中加载Systemd单元文件，如果存在同名文件，Systemd将使用较高优先级路径里的单元文件配置）</span></span><br><span class="line">ls /etc/systemd/system	<span class="comment">#优先级最高（包含用户自定义的单元文）</span></span><br><span class="line">ls /run/systemd/system	<span class="comment">#比以上优先级低（包含运行时生成的单元文件）</span></span><br><span class="line">ls /lib/systemd/system	<span class="comment">#比以上优先级低（包含Linux系统自带的单元文件和第三方服务安装的单元文件）</span></span><br><span class="line">ls /usr/lib/systemd/system	<span class="comment">#比以上优先级低（默认和/lib/systemd/system文件内容一致）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">systemctl start 服务名</span><br><span class="line"><span class="comment">#关闭服务</span></span><br><span class="line">systemctl stop 服务名</span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">systemctl restart 服务名</span><br><span class="line"><span class="comment">#查看服务运行状态</span></span><br><span class="line">systemctl status 服务名</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看所有服务自启动状态</span></span><br><span class="line">systemctl list-unit-files	<span class="comment">#systemctl list-unit-files | grep 服务名</span></span><br><span class="line"><span class="comment">#开启服务自启动（即所谓的设置开机自启动）</span></span><br><span class="line">systemctl <span class="built_in">enable</span> 服务名</span><br><span class="line"><span class="comment">#关闭服务自启动</span></span><br><span class="line">systemctl <span class="built_in">disable</span> 服务名</span><br><span class="line"><span class="comment">#查询某个服务是否是自启动的</span></span><br><span class="line">systemctl is-enabled 服务名</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看服务日志</span></span><br><span class="line">journalctl -u 服务名</span><br></pre></td></tr></table></figure><blockquote><p>💁‍♂ 说明：</p><p><code>systemctl</code>命令自带有服务自启动管理功能，可直接使用该命令来维护服务的自启动状态。</p><p>💁‍♂ 关于<code>/lib/systemd/system</code> 目录和 <code>/usr/lib/systemd/system</code> 目录默认文件相同的说明：</p><p>在 Linux 操作系统中，<code>/usr/lib</code> 目录和 <code>/lib</code> 目录都是用于存储共享库文件的目录。事实上，<code>/usr/lib</code> 目录中的大部分内容都可以在 <code>/lib</code> 目录中找到相应的文件。这是因为，早期版本的 Linux 发行版将所有的用户空间程序和库文件都安装在 <code>/usr</code> 目录中，而 <code>/lib</code> 目录只包含内核和驱动程序所需的库文件。随着 Linux 发行版的不断发展和演变，为了提高兼容性和可移植性，一些 Linux 发行版开始将某些库文件安装在 <code>/lib</code> 目录中，以避免某些应用程序无法正常工作。但是，出于向后兼容的考虑，又不能将所有的库文件都直接移到 <code>/lib</code> 目录下。这就导致了 <code>/usr/lib</code> 和 <code>/lib</code> 目录中的内容存在大量重复的情况。总之，在现代 Linux 系统中，<code>/usr/lib</code> 目录中的大部分内容都可以在 <code>/lib</code> 目录中找到相应的文件。这是由于历史原因和兼容性考虑所导致的，用户不需要过多关注这个问题，只需要根据需要使用相应的库文件即可。</p></blockquote><h5 id="自定义服务-v2"><a class="header-anchor" href="#自定义服务-v2">¶</a>自定义服务</h5><p>在 Systemd 中管理自定义服务的步骤如下：</p><ol><li><p>编写服务文件</p><p>创建一个描述服务的配置文件，并将其保存到 <code>/etc/systemd/system</code> 目录中，文件名以 <code>.service</code> 结尾。如：<code>my_custom_service.service</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=My Custom Service</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/bin/my_custom_service</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><blockquote><p>Systemd 服务单元文件的一些常见配置选项及其详细说明：</p><ol><li><code>[Unit]</code> 部分：</li></ol><ul><li><code>Description</code>：描述该服务的文字说明。</li><li><code>Documentation</code>：提供有关该服务的文档链接或路径。</li><li><code>Requires</code> 和 <code>Wants</code>：指定该服务所依赖的其他单元，要求它们在该服务之前启动。</li><li><code>After</code>：指定该服务应该在哪些其他单元之后启动。</li></ul><ol start="2"><li><code>[Service]</code> 部分：</li></ol><ul><li><code>Type</code>：指定服务的类型，如 <code>simple</code>、<code>forking</code>、<code>oneshot</code>、<code>dbus</code> 等。</li><li><code>ExecStart</code>：指定启动该服务时要执行的命令或脚本。</li><li><code>ExecStop</code>：指定停止该服务时要执行的命令或脚本。</li><li><code>WorkingDirectory</code>：指定服务的工作目录。</li><li><code>User</code> 和 <code>Group</code>：指定服务运行的用户和组。</li><li><code>Environment</code>：设置服务运行时的环境变量。</li><li><code>Restart</code>：指定服务在异常退出时的重启策略。<ul><li><code>no</code>：表示不进行重启，默认情况下，当服务停止或退出时不会自动重启。</li><li><code>on-failure</code>：表示仅在服务发生非正常的退出（即退出状态不为零）时才重启。这是默认的重启策略。</li><li><code>always</code>：表示无论服务退出的状态如何（无论是正常还是非正常），都进行重启。</li><li><code>on-abnormal</code>：表示仅在服务发生异常退出时才重启，例如由于收到未捕获的信号导致服务终止。</li><li><code>on-success</code>：表示仅在服务正常退出（即退出状态为零）时才重启。</li><li><code>on-watchdog</code>：表示仅在由 Systemd 监控的 watchdog 定时器触发时才重启。</li><li><code>on-abort</code>：表示仅在服务启动过程中遇到致命错误时才重启。</li></ul></li><li><code>RestartSec</code>：指定在重启服务之前等待的时间间隔。</li><li><code>ExecReload</code>：指定重新加载服务时要执行的命令或脚本。</li></ul><ol start="3"><li><code>[Install]</code> 部分：</li></ol><ul><li><code>WantedBy</code>：指定该服务应该在哪些目标（target）中启用。通常为 <code>multi-user.target</code> 或类似的目标。</li></ul></blockquote></li><li><p>重新加载 Systemd 配置</p><p>使用 <code>systemctl</code> 命令重新加载 Systemd 配置，使之生效。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure></li><li><p>启用开机自启动</p><p>使用 <code>systemctl</code> 命令将服务添加到开机自启动项，并设置为开机自动启动。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> my_custom_service.service</span><br></pre></td></tr></table></figure></li><li><p>启动服务</p><p>使用 <code>systemctl</code> 命令启动服务。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start my_custom_service.service</span><br></pre></td></tr></table></figure><p>至此，自定义服务已经成功地添加到 Linux 系统中，并且可以通过 <code>systemctl</code> 命令来管理它。</p></li></ol><blockquote><p>需要注意的是，在编写服务文件时，要遵循规范，确保服务能够正确地启动、停止和重启。在使用 Systemd 进行服务管理时，还可以使用其他一些命令来管理服务，例如 <code>systemctl stop</code>、<code>systemctl restart</code>、<code>systemctl status</code> 和 <code>journalctl</code> 等。</p></blockquote><h3 id="6-分配-swap-空间"><a class="header-anchor" href="#6-分配-swap-空间">¶</a>6. 分配 swap 空间</h3><h4 id="简要概述-v5"><a class="header-anchor" href="#简要概述-v5">¶</a>简要概述</h4><p>在安装 Linux 系统时在分区时可以分配 swap 空间（交换空间，即虚拟内存），而系统安装后（在运行中）如何创建或调整 swap 空间呢？</p><p>在装完 Linux 系统之后，分配 swap 空间有两种方式。</p><blockquote><p>提示：可通过命令 <code>free -h</code> 查看当前系统的 swap 空间大小。</p></blockquote><h4 id="方式1：新建磁盘分区作为-swap-分区"><a class="header-anchor" href="#方式1：新建磁盘分区作为-swap-分区">¶</a>方式1：新建磁盘分区作为 swap 分区</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#停止所有的 swap 分区</span></span><br><span class="line">swapoff -a</span><br><span class="line"><span class="comment"># 用 fdisk 命令对某个磁盘进行分区，添加 swap 分区，新建分区，在 fdisk 中用 t 命令将新添的分区 id 改为 82（Linux swap 类型），最后用 w 将操作实际写入硬盘（没用 w 之前的操作是无效的）。如下：</span></span><br><span class="line">fdisk /dev/sdb</span><br><span class="line"><span class="comment">#格式化 swap 分区，这里的 sdb2 要看加完后 p 命令显示的实际分区设备名</span></span><br><span class="line">mkswap /dev/sdb2</span><br><span class="line"><span class="comment">#激活启用新的 swap 分区</span></span><br><span class="line">swapon /dev/sdb2</span><br><span class="line"><span class="comment">#为了让系统启动时能自动启用这个交换分区，可以编辑 /etc/fstab 加入下面一行</span></span><br><span class="line">/dev/sdb2 swap swap defaults 0 0</span><br><span class="line"><span class="comment"># 启用 /etc/fstab 里的所有 swap 分区（可选）</span></span><br><span class="line"><span class="comment"># swapon -a</span></span><br></pre></td></tr></table></figure><p>停用 swap 分区，操作如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#停用指定 swap 分区</span></span><br><span class="line">swapoff /dev/sdb2</span><br><span class="line"><span class="comment">#删除或注释 /etc/fstab 中之前添加的相关挂载 swap 分区的开机自启动内容</span></span><br><span class="line"><span class="comment">#/dev/sdb2 swap swap defaults 0 0</span></span><br></pre></td></tr></table></figure><h4 id="方式2：用虚拟磁盘分区作为-swap-分区-推荐"><a class="header-anchor" href="#方式2：用虚拟磁盘分区作为-swap-分区-推荐">¶</a>方式2：用虚拟磁盘分区作为 swap 分区（推荐）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建一个新的虚拟磁盘分区（即文件）</span></span><br><span class="line">mkdir /swap</span><br><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/swap/swapfile bs=1M count=1024	<span class="comment">#大小可自己调整（文件大小 = bs * count）</span></span><br><span class="line"><span class="comment">#格式化为交换分区文件</span></span><br><span class="line">mkswap /swap/swapfile <span class="comment">#设置拟磁盘分区的文件系统</span></span><br><span class="line"><span class="comment">#设置文件权限（可选）</span></span><br><span class="line">chmod 600 /swap/swapfile</span><br><span class="line"><span class="comment">#激活启用新的 swap 分区</span></span><br><span class="line">swapon /swap/swapfile</span><br><span class="line"><span class="comment">#使系统开机时自启用，可以编辑 /etc/fstab 加入下面一行</span></span><br><span class="line">/swap/swapfile swap swap defaults 0 0</span><br></pre></td></tr></table></figure><blockquote><p>提示：系统的 swap 空间总容量由一个或多个 swap 分区来共同组成，停掉某些 swap 分区，系统的 swap 空间总容量也会随着减少掉相应的大小。所以想要增加 swap 空间总容量，只需要创建激活 swap 分区即可，减少容量则关停并删除某些 swap 分区即可</p></blockquote><p>停用 swap 分区，操作如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#停用指定 swap 分区</span></span><br><span class="line">swapoff /swap/swapfile</span><br><span class="line"><span class="comment">#删除 swap 分区文件</span></span><br><span class="line">rm /swap/swapfile</span><br><span class="line"><span class="comment">#删除或注释 /etc/fstab 中之前添加的相关挂载 swap 分区的开机自启动内容</span></span><br><span class="line"><span class="comment">#/swap/swapfile swap swap defaults 0 0</span></span><br></pre></td></tr></table></figure><h4 id="参考-v2"><a class="header-anchor" href="#参考-v2">¶</a>参考</h4><blockquote><ul><li><a href="https://blog.csdn.net/lovemysea/article/details/78306558" target="_blank" rel="noopener">https://blog.csdn.net/lovemysea/article/details/78306558</a></li><li><a href="https://www.jianshu.com/p/30cd53ed056c" target="_blank" rel="noopener">https://www.jianshu.com/p/30cd53ed056c</a></li></ul></blockquote><h2 id="九-网络管理"><a class="header-anchor" href="#九-网络管理">¶</a>九、网络管理</h2><h3 id="1-查看网卡配置信息-ifconfig"><a class="header-anchor" href="#1-查看网卡配置信息-ifconfig">¶</a>1. 查看网卡配置信息 <code>ifconfig</code></h3><p><code>ifconfig</code> 可以查看当前的网卡配置信息（主要含网卡名称、IP 信息等）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看网卡配置信息</span></span><br><span class="line">ifconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看网卡对应的 IP 地址</span></span><br><span class="line">ifconfig | grep inet</span><br></pre></td></tr></table></figure><blockquote><p>提示：一台计算机中有可能会有一个 <strong>物理网卡</strong> 和 <strong>多个虚拟网卡</strong>，在 Linux 中物理网卡的名字通常以 <code>ensXX</code> 表示</p></blockquote><p>网卡是一个专门负责网络通讯的硬件设备。IP 地址是设置在网卡上的地址信息。每台联网的电脑上都有 P 地址，是保证电脑之间正常通讯的重要设置。</p><blockquote><p>我们可以把 <strong>电脑</strong> 比作 <strong>电话</strong>，<strong>网卡</strong> 相当于 <strong>SIM 卡</strong>，<strong>IP 地址</strong> 相当于 <strong>电话号码</strong></p><p>注意：每台电脑的 IP 地址不能相同，否则会出现 IP 地址冲突，并且没有办法正常通讯</p><p><code>127.0.0.1</code> 被称为 <strong>本地回环/环回地址</strong>，一般用来测试本机网卡是否正常</p></blockquote><h3 id="2-检测网络连通性-ping-和-telnet"><a class="header-anchor" href="#2-检测网络连通性-ping-和-telnet">¶</a>2. 检测网络连通性 <code>ping 和 telnet</code></h3><p><code>ping</code> 一般用于检测当前计算机到目标计算机之间的网络是否连通，time数值越大，速度越慢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 测试 IP 连通性</span></span><br><span class="line"><span class="comment"># 检测到目标主机是否连接正常</span></span><br><span class="line">ping IP地址</span><br><span class="line"><span class="comment"># ping 本机 IP</span></span><br><span class="line">ping baidu.com</span><br><span class="line">ping 127.0.0.1 <span class="comment">#等同：ping localhost</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 测试端口连通性</span></span><br><span class="line">	<span class="comment">#在 telnet 会话连通后，如果不自动退出，需输入 Ctrl+] 组合键，在出现的提示符下输入 quit，然后按 Enter 键即可退出。</span></span><br><span class="line">telnet IP地址 端口</span><br><span class="line">telnet baidu.com 443</span><br></pre></td></tr></table></figure><blockquote><p><code>ping</code> 的工作原理与潜水艇的声纳相似，<code>ping</code> 这个命令就是取自 <strong>声纳的声音</strong></p><p>网络管理员之间也常将 <code>ping</code> 用作动词 —— <strong>ping 一下计算机X，看他是否开着</strong></p></blockquote><p>原理：网络上的机器都有 <strong>唯一确定的 IP 地址</strong>，我们给<strong>目标 IP 地址</strong>发送一个数据包，对方就要返回一个数据包，根据返回的数据包以及时间，我们可以确定目标主机的存在</p><blockquote><p>提示：在 Linux 中，想要终止一个终端程序的执行，绝大多数都可以使用 <code>CTRL + C</code></p></blockquote><h3 id="3-配置主机名"><a class="header-anchor" href="#3-配置主机名">¶</a>3. 配置主机名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看主机名</span></span><br><span class="line">hostname</span><br><span class="line"></span><br><span class="line"><span class="comment">##持久化修改主机名</span></span><br><span class="line"><span class="comment">#方式1（推荐）：</span></span><br><span class="line">hostnamectl <span class="built_in">set</span>-hostname <span class="string">"主机名称"</span></span><br><span class="line"><span class="comment">#如：hostnamectl set-hostname "centos7-test"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#方式2：</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"主机名称"</span> &gt; /etc/hostname</span><br><span class="line"><span class="comment">#如：echo "centos7-test" &gt; /etc/hostname</span></span><br><span class="line">reboot	<span class="comment">#注意，如果修改配置文件的方式设置主机名，则需要重启系统</span></span><br></pre></td></tr></table></figure><h3 id="4-配置-hosts-映射"><a class="header-anchor" href="#4-配置-hosts-映射">¶</a>4. 配置 hosts 映射</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑/etc/hosts然后配置ip和对应域名即可</span></span><br><span class="line">vim /etc/hosts</span><br></pre></td></tr></table></figure><h3 id="5-配置主机-ip"><a class="header-anchor" href="#5-配置主机-ip">¶</a>5. 配置主机 IP</h3><h4 id="1-配置临时-ip"><a class="header-anchor" href="#1-配置临时-ip">¶</a>1）配置临时 IP</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##设置临时IP（ifconfig 命令）</span></span><br><span class="line">	<span class="comment">#ifconfig 命令设置IP，会把替换掉原网络接口的IP</span></span><br><span class="line">	<span class="comment">#&lt;interface_name&gt; 为网络接口名称（如：eth0 或 ens33 等，可通过执行 ip addr 命令查看）</span></span><br><span class="line">	<span class="comment">#格式：ifconfig &lt;interface_name&gt; &lt;IP&gt;/&lt;子网掩码&gt; 或者 ifconfig &lt;interface_name&gt; &lt;IP&gt; netmask &lt;子网掩码&gt;</span></span><br><span class="line"><span class="comment">#示例：</span></span><br><span class="line"><span class="comment"># 首先，禁用网络接口（如果已经启用）</span></span><br><span class="line">ifconfig ens33 down</span><br><span class="line"><span class="comment"># 配置IP地址和子网掩码</span></span><br><span class="line">ifconfig ens33 192.168.60.100/24</span><br><span class="line"><span class="comment"># 启用网络接口</span></span><br><span class="line">ifconfig ens33 up</span><br><span class="line"></span><br><span class="line"><span class="comment">#临时设置网关IP</span></span><br><span class="line">	<span class="comment">#格式：ip route add default via &lt;gateway_ip&gt;</span></span><br><span class="line">	<span class="comment">#或者：route add default gw &lt;gateway_ip&gt;（一些旧版的Linux系统仅支持route add default gw &lt;gateway_ip&gt;）</span></span><br><span class="line">ip route add default via 192.168.60.2</span><br><span class="line"></span><br><span class="line"><span class="comment">#临时设置DNS服务器</span></span><br><span class="line">	<span class="comment">#格式：echo "nameserver &lt;dns-ip&gt;" &gt;&gt; /etc/resolv.conf</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"nameserver 8.8.8.8"</span> &gt;&gt; /etc/resolv.conf</span><br></pre></td></tr></table></figure><p>其他相关命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##添加临时IP（ip addr add 命令）</span></span><br><span class="line">	<span class="comment">#ip addr add 命令用于添加IP（即如果之前网络接口已经存在默认IP，则该命令会在保留原IP的情况下添加一个新的IP，使得多个IP可用）</span></span><br><span class="line">	<span class="comment">#&lt;interface_name&gt; 为网络接口名称（如：eth0 或 ens33 等，可通过执行 ip addr 命令查看）</span></span><br><span class="line">	<span class="comment">#格式：ip addr add &lt;IP&gt;/&lt;子网掩码&gt; dev &lt;interface_name&gt;</span></span><br><span class="line"><span class="comment">#示例：</span></span><br><span class="line">ip addr add 192.168.60.100/24 dev ens33</span><br><span class="line"></span><br><span class="line"><span class="comment">##移除临时IP（ip addr del 命令）</span></span><br><span class="line">	<span class="comment">#&lt;interface_name&gt; 为网络接口名称（如：eth0 或 ens33 等，可通过执行 ip addr 命令查看）</span></span><br><span class="line">	<span class="comment">#格式：ip addr del &lt;IP&gt;/&lt;子网掩码&gt; dev &lt;interface_name&gt;</span></span><br><span class="line"><span class="comment">#示例：</span></span><br><span class="line">ip addr del 192.168.60.100/24 dev ens33</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#还原IP（重启网络接口方式）</span></span><br><span class="line">	<span class="comment">#&lt;interface_name&gt; 为网络接口名称（如：eth0 或 ens33 等，可通过执行 ip addr 命令查看）</span></span><br><span class="line">ifconfig &lt;interface_name&gt; down</span><br><span class="line">ifconfig &lt;interface_name&gt; up</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line"><span class="comment">#ip link set &lt;interface_name&gt; down</span></span><br><span class="line"><span class="comment">#ip link set &lt;interface_name&gt; up</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#还原IP（重启网络服务方式）</span></span><br><span class="line">service network restart</span><br></pre></td></tr></table></figure><h4 id="2-配置静态-ip"><a class="header-anchor" href="#2-配置静态-ip">¶</a>2）配置静态 IP</h4><blockquote><p>说明：静态 IP 即重启系统或者网络后不会改变的 IP。</p></blockquote><h5 id="一-环境准备"><a class="header-anchor" href="#一-环境准备">¶</a>（一）环境准备</h5><p>如果 Linux 系统设置自动配置网络 IP （即 DHCP），那么虚拟机系统的 IP 将会默认由网关动态随机分配，所以重启系统或者网络的情况，这个 IP 可能会发生改变。如果希望重启系统或者网络后 IP 固定不变的话，则需要手动对网卡配置固定的静态 IP。</p><p>（1）确定要配置静态 IP 的子网、子网掩码、网关 IP</p><blockquote><p>要配置静态 IP 就要提前先确定静态 IP 的子网、子网掩码、网关 IP。这里以 VMware 的 Linux 虚拟机在 NAT 模式下配置静态 IP 为例进行讲解，操作如下：</p></blockquote><ul><li>确定子网：</li></ul><p>对于 NAT 模式，VMware 使用 VMnet8 这个宿主机虚拟网卡来管理 IP 的，其默认子网在安装 VMware 时初始化为一个默认值，通常为 <code>192.168.x.0</code>（如：<code>192.168.60.0</code>），不同设备该值可能不同，具体可以通过查看宿主机的 VMnet8 网卡配置来确定，或者在 VMware 的 “虚拟网络编辑器” 中查看，操作如下：</p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1563982742714.png" alt="1548175001833"></p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/image-20240108131350157.png" alt="image-20240108131350157"></p><blockquote><p>提示：</p><ul><li>如对默认设置的子网不满意，则可以点击 “更改设置” 来进行修改，修改子网后，网关 IP 也会自动跟着改变。</li><li>如果发现虚拟网络配置的子网段和宿主机的 VMnet8 网卡的配置不一致，需要点击 “更改设置” 以修改为同网段。</li></ul></blockquote><ul><li>确定子网掩码：</li></ul><p>子网掩码默认都为 <code>255.255.255.0</code></p><ul><li>确定网关 IP：</li></ul><p>默认 VMnet8 的网关 IP 为子网的一个 IP，通常为 <code>x.x.x.2</code>（如：<code>192.168.60.2</code>）</p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/image-20220504030250858.png" alt="image-20220504030250858"></p><p>（2）配置虚拟机的网络连接方式为&quot; NAT 模式&quot;。</p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/image-20200423025556615.png" alt="image-20200423025556615"></p><p>（3）进入 Linux 虚拟机终端，编辑 Linux 网卡配置文件，对于不同发行版 Linux 的网卡配置文件路径和名称可能不同，可通过<code>ifconfig</code>命令来查看网卡名称。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ifconfig</span></span><br><span class="line"><span class="comment"># ens33 即网卡名称</span></span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.60.112  netmask 255.255.255.0  broadcast 192.168.60.255</span><br><span class="line">        inet6 fe80::20c:29ff:fe09:6067  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:09:60:67  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 256  bytes 39985 (39.0 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 151  bytes 19628 (19.1 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 0  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><p>然后编辑网卡配置文件</p><blockquote><ul><li>Red Hat 系列系统的配置文件路径为：<code>/etc/sysconfig/network-scripts/ifcfg-&lt;网络接口名称&gt;</code>（如：<code>/etc/sysconfig/network-scripts/ifcfg-ens33</code>）</li><li>Debian 系统的配置文件路径为：<code>/etc/network/interfaces</code></li><li>Ubuntu 系统的配置文件路径为：<code>/etc/netplan/&lt;xxx&gt;-config.yaml</code>（如：<code>/etc/netplan/00-installer-config.yaml</code>）</li></ul></blockquote><h5 id="二-red-hat-centos-系统配置静态-ip"><a class="header-anchor" href="#二-red-hat-centos-系统配置静态-ip">¶</a>（二）Red Hat / CentOS 系统配置静态 IP</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-&lt;网络接口名称&gt;</span><br><span class="line"><span class="comment">#如：vi /etc/sysconfig/network-scripts/ifcfg-ens33</span></span><br></pre></td></tr></table></figure><p>修改如下:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">TYPE="Ethernet"</span><br><span class="line">PROXY_METHOD="none"</span><br><span class="line">BROWSER_ONLY="no"</span><br><span class="line"><span class="deletion">-BOOTPROTO="dhcp"</span></span><br><span class="line"><span class="addition">+BOOTPROTO="static"</span></span><br><span class="line">DEFROUTE="yes"</span><br><span class="line">IPV4_FAILURE_FATAL="no"</span><br><span class="line">IPV6INIT="yes"</span><br><span class="line">IPV6_AUTOCONF="yes"</span><br><span class="line">IPV6_DEFROUTE="yes"</span><br><span class="line">IPV6_FAILURE_FATAL="no"</span><br><span class="line">IPV6_ADDR_GEN_MODE="stable-privacy"</span><br><span class="line">NAME="ens33"</span><br><span class="line">UUID="4f676de2-5673-431b-b8fc-2dc4ad9accfc"</span><br><span class="line">DEVICE="ens33"</span><br><span class="line"><span class="deletion">-ONBOOT="no"</span></span><br><span class="line"><span class="addition">+ONBOOT="yes"</span></span><br><span class="line"><span class="addition">+IPADDR="192.168.60.100"</span></span><br><span class="line"><span class="addition">+GATEWAY="192.168.60.2"</span></span><br><span class="line"><span class="addition">+NETMASK="255.255.255.0"</span></span><br><span class="line"><span class="addition">+DNS1="223.5.5.5"</span></span><br><span class="line"><span class="addition">+DNS2="8.8.8.8"</span></span><br></pre></td></tr></table></figure><blockquote><p>💡 提示：网卡配置文件里的变量可能不同系统的也不同。但是以上修改的部分是必须的。</p><p>📚 主要变量说明：</p><ul><li>HWADDR：表示mac地址</li><li>TYPE：网络类型</li><li>BOOTPROTO：表示为网卡配置静态还是动态IP地址(none:表示无须启动协议；bootp:表示使用BOOTP协议；dhcp ：使用dhcp协议动态获取ip地址； static：表示手工设置静态IP地址)</li><li>ONBOOT：表示启动系统时是否激活网卡，yes为激活，no不激活（如果默认为no需要改成yes）</li><li>HWADDR：表示网卡的MAC地址</li><li>GATEWAY：表示该网关地址。填虚拟虚拟机网卡VMnet8对应的网关ip。</li><li>NETMASK：表示子网掩码。填填和VMnet8对于的子网掩码</li><li>IPADDR：表示网卡的静态IP地址。比如上面的网关是192.168.60.2并且子网掩码是255.255.255.0，那么表示固定ip的值需要是192.168.60.x（这个x是除了网关外3~254的任意数填，其中0表示网络，255一般用来做掩码，而1和2已经被VMnet8使用，所以0、1、2和255不用）</li><li>DNS1（可选）：表示第一个DNS服务器的地址。值可以是任意能使用的dns ip地址（用于解析域名）。这里使用google通过的dns ip<code>8.8.8.8</code>即可。（注意：如果 Vmware 虚拟机使用“仅主机模式”的话，不要设置 DNS ，否则可能会出现 SSH 登录超时的问题。）</li><li>DNS2（可选）：表示第二个DNS服务器的地址。</li></ul></blockquote><p>重启网络服务以生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重启网络服务</span></span><br><span class="line">service network restart</span><br><span class="line"><span class="comment">#如果上面命令重启 ip 没变，可以尝试重启系统试试</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><blockquote><p>执行后如果报如下错误：<br>Restarting network (via systemctl): Job for network.service failed because the control process exited with error code. See “systemctl status network.service” and “journalctl -xe” for details.</p><p>💁‍♂ 出现上面错误的大概率是mac地址和vmware配置的不一致。如下一定要一致：</p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/image-20220504023438615.png" alt="image-20220504023438615"></p></blockquote><h5 id="三-debian-系统配置静态-ip"><a class="header-anchor" href="#三-debian-系统配置静态-ip">¶</a>（三）Debian 系统配置静态 IP</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/network/interfaces</span><br></pre></td></tr></table></figure><p>配置内容如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This file describes the network interfaces available on your system</span></span><br><span class="line"><span class="comment"># and how to activate them. For more information, see interfaces(5).</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/network/interfaces.d/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># The loopback network interface</span></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line"><span class="comment"># The primary network interface</span></span><br><span class="line"><span class="comment">#allow-hotplug ens33</span></span><br><span class="line"><span class="comment">#iface ens33 inet dhcp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#允许网卡接口热插拔</span></span><br><span class="line">allow-hotplug ens33</span><br><span class="line"><span class="comment">#开机启动时自动激活网卡接口</span></span><br><span class="line">auto ens33</span><br><span class="line"></span><br><span class="line"><span class="comment">#static表示使用固定IP，dhcp表述使用动态IP</span></span><br><span class="line"><span class="comment">#iface ens33 inet dhcp</span></span><br><span class="line">iface ens33 inet static</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置静态IP地址</span></span><br><span class="line">address 192.168.60.201</span><br><span class="line"><span class="comment">#设置子网掩码</span></span><br><span class="line">netmask 255.255.255.0</span><br><span class="line"><span class="comment">#设置网关</span></span><br><span class="line">gateway 192.168.60.2</span><br><span class="line"><span class="comment">#设置DNS服务器（可选）</span></span><br><span class="line">dns-nameservers 223.5.5.5 8.8.8.8</span><br></pre></td></tr></table></figure><p>重启网络服务以生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重启网络服务</span></span><br><span class="line">service networking restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果上面命令重启 ip 没变，可以尝试重启系统试试</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h5 id="四-ubuntu-系统配置静态-ip"><a class="header-anchor" href="#四-ubuntu-系统配置静态-ip">¶</a>（四）Ubuntu 系统配置静态 IP</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/netplan/&lt;xxx&gt;-config.yaml</span><br><span class="line"><span class="comment">#如：vi /etc/netplan/00-installer-config.yaml</span></span><br></pre></td></tr></table></figure><p>配置内容如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">networkd</span> <span class="comment">#指定后端采用systemd-networkd或者Network Manager，可不填写则默认使用systemd-workd</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">ens33:</span> <span class="comment">#配置的网卡的名称</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">no</span> <span class="comment">#关闭DHCP，如果需要打开DHCP则写yes</span></span><br><span class="line">      <span class="comment">#dhcp6: no</span></span><br><span class="line">      <span class="attr">addresses:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.60</span><span class="number">.130</span><span class="string">/24</span> <span class="comment">#配置的静态ip地址和掩码</span></span><br><span class="line">        <span class="comment">#- 可配置 IPV6 地址</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">to:</span> <span class="string">default</span></span><br><span class="line">          <span class="attr">via:</span> <span class="number">192.168</span><span class="number">.60</span><span class="number">.2</span> <span class="comment">#网关地址</span></span><br><span class="line">      <span class="attr">nameservers:</span></span><br><span class="line">        <span class="attr">addresses:</span> <span class="string">[223.5.5.5,</span> <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span><span class="string">]</span> <span class="comment">#DNS服务器地址，多个DNS服务器地址需要用英文逗号分隔开</span></span><br></pre></td></tr></table></figure><p>重新加载配置以生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netplan apply</span><br></pre></td></tr></table></figure><blockquote><p>参考：</p><ul><li><a href="https://www.cnblogs.com/liujiaxin2018/p/16287463.html" target="_blank" rel="noopener">https://www.cnblogs.com/liujiaxin2018/p/16287463.html</a></li><li><a href="https://code84.com/810353.html" target="_blank" rel="noopener">https://code84.com/810353.html</a></li><li><a href="https://www.myfreax.com/how-to-configure-static-ip-address-on-ubuntu-20-04/" target="_blank" rel="noopener">https://www.myfreax.com/how-to-configure-static-ip-address-on-ubuntu-20-04/</a></li><li><a href="https://ld246.com/article/1593929878472" target="_blank" rel="noopener">https://ld246.com/article/1593929878472</a></li></ul></blockquote><h5 id="五-rocky-linux-系统配置静态-ip"><a class="header-anchor" href="#五-rocky-linux-系统配置静态-ip">¶</a>（五）Rocky Linux 系统配置静态 IP</h5><blockquote><p>参考：</p><p>网卡配置文件修改法：</p><ul><li><a href="https://www.cnblogs.com/liujiaxin2018/p/17379440.html" target="_blank" rel="noopener">https://www.cnblogs.com/liujiaxin2018/p/17379440.html</a></li><li><a href="https://docs.rockylinux.org/zh/gemstones/network/RL9_network_manager/#_2" target="_blank" rel="noopener">https://docs.rockylinux.org/zh/gemstones/network/RL9_network_manager/#_2</a></li></ul><p>交互式配置法：</p><ul><li><a href="https://docs.rockylinux.org/zh/guides/network/basic_network_configuration/" target="_blank" rel="noopener">https://docs.rockylinux.org/zh/guides/network/basic_network_configuration/</a></li></ul></blockquote><h3 id="6-配置-dns-服务器"><a class="header-anchor" href="#6-配置-dns-服务器">¶</a>6. 配置 DNS 服务器</h3><h4 id="1-公共-dns-服务器介绍"><a class="header-anchor" href="#1-公共-dns-服务器介绍">¶</a>1）公共 DNS 服务器介绍</h4><p>国内的常用 DNS 服务</p><blockquote><ul><li><a href="http://www.alidns.com/" target="_blank" rel="noopener">阿里云公共 DNS</a>：<ul><li>IPv4：<code>223.5.5.5</code>、 <code>223.6.6.6</code></li><li>IPv6：<code>2400:3200::1</code>、<code>2400:3200:baba::1</code></li></ul></li><li><a href="https://www.dnspod.cn/Products/Public.DNS" target="_blank" rel="noopener">腾讯云公共 DNS</a>：<ul><li>IPv4：<code>119.29.29.29</code>、<code>119.28.28.28</code></li><li>IPv6：<code>2402:4e00::</code>、<code>2402:4e00:1::</code> （<a href="https://docs.dnspod.cn/public-dns/linux-public-dns/" target="_blank" rel="noopener">参考</a>）</li></ul></li><li><a href="https://www.114dns.com/" target="_blank" rel="noopener">南京信风公共 DNS | 114DNS</a>：<ul><li>IPv4：<code>114.114.114.114</code>、<code>114.114.115.115</code></li><li>IPv6：暂无</li></ul></li><li><a href="https://dudns.baidu.com/" target="_blank" rel="noopener">百度公共 DNS</a>：<ul><li>IPv4：<code>180.76.76.76</code></li><li>IPv6：<code>2400:da00::6666</code></li></ul></li><li><a href="https://tuna.moe/help/dns/" target="_blank" rel="noopener">清华大学 TUNA 协会公共 DNS | DNS666</a>：<ul><li>IPv4：<code>101.6.6.6</code></li><li>IPv6：<code>2001:da8::666</code></li></ul></li></ul></blockquote><p>国外常用 DNS 服务</p><blockquote><ul><li><a href="https://developers.google.com/speed/public-dns/" target="_blank" rel="noopener">Google Public DNS</a>：<ul><li>IPv4：<code>8.8.8.8</code>、<code>8.8.4.4</code></li><li>IPv6：<code>2001:4860:4860::8888</code>、<code>2001:4860:4860::8844</code></li></ul></li><li><a href="https://1.1.1.1" target="_blank" rel="noopener">Cloudflare DNS</a>：<ul><li>IPv4：<code>1.0.0.1</code>、<code>1.1.1.1</code></li><li>IPv6：<code>2606:4700:4700::1111</code>、<code>2606:4700:4700::1001</code></li></ul></li><li><a href="https://www.opendns.com/" target="_blank" rel="noopener">OpenDNS</a>：<ul><li>IPv4：<code>208.67.222.222</code>、<code>208.67.220.220</code></li><li>IPv6：<code>2620:119:35::35</code>、<code>2620:119:53::53</code> （<a href="https://status.umbrella.com" target="_blank" rel="noopener">参考</a>）</li></ul></li></ul></blockquote><p>最佳实践推荐：解析国内站点推荐使用阿里 DNS 和腾讯 DNSPod（注重稳定请用前者、注重准确请用后者）；解析海外网站推荐主 DNS <code>1.0.0.1</code> 或 <code>208.67.222.222</code>，备 DNS <code>8.8.8.8</code> 或 <code>8.8.4.4</code></p><blockquote><p>参考：</p><ul><li><a href="https://www.51cto.com/article/715641.html" target="_blank" rel="noopener">https://www.51cto.com/article/715641.html</a></li><li><a href="https://www.bilibili.com/read/cv24699923/" target="_blank" rel="noopener">https://www.bilibili.com/read/cv24699923/</a></li></ul></blockquote><h4 id="2-查看当前使用的-dns-服务器"><a class="header-anchor" href="#2-查看当前使用的-dns-服务器">¶</a>2）查看当前使用的 DNS 服务器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##查看当前使用的 DNS 服务器（通用命令）</span></span><br><span class="line">cat /etc/resolv.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">##查看当前使用的 DNS 服务器（系统使用 systemd-resolved 维护 DNS 的情况）</span></span><br><span class="line">	<span class="comment">#在 Ubuntu 16.10 或更新的版本中，/etc/resolv.conf 文件通常由 systemd-resolved 服务动态生成和管理。因此，直接查看 /etc/resolv.conf 文件可能不会显示 DNS 服务器的配置，需要通过 resolvectl status 命令进行查看</span></span><br><span class="line">resolvectl status</span><br><span class="line"></span><br><span class="line"><span class="comment">##查看当前使用的 DNS 服务器（系统使用 resolvconf 维护 DNS 的情况）</span></span><br><span class="line">resolvconf -l</span><br></pre></td></tr></table></figure><blockquote><p>将看到一个或多个 <code>nameserver</code> 行，每行后面跟着 DNS 服务器的 IP 地址</p></blockquote><h4 id="3-linux-系统配置-dns-服务器"><a class="header-anchor" href="#3-linux-系统配置-dns-服务器">¶</a>3）Linux 系统配置 DNS 服务器</h4><h5 id="1-临时配置系统-dns-服务器"><a class="header-anchor" href="#1-临时配置系统-dns-服务器">¶</a>（1）临时配置系统 DNS 服务器</h5><p>Linux 系统的 DNS 配置由 <code>/etc/resolv.conf</code> 配置文件的 DNS 配置内容决定的，临时情况只需要在该文件里配置一个或多个 nameserver 即可使用自定义的 DNS 服务器（没有 nameserver 则表示不使用 DNS 服务器），修改该文件后会立即生效（不需要重启网络等操作），配置如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加或修改 nameserver 行以指定 DNS 服务器的 IP 地址</span></span><br><span class="line"><span class="comment">#可配置一个或多个 nameserver 行，每行后面跟着 DNS 服务器的 IP 地址</span></span><br><span class="line">vi /etc/resolv.conf</span><br><span class="line"><span class="comment">#配置内容如下：</span></span><br><span class="line">search localdomain</span><br><span class="line">nameserver 223.5.5.5</span><br><span class="line">nameserver 8.8.8.8</span><br></pre></td></tr></table></figure><h5 id="3-永久配置-dns-服务器"><a class="header-anchor" href="#3-永久配置-dns-服务器">¶</a>（3）永久配置 DNS 服务器</h5><h6 id="方式-1-维护网络接口配置文件的-dns-配置-推荐"><a class="header-anchor" href="#方式-1-维护网络接口配置文件的-dns-配置-推荐">¶</a>方式 1、维护网络接口配置文件的 DNS 配置（推荐）</h6><blockquote><p>提示：在网络接口配置文件中，如果获取 IP 的方式为静态的，则需要手动配置 DNS 服务器，这些配置会自动更新到 <code>/etc/resolv.conf</code> 文件中。如果获取 IP 的方式为 DHCP，则可以不用手动设置 DNS 服务器，系统会自动使用 DHCP 分配的 DNS 服务器并更新到 <code>/etc/resolv.conf</code> 文件中，而在 DHCP 的情况下又手动自定义了 DNS 服务器，那么自定义的 DNS 服务器和 DHCP 分配的 DNS 服务器都会同时更新到 <code>/etc/resolv.conf</code> 文件中。</p></blockquote><p>对于 Redhat 系列系统，操作如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#（1）编辑网络接口配置文件</span></span><br><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-&lt;网络接口名称&gt;</span><br><span class="line"><span class="comment">#如：vi /etc/sysconfig/network-scripts/ifcfg-ens33</span></span><br><span class="line"><span class="comment">#添加或修改如下 DNS 配置</span></span><br><span class="line">DNS1=<span class="string">"223.5.5.5"</span></span><br><span class="line">DNS2=<span class="string">"8.8.8.8"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#（2）重启网络服务以生效</span></span><br><span class="line">service network restart</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#（3）查看当前使用的 DNS 服务器（编辑网络接口的 DNS 配置会自动更新到 /etc/resolv.conf 文件中）</span></span><br><span class="line">cat /etc/resolv.conf</span><br></pre></td></tr></table></figure><p>对于 Debain 系统，操作如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#（1）编辑网络接口配置文件</span></span><br><span class="line">vi /etc/network/interfaces</span><br><span class="line"><span class="comment">#添加或修改如下 DNS 配置</span></span><br><span class="line">dns-nameservers 223.5.5.5 8.8.8.8</span><br><span class="line"></span><br><span class="line"><span class="comment">#（2）安装 resolvconf 服务</span></span><br><span class="line">	<span class="comment">#以上 dns-nameservers 配置在最小化安装的 Debian 系统中可能不会生效（即不会自动更新到 /etc/resolv.conf 中），如需使其生效，可如下操作：</span></span><br><span class="line"><span class="comment">#安装 resolvconf</span></span><br><span class="line">apt install -y resolvconf</span><br><span class="line"><span class="comment">#启用 resolvconf 服务自启动并立即允许服务</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now resolvconf.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#（3）重启网络服务以生效</span></span><br><span class="line">service networking restart</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#（4）查看当前使用的 DNS 服务器（编辑网络接口的 DNS 配置会自动更新到 /etc/resolv.conf 文件中）</span></span><br><span class="line">cat /etc/resolv.conf</span><br></pre></td></tr></table></figure><p>对于 Ubuntu 系列系统，操作如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#（1）编辑网络接口配置文件</span></span><br><span class="line">vi /etc/netplan/&lt;xxx&gt;-config.yaml</span><br><span class="line"><span class="comment">#如：vi /etc/netplan/00-installer-config.yaml</span></span><br><span class="line"><span class="comment">#添加或修改如下 DNS 配置（关注：nameservers）</span></span><br><span class="line">network:</span><br><span class="line">  <span class="comment">#其他配置</span></span><br><span class="line">  ethernets:</span><br><span class="line">    <span class="comment">#其他配置</span></span><br><span class="line">    ens33: <span class="comment">#配置的网卡的名称</span></span><br><span class="line">      <span class="comment">#其他配置</span></span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [223.5.5.5, 8.8.8.8] <span class="comment">#DNS服务器地址，多个DNS服务器地址需要用英文逗号分隔开</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#（2）重新加载配置以生效</span></span><br><span class="line">netplan apply</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#（3）查看当前使用的 DNS 服务器（编辑网络接口的 DNS 配置会自动更新到 /etc/resolv.conf 文件中）</span></span><br><span class="line">cat /etc/resolv.conf</span><br></pre></td></tr></table></figure><h6 id="方式-2-禁止其他网络配置工具自动更新-dns"><a class="header-anchor" href="#方式-2-禁止其他网络配置工具自动更新-dns">¶</a>方式 2、禁止其他网络配置工具自动更新 DNS</h6><blockquote><p>由于这种方式修改的内容较多，所以不推荐</p></blockquote><p>手动修改 <code>/etc/resolv.conf</code> 配置文件默认只能临时生效，通常重启网络或重启系统后，自定义的配置内容将会被重置，这是因为该文件的配置内容会被系统的一些其他网络配置工具（如：dhclient-script、NetworkManager 服务等）所默认维护，例如：dhclient-script、systemd-resolved、NetworkManager 等默认都会获取 DHCP 服务器的 IP 并自动追加到 <code>/etc/resolv.conf</code> 里，如果网络接口配置文件中还定义了其他的 DNS 配置，那么这些 DNS 配置也会被追加到 <code>/etc/resolv.conf</code> 中。如果不希望 <code>/etc/resolv.conf</code> 文件所手动自定义的内容被其他网络配置工具所影响，通常只需如下操作：</p><p>对于 Redhat 系列系统，操作如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、禁止 NetworkManager 服务自动更新 DNS</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"[main]\ndns=none"</span> &gt; /etc/NetworkManager/conf.d/no-dns.conf</span><br><span class="line">systemctl restart NetworkManager.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、禁止网络接口自动更新 DNS</span></span><br><span class="line">	<span class="comment">#在网络接口配置文件中添加：PEERDNS="no"，其表示禁止网络接口自动更新 /etc/resolv.conf 文件中的 DNS 服务器，默认 PEERDNS 的值为 true</span></span><br><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-&lt;网络接口名称&gt; <span class="comment">#如：vi /etc/sysconfig/network-scripts/ifcfg-ens33</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3、清空 /etc/resolv.conf 文件的配置内容</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">""</span> &gt; /etc/resolv.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#4、重启网络服务以生效</span></span><br><span class="line">systemctl restart network</span><br><span class="line"></span><br><span class="line"><span class="comment">#5、自定义 DNS 服务器，之后配置将会永久有效（不会被其他网络配置工具所重置）</span></span><br><span class="line">cat &gt; /etc/resolv.conf &lt;&lt; EOF</span><br><span class="line">search localdomain</span><br><span class="line">nameserver 223.5.5.5</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##如需恢复 NetworkManager 和网络接口来维护 /etc/resolv.conf，则如下操作：</span></span><br><span class="line"><span class="comment">#1、允许 NetworkManager 服务自动更新 DNS</span></span><br><span class="line">rm -f /etc/NetworkManager/conf.d/no-dns.conf</span><br><span class="line">systemctl restart NetworkManager.service</span><br><span class="line"><span class="comment">#2、允许网络接口自动更新 DNS</span></span><br><span class="line">	<span class="comment">#删除或注释掉 PEERDNS="no"相关的行</span></span><br><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-&lt;网络接口名称&gt; <span class="comment">#如：vi /etc/sysconfig/network-scripts/ifcfg-ens33</span></span><br><span class="line"><span class="comment">#3、重启网络服务以生效</span></span><br><span class="line">	<span class="comment">#重启网络后 /etc/resolv.conf 的内容将会自动被 NetworkManager 和网络接口重置</span></span><br><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure><p>对于 Debain 系统，操作如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、禁用并立即停止 resolvconf 服务</span></span><br><span class="line">systemctl <span class="built_in">disable</span> --now resolvconf.service</span><br><span class="line"><span class="comment">#2、重启网络服务以生效</span></span><br><span class="line">service networking restart</span><br><span class="line"><span class="comment">#3、清空 /etc/resolv.conf 文件的配置内容</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">""</span> &gt; /etc/resolv.conf</span><br><span class="line"><span class="comment">#4、自定义 DNS 服务器，之后配置将会永久有效（不会被其他网络配置工具所重置）</span></span><br><span class="line">cat &gt; /etc/resolv.conf &lt;&lt; EOF</span><br><span class="line">search localdomain</span><br><span class="line">nameserver 223.5.5.5</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#如需恢复 resolvconf 来维护 /etc/resolv.conf，则如下操作：</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now resolvconf.service</span><br><span class="line"><span class="comment">#重启网络服务以生效</span></span><br><span class="line">service networking restart</span><br></pre></td></tr></table></figure><p>对于 Ubuntu 系统，操作如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、禁用并立即停止 systemd-resolved 服务</span></span><br><span class="line">systemctl <span class="built_in">disable</span> --now systemd-resolved.service</span><br><span class="line"><span class="comment">#2、清空 /etc/resolv.conf 文件的配置内容</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">""</span> &gt; /etc/resolv.conf</span><br><span class="line"><span class="comment">#3、自定义 DNS 服务器，之后配置将会永久有效（不会被其他网络配置工具所重置）</span></span><br><span class="line">cat &gt; /etc/resolv.conf &lt;&lt; EOF</span><br><span class="line">search localdomain</span><br><span class="line">nameserver 223.5.5.5</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#如需恢复 systemd-resolved 来维护 /etc/resolv.conf，则如下操作：</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now systemd-resolved.service</span><br></pre></td></tr></table></figure><blockquote><p>参考：<a href="https://cloud.tencent.com/developer/article/1710514" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1710514</a></p></blockquote><h4 id="4-windows-系统配置-dns-服务器"><a class="header-anchor" href="#4-windows-系统配置-dns-服务器">¶</a>4）Windows 系统配置 DNS 服务器</h4><p>具体操作可参考：<a href="https://developer.aliyun.com/article/872704" target="_blank" rel="noopener">https://developer.aliyun.com/article/872704</a></p><p>补充说明：大部分情况下是直接生效，如未生效可尝试下面的办法，可通过如下命令刷新 DNS</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ipconfig</span> /flushdns</span><br></pre></td></tr></table></figure><h3 id="7-dns-域名解析查询"><a class="header-anchor" href="#7-dns-域名解析查询">¶</a>7. DNS 域名解析查询</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用 nslookup 命令查询</span></span><br><span class="line">	<span class="comment">#查询结果含如下内容：</span></span><br><span class="line">		<span class="comment">#（1）查询到的 IP 解析结果</span></span><br><span class="line">		<span class="comment">#（2）查询域名时使用的 DNS 服务器（默认为系统配置的 DNS 服务器），可在使用时指定 DNS 服务器，如：nslookup example.com 8.8.8.8</span></span><br><span class="line">	<span class="comment">#该命令可适用于 Windows 系统</span></span><br><span class="line">nslookup example.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用 dig 命令查询</span></span><br><span class="line">	<span class="comment">#查询结果含如下内容：</span></span><br><span class="line">		<span class="comment">#（1）查询到的 IP 解析结果</span></span><br><span class="line">		<span class="comment">#（2）查询域名时使用的 DNS 服务器（默认为系统配置的 DNS 服务器），可在使用时指定 DNS 服务器，如：dig example.com @8.8.8.8</span></span><br><span class="line">		<span class="comment">#（3）域名的 DNS 记录类型</span></span><br><span class="line">dig example.com</span><br></pre></td></tr></table></figure><h3 id="8-配置防火墙"><a class="header-anchor" href="#8-配置防火墙">¶</a>8. 配置防火墙</h3><h4 id="1-简要概述"><a class="header-anchor" href="#1-简要概述">¶</a>1）简要概述</h4><p>Linux 中常见的防火墙软件有 IPtables、UFW、FirewallD，通过这些工具可以对网络流量进行管理和控制，保障系统的安全性和稳定性。</p><blockquote><p>注意：IPtables、UFW、FirewallD 这三种防火墙软件并不是独立的，而是存在联系和依赖关系。FirewallD 和 UFW 都是基于 IPtables 的前端工具，可以帮助用户更方便地配置和管理 iptables 规则。同时，IPtables 仍然是 Linux 系统中默认的防火墙软件之一，为其他防火墙软件提供了底层支持和功能。用户可以根据实际需求和环境选择合适的防火墙软件，并进行适当的配置和管理，以确保系统的安全性和高可用性。</p></blockquote><h4 id="2-iptables-防火墙"><a class="header-anchor" href="#2-iptables-防火墙">¶</a>2）IPtables 防火墙</h4><p>IPtables 是 Linux 发行版中内置的基于 Netfilter 内核模块的防火墙软件，可用于控制和过滤网络流量。</p><blockquote><p>在 iptables 中，有四个主要的表（table）和五个预定义的链（chain），分别是：</p><ol><li>filter 表：这是默认情况下使用的表，用于进行最常见的防火墙操作，例如过滤数据包、禁止或允许特定端口或 IP 地址等。它包含了三个主要的链：INPUT、OUTPUT 和 FORWARD 链。</li><li>nat 表：这个表用于进行网络地址转换（NAT）操作，例如将私有 IP 地址映射到公共 IP 地址、修改源或目标 IP 地址等。它包含了三个主要的链：PREROUTING、POSTROUTING 和 OUTPUT 链。</li><li>mangle 表：这个表用于修改数据包的头部信息，例如修改 TTL 值、标记数据包、更改 QoS 信息等。它包含了五个主要的链：PREROUTING、OUTPUT、INPUT、FORWARD 和 POSTROUTING 链。</li><li>raw 表：这个表用于处理数据包之前的连接追踪（connection tracking）操作，例如禁止或允许特定协议、配置 ICMP 参数等。它包含了两个主要的链：PREROUTING 和 OUTPUT 链。</li></ol><p>其中，五个预定义的链是：</p><ol><li>INPUT 链：这个链用于对传入到本机的入站数据包进行处理。</li><li>OUTPUT 链：这个链用于对本机发起的出站数据包进行处理。</li><li>FORWARD 链：这个链用于对通过本机进行转发的数据包进行处理。</li><li>PREROUTING 链：这个链用于对通过网络接口的入站数据包进行处理。</li><li>POSTROUTING 链：这个链用于对通过网络接口的出站数据包进行处理。</li></ol></blockquote><blockquote><p>提示：Debain 等系统以及一些较旧版本的 Linux 发行版系统（例如：CentOS 6、Red Hat Enterprise Linux (RHEL) 6、Ubuntu 14.04 LTS 等）默认只安装有 iptables 防火墙软件，而未安装 UFW、FirewallD 等。如果系统中安装有这些上层的防火墙软件，但又希望只使用 iptables 来管理防火墙，则一定要卸载掉这些上层的防火墙软件。</p></blockquote><h5 id="1-语法格式"><a class="header-anchor" href="#1-语法格式">¶</a>（1）语法格式</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables [-t 表名] 命令选项 [链名] [参数选项] [-j 动作]</span><br></pre></td></tr></table></figure><blockquote><ul><li><p><code>[-t 表名]</code>：可选参数，用于指定要操作的表名称。表定义了特定类型的规则集合。常见的表有<code>filter</code>、<code>nat</code>和<code>mangle</code>。如果不指定表名，则默认为<code>filter</code>表。</p></li><li><p><code>命令选项</code>：指定要执行的操作命令。通常单字母命令选项为大写字母表示，常见的命令包括：</p></li><li><p><code>-A</code>（<code>--append</code>）：在指定链的末尾添加一条新规则。（如 ：<code>-A &lt;chain&gt;</code>）</p></li><li><p><code>-D</code>（<code>--delete</code>）：删除指定链中的一条规则。</p></li><li><p><code>-I</code>（<code>--insert</code>）：在指定链的开头或指定位置插入一条新规则。（如：<code>-I &lt;chain&gt; [num]</code> ，<code>num</code> 表示链的行号（编号）位置，如果不指定则为链的开头）</p></li><li><p><code>-R</code>（<code>--replace</code>）：替换指定链中的一条规则。</p></li><li><p><code>-L</code>（<code>--list</code>）：列出指定链或表中的规则。</p></li><li><p><code>-F</code>（<code>--flush</code>）：清除指定链中的所有规则。</p></li><li><p><code>-Z</code>（<code>--zero</code>）：将指定链中的数据包和字节计数器归零。</p></li><li><p><code>[链名]</code>：可选参数，用于指定要操作的链名称。链是规则的集合，它们决定了数据包的流向和处理方式。根据具体的表和命令，可能需要指定链名。</p></li><li><p><code>[参数选项]</code>：用于指定规则的匹配条件和其他参数。通常单字母参数选项为小写字母表示，常见的参数选项包括：</p></li><li><p><code>[!] -s</code>：指定匹配数据包的源地址或地址范围。表示方式：单个 IP 地址（如：<code>-s 192.168.0.1</code>）、CIDR 表示法（<code>-s 192.168.0.0/24</code>）、主机名（如：<code>-s host1</code>）、网络接口（如：<code>-s eth0</code>）</p></li><li><p><code>[!] -d</code>：指定匹配数据包的目标地址或地址范围。地址表示方式类比 <code>-s</code>。</p></li><li><p><code>[!] -p</code>：指定要匹配的协议类型，如：<code>tcp</code>、<code>udp</code>、<code>icmp</code>、<code>all</code>（默认值，表示匹配所有协议）等。</p></li><li><p><code>[!] -i</code>（<code>--in-interface</code>）：指定数据包进入防火墙的网络接口，用于匹配数据包的输入接口。</p></li><li><p><code>[!] -o</code>（<code>--out-interface</code>）：指定数据包离开防火墙的网络接口，用于匹配数据包的输出接口。</p></li><li><p><code>[!] --sport</code>：指定要匹配的单个源端口号。表示方式：单个端口（如：<code>--sport 80</code>）</p></li><li><p><code>[!] --dport</code>：指定要匹配的单个目标端口号。表示方式类比 <code>--sport</code>。</p></li><li><p><code>[!] --sports</code>：指定要匹配的多个源端口号。表示方式：单个端口（如：<code>--sports 80</code>）、逗号分隔的多个端口列表（如：<code>--sports 80,443</code>）、端口范围（如：<code>--sports 8000:9000</code> ，表示匹配端口在 8000 到 9000 范围内的）</p></li><li><p><code>[!] --dports</code>:指定要匹配的多个目标端口号。表示方式类比 <code>--sports</code>。</p></li><li><p><code>[!] -m state --state 连接状态</code>：匹配连接状态。NEW（新建的连接）、ESTABLISHED（已建立的连接）、RELATED（已关联连接，即已建立的连接）、INVALID（无效的连接）</p></li></ul><p>说明：<code>!</code>（取反操作符）用于对匹配条件进行取反操作。它可以在规则中用于否定某个条件，从而选择与该条件不匹配的数据包。</p><ul><li><p><code>-j 动作</code>：用于指定规则匹配后要执行的动作。动作可以是接受、丢弃、拒绝、转发等。常见的动作包括：</p></li><li><p><code>ACCEPT</code>：接受（允许）放行数据包，允许数据包通过防火墙。</p></li><li><p><code>DROP</code>：丢弃（拒绝）数据包，直接丢弃匹配到的数据包，不给予任何响应。</p></li><li><p><code>REJECT</code>：拒绝（拒绝访问）数据包，发送一个拒绝的响应给源主机，通知其访问被拒绝。</p></li><li><p><code>LOG</code>：记录数据包信息，将匹配到的数据包的相关信息记录到系统日志中，以便后续分析。</p></li><li><p><code>DNAT</code>：目标网络地址转换，用于目标地址的修改，通常与网络地址转换（NAT）一起使用。</p></li><li><p><code>SNAT</code>：源网络地址转换，用于源地址的修改，通常与网络地址转换（NAT）一起使用。</p></li><li><p><code>MASQUERADE</code>：网络地址转换（NAT）的一种特殊形式，将内部网络的数据包源地址修改为防火墙的外部接口地址。</p></li><li><p><code>REDIRECT</code>：重定向数据包，将匹配到的数据包重定向到指定的目标地址和端口。</p></li><li><p><code>MARK</code>：标记数据包，可以在匹配到的数据包上设置一个特定的标记，以供后续处理使用。</p></li></ul></blockquote><h5 id="2-添加规则"><a class="header-anchor" href="#2-添加规则">¶</a>（2）添加规则</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例1：放行指定端口</span></span><br><span class="line">	<span class="comment"># -t filter可省略</span></span><br><span class="line">	<span class="comment"># 添加 “目标端口为80的TCP数据包允许传入” 的规则</span></span><br><span class="line">iptables -t filter -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例2：拒绝某IP访问</span></span><br><span class="line"><span class="comment">#添加 “拒绝并丢弃源IP为192.168.100.10的传入数据包” 的规则</span></span><br><span class="line">iptables -A INPUT -s 192.168.100.10 -j DROP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置常规安全的防火墙默认规则（即允许所有输出流量，但阻止所有输入和转发流量，另外允许ssh默认22端口的输入流量）</span></span><br><span class="line">	<span class="comment">#iptables默认情况下没有设置任何规则，以确保网络安全推荐设置默认规则，然后再根据需要添加其他规则</span></span><br><span class="line">iptables -t filter -A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables --policy INPUT DROP</span><br><span class="line">iptables --policy FORWARD DROP</span><br><span class="line">iptables --policy OUTPUT ACCEPT</span><br></pre></td></tr></table></figure><h5 id="3-删除规则"><a class="header-anchor" href="#3-删除规则">¶</a>（3）删除规则</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##示例1：删除放行指定端口规则</span></span><br><span class="line"><span class="comment">#删除 “目标端口为80的TCP数据包允许传入” 的规则</span></span><br><span class="line">iptables -t filter -D INPUT -p tcp --dport 80 -j ACCEPT</span><br></pre></td></tr></table></figure><blockquote><p>该命令会删除指定端口的 iptables 规则。其中 <code>-D</code> 表示从链中删除规则。</p></blockquote><h5 id="4-修改规则"><a class="header-anchor" href="#4-修改规则">¶</a>（4）修改规则</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例1：修改指定端口规则</span></span><br><span class="line">iptables -t filter -R INPUT &lt;num&gt; -p tcp --dport &lt;port&gt; -j DROP</span><br></pre></td></tr></table></figure><blockquote><p>该命令会用新规则替换指定编号的旧规则，并拒绝传入 TCP 流量到指定端口。其中 <code>-R</code> 表示替换指定规则编号的规则。</p></blockquote><h5 id="5-查看防火墙规则"><a class="header-anchor" href="#5-查看防火墙规则">¶</a>（5）查看防火墙规则</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列出默认的filter表中所有链的所有规则</span></span><br><span class="line">iptables -L</span><br><span class="line">iptables -nvL</span><br><span class="line">iptables -nvL --line-numbers</span><br><span class="line"></span><br><span class="line"><span class="comment">#列出filter表中INPUT链的所有规则（通常用于查看流量进入服务器时的端口放行规则和IP放行规则）</span></span><br><span class="line">iptables -t filter -L INPUT -nv</span><br><span class="line"><span class="comment">#列出nat表中POSTROUTING链的所有规则（通常用于查看NAT地址转换规则）</span></span><br><span class="line">iptables -t nat -L POSTROUTING -nv</span><br></pre></td></tr></table></figure><blockquote><p>参数说明：</p><ul><li><code>-n</code>：禁止将 IP 地址和端口号解析为主机名和服务名称。默认情况下，<code>iptables</code>会尝试解析 IP 地址和端口号为可读的主机名和服务名称，但使用<code>-n</code>参数可以避免此解析过程，以提高显示速度与可读性。</li><li><code>-L</code>：列出规则。</li><li><code>[chain]</code>：指定要操作的链名称（可选，默认为 filter 链）</li><li><code>--line-numbers</code>：在每个规则前面显示规则的行号（编号）。</li><li><code>-v</code>：以详细模式显示。该参数会在输出结果中显示规则的数据包和字节数统计信息。</li></ul><p>该命令可以列出当前 iptables 的所有规则，包括链（chain）、策略（policy）和规则（rule）等信息。</p></blockquote><h5 id="6-重置-iptables-规则"><a class="header-anchor" href="#6-重置-iptables-规则">¶</a>（6）重置 iptables 规则</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">iptables --policy INPUT ACCEPT <span class="comment"># 将输入链设置为默认接受所有数据包</span></span><br><span class="line">iptables --policy FORWARD DROP <span class="comment"># 将转发链设置为默认拒绝所有数据包</span></span><br><span class="line">iptables --policy OUTPUT ACCEPT <span class="comment"># 将输出链设置为默认接受所有数据包</span></span><br><span class="line">iptables -F  <span class="comment"># 清除所有防火墙规则</span></span><br><span class="line">iptables -X  <span class="comment"># 删除所有用户定义的链</span></span><br><span class="line">iptables -Z  <span class="comment"># 清除所有计数器和数据包计数器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注意，以上将会重置所有iptables规则，如果系统安装有Docker，则Docker相关的iptables规则也会被清空，为了保留Docker相关的iptables规则，可以通过重启Docker服务来自动添加回Docker相关的iptables规则，如下：</span></span><br><span class="line">systemctl restart docker</span><br><span class="line"><span class="comment">#查看是否包含Docker相关的iptables规则</span></span><br><span class="line">iptables -nvL</span><br></pre></td></tr></table></figure><h5 id="7-防火墙规则持久化"><a class="header-anchor" href="#7-防火墙规则持久化">¶</a>（7）防火墙规则持久化</h5><p>默认通过 <code>iptables</code> 命令操作防火墙规则会立刻生效，但这些<code>iptables</code>规则还在本次系统运行时有效，一旦系统重启，<code>iptables</code>规则将会重置为默认设置，为了使<code>iptables</code>规则在系统重新启动后仍然有效，用户需要将规则保存到某个文件中，并在启动时加载这些规则。操作如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导出当前的iptables规则并保存（可选择保存为任何文件路径）</span></span><br><span class="line">mkdir -p /etc/sysconfig</span><br><span class="line">iptables-save &gt; /etc/sysconfig/iptables</span><br><span class="line"></span><br><span class="line"><span class="comment">#系统重启后，需要手动执行如下命令以重新导入配置文件中的iptables规则（导入后，规则会立刻生效）</span></span><br><span class="line">iptables-restore &lt; /etc/sysconfig/iptables</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果不希望每次重启都手动导入，则可以将导入命令配置到系统启动加载配置文件中（使其能够开机自启动并自动导入 iptables 规则），如下：</span></span><br><span class="line"><span class="comment">#提示：/etc/network/if-pre-up.d目录下的脚本将会在系统重启过程网络接口启动之前自动执行。（重启网络服务也会自动执行）</span></span><br><span class="line">cat &gt; /etc/network/<span class="keyword">if</span>-pre-up.d/iptablesload &lt;&lt; EOF</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">iptables-restore &lt; /etc/sysconfig/iptables</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#赋予执行权限</span></span><br><span class="line">chmod +x /etc/network/<span class="keyword">if</span>-pre-up.d/iptablesload</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启测试</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><p>以上是手动维护配置文件和 iptables 持久化规则文件，操作比较麻烦，由此可以使用一些通用的工具简化实现，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##对于Debian/Ubuntu类系统，可以安装 iptables-persistent 工具包，使其以守护进程的方式来运行，这样系统重启后可以自动将保存的内容加载到 iptables 中，如下：</span></span><br><span class="line">apt install -y iptables-persistent</span><br><span class="line"><span class="comment">#保存规则</span></span><br><span class="line">service  iptables-persistent save</span><br><span class="line"><span class="comment">#重启测试</span></span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line"><span class="comment">##对于RHEL/CentOS类系统，可以安装 iptables-service 工具包,使其以守护进程的方式来运行，这样系统重启后可以自动将保存的内容加载到 iptables 中，如下：</span></span><br><span class="line"><span class="comment">#在 centos6 中默认有该工具包了，但在 centos7 中已经不能再使用类似 service iptables start 这样的命令了，所以 service iptables save 也无法执行，同时，在 centos7中，使用 firewall 替代了原来的 iptables service，不过不用担心，我们只要通过 yum 源安装 iptables与iptables-services 即可（iptables 一般会被默认安装，但是iptables-services 在 centos7 中一般不会被默认安装），在centos7 中安装完 iptables-services 后，即可像 centos6 中一样，通过 service iptables save 命令保存规则了，规则同样保存在 /etc/sysconfig/iptables 文件中</span></span><br><span class="line"><span class="comment">#配置好yum源以后安装iptables-service</span></span><br><span class="line">yum install -y iptables-services</span><br><span class="line"><span class="comment">#停止firewalld</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="comment">#禁止firewalld自动启动</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"><span class="comment">#启动iptables</span></span><br><span class="line">systemctl start iptables</span><br><span class="line"><span class="comment">#将iptables设置为开机自动启动，以后即可通过iptables-service控制iptables服务</span></span><br><span class="line">systemctl <span class="built_in">enable</span> iptables</span><br><span class="line"><span class="comment">#保存规则</span></span><br><span class="line">service iptables save</span><br><span class="line"><span class="comment">#重启测试</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><blockquote><p>参考：</p><ul><li><a href="https://www.cnblogs.com/big-cousin/p/17007533.html" target="_blank" rel="noopener">https://www.cnblogs.com/big-cousin/p/17007533.html</a></li><li><a href="https://salogs.com/news/2015/08/20/iptables-save/" target="_blank" rel="noopener">https://salogs.com/news/2015/08/20/iptables-save/</a></li></ul></blockquote><h5 id="8-使用-iptables-实现-tcp-udp-端口转发"><a class="header-anchor" href="#8-使用-iptables-实现-tcp-udp-端口转发">¶</a>（8）使用 IPtables 实现 TCP/UDP 端口转发</h5><blockquote><p>参考：</p><ul><li><a href="https://www.cnblogs.com/paul8339/p/14688156.html" target="_blank" rel="noopener">https://www.cnblogs.com/paul8339/p/14688156.html</a></li><li><a href="https://www.youtube.com/watch?v=qQej5kv868g" target="_blank" rel="noopener">https://www.youtube.com/watch?v=qQej5kv868g</a></li></ul></blockquote><h5 id="9-参考"><a class="header-anchor" href="#9-参考">¶</a>（9）参考</h5><blockquote><ul><li><a href="https://blog.csdn.net/lvoelife/article/details/129101416" target="_blank" rel="noopener">https://blog.csdn.net/lvoelife/article/details/129101416</a></li></ul></blockquote><h4 id="3-ufw-防火墙"><a class="header-anchor" href="#3-ufw-防火墙">¶</a>3）UFW 防火墙</h4><p>UFW 是 Debian 系列 Linux 系统中 IPtables 防火墙的前端工具。旨在简化 iptables 的配置。</p><blockquote><p>如果系统默认没有安装 UFW，则可执行命令安装：<code>apt install ufw</code></p></blockquote><h5 id="1-查看-ufw-服务状态"><a class="header-anchor" href="#1-查看-ufw-服务状态">¶</a>（1）查看 ufw 服务状态</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status ufw</span><br></pre></td></tr></table></figure><h5 id="2-查看-ufw-的状态"><a class="header-anchor" href="#2-查看-ufw-的状态">¶</a>（2）查看 ufw 的状态</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#该命令可以看到ufw的状态（inactive是关闭，active是开启），ufw开启时还会列出当前配置的策略。</span></span><br><span class="line">ufw status</span><br></pre></td></tr></table></figure><blockquote><p>注意：新安装 Ubuntu 系统，UFW 防火墙默认是不开启的。</p></blockquote><h5 id="3-开启-重启-关闭-ufw-服务"><a class="header-anchor" href="#3-开启-重启-关闭-ufw-服务">¶</a>（3）开启、重启、关闭、ufw 服务</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用服务（开机启动）</span></span><br><span class="line">ufw <span class="built_in">enable</span></span><br><span class="line"><span class="comment"># 开启服务</span></span><br><span class="line">systemctl start ufw</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl restart ufw</span><br><span class="line"><span class="comment"># 重新加载UFW的配置文件（即 /etc/ufw/*.rules）</span></span><br><span class="line">ufw reload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用服务（开机禁用）</span></span><br><span class="line">ufw <span class="built_in">disable</span></span><br><span class="line"><span class="comment"># 关闭服务</span></span><br><span class="line">systemctl stop ufw</span><br></pre></td></tr></table></figure><h5 id="4-查看防火墙规则"><a class="header-anchor" href="#4-查看防火墙规则">¶</a>（4）查看防火墙规则</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw status</span><br></pre></td></tr></table></figure><h5 id="5-防火墙端口规则维护"><a class="header-anchor" href="#5-防火墙端口规则维护">¶</a>（5）防火墙端口规则维护</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 放行访问规则</span></span><br><span class="line"><span class="comment">#放行指定端口号访问（如果不带有TCP或者UDP，则默认两种都可以）</span></span><br><span class="line">ufw allow 端口号</span><br><span class="line">ufw allow 端口号/tcp</span><br><span class="line">ufw allow 端口号/udp</span><br><span class="line"><span class="comment">#允许2200到2222端口的TCP流量允许访问</span></span><br><span class="line">ufw allow 2200:2222/tcp</span><br><span class="line"><span class="comment">#设置特定的IP允许访问</span></span><br><span class="line">ufw allow from xx.xx.xx.xx</span><br><span class="line"><span class="comment">#指定特定IP连接到特定端口允许访问</span></span><br><span class="line">ufw allow from xx.xx.xx.xx to any poart 端口号</span><br><span class="line"><span class="comment">#设置特定的子网xx.xx.xx网段ip允许访问</span></span><br><span class="line">ufw allow from xx.xx.xx.0/24</span><br><span class="line"></span><br><span class="line"><span class="comment">## 阻止访问规则</span></span><br><span class="line"><span class="comment">#阻止指定端口号访问（如果不带有TCP或者UDP，则默认两种都可以），注意如果之前有该端口的allow规则，那么只是改规则为deny，而不会删除规则</span></span><br><span class="line">ufw deny 端口号</span><br><span class="line">ufw deny 端口号/tcp</span><br><span class="line">ufw deny 端口号/udp</span><br><span class="line"><span class="comment">#阻止2200到2222端口的tcp</span></span><br><span class="line">ufw deny 2200:2222/tcp</span><br><span class="line"><span class="comment">#阻止特定IP访问</span></span><br><span class="line">ufw deny from xx.xx.xx.xx</span><br><span class="line"><span class="comment">#阻止特定IP通过端口</span></span><br><span class="line">ufw deny from xx.xx.xx.xx to any poart 端口号</span><br><span class="line"><span class="comment">#阻止特定子网xx.xx.xx网段ip允许访问</span></span><br><span class="line">ufw deny from xx.xx.xx.0/24</span><br><span class="line"><span class="comment">#禁止外部访问smtp服务，#以服务名代表端口，可以使用less /etc/services列出所有服务信息, 其中包括该服务使用了哪个端口和哪种协议</span></span><br><span class="line">ufw deny smtp</span><br><span class="line"><span class="comment">#删除上面建立的某条规则，或者ufw delete allow 80/tcp，如果出现无法删除，可以用序号：ufw status numbered，然后通过序号删除ufw delete 1</span></span><br><span class="line">ufw delete allow smtp</span><br><span class="line"><span class="comment">#要拒绝所有的TCP流量从10.0.0.0/8 到192.168.0.1地址的22端口</span></span><br><span class="line">ufw deny proto tcp from 10.0.0.0/8 to 192.168.0.1 port 22</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置出入（默认的规则都是进来的，我们可以通过in和out配置）</span></span><br><span class="line">ufw allow <span class="keyword">in</span> 2222 <span class="comment">#允许2222端口的流量进来</span></span><br><span class="line">ufw denty <span class="keyword">in</span> 2222 <span class="comment">#阻止2222端口的流量进来</span></span><br><span class="line">ufw allow out 2222 <span class="comment">#允许2222端口的流量出去</span></span><br><span class="line">ufw denty out 2222 <span class="comment">#阻止2222端口的流量出去</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除规则（两种方式）</span></span><br><span class="line"><span class="comment">#方式1：通过在规则前面加上delete删除规则</span></span><br><span class="line"><span class="comment">#删除放行的某端口规则</span></span><br><span class="line">ufw delete allow 端口号</span><br><span class="line"><span class="comment">#方式2：通过查看规则序列号来删除</span></span><br><span class="line"><span class="comment">#查看规则序列号</span></span><br><span class="line">ufw status numbered</span><br><span class="line"><span class="comment">#删除第3条规则</span></span><br><span class="line">ufw delete 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 重置规则（恢复初始规则配置）</span></span><br><span class="line">ufw reset</span><br></pre></td></tr></table></figure><blockquote><p>💁‍♂ 说明：</p><ul><li>一旦启用 UFW 之后，默认情况防火墙将不允许所有入栈连接访问，包括 SSH 连接，所以在开启防火墙之后，建议将 SSH 的监听端口设置为允许访问，操作如：<code>ufw allow ssh</code> （等价于：<code>ufw allow 22</code>）</li><li>在 UFW 中的所有修改都会立刻生效，不需要重新加载配置以来生效。</li></ul><p>📖 参考：</p><ul><li><a href="https://wiki.ubuntu.org.cn/Ufw%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97" target="_blank" rel="noopener">https://wiki.ubuntu.org.cn/Ufw使用指南</a></li><li><a href="https://zhuanlan.zhihu.com/p/571124400" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/571124400</a></li></ul></blockquote><h4 id="4-firewalld-防火墙"><a class="header-anchor" href="#4-firewalld-防火墙">¶</a>4）FirewallD 防火墙</h4><p>FirewallD 是 Red Hat 系列 Linux 系统中 IPtables 防火墙的前端工具。旨在简化 iptables 的配置。</p><h5 id="1-查看-firewall-服务状态"><a class="header-anchor" href="#1-查看-firewall-服务状态">¶</a>（1）查看 firewall 服务状态</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure><h5 id="2-查看-firewall-的状态"><a class="header-anchor" href="#2-查看-firewall-的状态">¶</a>（2）查看 firewall 的状态</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --state</span><br></pre></td></tr></table></figure><h5 id="3-开启-重启-关闭-firewalld-service-服务"><a class="header-anchor" href="#3-开启-重启-关闭-firewalld-service-服务">¶</a>（3）开启、重启、关闭、firewalld.service 服务</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启服务</span></span><br><span class="line">systemctl start firewalld</span><br><span class="line"><span class="comment"># 开机自启动服务</span></span><br><span class="line">systemctl <span class="built_in">enable</span> firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">systemctl restart firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="comment"># 禁止开机自启动服务</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure><h5 id="4-查看防火墙规则-v2"><a class="header-anchor" href="#4-查看防火墙规则-v2">¶</a>（4）查看防火墙规则</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --list-all</span><br></pre></td></tr></table></figure><h5 id="5-防火墙端口规则维护-v2"><a class="header-anchor" href="#5-防火墙端口规则维护-v2">¶</a>（5）防火墙端口规则维护</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询端口是否放行</span></span><br><span class="line">firewall-cmd --query-port=8080/tcp</span><br><span class="line"><span class="comment">#放行80端口</span></span><br><span class="line">firewall-cmd --permanent --add-port=80/tcp</span><br><span class="line"><span class="comment">#删除放行的80规则</span></span><br><span class="line">firewall-cmd --permanent --remove-port=80/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment">#放行端口区间</span></span><br><span class="line">firewall-cmd --zone=public --add-port=4400-4600/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=4400-4600/udp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除放行的端口区间规则</span></span><br><span class="line">firewall-cmd --zone=public --remove-port=4400-4600/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --remove-port=4400-4600/udp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment">#重新加载配置以使修改生效</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><blockquote><p>参数解释：</p><ul><li><code>--permanent</code>：表示设置为持久</li><li><code>--add-port</code>：标识添加的端口</li></ul><p>提示：FirewallD 没有类似 <code>ufw reset</code> 重置规则的命令，如需恢复初始规则配置只能手动维护。</p></blockquote><h3 id="9-查看系统程序对应网络信息-netstat"><a class="header-anchor" href="#9-查看系统程序对应网络信息-netstat">¶</a>9. 查看系统程序对应网络信息 <code>netstat</code></h3><p>般用于检验本机各端口的网络连接情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装net-tools（包含ifconfig、netstat等网络命令的工具包）</span></span><br><span class="line">yum install -y net-tools</span><br><span class="line">apt install -y net-tools</span><br><span class="line"></span><br><span class="line">netstat      <span class="comment">#命令用于显示各种网络相关信息，如网络连接, 路由表, 接口状态等等</span></span><br><span class="line">netstat -lt  <span class="comment">#列出所有处于监听状态的tcp端口</span></span><br><span class="line">netstat -tunlp <span class="comment">#查看所有的监听端口(包括tcp和udp)信息, 同时含 PID 和进程名称</span></span><br><span class="line">netstat -tunlp|grep 端口号 <span class="comment">#用于查看指定监听端口号的进程情况</span></span><br></pre></td></tr></table></figure><blockquote><ul><li><code>-a</code>：显示所有连接和监听端口</li><li><code>-t</code>：仅显示 TCP 连接</li><li><code>-u</code>：仅显示 UDP 连接</li><li><code>-n</code>：以数字形式显示 IP 地址和端口号，而不进行反向域名解析</li><li><code>-l</code>：仅显示监听状态的连接</li><li><code>-p</code>：显示建立相关连接的进程 ID</li></ul></blockquote><h3 id="10-网络测试工具-nc"><a class="header-anchor" href="#10-网络测试工具-nc">¶</a>10. 网络测试工具 <code>nc</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##安装nc</span></span><br><span class="line">yum install -y nc <span class="comment"># CentOS/RedHat</span></span><br><span class="line">apt install -y netcat <span class="comment"># Ubuntu</span></span><br><span class="line">apt install -y netcat-openbsd <span class="comment"># Debian</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##检查服务器端口是否通</span></span><br><span class="line">nc -zv ip 端口</span><br><span class="line"><span class="comment">#如下：</span></span><br><span class="line">$ root@ubuntu18:~<span class="comment"># nc -zv 192.168.30.100 80</span></span><br><span class="line">Connection to 192.168.30.100 80 port [tcp/http] succeeded!</span><br><span class="line"></span><br><span class="line"><span class="comment">##启动一个tcp端口（默认仅支持 IPv4，可添加 -4 -6 来同时支持 IPv4 和 IPv6）</span></span><br><span class="line">nc -l -p 端口</span><br><span class="line"><span class="comment">#如下：</span></span><br><span class="line">$ nc -l -p 8989	<span class="comment">#服务端开启一个8989端口tcp进程</span></span><br><span class="line">$ telnet 192.168.60.149 8989 <span class="comment">#客户端通过telnet连接测试端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##扫描端口(扫描指定ip某范围下启动的端口)</span></span><br><span class="line">nc -v -w 1 ip -z 扫描起始的端口-扫描终止的端口</span><br><span class="line"><span class="comment">#如下：</span></span><br><span class="line">$ nc -v -w 1 example.com -z 80-443</span><br><span class="line">Connection to example.com 80 port [tcp/http] succeeded!</span><br><span class="line">nc: connect to example.com port 81 (tcp) timed out: Operation now <span class="keyword">in</span> progress</span><br><span class="line">Connection to example.com 82 port [tcp/*] succeeded!</span><br><span class="line">nc: connect to example.com port 83 (tcp) timed out: Operation now <span class="keyword">in</span> progress</span><br><span class="line">nc: connect to example.com port 84 (tcp) timed out: Operation now <span class="keyword">in</span> progress</span><br><span class="line"></span><br><span class="line"><span class="comment">##验证UDP端口连通性</span></span><br><span class="line">nc -l -u 8989	<span class="comment">#服务端开启一个82端口udp进程</span></span><br><span class="line">nc -uvz example.com 8989	<span class="comment">#客户端连接服务端验证udp端口是否可用</span></span><br><span class="line"><span class="comment">#echo "hello" | nc -u -w1 example.com 8989 #客户端连接服务端udp端口并发生消息报文</span></span><br></pre></td></tr></table></figure><h3 id="11-路由追踪-traceroute"><a class="header-anchor" href="#11-路由追踪-traceroute">¶</a>11. 路由追踪 <code>traceroute</code></h3><p>现实世界中的网络是由无数的计算机和路由器组成的一张的大网，应用的数据包在发送到服务器之前都要经过层层的路由转发。而Traceroute是一种常规的网络分析工具，用来定位到目标主机之间的所有路由器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-U 使用UDP协议（默认）发送数据包测试路由追踪（因为大部分的应用服务器都不提供UDP服务（或者被防火墙挡掉），所以会拿不到服务器的任何返回，所以不建议使用UDP测试）</span></span><br><span class="line"><span class="comment">#-T 使用TCP协议的SYN发送数据包测试路由追踪</span></span><br><span class="line"><span class="comment">#-I 使用icmp协议发送数据包测试路由追踪（ICMP即Internet控制报文协议，用于在IP主机、路由器之间传递控制消息的一种网络层协议，ICMP是IP协议的一部分，因此，ICMP协议的报文包含在IP数据报的数据部分。ICMP不像TCP或UDP有端口，只要服务器不禁止icmp消息，都是可以拿到路由应答的）</span></span><br><span class="line"><span class="comment">#-p 指定UDP端口。缺省值为 33434。如果 UDP 端口不可用，那么该选项可以用于选择一个未曾使用的端口范围。</span></span><br><span class="line"><span class="comment">#-m 指定最大ttl，默认30，即最大跳数</span></span><br><span class="line">traceroute [参数] ip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试（向baidu.com发送icmp数据包并追踪路由）</span></span><br><span class="line">$ traceroute -I -m 100  baidu.com</span><br><span class="line">traceroute to baidu.com (110.242.68.66), 30 hops max, 60 byte packets</span><br><span class="line"> 1  _gateway (192.168.60.2)  0.075 ms  0.040 ms  0.037 ms</span><br><span class="line"> 2  * * *</span><br><span class="line"> 3  * * *</span><br><span class="line"> 4  * * *</span><br><span class="line"> 5  * * *</span><br><span class="line"> 6  * * *</span><br><span class="line"> 7  * * *</span><br><span class="line"> 8  * * *</span><br><span class="line"> 9  * * *</span><br><span class="line">10  * * *</span><br><span class="line">11  * * *</span><br><span class="line">12  * * *</span><br><span class="line">13  * * *</span><br><span class="line">14  * * *</span><br><span class="line">15  * * * <span class="comment">#***的路由表示该路由服务屏蔽了ICMP消息</span></span><br><span class="line">16  110.242.68.66 (110.242.68.66)  42.452 ms  42.450 ms  42.423 ms  <span class="comment">#共经历16跳后到达服务器</span></span><br></pre></td></tr></table></figure><p>Windows系统中也有路由追踪工具，那就是<code>tracert</code>，<code>tracert</code>采用的是icmp协议实现的，故不需要指定消息的协议。</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#-h 指定最大ttl，默认<span class="number">30</span>，即最大跳数</span><br><span class="line">tracert ip</span><br></pre></td></tr></table></figure><blockquote><p>参考：</p><ul><li><a href="https://www.jianshu.com/p/75a5822d0eec" target="_blank" rel="noopener">《Traceroute（路由追踪）的原理及实现》</a></li><li><a href="https://blog.csdn.net/wangyuxiang946/article/details/124553016" target="_blank" rel="noopener">《ICMP协议 详解，ICMP协议的功能及实现原理，ICMP协议报文类型》</a></li></ul></blockquote><h2 id="十-远程操作"><a class="header-anchor" href="#十-远程操作">¶</a>十、远程操作</h2><h3 id="1-远程操作网络基础"><a class="header-anchor" href="#1-远程操作网络基础">¶</a>1. 远程操作网络基础</h3><p><strong>域名</strong>：由一串“”用点分隔“”的名字组成，例如：<code>www.baidu.com</code>；是IP 地址的别名，方便用户记忆。</p><p><strong>IP地址</strong>：IP 地址是网络中计算机的唯一网络标识。</p><p><strong>端口号</strong>：是某台计算机上运行的应用程序的唯一网络标识。常见服务端口号列表：</p><table><thead><tr><th>序号</th><th>服务</th><th>端口号</th></tr></thead><tbody><tr><td>01</td><td>SSH 服务器</td><td>22</td></tr><tr><td>02</td><td>Web 服务器</td><td>80</td></tr><tr><td>03</td><td>HTTPS</td><td>443</td></tr><tr><td>04</td><td>FTP 服务器</td><td>21</td></tr></tbody></table><p>windows系统可以打开cmd输入以下命令检测网络互连的其他主机的端口号是否放行。</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet ip 端口</span><br></pre></td></tr></table></figure><blockquote><p>提示：有关 <strong>端口号</strong>的详细内容，待续补充······</p></blockquote><p><strong>ssh协议</strong>： SSH是目前较可靠，专为远程登录会话和其他网络服务提供安全性的协议。特点：利用SSH协议可以有效防止远程管理过程中的信息泄露；通过SSH 协议可以对所有传输的数据进行加密，也能够防止 DNS 欺骗和 IP 欺骗；此外它还具有一个优点，就是是传输的数据可以是经过压缩的，所以可以加快传输的速度。</p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/001_SSH%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="001_SSH示意图"></p><p><em>要搭建ssh环境，需要分别安装服务端和客户端程序。SSH服务端是安装在服务器中提供ssh协议远程操控的服务软件。只有ssh服务端运行了才能通过ssh客户端连接服务器。</em></p><h3 id="2-远程登录"><a class="header-anchor" href="#2-远程登录">¶</a>2. 远程登录</h3><h4 id="2-1-ssh服务端安装和配置"><a class="header-anchor" href="#2-1-ssh服务端安装和配置">¶</a>2.1 ssh服务端安装和配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##切换到root用户</span></span><br><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line"><span class="comment">##安装ssh服务（如没有安装）</span></span><br><span class="line"><span class="comment">#Debian系列系统安装ssh服务</span></span><br><span class="line">apt install openssh-server</span><br><span class="line"><span class="comment">#Redhat系列系统安装ssh服务</span></span><br><span class="line">yum install openssh openssh-clients openssh-server -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#编辑 sshd_config 配置文件</span></span><br><span class="line">	<span class="comment">#将 PermitRootLogin 的值设置为 yes，表示允许 root 用户登录。</span></span><br><span class="line">	<span class="comment">#将 PasswordAuthentication 的值设置为 yes，表示允许使用密码认证，如果为 no，则表示不允许使用密码认证，只能使用公钥认证。</span></span><br><span class="line">	<span class="comment">#注意：如果在 sshd_config 配置文件中有导入其他配置文件，则需要注意导入的配置文件是否会覆盖配置内容，例如：Ubuntu22.04 中就会导入 /etc/ssh/sshd_config.d/50-cloud-init.conf 配置内容</span></span><br><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="comment">##sshd服务管理命令</span></span><br><span class="line">	<span class="comment">#systemctl start|stop|restart|enable|status &lt;service&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">#Redhat系列系统启动sshd服务，并设置开机自启动</span></span><br><span class="line">systemctl start sshd <span class="comment">#启动服务（通常安装后默认都已启动）</span></span><br><span class="line"><span class="comment">#或：service sshd start</span></span><br><span class="line">systemctl <span class="built_in">enable</span> sshd <span class="comment">#开机自启动服务</span></span><br><span class="line"><span class="comment">#或：chkconfig --level 3 sshd on</span></span><br><span class="line">systemctl restart sshd <span class="comment">#重启服务（可选，如修改sshd_config配置，则需要重启服务）</span></span><br><span class="line"><span class="comment">#或：service sshd restart</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Redhat系列系统启动ssh服务，并设置开机自启动</span></span><br><span class="line">systemctl start ssh <span class="comment">#启动服务</span></span><br><span class="line"><span class="comment">#或：service ssh start</span></span><br><span class="line">systemctl <span class="built_in">enable</span> ssh <span class="comment">#开机自启动服务</span></span><br><span class="line"><span class="comment">#或：chkconfig --level 3 ssh on</span></span><br><span class="line">systemctl restart ssh <span class="comment">#重启服务（可选，如修改sshd_config配置，则需要重启服务）</span></span><br><span class="line"><span class="comment">#或：service ssh restart</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##配置root用户密码认证（只需设置root用户密码即可）</span></span><br><span class="line">passwd root</span><br><span class="line"><span class="comment">##配置root用户公钥认证（只需将客户端的ssh公钥内容导入到root用户的ssh配置即可）</span></span><br><span class="line"><span class="comment">#清除root用户的默认ssh配置（防止一些默认脚本影响使用，如authorized_keys文件原本就没有脚本内容则无需操作）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">""</span> &gt; /root/.ssh/authorized_keys</span><br><span class="line"><span class="comment">#将客户端的ssh公钥内容导入到root用户的ssh配置中（客户端可通过 cat ~/.ssh/id_rsa.pub 命令获取ssh公钥内容）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"ssh公钥内容"</span> &gt;&gt; /root/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><h4 id="2-2-ssh客户端安装和使用"><a class="header-anchor" href="#2-2-ssh客户端安装和使用">¶</a>2.2 ssh客户端安装和使用</h4><p>SSH 客户端是一种使用SSH协议连接到远程计算机的软件程序，通过SSH 客户端我们可以连接到运行了 SSH 服务器的远程机器上。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#默认系统已经安装，如果没有可通过命令来安装</span></span><br><span class="line">apt install openssh-client</span><br></pre></td></tr></table></figure><p><strong>(1) Linux下SSH 客户端的简单使用</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##ssh远程连接服务器</span></span><br><span class="line"><span class="comment">#user是在远程机器上的用户名，如果不指定的话默认为当前用户</span></span><br><span class="line"><span class="comment">#remote是远程机器的地址，可以是IP或者域名</span></span><br><span class="line"><span class="comment">#port是SSH Serve监听的端口，如果不指定，就为默认值22</span></span><br><span class="line">ssh [-p port] user@remote</span><br></pre></td></tr></table></figure><p><em>注意：如果在 <code>Windows</code> 系统中，可以安装 <code>PuTTY</code> 或者 <code>XShell</code> 客户端软件即可。</em></p><blockquote><p>提示：使用 <code>exit</code> 退出当前用户的登录</p></blockquote><p><strong>(2) Windows 下 SSH 客户端的安装</strong></p><ul><li><p><code>Putty</code> <a href="http://www.chiark.greenend.org.uk/%7Esgtatham/putty/latest.html" target="_blank" rel="noopener">http://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html</a></p></li><li><p><code>XShell</code> <a href="http://xshellcn.com" target="_blank" rel="noopener">http://xshellcn.com</a></p><blockquote><p>建议从官方网站下载正式的安装程序</p></blockquote></li></ul><h5 id="1-ssh免密码登录"><a class="header-anchor" href="#1-ssh免密码登录">¶</a>1）ssh免密码登录</h5><p>实现方式：使用公钥认证进行登录。</p><p>原理：使用非对称加密原理进行登录认证。首先由ssh客户端生成密钥对，然后用户将公钥添加到服务端的某认证配置文件里。当用户登陆时，会通过私钥对请求数据进行签名，并将已经签名的数据发送给ssh服务端，ssh服务端会去认证配置文件拿到公钥并进行验签,如果验签成功则允许登入，否则拒绝。由于私钥只有保存在用户自己的客户端中，因此入侵者就算得到用户公钥，也不能登陆到服务器。</p><blockquote><p>非对称加密算法：</p><p>使用 <strong>公钥</strong> 加密的数据，只能使用 <strong>私钥</strong> 解密</p><p>使用 <strong>私钥</strong> 加密的数据，只能使用 <strong>公钥</strong> 解密</p></blockquote><p><strong>实现步骤</strong></p><p>（1）SSH客户端生成密钥对</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成密钥对，一路回车即可。会在~/.ssh下生成一个私钥文件（id_rsa）和一个公钥文件（id_rsa.pub）</span></span><br><span class="line">ssh-keygen</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认 ssh 秘钥标识为 “root@主机名”，如果希望自定义标识可如下实现：</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">"youremail@example.com"</span></span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1541837505008.png" alt="1541837505008"></p><blockquote><p>终端会提示一些问题：</p><ul><li>第一个问题是设置私钥和公钥的文件名，如果不设置默认是<code>id_rsa</code>和<code>id_rsa.pub</code></li><li>第二个问题是要不要对私钥设置口令（passphrase），如果担心私钥的安全则可以设置。</li></ul><p>关于多个客户端使用同一个 ssh key 的实现方式：</p><p>每个客户端连接服务器都需要配置该客户端自己的 ssh key 到服务器中。通常情况下，不同的客户端会使用不同的 ssh key，这样虽然更能保护私钥的安全，但也会导致多密码管理麻烦。如果用户能确保多个客户端都是自己的，那么可以让这些客户端使用同一个 ssh key，这样就只需要设置一个 ssh key 到服务器，多个客户端就能免密连接服务器了。虽然可以直接复制 ssh key 到其他的客户端中，但在 Linux 客户端中使用时可能会提示失败：<code>WARNING: UNPROTECTED PRIVATE KEY FILE!</code>，解决办法是：对复制的文件重新设置操作权限，命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 ~/.ssh/id_rsa</span><br><span class="line">chmod 644 ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure></blockquote><p>（2）上传公钥到服务器</p><p>方式1：直接copy客户端的<code>~/.ssh/id_rsa.pub</code>内容直接追加到服务端的<code>~/.ssh/authorized_keys</code>里。</p><p>方式2：SSH客户端执行以下命令上传 到服务端：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#执行完命令即可上传客户端公钥到指定的服务器的~/.ssh/authorized_keys里（其实就是追加了id_rsa.pub的内容）</span></span><br><span class="line">ssh-copy-id -p port user@remote</span><br></pre></td></tr></table></figure><p>执行完以上操作后，远程服务器即可认证客户端，客户端也有了ssh免密登录的权限。</p><p><strong>示意图:</strong></p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/003_SSH%E5%85%8D%E5%AF%86%E7%A0%81%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="003_SSH 免密码示意图"></p><h5 id="3-配置ssh服务别名"><a class="header-anchor" href="#3-配置ssh服务别名">¶</a>3）配置ssh服务别名</h5><p>客户端每次都输入 <code>ssh -p port user@remote</code>，时间久了会觉得很麻烦，特别是当 <code>user</code>, <code>remote</code> 和 <code>port</code> 都得输入，而且还不好记忆。</p><p>而给客户端<strong>配置别名</strong>可以解决这个问题，譬如用：<code>ssh myserver</code> 来替代上面这么一长串。要实现这个功能需要在客户端的 <code>~/.ssh/config</code> （没有这个文件则手动创建）里面追加以下内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host myserver</span><br><span class="line">    HostName 服务器ip地址</span><br><span class="line">    User 服务器用户名</span><br><span class="line">    Port 22</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host myserver</span><br><span class="line">    HostName 192.168.1.130</span><br><span class="line">    User qcmoke</span><br><span class="line">    Port 22</span><br></pre></td></tr></table></figure><p>保存之后，即可用 以下命令实现快速远程登录了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ssh myserver</span><br><span class="line"></span><br><span class="line"><span class="comment">#此外对于scp命令同样可以使用myserver替代-P port user@remote了</span></span><br><span class="line">$ scp -r demo myserver:/home</span><br></pre></td></tr></table></figure><p><em>注意：ssh客户端会把你每次登陆过的计算机的公钥(public key)都记录在<code>~/.ssh/known_hosts</code>中。当下次登陆相同计算机时，ssh服务端会核对公钥。如果公钥不同，ssh服务端会发出警告给客户端。</em></p><p><em>一台客户端连接多个Linux系统，会经常切换，但客户端使用同一个ip，客户端登录过一次后就会把ssh信息记录在客户端本地的<code>~/.ssh/known_hsots</code>文件中，客户端切换其他系统后再用ssh访问原来登陆的系统就会出现冲突警告。</em></p><p><em>解决办法： 客户端直接把<code>~/.ssh/known_hosts</code>文件删除即可。</em></p><h3 id="3-远程文件传输"><a class="header-anchor" href="#3-远程文件传输">¶</a>3. 远程文件传输</h3><p>通过使用ssh客户端可以登录控制服务器了，但是想要在客户端和服务器之间进行文件传输还得需要其他的传输工具。有的是基于ssh协议的，有的基于ftp协议的，还有的是基于sftp协议等的，各有千秋。下面介绍三种工具：即SCP、FileZilla、Xftp 。</p><h4 id="3-1-scp"><a class="header-anchor" href="#3-1-scp">¶</a>3.1 scp</h4><p>scp 就是 <code>secure copy</code>，是基于<code>ssh</code>登陆进行<strong>安全的远程文件拷贝</strong>命令。只要服务器安装有ssh服务软件，客户端安装有ssh客户端软件，并建立起了连接，则可以直接使用。它的<strong>地址格式与 ssh 基本相同</strong>，<strong>需要注意的是</strong>，在指定端口时用的是大写的 <code>-P</code> 而不是小写的。</p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/002_SCP%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="002_SCP示意图"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把本地当前目录下的 01.py 文件 复制到 远程 家目录下的 Desktop/01.py</span></span><br><span class="line"><span class="comment"># 注意：`:` 后面的路径如果不是绝对路径，则以用户的家目录作为参照路径</span></span><br><span class="line">scp -P port 01.py user@remote:Desktop/01.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把远程 家目录下的 Desktop/01.py 文件 复制到 本地当前目录下的 01.py</span></span><br><span class="line">scp -P port user@remote:Desktop/01.py 01.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加上 -r 选项可以传送文件夹</span></span><br><span class="line"><span class="comment"># 把当前目录下的 demo 文件夹 复制到 远程 家目录下的 Desktop</span></span><br><span class="line">scp -r demo user@remote:Desktop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把远程 家目录下的 Desktop 复制到 当前目录下的 demo 文件夹</span></span><br><span class="line">scp -r user@remote:Desktop demo</span><br></pre></td></tr></table></figure><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td>-r</td><td>若给出的源文件是目录文件，则 scp 将递归复制该目录下的所有子目录和文件，目标文件必须为一个目录名</td></tr><tr><td>-P</td><td>若远程 SSH 服务器的端口不是 22，需要使用大写字母 -P 选项指定端口</td></tr></tbody></table><blockquote><p>注意：</p><p><code>scp</code> 这个终端命令只能在 <code>Linux</code> 或者 <code>UNIX</code> 系统下使用</p><p>如果在 <code>Windows</code> 系统中，可以安装 <code>PuTTY</code>，使用 <code>pscp</code> 命令行工具或者安装 <code>FileZilla</code> 使用 <code>FTP</code> 进行文件传输</p></blockquote><h4 id="3-2-filezilla"><a class="header-anchor" href="#3-2-filezilla">¶</a>3.2 FileZilla</h4><p>官方网站：<a href="https://www.filezilla.cn/download/client" target="_blank" rel="noopener">https://www.filezilla.cn/download/client</a></p><p><code>FileZilla</code> 在传输文件时，使用的是 <code>FTP 服务</code> 而不是 <code>SSH 服务</code>，因此端口号应该设置为 <code>21</code>。使用FTP服务的时候，我们都知道默认是21号端口，其实还有一个20号端口。FTP使用两个TCP连接，21号端口负责控制连接，20号端口负责数据连接。</p><h4 id="3-3-xftp"><a class="header-anchor" href="#3-3-xftp">¶</a>3.3 Xftp</h4><p>官方网站：<a href="https://www.netsarang.com/products/xfp_overview.html" target="_blank" rel="noopener">https://www.netsarang.com/products/xfp_overview.html</a></p><p>Xftp除了使用FTP服务还使用了SFTP服务，通过使用SFTP协议连接服务器传输文件会更安全。SFTP是SSH的一部分，在SSH软件包中，已经包含了一个SFTP(Secure File Transfer Protocol)的安全文件传输子系统，SFTP本身没有单独的守护进程，它必须使用sshd守护进程（端口号默认是22）来完成相应的连接操作。由于这种传输方式使用了加密/解密技术，文件传送相对来说是很安全的，但是是有代价的，它的传输效率比FTP要低得多。</p><h4 id="3-4-lrzsz"><a class="header-anchor" href="#3-4-lrzsz">¶</a>3.4 lrzsz</h4><p>基于命令操作的上传下载的工具 <code>lrzsz</code>，目前主流的SSH连接工具 ( SecureCRT、XShell 等 ) 都支持这些协议。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务器安装</span></span><br><span class="line">yum install -y lrzsz	<span class="comment">#centos</span></span><br><span class="line">apt install lrzsz	<span class="comment">#ubuntu</span></span><br><span class="line"><span class="comment">#在客户端执行弹窗选择文件上传</span></span><br><span class="line">rz</span><br><span class="line"><span class="comment">#在服务端执行选择文件下载（多文件sz 1.txt 2.txt）</span></span><br><span class="line">sz a.txt</span><br></pre></td></tr></table></figure><h2 id="十一-磁盘管理"><a class="header-anchor" href="#十一-磁盘管理">¶</a>十一、磁盘管理</h2><h3 id="1-相关基础命令"><a class="header-anchor" href="#1-相关基础命令">¶</a>1. 相关基础命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示磁盘分区使用情况 -h：使用人类可读的格式 -T：显示磁盘分区文件系统类型</span></span><br><span class="line">df -h</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看可用设备（包括磁盘等）-f 查看文件系统相关设备 -S 查看scsi设备相关设备</span></span><br><span class="line">lsblk</span><br><span class="line">lsblk -f</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# lsblk </span><br><span class="line">#TYPE：disk表示磁盘，part表示标准分区，lvm逻辑卷分区</span><br><span class="line">#MOUNTPOINT：挂载点</span><br><span class="line">NAME                                                 MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda #第一个磁盘                                         8:0    0   20G  0 disk </span><br><span class="line">├─sda1 #第一个磁盘下的第一个分区                          8:1    0  500M  0 part &#x2F;boot</span><br><span class="line">└─sda2 #第一个磁盘下的第二个分区                          8:2    0 19.5G  0 part </span><br><span class="line">  ├─centos-swap                                      253:0    0    2G  0 lvm  [SWAP]</span><br><span class="line">  └─centos-root                                      253:1    0 17.5G  0 lvm  &#x2F;</span><br><span class="line">sdb  #第二个磁盘（没有分区）                             8:16   0   10G  0 disk</span><br><span class="line"></span><br><span class="line">#磁盘格式化后就会有文件系统类型和uuid  </span><br><span class="line">[root@localhost ~]# lsblk -f</span><br><span class="line">NAME                                                 FSTYPE（文件系统类型）LABEL UUID                                   MOUNTPOINT</span><br><span class="line">sda                                                                                                           </span><br><span class="line">├─sda1                                               xfs               be642956-78fe-4538-a3ab-840d6de853b7   &#x2F;boot</span><br><span class="line">└─sda2                                               LVM2_member       dCCxeE-hgqX-XBLU-6AXZ-ikIJ-va94-Q5IF2D </span><br><span class="line">  ├─centos-swap                                      swap              653b8409-ce8f-4f98-904a-a1745d6568cc   [SWAP]</span><br><span class="line">  └─centos-root                                      xfs               c6387d81-0587-4548-9a06-6c406ad9034a   &#x2F;</span><br><span class="line">sdb</span><br></pre></td></tr></table></figure><h3 id="2-标准分区管理"><a class="header-anchor" href="#2-标准分区管理">¶</a>2. 标准分区管理</h3><p>当添加了一块新磁盘后，系统是不能直接使用的，需要对磁盘进行创建分区、格式化分区、挂载分区三个步骤后才能正常使用。</p><h4 id="1-创建分区"><a class="header-anchor" href="#1-创建分区">¶</a>1）创建分区</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#可通过如下命令查看新加的磁盘其所在linux系统中的名称，假设为/dev/sdb</span></span><br><span class="line">fdisk -l</span><br><span class="line"><span class="comment">#创建分区，对新磁盘进行分区（执行命令之后将会进行手工命令交互过程）</span></span><br><span class="line">fdisk /dev/sdb</span><br></pre></td></tr></table></figure><p>创建分区示例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># fdisk /dev/sdb </span></span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table</span><br><span class="line">Building a new DOS disklabel with disk identifier 0x5a23d71f.</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): m	<span class="comment">#查看输入选项菜单</span></span><br><span class="line">Command action</span><br><span class="line">   a   toggle a bootable flag</span><br><span class="line">   b   edit bsd disklabel</span><br><span class="line">   c   toggle the dos compatibility flag</span><br><span class="line">   d   delete a partition</span><br><span class="line">   g   create a new empty GPT partition table</span><br><span class="line">   G   create an IRIX (SGI) partition table</span><br><span class="line">   l   list known partition types</span><br><span class="line">   m   <span class="built_in">print</span> this menu</span><br><span class="line">   n   add a new partition</span><br><span class="line">   o   create a new empty DOS partition table</span><br><span class="line">   p   <span class="built_in">print</span> the partition table</span><br><span class="line">   q   quit without saving changes</span><br><span class="line">   s   create a new empty Sun disklabel</span><br><span class="line">   t   change a partition<span class="string">'s system id</span></span><br><span class="line"><span class="string">   u   change display/entry units</span></span><br><span class="line"><span class="string">   v   verify the partition table</span></span><br><span class="line"><span class="string">   w   write table to disk and exit</span></span><br><span class="line"><span class="string">   x   extra functionality (experts only)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Command (m for help): n	#创建新分区</span></span><br><span class="line"><span class="string">Partition type:</span></span><br><span class="line"><span class="string">   p   primary (0 primary, 0 extended, 4 free)</span></span><br><span class="line"><span class="string">   e   extended</span></span><br><span class="line"><span class="string">Select (default p): p	#分区类型选择为主分区</span></span><br><span class="line"><span class="string">Partition number (1-4, default 1): 1	#指定分区号，如果输入1，那么分区为/dev/sdb2，2则为/dev/sdb2</span></span><br><span class="line"><span class="string">First sector (2048-20971519, default 2048): 2048	#指定第一个扇区地址（2048默认值，表示从磁盘的第一个扇区，可直接回车选默认）</span></span><br><span class="line"><span class="string">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-20971519, default 20971519): 20971519 #最后一个扇区地址（默认磁盘的最大可存储地址，可直接回车选默认，如果该磁盘需要创建多个分区的话可以按照需求修改）</span></span><br><span class="line"><span class="string">Partition 1 of type Linux and of size 10 GiB is set</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Command (m for help): w #写入分区并退出</span></span><br><span class="line"><span class="string">The partition table has been altered!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Calling ioctl() to re-read partition table.</span></span><br><span class="line"><span class="string">Syncing disks.</span></span><br></pre></td></tr></table></figure><blockquote><p>默认使用DOS（即MBR）作为磁盘分区方案，如果需要使用GPT，那么需要在输入“n”创建分区之前先输入“g”指定为GPT分区方案，如需改回MBR方案，只需创建分区之前先输入“o”指定为MBR分区方案。</p><p>MBR只能支持最多4个主分区或3个主分区和1个扩展分区。每个主分区最多可以有一个逻辑分区，而一个扩展分区可以创建多个逻辑分区。它使用了一个512字节的扇区来存储分区表信息，由于分区表大小的限制所以只能支持到最多4个主分区。</p><p>GPT能够支持更多的分区（理论无限）。GPT没有主分区和扩展分区的概念，所有分区都是相等的，可以理解为所有的分区都是主分区。它使用64个扇区（32KB）来存储分区信息，相比之下，MBR分区表只有512字节。这使得GPT分区表能够存储更多的分区信息。</p></blockquote><h4 id="2-格式化分区"><a class="header-anchor" href="#2-格式化分区">¶</a>2）格式化分区</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#格式化分区</span></span><br><span class="line">mkfs -t ext4 /dev/sdb1</span><br><span class="line"><span class="comment">#或者mkfs.ext4 -F /dev/sdb1</span></span><br></pre></td></tr></table></figure><h4 id="3-挂载分区"><a class="header-anchor" href="#3-挂载分区">¶</a>3）挂载分区</h4><p>挂载即将一个分区与一个目录进行关联，使操作该目录文件即操作对应的磁盘分区。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先创建需要挂载的目录</span></span><br><span class="line">mkdir /data</span><br><span class="line"><span class="comment">#将分区挂载到对应目录（临时挂载）</span></span><br><span class="line">mount /dev/sdb1 /data</span><br><span class="line"><span class="comment">#最后查看挂载是否成功</span></span><br><span class="line">df -h</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置开机自动挂载</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"/dev/sdb1 /data ext4 defaults 1 1"</span> &gt;&gt; /etc/fstab</span><br><span class="line"><span class="comment">#或者通过分区的uuid进行挂载（查看所有分区的对应UUID，可通过命令blkid查看），如下：</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"UUID=6f74be84-76e7-4177-a387-e2e711329c33 /data ext4 defaults 1 1"</span> &gt;&gt; /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment">#挂载 /etc/fstab 配置文件里的所有文件系统以立即生效</span></span><br><span class="line">mount -a</span><br><span class="line"><span class="comment">#或者通过重启以生效：reboot</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看系统磁盘挂载情况</span></span><br><span class="line">df -h</span><br></pre></td></tr></table></figure><blockquote><p>注意：如果需挂载的目录在挂载前存在文件，那么挂载后这些文件将会&quot;消失&quot;，但卸载后这些文件就又会显现，原因是挂载前文件是存在于原来的磁盘分区上的，如果同一目录挂载了新的磁盘分区，那么该目录显示的是新磁盘分区的内容，而新分区并没有这些文件所以文件会&quot;消失&quot;。当卸载后，挂载目录又会回到原磁盘分区上，自然就会把原本的文件显现出来。</p></blockquote><h4 id="4-卸载及删除分区"><a class="header-anchor" href="#4-卸载及删除分区">¶</a>4）卸载及删除分区</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##卸载</span></span><br><span class="line">umount /dev/sdb1 </span><br><span class="line"><span class="comment">#或者 umount /data</span></span><br><span class="line"><span class="comment">#如果是开机自动挂载的话还需要删除/etc/fstab文件对应的挂载配置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##删除分区</span></span><br><span class="line">fdisk /dev/sdb</span><br><span class="line">m</span><br><span class="line">d</span><br><span class="line">1   </span><br><span class="line">d   <span class="comment">#删除</span></span><br><span class="line">w   <span class="comment">#输入 w  保存，这个时候分区以及删除了，可以重新创建了</span></span><br></pre></td></tr></table></figure><h4 id="参考："><a class="header-anchor" href="#参考：">¶</a>参考：</h4><p><a href="https://www.cnblogs.com/zishengY/p/7137671.html" target="_blank" rel="noopener">https://www.cnblogs.com/zishengY/p/7137671.html</a></p><p><a href="https://www.iplayio.cn/post/80157" target="_blank" rel="noopener">https://www.iplayio.cn/post/80157</a></p><h3 id="3-lvm分区管理"><a class="header-anchor" href="#3-lvm分区管理">¶</a>3. LVM分区管理</h3><h4 id="1-相关概念"><a class="header-anchor" href="#1-相关概念">¶</a>1）相关概念</h4><p>标准分区是指将磁盘分割成若干个区域，每个区域被称为分区。每个分区都被视为一个独立的逻辑单元，并且可以格式化为不同的文件系统类型。标准分区方案的优点是简单、直观，易于管理和维护。但是，如果需要调整分区大小或添加新的分区，则需要重新分区，并且可能需要重装操作系统，这会导致数据丢失和系统停机时间较长等问题。</p><p>LVM是一种更加灵活的磁盘分区方案，它允许将多个物理磁盘或分区设置为物理卷（PV）， 然后将它们组合成一个或多个逻辑卷组（VG），然后将逻辑卷组划分为一个或多个逻辑卷（LV）。逻辑卷是一个虚拟的磁盘分区，它可以动态地调整大小和移动，而不需要重新分区或重装操作系统。此外，LVM还支持在线扩容和快照等高级特性。</p><p>与标准分区相比，LVM的优点在于它提供了更高的灵活性和可扩展性，可以动态地分配和管理存储空间，避免了重新分区和重装操作系统的繁琐过程。但是，LVM也存在一些缺点，比如它可能会降低磁盘性能，增加系统复杂度和学习成本等。因此，在选择分区方案时，需要根据实际需求和环境来进行权衡和选择。</p><p>说明：</p><blockquote><p>物理卷逻辑上可划分为多个大小相同的物理拓展PE，PE是LVM中的最小分配单元，每个 PE 的大小通常为 4MB，可以在创建pv的时候指定其大小，如创建一个PE大小为8MB的物理卷/dev/sdb1：<code>pvcreate -s 8M /dev/sdb1</code></p><p>LV大小为PE的整数倍，组成LV的PE可能来自不同的物理磁盘。</p><p>在LVM中，物理卷（PV）的可用大小可能小于其底层设备的大小，其中一些原因包括：</p><ol><li>LVM会在物理卷上保留一部分空间作为元数据区域，用于存储逻辑卷组（VG）和逻辑卷（LV）的元数据信息。这些元数据占用了一定的空间，从而减少了物理卷的可用空间。</li><li>物理卷使用的文件系统可能也会在设备上分配一些空间，例如ext4文件系统会在物理卷上保留一部分空间用于存储文件系统元数据和碎片信息。这些空间也会使得物理卷的可用空间减少。</li><li>如果物理卷上还有其他分区或文件系统，则它们也会占用一些空间，从而减少了物理卷的可用空间。</li></ol><p>因此，当创建物理卷时，应该考虑到这些因素，并为物理卷预留足够的空间以供元数据和其他用途使用。</p></blockquote><h4 id="2-查看"><a class="header-anchor" href="#2-查看">¶</a>2）查看</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看物理卷</span></span><br><span class="line">pvs、pvdisplay、pvscan</span><br><span class="line"><span class="comment">#查看卷组</span></span><br><span class="line">vgs、vgdisplay、vgscan</span><br><span class="line"><span class="comment">#查看逻辑卷</span></span><br><span class="line">lvs、lvdisplay、lvscan</span><br><span class="line"><span class="comment">#查看磁盘分区</span></span><br><span class="line">fdisk -L</span><br></pre></td></tr></table></figure><h4 id="3-创建-pv-vg-lv"><a class="header-anchor" href="#3-创建-pv-vg-lv">¶</a>3）创建 pv、vg、lv</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建pv物理卷(设备路径可以是磁盘设备路径（/dev/sdb）或者分区设备路径（/dev/sdb1）)</span></span><br><span class="line">pvcreate 设备路径</span><br><span class="line"><span class="comment">#如：pvcreate /dev/sdb</span></span><br><span class="line"><span class="comment">#还可以同时创建多个pv，如：pvcreate vg名 pv1路径 pv2路径 pv3路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建vg卷组</span></span><br><span class="line">vgcreate vg名 pv路径</span><br><span class="line"><span class="comment">#如：vgcreate myvg /dev/sdb</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建lv逻辑卷（大小可以用计量单位，比如5G，2048M等，如果设置的大小不满足pe大小的整数倍将自动进行四舍五入处理）</span></span><br><span class="line">lvcreate -n lv名 -L 大小 vg名</span><br><span class="line"><span class="comment">#如：lvcreate -n mylv -L 5G myvg</span></span><br></pre></td></tr></table></figure><h4 id="4-格式化和挂载-lv"><a class="header-anchor" href="#4-格式化和挂载-lv">¶</a>4）格式化和挂载 lv</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#格式化lv（lv完整路径可以通过命令lvdisplay查看）</span></span><br><span class="line">mkfs.ext4 lv完整路径</span><br><span class="line"><span class="comment">#如：mkfs.ext4 /dev/myvg/mylv</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#挂载（挂载点即需要挂载的目录，需要提前创建）</span></span><br><span class="line">mount  lv完整路径  挂载点目录路径</span><br><span class="line"><span class="comment">#如：mount  /dev/myvg/mylv  /mnt/mylv</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#开机自动挂载</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"lv完整路径 挂载点目录路径 ext4 defaults 1 1"</span> &gt;&gt; /etc/fstab</span><br><span class="line"><span class="comment">#如：echo "/dev/myvg/mylv /mnt/mylv ext4 defaults 1 1" &gt;&gt; /etc/fstab</span></span><br></pre></td></tr></table></figure><h4 id="5-卸载-lv"><a class="header-anchor" href="#5-卸载-lv">¶</a>5）卸载 lv</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#（如果有开机自动挂载配置还需要删除/etc/fstab文件对应的挂载配置）</span></span><br><span class="line">umount lv完整路径</span><br><span class="line"><span class="comment">#如：umount /mnt/mylv</span></span><br></pre></td></tr></table></figure><h4 id="6-删除-lv-vg-pv"><a class="header-anchor" href="#6-删除-lv-vg-pv">¶</a>6）删除 lv、vg、pv</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删lv（注意：删除lv前要先将其卸载）</span></span><br><span class="line">lvremove lv完整路径 </span><br><span class="line"><span class="comment">#如：lvremove /dev/myvg/mylv</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删vg</span></span><br><span class="line">vgremove vg名</span><br><span class="line"><span class="comment">#如：vgremove myvg</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删PV</span></span><br><span class="line">pvremove 设备完整路径 去硬盘</span><br><span class="line"><span class="comment">#如：pvremove /dev/sdb</span></span><br></pre></td></tr></table></figure><h4 id="7-扩容"><a class="header-anchor" href="#7-扩容">¶</a>7）扩容</h4><p>扩容 l v的时如果 vg 容量不够，需要添加 pv 并加到 vg 中然后再给 lv 扩容，否则不需要这个步骤。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加新的pv</span></span><br><span class="line">pvcreate 设备路径</span><br><span class="line"><span class="comment">#如：pvcreate /dev/sdc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#扩展vg</span></span><br><span class="line">vgextend vg名 新增pv路径</span><br><span class="line"><span class="comment">#如：vgextend myvg /dev/sdc</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#扩容lv（扩展量可以用计量单位，比如3G，通过+表示扩展多少，而如果不用+则表示扩展到多少）</span></span><br><span class="line">lvextend -L +扩展量 lv完整路径</span><br><span class="line"><span class="comment">#如：lvextend -L +3G /dev/myvg/mylv</span></span><br></pre></td></tr></table></figure><p>以上只是对lv进行扩容，但文件系统是无法识别的，故需要调整文件系统容量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#调整文件系统容量（将文件系统扩展到逻辑卷的整个大小）</span></span><br><span class="line">resize2fs lv完整路径 </span><br><span class="line"><span class="comment">#如：resize2fs /dev/myvg/mylv</span></span><br></pre></td></tr></table></figure><h4 id="8-缩容"><a class="header-anchor" href="#8-缩容">¶</a>8）缩容</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#首先进行卸载</span></span><br><span class="line">umount lv完整路径</span><br><span class="line"><span class="comment">#如：umount /dev/myvg/mylv</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#检查文件系统</span></span><br><span class="line">e2fsck -f lv完整路径</span><br><span class="line"><span class="comment">#如：e2fsck -f /dev/myvg/mylv</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#减少文件系统</span></span><br><span class="line">resize2fs lv完整路径 减少到的大小</span><br><span class="line"><span class="comment">#如：resize2fs /dev/myvg/mylv 2G</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#减少lv卷大小（注意:文件系统的减小后大小一定要和lv卷最终大小相等）</span></span><br><span class="line">lvreduce -L 减少到的大小 lv的完整路径</span><br><span class="line"><span class="comment">#如：lvreduce -L 2G /dev/myvg/mylv</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重新挂载使用</span></span><br><span class="line">mount  lv完整路径  挂载点</span><br><span class="line"><span class="comment">#如：mount  /dev/myvg/mylv  /mnt/mylv</span></span><br></pre></td></tr></table></figure><h4 id="9-替换磁盘"><a class="header-anchor" href="#9-替换磁盘">¶</a>9）替换磁盘</h4><p>在 LVS 中，替换磁盘即替换 PV，注意新 PV 容量要大于等于原 PV。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设将原sda磁盘替换为新的sdb磁盘，并移除原sda磁盘，操作如下：</span></span><br><span class="line"><span class="comment">#先准备一个新的磁盘 pv 加入搭配 vg 中</span></span><br><span class="line">pvcreate /dev/sdb</span><br><span class="line">gextend myvg /dev/sdb</span><br><span class="line"><span class="comment">#通过pvmove命令移动原pv的数据到新的pv中</span></span><br><span class="line">pvmove /dev/sda /dev/sdb</span><br><span class="line"><span class="comment">#从vg中移除原pv</span></span><br><span class="line">vgreduce myvg /dev/sda</span><br><span class="line"><span class="comment">#删除原pv</span></span><br><span class="line">pvremove /dev/sda</span><br><span class="line"><span class="comment">#如果新pv容量比原pv大，则还可以通过lvextend和resize2fs命令进行扩容</span></span><br></pre></td></tr></table></figure><h4 id="参考：-v2"><a class="header-anchor" href="#参考：-v2">¶</a>参考：</h4><blockquote><ul><li><a href="https://www.cnblogs.com/linuxprobe/p/5381538.html" target="_blank" rel="noopener">https://www.cnblogs.com/linuxprobe/p/5381538.html</a></li></ul></blockquote><h2 id="十二-时间管理"><a class="header-anchor" href="#十二-时间管理">¶</a>十二、时间管理</h2><h3 id="1-查看时间"><a class="header-anchor" href="#1-查看时间">¶</a>1. 查看时间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前系统时间</span></span><br><span class="line">date</span><br><span class="line"><span class="comment">#指定格式查看当前系统时间</span></span><br><span class="line">date +<span class="string">"%Y-%m-%d %H:%M:%S"</span></span><br><span class="line"><span class="comment">#查看日历，-y选项可以查看一年的日历</span></span><br><span class="line">cal</span><br><span class="line">cal 2022</span><br></pre></td></tr></table></figure><h3 id="2-修改时间"><a class="header-anchor" href="#2-修改时间">¶</a>2. 修改时间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改时分秒</span></span><br><span class="line">date -s 11:11:11</span><br><span class="line"><span class="comment">#修改年月日</span></span><br><span class="line">date -s 2019-11-11</span><br><span class="line"><span class="comment">#修改年月日时分秒</span></span><br><span class="line">date -s <span class="string">"2019-11-11 11:11:11"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#保存为bios时间(RTC)（同步BIOS时钟，强制将系统时间写入CMOS，使之永久生效，避免系统重启后恢复成原时间。）</span></span><br><span class="line">hwclock  -w</span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line">clock -w</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看bios时间</span></span><br><span class="line">hwclock  -r</span><br></pre></td></tr></table></figure><h3 id="3-设置时区"><a class="header-anchor" href="#3-设置时区">¶</a>3.设置时区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前系统配置的时区</span></span><br><span class="line">timedatectl | grep <span class="string">"Time zone"</span>	<span class="comment">#或者：cat /etc/timezone</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#显示系统中支持的所有时区列表</span></span><br><span class="line">timedatectl list-timezones</span><br><span class="line"><span class="comment">#设置当前系统为Asia/Shanghai上海时区</span></span><br><span class="line">timedatectl <span class="built_in">set</span>-timezone Asia/Shanghai</span><br></pre></td></tr></table></figure><h3 id="4-时间同步"><a class="header-anchor" href="#4-时间同步">¶</a>4. 时间同步</h3><h4 id="4-1-单机版"><a class="header-anchor" href="#4-1-单机版">¶</a>4.1 单机版</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装ntpdate</span></span><br><span class="line">yum install ntpdate -y</span><br><span class="line"><span class="comment">#同步网络时间（要求服务器可访问外网）</span></span><br><span class="line">ntpdate ntp1.aliyun.com</span><br><span class="line"><span class="comment">#保存为bios时间(RTC)</span></span><br><span class="line">hwclock  -w</span><br></pre></td></tr></table></figure><h4 id="4-2-集群版"><a class="header-anchor" href="#4-2-集群版">¶</a>4.2 集群版</h4><p>方案：集群中，要求有一台能访问外网的服务器作为时间服务器，其余内网服务器通过这台时间服务器来实现时间同步。有两种常用的服务工具实现：ntp和chrony</p><p>注意：这里ntp和chrony相比于ntpdate的区别在于，ntpdate只能手动单次同步时间（除非编写cronp配置），其同步时间的速度是很快的。而ntp和chrony本身就可以自己定时同步时间，其同步时间的速度可能需要几分钟以上。</p><p>全球相关ntp时间服务器：<a href="https://www.ntppool.org/zh/" target="_blank" rel="noopener">https://www.ntppool.org/zh/</a></p><h5 id="4-2-1-ntp"><a class="header-anchor" href="#4-2-1-ntp">¶</a>4.2.1 ntp</h5><p>（1）安装和环境准备</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装ntp</span></span><br><span class="line">yum install ntp -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#开放123端口防火墙作为客户端访问的端口</span></span><br><span class="line">firewall-cmd --permanent --add-port=123/udp</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"><span class="comment">#使用前可以把其他时间同步服务关掉，比如chrony（如果有使用的话）</span></span><br><span class="line">systemctl stop chronyd &amp;&amp; systemctl <span class="built_in">disable</span> chronyd</span><br></pre></td></tr></table></figure><p>（2）修改ntp参数配置文件</p><blockquote><p>🙆‍♂对于ntpd，发现这里不做配置也可以自动同步硬件时间。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim  /etc/sysconfig/ntpd</span><br><span class="line"><span class="comment">#可选择修改，是让ntpdate同步时候时写到硬件</span></span><br><span class="line">vim /etc/sysconfig/ntpdate</span><br></pre></td></tr></table></figure><p>修改或者追加如下配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#同步时间后，写到硬件中</span></span><br><span class="line"><span class="attr">SYNC_HWCLOCK</span>=<span class="string">yes</span></span><br></pre></td></tr></table></figure><p>（3）修改ntp配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改ntp配置文件（只做以下相关配置修改，其余保持不变）</span></span><br><span class="line">vim /etc/ntp.conf</span><br></pre></td></tr></table></figure><p>服务端配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#允许192.168.60.0网段内所有机器从本机同步时间</span></span><br><span class="line"><span class="attr">restrict</span> <span class="string">192.168.60.0 mask 255.255.255.0 nomodify notrap</span></span><br><span class="line"><span class="comment">#时间服务器地址</span></span><br><span class="line"><span class="attr">server</span> <span class="string">0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="attr">server</span> <span class="string">ntp1.aliyun.com iburst</span></span><br><span class="line"><span class="comment">#允许上层时间服务器主动修改本机时间</span></span><br><span class="line"><span class="attr">restrict</span> <span class="string">0.centos.pool.ntp.org nomodify notrap noquery</span></span><br><span class="line"><span class="attr">restrict</span> <span class="string">ntp1.aliyun.com nomodify notrap noquery</span></span><br><span class="line"><span class="comment">#外部时间服务器不可用时，以本地时间作为时间服务</span></span><br><span class="line"><span class="attr">server</span>  <span class="string">127.127.1.0</span></span><br><span class="line"><span class="attr">fudge</span>   <span class="string">127.127.1.0 stratum 10</span></span><br></pre></td></tr></table></figure><p>客户端配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#从node1中同步时间</span></span><br><span class="line"><span class="attr">server</span> <span class="string">192.168.60.101 iburst</span></span><br><span class="line"><span class="comment">#允许node01修改本地时间</span></span><br><span class="line"><span class="attr">restrict</span> <span class="string">192.168.60.101 nomodify notrap noquery</span></span><br><span class="line"><span class="comment">#如果node01不可用，用本地的时间服务</span></span><br><span class="line"><span class="attr">server</span> <span class="string">127.127.1.0</span></span><br><span class="line"><span class="attr">fudge</span> <span class="string">127.127.1.0 stratum 10</span></span><br></pre></td></tr></table></figure><p>（4）启动和测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ntpd进程进行同步时，可能需要5-10分钟的时间才能同步，另外ntpd开启后，则无法使用ntpdate，所以可以提前先手动同步</span></span><br><span class="line">ntpdate ntp1.aliyun.com</span><br><span class="line"><span class="comment">#ntpdate 192.168.60.101</span></span><br><span class="line">hwclock  -w</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">systemctl start ntpd</span><br><span class="line"><span class="comment">#开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> ntpd</span><br><span class="line">netstat -tunlp |grep ntpd</span><br><span class="line"></span><br><span class="line"><span class="comment">##上层 ntp 的状态</span></span><br><span class="line">    <span class="comment">#*表示目前使用的ntp server</span></span><br><span class="line">    <span class="comment">#remote：用于同步的远程节点或服务器。“LOCAL”表示本机（当没有远程服务器可用时会出现）</span></span><br><span class="line">    <span class="comment">#refid：远程的服务器进行同步的更高一级服务器</span></span><br><span class="line">    <span class="comment">#st：即stratum阶层，值越小表示ntp serve的精准度越高</span></span><br><span class="line">    <span class="comment">#when：最后一次同步到现在的时间</span></span><br><span class="line">    <span class="comment">#Poll表示，每隔多少毫秒与ntp server同步一次</span></span><br><span class="line">    <span class="comment">#reach：已经成功更新的次数</span></span><br><span class="line">    <span class="comment">#delay：从本地到远程节点或服务器通信的往返时间</span></span><br><span class="line">    <span class="comment">#offset：主机与远程节点或服务器时间源的时间偏移量，offset 越接近于0，主机和 NTP 服务器的时间越接近(以方均根表示，单位为毫秒)</span></span><br><span class="line">    <span class="comment">#jitter：与远程节点同步的时间源的平均偏差（多个时间样本中的 offset 的偏差，单位是毫秒），这个数值的绝对值越小，主机的时间就越精确</span></span><br><span class="line">ntpq -p</span><br><span class="line"><span class="comment">#可通过watch来实时监控</span></span><br><span class="line">watch ntpq -p</span><br><span class="line"></span><br><span class="line"><span class="comment">#ntp 同步状态（等待5-10分钟后，查看同步状态）</span></span><br><span class="line">ntpstat</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看日志</span></span><br><span class="line">tail -f /var/<span class="built_in">log</span>/messages</span><br></pre></td></tr></table></figure><h5 id="4-2-2-chrony"><a class="header-anchor" href="#4-2-2-chrony">¶</a>4.2.2 chrony</h5><p>（1）安装和环境准备</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装chrony</span></span><br><span class="line">yum install chrony -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#开放123端口防火墙作为客户端访问的端口</span></span><br><span class="line">firewall-cmd --permanent --add-port=123/udp</span><br><span class="line">firewall-cmd --permanent --add-port=323/udp</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"><span class="comment">#使用前可以把其他时间同步服务关掉，比如ntp（如果有使用的话）</span></span><br><span class="line">systemctl stop ntpd &amp;&amp; systemctl <span class="built_in">disable</span> ntpd</span><br></pre></td></tr></table></figure><p>（2）修改chrony配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改配置文件（只做以下相关配置修改，其余保持不变）</span></span><br><span class="line">vim /etc/chrony.conf</span><br></pre></td></tr></table></figure><p>服务端配置</p><p>假设服务端ip为192.168.60.101</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#外网ntp时间服务器地址</span></span><br><span class="line"><span class="attr">server</span> <span class="string">0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="attr">server</span> <span class="string">ntp1.aliyun.com       iburst</span></span><br><span class="line"><span class="comment">#同步到bios时间(RTC)</span></span><br><span class="line"><span class="attr">rtcsync</span></span><br><span class="line"><span class="comment">#限制允许192.168.60网段ip的客户端同步</span></span><br><span class="line"><span class="attr">allow</span> <span class="string">192.168.60.0/24</span></span><br><span class="line"><span class="comment">#即使未与时间源同步也可提供本地时间</span></span><br><span class="line"><span class="attr">local</span> <span class="string">stratum 10</span></span><br></pre></td></tr></table></figure><p>客户端配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除其它server，并添加如下server</span></span><br><span class="line"><span class="attr">server</span> <span class="string">192.168.60.101 iburst</span></span><br><span class="line"><span class="comment">#同步到bios时间(RTC)</span></span><br><span class="line"><span class="attr">rtcsync</span></span><br></pre></td></tr></table></figure><p>（3）启动和测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">systemctl start chronyd</span><br><span class="line"><span class="comment">#测试时间同步的时候（假设手动设置了错误的时间）如果chronyd已经启动了的话，需要重启以下才能看效果</span></span><br><span class="line">systemctl restart chronyd</span><br><span class="line"><span class="comment">#开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> chronyd</span><br><span class="line">netstat -tunlp |grep chronyd</span><br><span class="line"></span><br><span class="line"><span class="comment">#强制快速同步系统时间</span></span><br><span class="line">chronyc -a makestep</span><br><span class="line">hwclock  -w</span><br><span class="line"></span><br><span class="line"><span class="comment">#chrony兼容ntpdate，客户端也可以使用ntpdate手动快速同步时间</span></span><br><span class="line">ntpdate 192.168.60.101</span><br></pre></td></tr></table></figure><h3 id="5-定时任务"><a class="header-anchor" href="#5-定时任务">¶</a>5. 定时任务</h3><h4 id="1-用户定时任务"><a class="header-anchor" href="#1-用户定时任务">¶</a>1）用户定时任务</h4><p>每个用户都可以创建自己的定时任务，这些任务仅对该用户可见和执行。用户定时任务通常存储在<code>/var/spool/cron</code>目录里。都是以用户名命名的子目录里。</p><blockquote><ul><li>在 RedHat 系列系统里，用户的定时任务配置文件（也称为 crontab 文件）存储在 <code>/var/spool/cron/</code> 目录中。每个用户的定时任务都保存在相应的用户名文件中，例如，root 用户的定时任务文件位于<code>/var/spool/cron/root</code>。</li><li>在 Debian 系列系统里，用户的定时任务配置文件同样是 crontab 文件，存储在 <code>/var/spool/cron/crontabs/</code> 目录中。每个用户的定时任务都保存在相应的用户名文件中，例如，root用户的定时任务文件位于 <code>/var/spool/cron/crontabs/root</code>。</li></ul></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##用户定时任务的配置格式</span></span><br><span class="line">m h  dom mon dow   <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#编辑用户定时任务</span></span><br><span class="line">crontab -e</span><br><span class="line"></span><br><span class="line"><span class="comment">##示例：</span></span><br><span class="line"><span class="comment">#（1）每天凌晨2点执行命令</span></span><br><span class="line">0 2 * * * <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#（2）每周一到周五的上午9点执行命令</span></span><br><span class="line">0 9 * * 1-5 <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#（3）每个月的1号和15号的下午3点执行命令</span></span><br><span class="line">0 15 1,15 * * <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#（4）每小时的第10分钟执行命令</span></span><br><span class="line">10 * * * * <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#（5）每隔5分钟执行命令</span></span><br><span class="line">*/5 * * * * <span class="built_in">command</span></span><br><span class="line"><span class="comment">#每1分钟执行一次任务</span></span><br><span class="line">* * * * * <span class="built_in">command</span> <span class="comment">#同：*/1 * * * * command</span></span><br></pre></td></tr></table></figure><blockquote><p>💁‍♂ cron 表达式说明：</p><p>定时任务的语法由五个时间字段和一个命令字段组成，用于指定任务执行的时间间隔和要执行的命令。</p><ul><li><code>m</code>：分钟（minute：0-59）</li><li><code>h</code>：小时（hour：0-23）</li><li><code>dom</code>：月份中的某一天（day of month：1-31）</li><li><code>mon</code>：月份（month：1-12）</li><li><code>dow</code>：星期中的某一天（day of week：0-7，其中0和7都表示星期日）</li><li><code>command</code>：要执行的命令或脚本路径</li></ul><p>特殊的字符和符号：</p><ul><li>星号(*)：通配符，表示匹配所有可能的值。例如，<code>*</code>表示每分钟、每小时、每天、每月、每周都执行。</li><li>逗号(,)：用于列举多个值。例如，<code>1,5,10</code>表示1、5和10这三个值。</li><li>连接符(-)：用于定义范围。例如，<code>3-6</code>表示从3到6的连续值。</li><li>斜线(/)：用于定义步长。例如，<code>*/5</code>表示每隔5个单位执行一次。对于分钟字段，<code>*/5</code>表示每隔5分钟执行一次。</li></ul><p>💁‍♂ 注意：用户定时任务只能强制以用户身份运行，不能指定执行任务的用户</p></blockquote><h4 id="2-系统定时任务"><a class="header-anchor" href="#2-系统定时任务">¶</a>2）系统定时任务</h4><p>系统定时任务对整个系统生效。这些任务只有 root 用户或具有 sudo 权限的用户才能管理维护，系统级别的 crontab 文件通常存储在 <code>/etc/crontab</code> 或 <code>/etc/cron.d/</code> 目录中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##系统定时任务的配置格式</span></span><br><span class="line">m h dom mon dow user <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#编辑系统定时任务</span></span><br><span class="line">vi /etc/crontab</span><br><span class="line"></span><br><span class="line"><span class="comment">##示例：</span></span><br><span class="line"><span class="comment">#（1）每天凌晨2点执行命令</span></span><br><span class="line">0 2 * * * root <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#（2）每周一到周五的上午9点执行命令</span></span><br><span class="line">0 9 * * 1-5 root <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#（3）每个月的1号和15号的下午3点执行命令</span></span><br><span class="line">0 15 1,15 * * root <span class="built_in">command</span></span><br></pre></td></tr></table></figure><blockquote><ul><li><code>user</code>：执行命令的用户（默认以 root 用户身份运行，但可以指定其他用户身份运行）</li></ul></blockquote><h2 id="十三-shell编程"><a class="header-anchor" href="#十三-shell编程">¶</a>十三、Shell编程</h2><h3 id="1-sed-命令工具"><a class="header-anchor" href="#1-sed-命令工具">¶</a>1. sed 命令工具</h3><ul><li><p>偏向场景是以流处理的方式编辑文档</p></li><li><p>处理方式：以行处理</p></li></ul><p>sed是一种几乎包括在所有 UNIX 平台（包括 Linux）的轻量级流编辑器。sed主要是用来将数据进行选取、替换、删除、新增的命令。</p><h4 id="1-1-格式"><a class="header-anchor" href="#1-1-格式">¶</a>1.1 格式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed [选项] <span class="string">'[ 匹配地址 [!] 动作]'</span> 文件名</span><br></pre></td></tr></table></figure><blockquote><p><code>!</code>表示对匹配地址的行不执行动作</p><p>匹配地址可以是:</p><p>（1）模式匹配地址，即正则表达式</p><p>（2）行数范围，写数字</p></blockquote><p><strong>常用选项</strong></p><blockquote><p><code>-n</code>： 一般sed命令会把<code>所有</code>数据都输出到屏幕 ，如果加入此选择，则只会把经过sed命令处理的<code>行</code>输出到屏幕。<br><code>-e</code>： 允许对输入数据应用多条sed命令编辑<br><code>-i</code>： 用sed的修改结果直接修改读取数据的文件，而不是由屏幕输出（即会修改源数据）</p></blockquote><p><strong>动作</strong>(作用于行)</p><blockquote><p><code>a \</code>： <strong>追加</strong>，在当前行后添加一行或多行。添加多行时，除最后 一行<br>外，每行末尾需要用“\”代表数据未完结。<br><code>c \</code>： <strong>行替换</strong>，用c后面的字符串替换原数据行，替换多行时，除最<br>后一行外，每行末尾需用“\”代表数据未完结。<br><code>i \</code>： <strong>插入</strong>，在当期行前插入一行或多行。插入多行时，除最后 一行<br>外，每行末尾需要用“\”代表数据未完结。<br><code>d</code>： <strong>删除</strong>，删除指定的行。<br><code>p</code>： <strong>打印</strong>，输出指定的行。<br><code>s</code>：<strong>字串替换</strong>，用一个字符串替换另外一个字符串。格式为“行范。（作用于行中的字符串）<br>围<code>s/</code>旧字串/新字串<code>/g”</code>（和vim中的替换格式类似）</p></blockquote><h4 id="1-2-在第二行后追加一行内容"><a class="header-anchor" href="#1-2-在第二行后追加一行内容">¶</a>1.2 在第二行后追加一行内容</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sed -i <span class="string">'2a s003,\tlisi,\tjava,\t100,\tok,'</span> student.txt <span class="comment">#不加-i则会输出到屏幕（即不修改原文件的内容），加了-i则会输出会原文件以覆盖原内容</span></span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1542620949919.png" alt="1542620949919"></p><h4 id="1-2-在第二行前追加两行内容"><a class="header-anchor" href="#1-2-在第二行前追加两行内容">¶</a>1.2 在第二行前追加两行内容</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">'2i \</span></span><br><span class="line"><span class="string">s004,\twangwu,\tjava,\t100,\tok, \</span></span><br><span class="line"><span class="string">s005,\tzhaosi,\tc++,\t100,\tok,'</span> student.txt</span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1542622161517.png" alt="1542622161517"></p><p><code>\</code>表示输入未结束</p><h4 id="1-3-打印行"><a class="header-anchor" href="#1-3-打印行">¶</a>1.3 打印行</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sed -n <span class="string">'2 p'</span> student.txt  <span class="comment">#只打印第二行，-n防止打印第二行后还会打印所有行  #此处的2是行数匹配地址</span></span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1542620106443.png" alt="1542620106443"></p><h4 id="1-4-删除行"><a class="header-anchor" href="#1-4-删除行">¶</a>1.4 删除行</h4><p>删除第二行到第三行（不改变源文件的数据，只输出删除后剩余的结果）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">'2,3d'</span> student.txt</span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1542620284091.png" alt="1542620284091"></p><p>删除第一行并修改文本源数据（将输出结果覆盖作用的文件内容）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sed -i <span class="string">'1d'</span> student.txt</span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1542620470315.png" alt="1542620470315"></p><h4 id="1-5-字符串替换"><a class="header-anchor" href="#1-5-字符串替换">¶</a>1.5 字符串替换</h4><p><code>sed ' 匹配地址 s/旧字串/新字串/g' 文件名</code></p><p>此处匹配地址如果是正则匹配地址，那么一定要加<code>/ /</code>以表示正则模式</p><p>把第二行的<code>wen</code>改成<code>xuan</code></p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1542622690522.png" alt="1542622690522"></p><h3 id="2-awk-命令工具"><a class="header-anchor" href="#2-awk-命令工具">¶</a>2. awk 命令工具</h3><ul><li><p>偏向场景是以流处理的格式化报表输出</p></li><li><p>处理方式：以行处理</p></li></ul><h4 id="2-1-格式"><a class="header-anchor" href="#2-1-格式">¶</a>2.1 格式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk  <span class="string">'条件1&#123;动作1&#125;  条件2&#123;动作2&#125;  …'</span>  文件名</span><br></pre></td></tr></table></figure><blockquote><p>条件（Pattern）：<br>一般使用关系表达式作为条件<br>x &gt; 10 判断变量 x是否大于10<br>x&gt;=10 大于等于<br>x&lt;=10 小于等于<br>动作（Action）：<br>格式化输出<br>流程控制语句</p><p>如果没有指定条件，每行都执行相应的动作</p><p>所有的动作或者命令都要用{}括起来</p></blockquote><p>测试文件：student.txt:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s001,	wen,	java,   90,	ok,</span><br><span class="line">s001,	wen,	c,   90,	ok,</span><br><span class="line">s001,	wen,	c#,   90,	ok,</span><br><span class="line">s002,	qcmoke,	c,	100,	ok,</span><br></pre></td></tr></table></figure><h5 id="2-1-1-输出第一列和第二列"><a class="header-anchor" href="#2-1-1-输出第一列和第二列">¶</a>2.1.1 输出第一列和第二列</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'&#123;print $1$2&#125;'</span> student.txt</span><br><span class="line"><span class="comment"># $1为取出第一个分隔开的字段，$2为取出第二个分隔开的字段</span></span><br><span class="line"><span class="comment"># 默认识别的分隔符是制表符或者大于零的任意空格</span></span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1542617270519.png" alt="1542617270519"></p><h4 id="2-2-begin"><a class="header-anchor" href="#2-2-begin">¶</a>2.2 BEGIN</h4><p>BEGIN是在所有的数据读取之前的命令语句,以是否执行成功为条件结果，满足BEGIN才执行{}里的内容</p><h5 id="2-2-1-测试begin"><a class="header-anchor" href="#2-2-1-测试begin">¶</a>2.2.1 测试BEGIN</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN&#123;print "hello"&#125; &#123;print $1  "\t"  $2&#125;'</span> student.txt</span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1542617203006.png" alt="1542617203006"></p><h4 id="2-3-fs内置对象"><a class="header-anchor" href="#2-3-fs内置对象">¶</a>2.3 <code>FS</code>内置对象</h4><p>作用：给awk命令设置识别的分隔符</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'&#123;FS=","&#125; &#123;print $1 "\t" $2&#125;'</span> student.txt</span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1542618027330.png" alt="1542618027330"></p><p>awk默认是先读入一行数据才开始处理后面的动作，故在指定分隔符后，从第二行开始才生效，而第一行无效。</p><p>处理：</p><h5 id="2-3-1-测试fs"><a class="header-anchor" href="#2-3-1-测试fs">¶</a>2.3.1 测试FS</h5><p>使用BEGIN，让awk读取第一行数据前就先指定分隔符。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN&#123;FS=","&#125; &#123;print $1 "\t" $2&#125;'</span> student.txt</span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1542618296511.png" alt="1542618296511"></p><h4 id="2-4-end"><a class="header-anchor" href="#2-4-end">¶</a>2.4 END</h4><p>作用：在所有数据都读取并执行完所有动作之后再执行某个动作，以是否成功为条件结果。</p><h5 id="2-4-1-测试end"><a class="header-anchor" href="#2-4-1-测试end">¶</a>2.4.1 测试END</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'&#123;print $1$2&#125;END&#123;print "ending over !"&#125;'</span> student.txt</span><br></pre></td></tr></table></figure><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/1542618618673.png" alt="1542618618673"></p><h3 id="3-通过-cat-命令在文件末尾追加内容-并防止重复添加"><a class="header-anchor" href="#3-通过-cat-命令在文件末尾追加内容-并防止重复添加">¶</a>3. 通过 cat 命令在文件末尾追加内容（并防止重复添加）</h3><p>示例如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在/etc/bash.bashrc文件末尾配置export LC_ALL="C.UTF-8"</span></span><br><span class="line">text_str=<span class="string">'export LC_ALL="C.UTF-8"'</span> ;\</span><br><span class="line">file_str=<span class="string">'/etc/bash.bashrc'</span> ;\</span><br><span class="line">grep -v <span class="string">'^#'</span> <span class="string">"<span class="variable">$file_str</span>"</span> | grep -q <span class="string">"<span class="variable">$text_str</span>"</span> || cat &gt;&gt; <span class="string">"<span class="variable">$file_str</span>"</span> &lt;&lt; EOF</span><br><span class="line"><span class="variable">$text_str</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#或者：</span></span><br><span class="line">text_str=<span class="string">'export LC_ALL="C.UTF-8"'</span> ;\</span><br><span class="line">file_str=<span class="string">'/etc/bash.bashrc'</span> ;\</span><br><span class="line">grep -v <span class="string">'^#'</span> <span class="string">"<span class="variable">$file_str</span>"</span> | grep -q <span class="string">"<span class="variable">$text_str</span>"</span> || <span class="built_in">echo</span> <span class="string">"<span class="variable">$text_str</span>"</span> &gt;&gt; <span class="string">"<span class="variable">$file_str</span>"</span></span><br></pre></td></tr></table></figure><h2 id="十四-vi-和-vim"><a class="header-anchor" href="#十四-vi-和-vim">¶</a>十四、vi 和 vim</h2><h3 id="基本使用"><a class="header-anchor" href="#基本使用">¶</a>基本使用</h3><p>vi和vim的三种模式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">正常模式：以 vim 打开一个档案就直接进入一般模式了(这是默认的模式)。在这个模式中， 你可以使用『上下左右』按键来移动光标，你可以使用『删除字符』或『删除整行』来处理档案内容， 也可以使用『复制、粘贴』来处理你的文件数据。</span><br><span class="line">插入模式：按下 i, I, o, O, a, A, r, R 等任何一个字母之后才会进入编辑模式, 一般来说按 i 即可.</span><br><span class="line">命令行模式：即先按 esc 键再输入 ：时的情况。可以提供你相关指令，完成读取、存盘、替换、离开vim、显示行号等的动作则是在此模式中达成的！</span><br></pre></td></tr></table></figure><p>各种模式的相互切换如图：</p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/image-20230319063455443.png" alt="image-20230319063455443"></p><p>常用操作如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1) 拷贝行：在一般模式下, yy 拷贝当前行（5yy 拷贝当前行向下的 5 行），输入 p 进行粘贴。</span><br><span class="line">2) 删除行：删除当前行 dd ；删除当前行向下的 5 行 5dd</span><br><span class="line">3) 查找某个单词：命令行下，&#x2F;关键字 ， 回车 查找，输入n就是查找下一个，输入N向上查找下一个</span><br><span class="line">4) 设置文件的行号，取消文件的行号：在一般模式下, :set nu 和 :set nonu</span><br><span class="line">5) 将光标移动到文档首行和末行：在一般模式下，末行[G]，首行[gg]</span><br><span class="line">6) 撤销：在一个文件中输入内容后，在一般模式下, 撤销按 u</span><br><span class="line">7) 将光标移动到指定行：在一般模式下，先输入行号（如20），再按 shift + g</span><br></pre></td></tr></table></figure><blockquote><p>更多命令操作见下图：</p><p><img src="/linux/../images/loading-post.gif" data-original="to_learn_linux/vi-vim-cheat-sheet-sch1.gif" alt="vi-vim-cheat-sheet-sch"></p><p>参考：<a href="https://www.runoob.com/linux/linux-vim.html" target="_blank" rel="noopener">https://www.runoob.com/linux/linux-vim.html</a></p></blockquote><h3 id="常见问题"><a class="header-anchor" href="#常见问题">¶</a>常见问题</h3><h4 id="1-解决使用-vi-或-vim-粘贴导致缩进问题或乱码"><a class="header-anchor" href="#1-解决使用-vi-或-vim-粘贴导致缩进问题或乱码">¶</a>（1）解决使用 vi 或 vim 粘贴导致缩进问题或乱码</h4><p>这是由于 vi 或 vim 对于某些格式的文件（如：yaml 文件）进行粘贴时进行了自动格式化处理，为了防止自动格式化可如下解决：</p><ul><li>在命令模式下，输入 <code>:set paste</code> 并回车确认，然后再输入 <code>i</code> 进行粘贴。</li><li>如需恢复自动缩进只需在命令模式输入 <code>:set nopaste</code> 即可</li></ul><h2 id="十五-linux安装"><a class="header-anchor" href="#十五-linux安装">¶</a>十五、Linux安装</h2><h3 id="自定义磁盘分区"><a class="header-anchor" href="#自定义磁盘分区">¶</a>自定义磁盘分区</h3><p>在安装Linux时，以下分区是<strong>必须</strong>要创建的：</p><ol><li>根分区（/）：这是Linux系统的根目录，包含操作系统的所有文件和目录。</li><li>交换分区（swap）：用于虚拟内存，当物理内存不足时，系统将部分数据移至交换分区中（通常建议将交换分区大小设置为物理内存的两倍）。</li></ol><p>如果使用UEFI启动，则还需要创建一个EFI系统分区（ESP），它包含引导加载程序、内核文件和其他支持文件。但是，如果使用传统的BIOS引导模式，则不需要创建ESP分区。</p><blockquote><p>需要注意的是，在某些情况下，可能会出现不需要 ESP 分区也可以使用 UEFI 启动的情况。例如，某些 UEFI 固件可能支持直接从磁盘中的某个分区启动操作系统，而无需使用 ESP 分区。此外，一些特定的发行版或安装程序可能提供了与 ESP 分区无关的替代方案，以便在没有 ESP 分区的情况下实现 UEFI 启动</p></blockquote><p>请注意，以上仅适用于基本的Linux安装。而为了数据的安全，<strong>通常</strong>会创建以下几个分区</p><ul><li><code>根分区（/）</code></li><li><code>交换分区（swap）</code></li><li><code>/home 分区</code>：用于存储用户数据和配置文件。</li><li><code>/boot 分区</code>：通常用于存储启动引导程序、内核映像以及相关的配置文件等。需要足够的空间来存储未来更新的内核文件。</li><li><code>EFI 系统分区（ESP）</code>：如果使用UEFI启动，则需要一个ESP分区，它包含引导加载程序、内核文件和其他支持文件，在l安装inux后会自动挂载到系统的<code>/boot/efi</code>目录。</li></ul><blockquote><p>在某些情况下，还可能需要创建其他分区，如<code>/var</code>、<code>/tmp</code> 或 <code>/usr</code> 分区等。但这取决于具体的需求和Linux发行版的要求。</p><p>**分区容量分配示例：**对于一个 100GB 容量的磁盘，建议将其分区和配置如下：</p><ol><li><code>根分区（/）</code>：将根分区设置为 40-50GB。这足以安装Linux系统、常用应用程序和一些基本的开发工具。</li><li><code>交换分区（swap）</code>：将交换分区设置为 2-4GB。这里推荐使用物理内存大小的两倍作为交换分区大小的基准。</li><li><code>/home 分区</code>：将<code>/home</code>分区设置为 30-50GB。这将为用户数据和配置文件提供足够的存储空间。</li><li><code>/boot 分区</code>：设置 2GB（至少 200MB，但考虑到可能需要升级内核或者自编译内核等可能需要较多空间，则建议设置为 2GB，防止升级内核时出现分区空间不足的问题），要确保足够存储未来的内核更新文件。</li><li><code>EFI 系统分区（ESP）</code>：如果您使用 UEFI 引导，则需要创建一个 ESP 分区。通常，这个分区只需要为 100-500MB 即可。</li><li><code>其他分区</code>：如果您需要存储大量的数据、音频或视频文件，可以创建一个单独的数据分区。该分区的大小应根据您的特定需求来确定。</li></ol><p>提示：如果没有特别需求，其实只分配根分区和交换分区就够了。</p></blockquote><h2 id="十六-常见问题解决"><a class="header-anchor" href="#十六-常见问题解决">¶</a>十六、常见问题解决</h2><h3 id="1-linux更新被锁的解决方法"><a class="header-anchor" href="#1-linux更新被锁的解决方法">¶</a>1. linux更新被锁的解决方法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#问题如下：</span></span><br><span class="line">E: 无法获得锁 /var/lib/dpkg/lock - open (11: 资源暂时不可用)</span><br><span class="line">E: 无法锁定管理目录(/var/lib/dpkg/)，是否有其他进程正占用它？</span><br><span class="line"></span><br><span class="line"><span class="comment">#解决：</span></span><br><span class="line">rm /var/lib/dpkg/lock</span><br></pre></td></tr></table></figure><h3 id="2-解决使用ls命令目录无法高亮显示的问题"><a class="header-anchor" href="#2-解决使用ls命令目录无法高亮显示的问题">¶</a>2. 解决使用<code>ls</code>命令目录无法高亮显示的问题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; ~/.bashrc &lt;&lt; <span class="string">'EOF'</span></span><br><span class="line"><span class="built_in">alias</span> ls=<span class="string">'ls --color=auto'</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#使配置文件修改生效</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure></div><div><div><br><br><div style="text-align:center;color:#ccc;font-size:14px">----------- 本文结束 -----------</div><br><br><br><br></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>如果你觉得我的文章对你有帮助，你可以打赏我哦~</div><button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'><span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="../images/loading-post.gif" data-original="/images/wechatpay.png" alt="Qcmoke 微信支付"><p>微信支付</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/linux/" rel="tag"><i class="fa fa-tag"></i> linux</a> <a href="/tags/ubuntu/" rel="tag"><i class="fa fa-tag"></i> ubuntu</a></div><div class="post-widgets"><div class="wp_rating"><div id="wpac-rating"></div></div><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/tools/rclone.html" rel="prev" title="通过Rclone挂载Google Drive到VPS"><i class="fa fa-chevron-left"></i> 通过Rclone挂载Google Drive到VPS</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/tools/frp.html" rel="next" title="frp实现内网穿透">frp实现内网穿透 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div class="tablink-li"><button class="tablink" onclick='openPage("tabs-gitalk",this)' id="defaultOpen">Gitalk</button> <button class="tablink" onclick='openPage("tabs-valine",this)'>Valine</button></div><div class="tabcontent-li"><div id="tabs-gitalk" class="tabcontent"><div id="gitalk-container"></div></div><div id="tabs-valine" class="tabcontent"><div id="comments-valine"></div></div></div></div><script>function openPage(e,t){for(var n=document.getElementsByClassName("tabcontent"),l=0;l<n.length;l++)n[l].style.display="none";for(tablinks=document.getElementsByClassName("tablink"),l=0;l<tablinks.length;l++)tablinks[l].classList.remove("currentTabcontent");document.getElementById(e).style.display="block",t.classList.add("currentTabcontent")}document.getElementById("defaultOpen").click()</script></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/"><img class="site-author-image" itemprop="image" src="../images/loading-post.gif" data-original="/images/logo.jpg" alt="Qcmoke"></a><p class="site-author-name" itemprop="name">Qcmoke</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">83</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">8</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">91</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:qcmoke@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a> </span><span class="links-of-author-item"><a href="https://github.com/qcmoke" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://weibo.com/u/5469824288" target="_blank" title="weibo"><i class="fa fa-fw fa-weibo"></i>weibo</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li class="recent_posts_li"><a href="/windows/clean_c_drive.html" title="Windows系统C盘清理" target="_blank">Windows系统C盘清理</a></li><li class="recent_posts_li"><a href="/devops/lvs.html" title="lvs学习笔记" target="_blank">lvs学习笔记</a></li><li class="recent_posts_li"><a href="/devops/mysql_ha.html" title="Keepalived+MySQL实现高可用" target="_blank">Keepalived+MySQL实现高可用</a></li><li class="recent_posts_li"><a href="/devops/keepalived.html" title="keepalived学习笔记" target="_blank">keepalived学习笔记</a></li><li class="recent_posts_li"><a href="/tools/pyenv.html" title="python版本管理工具pyenv" target="_blank">python版本管理工具pyenv</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一-概念"><span class="nav-text">一、概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-终端命令格式"><span class="nav-text">1. 终端命令格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-查阅命令的帮助文档信息"><span class="nav-text">2. 查阅命令的帮助文档信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-help"><span class="nav-text">2.1 --help</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-man"><span class="nav-text">2.2 man</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二-基础命令"><span class="nav-text">二、基础命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三-命令操作技巧"><span class="nav-text">三、命令操作技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-放大终端窗口的字体显示"><span class="nav-text">1. 放大终端窗口的字体显示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-缩小终端窗口的字体显示"><span class="nav-text">2. 缩小终端窗口的字体显示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-自动补全"><span class="nav-text">3. 自动补全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-终端历史命令切换"><span class="nav-text">4. 终端历史命令切换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-退出执行中的命令"><span class="nav-text">5. 退出执行中的命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四-文件管理"><span class="nav-text">四、文件管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-文件系统"><span class="nav-text">1. 文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#windows-文件系统"><span class="nav-text">Windows 文件系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#linux-文件系统"><span class="nav-text">Linux 文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#linux目录结构"><span class="nav-text">Linux目录结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#linux主要目录介绍"><span class="nav-text">Linux主要目录介绍</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-常用命令"><span class="nav-text">2. 常用命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-列出目录文件-ls-tree"><span class="nav-text">1）列出目录文件（ls、tree）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-切换目录-cd"><span class="nav-text">2）切换目录（ cd ）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-创建和删除操作-touch-mkdir-rm"><span class="nav-text">3）创建和删除操作（touch、mkdir、rm）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-拷贝和移动文件-cp-mv"><span class="nav-text">4）拷贝和移动文件（cp、mv）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-查看文件内容-cat-more-grep-tail"><span class="nav-text">5）查看文件内容（cat、more 、grep、tail）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-cat-查看文件的所有内容"><span class="nav-text">（1）cat 查看文件的所有内容</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-more-分屏显示文件内容"><span class="nav-text">（2）more 分屏显示文件内容</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-grep-搜索文本文件内容"><span class="nav-text">（3）grep 搜索文本文件内容</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-tail-取出文件后面几行"><span class="nav-text">（4）tail 取出文件后面几行</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-查找文件-find"><span class="nav-text">6）查找文件（ find ）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-查看目录或文件占用大小-du"><span class="nav-text">7）查看目录或文件占用大小（ du ）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-链接-ln"><span class="nav-text">8）链接（ ln ）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#简要概述"><span class="nav-text">简要概述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#软链接"><span class="nav-text">软链接</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#硬链接"><span class="nav-text">硬链接</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-打包-和-解包-tar"><span class="nav-text">9）打包 和 解包（ tar ）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-压缩-和-解压缩"><span class="nav-text">10）压缩 和 解压缩</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-gzip"><span class="nav-text">（1）gzip</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-gunzip"><span class="nav-text">（2）gunzip</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-tar-和-gzip"><span class="nav-text">（3）tar 和 gzip</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-bzip2"><span class="nav-text">（4）bzip2</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-zip-和-unzip"><span class="nav-text">（5）zip 和 unzip</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-重定向-和"><span class="nav-text">11）重定向（ &gt; 和 &gt;&gt; ）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12-管道"><span class="nav-text">12）管道（ | ）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13-统计-wc"><span class="nav-text">13）统计（ wc ）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-文件权限管理"><span class="nav-text">3. 文件权限管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-文件的详细信息"><span class="nav-text">1. 文件的详细信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-设置文件权限"><span class="nav-text">2. 设置文件权限</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-文件属性模式"><span class="nav-text">3. 文件属性模式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#lsattr"><span class="nav-text">lsattr</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#chattr"><span class="nav-text">chattr</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#文件属性模式相关问题"><span class="nav-text">文件属性模式相关问题</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五-用户管理"><span class="nav-text">五、用户管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-基本概念"><span class="nav-text">1. 基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-用户组维护"><span class="nav-text">2. 用户组维护</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-用户维护"><span class="nav-text">3. 用户维护</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-创建用户"><span class="nav-text">1）创建用户</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-设置用户密码"><span class="nav-text">2）设置用户密码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-查看系统的用户信息"><span class="nav-text">3）查看系统的用户信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-删除用户"><span class="nav-text">4）删除用户</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-查看系统用户信息"><span class="nav-text">5）查看系统用户信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-修改用户组和登录的shell"><span class="nav-text">6）修改用户组和登录的Shell</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-切换用户"><span class="nav-text">7）切换用户</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-超级用户权限维护"><span class="nav-text">4. 超级用户权限维护</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-用户登录维护"><span class="nav-text">5. 用户登录维护</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-查看当前登录到系统上的用户信息"><span class="nav-text">1）查看当前登录到系统上的用户信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-查看系统中所有用户的最近登录信息"><span class="nav-text">2）查看系统中所有用户的最近登录信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-查看系统中用户的完整登录历史记录"><span class="nav-text">3）查看系统中用户的完整登录历史记录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-踢出登录用户"><span class="nav-text">4） 踢出登录用户</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#六-软件管理"><span class="nav-text">六、软件管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-软件管理简介"><span class="nav-text">1. 软件管理简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-包全名与包名"><span class="nav-text">1.1 包全名与包名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-linux包依赖性"><span class="nav-text">1.2 Linux包依赖性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-常见软件包命名原则"><span class="nav-text">1.3 常见软件包命名原则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-linux软件包优先级"><span class="nav-text">1.4 linux软件包优先级</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-debain-系列系统的软件管理"><span class="nav-text">2. Debain 系列系统的软件管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-dpkg-本地包管理器"><span class="nav-text">1）dpkg 本地包管理器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-安装"><span class="nav-text">（1）安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-卸载"><span class="nav-text">（2）卸载</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-查询"><span class="nav-text">（3）查询</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-apt-在线包管理器"><span class="nav-text">2）apt 在线包管理器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-apt-软件源"><span class="nav-text">（1） apt 软件源</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-1-修改-ubuntu-软件源为国内源"><span class="nav-text">（1.1）修改 Ubuntu 软件源为国内源</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#1-2-修改-debian-软件源为国内源"><span class="nav-text">（1.2）修改 Debian 软件源为国内源</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-查询"><span class="nav-text">（2）查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-安装"><span class="nav-text">（3） 安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-更新"><span class="nav-text">（4） 更新</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-卸载"><span class="nav-text">（5） 卸载</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-redhat-系列系统的软件管理"><span class="nav-text">3. Redhat 系列系统的软件管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-rpm-本地包管理器"><span class="nav-text">1）rpm 本地包管理器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-安装-v2"><span class="nav-text">（1）安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-升级"><span class="nav-text">（2）升级</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-卸载"><span class="nav-text">（3）卸载</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-查询包是否安装"><span class="nav-text">（4）查询包是否安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-查询软件包详细信息"><span class="nav-text">（5） 查询软件包详细信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-查询软件包安装位置"><span class="nav-text">（6）查询软件包安装位置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-查询系统文件所属的软件包"><span class="nav-text">（7）查询系统文件所属的软件包</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-查询软件包的依赖性"><span class="nav-text">（8） 查询软件包的依赖性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-软件包完整性校验"><span class="nav-text">（9） 软件包完整性校验</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#10-从rpm包中提取文件"><span class="nav-text">（10）从RPM包中提取文件</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-yum-线包管理器"><span class="nav-text">2）yum 线包管理器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-yum软件源"><span class="nav-text">（1）yum软件源</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-查询-v2"><span class="nav-text">（2）查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-安装-v2"><span class="nav-text">（3）安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-更新-v2"><span class="nav-text">（4）更新</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-卸载-v2"><span class="nav-text">（5） 卸载</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-软件组安装卸载"><span class="nav-text">（6）软件组安装卸载</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-snap-在线包管理器"><span class="nav-text">4. Snap 在线包管理器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-安装-snap"><span class="nav-text">1）安装 Snap</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-snap-常用命令"><span class="nav-text">2）Snap 常用命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-卸载-snap"><span class="nav-text">3）卸载 Snap</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-源码包安装卸载-待续"><span class="nav-text">5. 源码包安装卸载（待续···）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-通用更换系统软件源脚本-支持大部分-linux-系统"><span class="nav-text">6. 通用更换系统软件源脚本（支持大部分 Linux 系统）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#七-进程管理"><span class="nav-text">七、进程管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-列出当前进程信息-ps"><span class="nav-text">1. 列出当前进程信息 ps</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-查看系统内存使用情况-free"><span class="nav-text">2. 查看系统内存使用情况 free</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-系统负载监控-top"><span class="nav-text">3. 系统负载监控 top</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-通过监听端口查询对应进程信息"><span class="nav-text">4. 通过监听端口查询对应进程信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-终止进程-kill"><span class="nav-text">5. 终止进程 kill</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-通过-pid-找出进程的对应文件路径"><span class="nav-text">6. 通过 PID 找出进程的对应文件路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-查看命令路径-which"><span class="nav-text">7. 查看命令路径 which</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-查看进程树-pstree"><span class="nav-text">8. 查看进程树 pstree</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-系统监控实用工具"><span class="nav-text">9. 系统监控实用工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-iftop"><span class="nav-text">1）iftop</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-nload"><span class="nav-text">2）nload</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-htop"><span class="nav-text">3）htop</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-iotop"><span class="nav-text">4）iotop</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-glances"><span class="nav-text">5）glances</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装"><span class="nav-text">安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#standalone-模式"><span class="nav-text">Standalone 模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#client-server-模式"><span class="nav-text">Client &#x2F; Server 模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#web-server-模式"><span class="nav-text">Web server 模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置文件"><span class="nav-text">配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#颜色级别定义"><span class="nav-text">颜色级别定义</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#配置文件示例"><span class="nav-text">配置文件示例</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#八-系统管理"><span class="nav-text">八、系统管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-关机和重启"><span class="nav-text">1. 关机和重启</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-查看系统配置"><span class="nav-text">2. 查看系统配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-环境变量"><span class="nav-text">3. 环境变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#简要概述-v2"><span class="nav-text">简要概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#临时设置环境变量"><span class="nav-text">临时设置环境变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#永久设置环境变量"><span class="nav-text">永久设置环境变量</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-系统版本和内核版本"><span class="nav-text">4. 系统版本和内核版本</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-查看系统版本"><span class="nav-text">1）查看系统版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-查看内核版本"><span class="nav-text">2）查看内核版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-升级内核版本"><span class="nav-text">3）升级内核版本</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#简要说明"><span class="nav-text">简要说明</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方式一：通过系统默认官方源在线升级的内核版本"><span class="nav-text">方式一：通过系统默认官方源在线升级的内核版本</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方式二：使用第三方源在线安装较新版本的内核"><span class="nav-text">方式二：使用第三方源在线安装较新版本的内核</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方式三：使用已编译好的二进制包进行安装"><span class="nav-text">方式三：使用已编译好的二进制包进行安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方式四：下载内核源码手动编译安装"><span class="nav-text">方式四：下载内核源码手动编译安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#参考"><span class="nav-text">参考</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-服务管理"><span class="nav-text">5. 服务管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-服务相关概念"><span class="nav-text">1）服务相关概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-启动框架相关概念"><span class="nav-text">2）启动框架相关概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-sysvinit-服务管理"><span class="nav-text">3）SysVinit 服务管理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#简要概述-v3"><span class="nav-text">简要概述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#linux系统运行级别的概念"><span class="nav-text">Linux系统运行级别的概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#常用命令-service-和-chkconfig-update-rc-d"><span class="nav-text">常用命令（service 和 chkconfig、update-rc.d）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#自定义服务"><span class="nav-text">自定义服务</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-systemd-服务管理"><span class="nav-text">4）Systemd 服务管理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#简要概述-v4"><span class="nav-text">简要概述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#常用命令-systemctl"><span class="nav-text">常用命令（systemctl）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#自定义服务-v2"><span class="nav-text">自定义服务</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-分配-swap-空间"><span class="nav-text">6. 分配 swap 空间</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#简要概述-v5"><span class="nav-text">简要概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方式1：新建磁盘分区作为-swap-分区"><span class="nav-text">方式1：新建磁盘分区作为 swap 分区</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方式2：用虚拟磁盘分区作为-swap-分区-推荐"><span class="nav-text">方式2：用虚拟磁盘分区作为 swap 分区（推荐）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#参考-v2"><span class="nav-text">参考</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#九-网络管理"><span class="nav-text">九、网络管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-查看网卡配置信息-ifconfig"><span class="nav-text">1. 查看网卡配置信息 ifconfig</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-检测网络连通性-ping-和-telnet"><span class="nav-text">2. 检测网络连通性 ping 和 telnet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-配置主机名"><span class="nav-text">3. 配置主机名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-配置-hosts-映射"><span class="nav-text">4. 配置 hosts 映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-配置主机-ip"><span class="nav-text">5. 配置主机 IP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-配置临时-ip"><span class="nav-text">1）配置临时 IP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-配置静态-ip"><span class="nav-text">2）配置静态 IP</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#一-环境准备"><span class="nav-text">（一）环境准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#二-red-hat-centos-系统配置静态-ip"><span class="nav-text">（二）Red Hat &#x2F; CentOS 系统配置静态 IP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#三-debian-系统配置静态-ip"><span class="nav-text">（三）Debian 系统配置静态 IP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#四-ubuntu-系统配置静态-ip"><span class="nav-text">（四）Ubuntu 系统配置静态 IP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#五-rocky-linux-系统配置静态-ip"><span class="nav-text">（五）Rocky Linux 系统配置静态 IP</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-配置-dns-服务器"><span class="nav-text">6. 配置 DNS 服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-公共-dns-服务器介绍"><span class="nav-text">1）公共 DNS 服务器介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-查看当前使用的-dns-服务器"><span class="nav-text">2）查看当前使用的 DNS 服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-linux-系统配置-dns-服务器"><span class="nav-text">3）Linux 系统配置 DNS 服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-临时配置系统-dns-服务器"><span class="nav-text">（1）临时配置系统 DNS 服务器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-永久配置-dns-服务器"><span class="nav-text">（3）永久配置 DNS 服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#方式-1-维护网络接口配置文件的-dns-配置-推荐"><span class="nav-text">方式 1、维护网络接口配置文件的 DNS 配置（推荐）</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#方式-2-禁止其他网络配置工具自动更新-dns"><span class="nav-text">方式 2、禁止其他网络配置工具自动更新 DNS</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-windows-系统配置-dns-服务器"><span class="nav-text">4）Windows 系统配置 DNS 服务器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-dns-域名解析查询"><span class="nav-text">7. DNS 域名解析查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-配置防火墙"><span class="nav-text">8. 配置防火墙</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-简要概述"><span class="nav-text">1）简要概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-iptables-防火墙"><span class="nav-text">2）IPtables 防火墙</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-语法格式"><span class="nav-text">（1）语法格式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-添加规则"><span class="nav-text">（2）添加规则</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-删除规则"><span class="nav-text">（3）删除规则</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-修改规则"><span class="nav-text">（4）修改规则</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-查看防火墙规则"><span class="nav-text">（5）查看防火墙规则</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-重置-iptables-规则"><span class="nav-text">（6）重置 iptables 规则</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-防火墙规则持久化"><span class="nav-text">（7）防火墙规则持久化</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-使用-iptables-实现-tcp-udp-端口转发"><span class="nav-text">（8）使用 IPtables 实现 TCP&#x2F;UDP 端口转发</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-参考"><span class="nav-text">（9）参考</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-ufw-防火墙"><span class="nav-text">3）UFW 防火墙</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-查看-ufw-服务状态"><span class="nav-text">（1）查看 ufw 服务状态</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-查看-ufw-的状态"><span class="nav-text">（2）查看 ufw 的状态</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-开启-重启-关闭-ufw-服务"><span class="nav-text">（3）开启、重启、关闭、ufw 服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-查看防火墙规则"><span class="nav-text">（4）查看防火墙规则</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-防火墙端口规则维护"><span class="nav-text">（5）防火墙端口规则维护</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-firewalld-防火墙"><span class="nav-text">4）FirewallD 防火墙</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-查看-firewall-服务状态"><span class="nav-text">（1）查看 firewall 服务状态</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-查看-firewall-的状态"><span class="nav-text">（2）查看 firewall 的状态</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-开启-重启-关闭-firewalld-service-服务"><span class="nav-text">（3）开启、重启、关闭、firewalld.service 服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-查看防火墙规则-v2"><span class="nav-text">（4）查看防火墙规则</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-防火墙端口规则维护-v2"><span class="nav-text">（5）防火墙端口规则维护</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-查看系统程序对应网络信息-netstat"><span class="nav-text">9. 查看系统程序对应网络信息 netstat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-网络测试工具-nc"><span class="nav-text">10. 网络测试工具 nc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-路由追踪-traceroute"><span class="nav-text">11. 路由追踪 traceroute</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十-远程操作"><span class="nav-text">十、远程操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-远程操作网络基础"><span class="nav-text">1. 远程操作网络基础</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-远程登录"><span class="nav-text">2. 远程登录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-ssh服务端安装和配置"><span class="nav-text">2.1 ssh服务端安装和配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-ssh客户端安装和使用"><span class="nav-text">2.2 ssh客户端安装和使用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-ssh免密码登录"><span class="nav-text">1）ssh免密码登录</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-配置ssh服务别名"><span class="nav-text">3）配置ssh服务别名</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-远程文件传输"><span class="nav-text">3. 远程文件传输</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-scp"><span class="nav-text">3.1 scp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-filezilla"><span class="nav-text">3.2 FileZilla</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-xftp"><span class="nav-text">3.3 Xftp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-lrzsz"><span class="nav-text">3.4 lrzsz</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十一-磁盘管理"><span class="nav-text">十一、磁盘管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-相关基础命令"><span class="nav-text">1. 相关基础命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-标准分区管理"><span class="nav-text">2. 标准分区管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-创建分区"><span class="nav-text">1）创建分区</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-格式化分区"><span class="nav-text">2）格式化分区</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-挂载分区"><span class="nav-text">3）挂载分区</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-卸载及删除分区"><span class="nav-text">4）卸载及删除分区</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#参考："><span class="nav-text">参考：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-lvm分区管理"><span class="nav-text">3. LVM分区管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-相关概念"><span class="nav-text">1）相关概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-查看"><span class="nav-text">2）查看</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-创建-pv-vg-lv"><span class="nav-text">3）创建 pv、vg、lv</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-格式化和挂载-lv"><span class="nav-text">4）格式化和挂载 lv</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-卸载-lv"><span class="nav-text">5）卸载 lv</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-删除-lv-vg-pv"><span class="nav-text">6）删除 lv、vg、pv</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-扩容"><span class="nav-text">7）扩容</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-缩容"><span class="nav-text">8）缩容</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-替换磁盘"><span class="nav-text">9）替换磁盘</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#参考：-v2"><span class="nav-text">参考：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十二-时间管理"><span class="nav-text">十二、时间管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-查看时间"><span class="nav-text">1. 查看时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-修改时间"><span class="nav-text">2. 修改时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-设置时区"><span class="nav-text">3.设置时区</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-时间同步"><span class="nav-text">4. 时间同步</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-单机版"><span class="nav-text">4.1 单机版</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-集群版"><span class="nav-text">4.2 集群版</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-1-ntp"><span class="nav-text">4.2.1 ntp</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-2-chrony"><span class="nav-text">4.2.2 chrony</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-定时任务"><span class="nav-text">5. 定时任务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-用户定时任务"><span class="nav-text">1）用户定时任务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-系统定时任务"><span class="nav-text">2）系统定时任务</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十三-shell编程"><span class="nav-text">十三、Shell编程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-sed-命令工具"><span class="nav-text">1. sed 命令工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-格式"><span class="nav-text">1.1 格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-在第二行后追加一行内容"><span class="nav-text">1.2 在第二行后追加一行内容</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-在第二行前追加两行内容"><span class="nav-text">1.2 在第二行前追加两行内容</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-打印行"><span class="nav-text">1.3 打印行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-删除行"><span class="nav-text">1.4 删除行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-字符串替换"><span class="nav-text">1.5 字符串替换</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-awk-命令工具"><span class="nav-text">2. awk 命令工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-格式"><span class="nav-text">2.1 格式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-1-输出第一列和第二列"><span class="nav-text">2.1.1 输出第一列和第二列</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-begin"><span class="nav-text">2.2 BEGIN</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-1-测试begin"><span class="nav-text">2.2.1 测试BEGIN</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-fs内置对象"><span class="nav-text">2.3 FS内置对象</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-3-1-测试fs"><span class="nav-text">2.3.1 测试FS</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-end"><span class="nav-text">2.4 END</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-4-1-测试end"><span class="nav-text">2.4.1 测试END</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-通过-cat-命令在文件末尾追加内容-并防止重复添加"><span class="nav-text">3. 通过 cat 命令在文件末尾追加内容（并防止重复添加）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十四-vi-和-vim"><span class="nav-text">十四、vi 和 vim</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本使用"><span class="nav-text">基本使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常见问题"><span class="nav-text">常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-解决使用-vi-或-vim-粘贴导致缩进问题或乱码"><span class="nav-text">（1）解决使用 vi 或 vim 粘贴导致缩进问题或乱码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十五-linux安装"><span class="nav-text">十五、Linux安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义磁盘分区"><span class="nav-text">自定义磁盘分区</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十六-常见问题解决"><span class="nav-text">十六、常见问题解决</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-linux更新被锁的解决方法"><span class="nav-text">1. linux更新被锁的解决方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-解决使用ls命令目录无法高亮显示的问题"><span class="nav-text">2. 解决使用ls命令目录无法高亮显示的问题</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Qcmoke</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv">本站访客数 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人次 </span><span class="site-pv">本站总访问量 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div><a href="https://beian.miit.gov.cn/" target="_blank">黔ICP备20002951号-1</a></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><i id="darkmode" class="fa fa-lightbulb-o" aria-hidden="true"></i><script>var body=$("body"),darkmode=$("#darkmode");!matchMedia("(prefers-color-scheme: dark)").matches&&"1"!==localStorage.getItem("darkmode")||"1"===localStorage.getItem("noDark")||body.addClass("dark"),body.hasClass("dark")?darkmode.removeClass("fa-moon-o").addClass("fa-lightbulb-o"):darkmode.removeClass("fa-lightbulb-o").addClass("fa-moon-o"),darkmode.click(function(){body.hasClass("dark")?(darkmode.removeClass("fa-lightbulb-o").addClass("fa-moon-o"),body.removeClass("dark"),localStorage.setItem("darkmode","0"),localStorage.setItem("noDark","1")):(darkmode.removeClass("fa-moon-o").addClass("fa-lightbulb-o"),body.addClass("dark"),localStorage.setItem("darkmode","1"),localStorage.setItem("noDark","0"))})</script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/clipboard.min.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/highlight-wrap.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script src="/js/src/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">for(var emoticonList=[],i=1;i<=164;i++)emoticonList.push("aru ("+i+").png");new Valine({lang:"zh-cn",admin_email:"qcmoke@gmail.com",el:"#comments-valine",appId:"6LNbUERxbG0OAnWfmJSbmXiW-MdYXbMMI",appKey:"d2FLy9fmXOTiM8TrokuIuDWx",placeholder:"留下你的小爪印吧~",serverURLs:"https://leancloud.qcmoke.cn"})</script><script>var checkExist;window.location.hash&&(checkExist=setInterval(function(){$(window.location.hash).length&&($("html, body").animate({scrollTop:$(window.location.hash).offset().top-90},1e3),clearInterval(checkExist))},100))</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script type="text/javascript">const gitalk=new Gitalk({clientID:"d933e443cdfe503ce05a",clientSecret:"149d163f4b10cedf7a68993289da9c0f0836bd34",repo:"mygitalk",owner:"qcmoke",admin:"qcmoke".split(","),id:location.pathname,distractionFreeMode:"true",createIssueManually:"true"});gitalk.render("gitalk-container")</script><script type="text/javascript">var isfetched=!1,isXml=!0,search_path="search.xml",path=(0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1),"/"+search_path),onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")};function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var searchFunc=function(t,s,a){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");function e(){var e,m=n.value.trim().toLowerCase(),x=m.split(/[\s\-]+/),w=(1<x.length&&x.push(m),[]);0<m.length&&o.forEach(function(t){var e=!1,o=0,h=0,n=t.title.trim(),r=n.toLowerCase(),s=t.content.trim().replace(/<[^>]+>/g,""),a=s.toLowerCase(),i=decodeURIComponent(t.url),c=[],l=[];if(""!=n&&(x.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r,s=0,a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());-1<(r=e.indexOf(t,s));)a.push({position:r,word:t}),s=r+n;return a}c=c.concat(e(t,r,!1)),l=l.concat(e(t,a,!1))}),0<c.length||0<l.length)&&(e=!0,o=c.length+l.length),e){function p(t,e,o,n){for(var r=n[n.length-1],s=r.position,a=r.word,i=[],c=0;s+a.length<=o&&0!=n.length;){a===m&&c++,i.push({position:s,length:a.length});var l=s+a.length;for(n.pop();0!=n.length&&(s=(r=n[n.length-1]).position,a=r.word,s<l);)n.pop()}return h+=c,{hits:i,start:e,end:o,searchTextCount:c}}[c,l].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});for(var t=[],u=(0!=c.length&&t.push(p(0,0,n.length,c)),[]);0!=l.length;){var f=l[l.length-1],d=f.position,f=f.word,g=d-20,v=d+80;g<0&&(g=0),(v=v<d+f.length?d+f.length:v)>s.length&&(v=s.length),u.push(p(0,g,v,l))}u.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});e=parseInt("1");function $(o,t){var n="",r=t.start;return t.hits.forEach(function(t){n+=o.substring(r,t.position);var e=t.position+t.length;n+='<b class="search-keyword">'+o.substring(t.position,e)+"</b>",r=e}),n+=o.substring(r,t.end)}0<=e&&(u=u.slice(0,e));var C="";C+=0!=t.length?"<li><a href='"+i+"' class='search-result-title'>"+$(n,t[0])+"</a>":"<li><a href='"+i+"' class='search-result-title'>"+n+"</a>",u.forEach(function(t){C+="<a href='"+i+'\'><p class="search-result">'+$(s,t)+"...</p></a>"}),C+="</li>",w.push({item:C,searchTextCount:h,hitCount:o,id:w.length})}}),1===x.length&&""===x[0]?r.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>':0===w.length?r.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>':(w.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id}),e='<ul class="search-result-list">',w.forEach(function(t){e+=t.item}),e+="</ul>",r.innerHTML=e)}var o=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,n=document.getElementById(s),r=document.getElementById(a);n.addEventListener("input",e),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script>function addCount(n){var t=$(".leancloud_visitors"),o=t.attr("id").trim(),i=t.attr("data-flag-title").trim();n("get","/classes/Counter",{where:JSON.stringify({url:o})}).done(function({results:t}){var e;0<t.length?(e=t[0],n("put","/classes/Counter/"+e.objectId,JSON.stringify({time:{__op:"Increment",amount:1}})).done(function(){$(document.getElementById(o)).find(".leancloud-visitors-count").text(e.time+1)}).fail(function({responseJSON:t}){console.log("Failed to save Visitor num, with error message: "+t.error)})):n("post","/classes/Counter",JSON.stringify({title:i,url:o,time:1})).done(function(){$(document.getElementById(o)).find(".leancloud-visitors-count").text(1)}).fail(function(){console.log("Failed to create")})}).fail(function({responseJSON:t}){console.log("LeanCloud Counter Error: "+t.code+" "+t.error)})}$(function(){$.get("https://app-router.leancloud.cn/2/route?appId=6LNbUERxbG0OAnWfmJSbmXiW-MdYXbMMI").done(function({}){/http:\/\/(localhost|127.0.0.1|0.0.0.0)/.test(document.URL)||addCount(function(t,e,n){return $.ajax({method:t,url:"https://leancloud.qcmoke.cn/1.1"+e,headers:{"X-LC-Id":"6LNbUERxbG0OAnWfmJSbmXiW-MdYXbMMI","X-LC-Key":"d2FLy9fmXOTiM8TrokuIuDWx","Content-Type":"application/json"},data:n})})})})</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"default",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions)</script><script type="text/javascript">(wpac_init=window.wpac_init||[]).push({widget:"Rating",id:23769,el:"wpac-rating",color:"fc6423"}),function(){var e,t;"WIDGETPACK_LOADED"in window||(WIDGETPACK_LOADED=!0,(e=document.createElement("script")).type="text/javascript",e.async=!0,e.src="//embed.widgetpack.com/widget.js",(t=document.getElementsByTagName("script")[0]).parentNode.insertBefore(e,t.nextSibling))}()</script><script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],0<=(n=t.getBoundingClientRect()).top&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"left","width":80,"height":130},"mobile":{"show":false},"log":false});</script></body></html>